Upgrading Cisco Router IOS

Get link

Facebook

Twitter

Pinterest

Email

Other Apps

May 23, 2004

Today I upgraded the flash and system RAM in my Cisco 2651XM router.  Before upgrading the router memory, I had this in place:C2600 platform with 65536 Kbytes of main memory16384K bytes of processor board System flash (Read/Write)I bought 64 MB extra main memory and 16 MB extra flash memory.  When I opened up the router, the insides looked like this diagram:

I had a single 64 MB DRAM DIMM in the "Primary memory" slot with one free.  I had no memory in the "System-code SIMM (Flash memory)" slot, since the 2651XM must ship with 16 MB on the motherboard.  Once I snapped in the extra memory, my router recognized it without any trouble, as will be seen later.I also decided to upgrade from a 12.2 release to 12.3.  My old IOS was  12.2(11)T10, which corresponded to the c2600-ik9s-mz.122-11.T10.bin image.  The 'show flash' command showed this after the memory upgrades:gill#sh flashSystem flash directory:File  Length   Name/status  1   14962584  c2600-ik9s-mz.122-11.T10.bin[14962648 bytes used, 18591784 available, 33554432 total]32768K bytes of processor board System flash (Read/Write)First I searched for a suitable IOS from the Cisco IOS Feature Navigator and Upgrade Planner tools.  I located a version of IOS which offered NetFlow and SSH v2 in the 12.3 train, 12.3(4)T4 (image c2600-a3jk9s-mz.123-4.T4.bin).  I downloaded it to a TFTP server on the same network as the router, into the TFTP server's /tftpboot directory.I did not make a copy of the existing router flash image as I already had it elsewhere for safekeeping.  Next I copied my startup-config to the TFTP server:gill#copy startup-config tftp://172.27.20.5/gill-startup-configAddress or name of remote host [172.27.20.5]?Destination filename [gill-startup-config]?!!2200 bytes copied in 0.072 secs (30556 bytes/sec)Now I was ready to copy my new flash image to the router:gill#copy tftp flashAddress or name of remote host []? 172.27.20.5Source filename []? c2600-a3jk9s-mz.123-4.T4.binDestination filename [c2600-a3jk9s-mz.123-4.T4.bin]?Accessing tftp://172.27.20.5/c2600-a3jk9s-mz.123-4.T4.bin...Erase flash: before copying? [confirm]Erasing the flash filesystem will remove all files! Continue? [confirm]Erasing device... eeeeeeeeeeeeeeee...edited...Erase of flash: completeLoading c2600-a3jk9s-mz.123-4.T4.bin from 172.27.20.5 (via FastEthernet0/1):!!!!!!!...edited...[OK - 24299960 bytes]Verifying checksum...  OK (0x5193)24299960 bytes copied in 182.832 secs (132909 bytes/sec)Next I checked to see if it was loaded:gill#sh flashSystem flash directory:File  Length   Name/status  1   24299960  c2600-a3jk9s-mz.123-4.T4.bin[24300024 bytes used, 8730120 available, 33030144 total]32768K bytes of processor board System flash (Read/Write)This looked fine, so I changed the system boot parameters to use the new image, copied the running-config to startup-config, and reloaded the router:gill#conf termEnter configuration commands, one per line.  End with CNTL/Z.gill(config)#no boot system flash c2600-ik9s-mz.122-11.T10.bingill(config)#boot system flash  c2600-a3jk9s-mz.123-4.T4.bingill(config)#exitgill#01:21:28: %SYS-5-CONFIG_I: Configured from console by consolegill#copy running-config startup-configDestination filename [startup-config]?Building configuration...[OK]gill#reloadProceed with reload? [confirm]01:22:32: %SYS-5-RELOAD: Reload requested by console.I then watched the router come up:System Bootstrap, Version 12.2(7r) [cmong 7r], RELEASE SOFTWARE (fc1)Copyright (c) 2002 by cisco Systems, Inc.C2600 platform with 131072 Kbytes of main memoryprogram load complete, entry point: 0x80008000, size: 0x172c840Self decompressing the image : ###########...edited...############ [OK]Smart Init is enabledsmart init is sizing iomem  ID            MEMORY_REQ                 TYPE00036F          0X00103980 C2651XM Dual Fast Ethernet                0X000F3BB0 public buffer pools                0X00211000 public particle poolsTOTAL:          0X00408530If any of the above Memory Requirements are"UNKNOWN", you may be using an unsupportedconfiguration or there is a software problem andsystem operation may be compromised.Rounded IOMEM up to: 5Mb.Using 3 percent iomem. [5Mb/128Mb]...edited...program load complete, entry point: 0x80008000, size: 0x172c840Self decompressing the image : ###########...edited...############ [OK]Smart Init is enabledsmart init is sizing iomem  ID            MEMORY_REQ                 TYPE00036F          0X00103980 C2651XM Dual Fast Ethernet                0X000F3BB0 public buffer pools                0X00211000 public particle poolsTOTAL:          0X00408530If any of the above Memory Requirements are"UNKNOWN", you may be using an unsupportedconfiguration or there is a software problem andsystem operation may be compromised.Rounded IOMEM up to: 5Mb.Using 3 percent iomem. [5Mb/128Mb]...edited...Cisco IOS Software, C2600 Software (C2600-A3JK9S-M), Version 12.3(4)T4,  RELEASE SOFTWARE (fc2)Technical Support: http://www.cisco.com/techsupportCopyright (c) 1986-2004 by Cisco Systems, Inc.Compiled Thu 11-Mar-04 19:57 by eaarmasImage text-base: 0x80008098, data-base: 0x8243BC1C...edited...Cisco 2651XM (MPC860P) processor (revision 0x100) with 125952K/5120K bytes of memory.Processor board ID JAE071601DV (2514262155)M860 processor: part number 5, mask 22 FastEthernet interfaces32K bytes of NVRAM.32768K bytes of processor board System flash (Read/Write)Press RETURN to get started!*Mar  1 00:00:04.695: %LINEPROTO-5-UPDOWN: Line protocol on Interface VoIP-Null0, changed state to up*Mar  1 00:00:15.280: %LINK-3-UPDOWN: Interface FastEthernet0/0, changed state to up*Mar  1 00:00:15.280: %LINK-3-UPDOWN: Interface FastEthernet0/1, changed state to up00:00:16: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/0, changed state to up00:00:16: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state to up00:00:18: %SYS-5-CONFIG_I: Configured from memory by console00:00:19: %SYS-5-RESTART: System restarted --Cisco IOS Software, C2600 Software (C2600-A3JK9S-M), Version 12.3(4)T4,  RELEASE SOFTWARE (fc2)Technical Support: http://www.cisco.com/techsupportCopyright (c) 1986-2004 by Cisco Systems, Inc.Compiled Thu 11-Mar-04 19:57 by eaarmas00:00:19: %SNMP-5-COLDSTART: SNMP agent on host gill is undergoing a cold start00:00:19: %NTP-6-RESTART: NTP process starts00:00:20: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/0, changed state to down00:00:20: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state to down00:00:21: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state to up00:00:27: %DHCP-6-ADDRESS_ASSIGN: Interface FastEthernet0/0 assigned DHCP address edited, mask 255.255.254.0, hostname gill00:00:30: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/0, changed state to up00:00:33: %NTP-5-PEERSYNC: NTP synced to peer 204.152.184.7200:00:33: %NTP-6-PEERREACH: Peer 204.152.184.72 is reachableEverything looks fine, including the time setting via NTP.  I also looked again at the flash and then the filesystem:gill>enablePassword:gill#sh flash detailedSystem flash directory:File  Length   Name/status        addr      fcksum  ccksum  1   24299960  c2600-a3jk9s-mz.123-4.T4.bin        0x40      0x5193  0x5193[24300024 bytes used, 8730120 available, 33030144 total]32768K bytes of processor board System flash (Read/Write)gill#show file systemsFile Systems:     Size(b)     Free(b)      Type  Flags  Prefixes           -           -    opaque     rw   system:       29688       26383     nvram     rw   nvram:           -           -    opaque     rw   null:           -           -    opaque     ro   xmodem:           -           -    opaque     ro   ymodem:           -           -   network     rw   tftp:*   33030144     8730120     flash     rw   flash:           -           -   network     rw   pram:           -           -   network     rw   rcp:           -           -   network     rw   scp:           -           -   network     ro   http:           -           -   network     rw   ftp:           -           -   network     ro   https:           -           -    opaque     ro   cns:My upgrade was complete!
