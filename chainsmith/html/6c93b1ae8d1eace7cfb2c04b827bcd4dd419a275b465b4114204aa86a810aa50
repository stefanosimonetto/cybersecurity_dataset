<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<script type="text/javascript">var BOOTSTRAP_VERSION ="lumen";
	var BOOTSTRAP_JS_HEAD =1;
	var BOOTSTRAP_CDN_ENABLE =0; var BOOTSTRAP_NAVBAR_TYPE =0; var BOOTSTRAP_LOGO_OPTION =0; var BOOTSTRAP_NAVBAR =1; var BootstrapInputFix =true;var BootstrapNavbarLineHeightFix =true;var BOOTSTRAP_EDT= 0; </script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Virus Bulletin :: Throwback Thursday: Macro Viruses - Part 2 (October 1999)</title>
<meta name="description" content="Everything you ever wanted to know about macro viruses but were afraid to ask! In this part: WordBasic, VBA, up/down conversion and polymorphism." />
<meta name="generator" content="concrete5 - 5.6.3.5" />
<script type="text/javascript">
var CCM_DISPATCHER_FILENAME = '/index.php';var CCM_CID = 1604;var CCM_EDIT_MODE = false;var CCM_ARRANGE_MODE = false;var CCM_IMAGE_PATH = "/concrete/images";
var CCM_TOOLS_PATH = "/index.php/tools/required";
var CCM_BASE_URL = "https://www.virusbulletin.com";
var CCM_REL = "";

</script>
<link rel="shortcut icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="/concrete/css/ccm.base.css" />
<script type="text/javascript" src="/concrete/js/jquery.js"></script>
<script type="text/javascript" src="/concrete/js/ccm.base.js"></script>
<script type="text/javascript">
var COOKIES_ALLOWED=false;
</script>
<link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure.css" />
<!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure_ie.css" /><![endif]-->
<script type="text/javascript">
var COOKIES_DISCLOSURE_HIDE_INTERVAL=10;
</script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_hide.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap-overwrites.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/members.css" />
<script type="text/javascript" src="/packages/bootstrap/js/common/prettify.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="/libraries/css/jquery.fancybox.css" />
<script type="text/javascript" src="/libraries/js/jquery.fancybox.pack.js"></script>
<link rel="stylesheet" media="screen" type="text/css" href="/files/cache/css/bootstrap/typography.css" />
<script type="text/javascript" src="/index.php/tools/packages/free_cookies_disclosure/disclosure_i18n_js"></script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_ajax_form.js"></script>
<link rel="stylesheet" type="text/css" href="/concrete/blocks/page_list/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/remo_expand/blocks/remo_expand/templates/vbexpand/view.css" />
<script type="text/javascript" src="/packages/remo_expand/js/jquery.color.js"></script>
<script type="text/javascript" src="/packages/remo_expand/js/jquery.ba-hashchange.js"></script>
<script type="text/javascript" src="/packages/remo_expand/js/remo.expand.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/blocks/search/templates/VB_global_search/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/travisn_spacer/css/ccm.tnspacer.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.js" integrity="sha256-1SFdTXlsw0RkQ+iO0E91LDshGiIbPiTYqJto0px4wds=" crossorigin="anonymous"></script>
<!--[if gte IE 9]>
<script src="/packages/bootstrap/js/common/modernizr.js"></script>
<![endif]-->

<!--[if lt IE 9]>	
	
	<script src="/packages/bootstrap/js/common/html5shiv.js"></script>
	<script src="/packages/bootstrap/js/common/respond.min.js"></script>
	
<![endif]-->
</head>
<body data-spy="scroll" data-target=".bs-sidebar">

<div class="navbar  navbar-fixed-top navbar-default  bs-docs-nav">
<div class="navbar-inner">
<div class="container"><div class="row"><div class="col-sm-4 col-md-4 logo-position-1 col-logo">
<div class="navbar-header">
<button type="button" class="navbar-toggle btn_navbar_custom">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button><div class="mobile-clearfix"></div><div class="navbar-brand navbar-brand-area"><a href="/"><img border="0" class="ccm-image-block" alt="" src="/files/4614/4535/7515/logo-big.png" width="339" height="92" /></a></div> </div>
</div><div class="col-sm-8 col-md-8 logo-position-1 col-nav"> <div class="nav-collapse collapse nav_collapse_custom navbar-collapse"> <div style="clear:both"></div>
<div class="vb-global-search-div">
<form action="/index.php/global-search-results/" method="get">
<fieldset>
<input name="search_paths[]" type="hidden" value="" />
<input name="query" type="text" class="vb-global-search" placeholder="Search site..." />
<input name="submit" type="submit" value="Search!" style="display:none" />
</fieldset>
</form>
</div>
<div class="tnSpacer" style="height:48px"></div>
<ul class="nav nav-pills"><li class=" nav-first nav-item-6299"><a href="/newsletter/" target="_self" class=" nav-first nav-item-6299 ">Newsletter</a></li><li class=" nav-item-260"><a href="/conference/" target="_self" class=" nav-item-260 ">VB Conference</a></li><li class=" nav-item-166"><a href="/testing/" target="_self" class=" nav-item-166 ">VB Testing</a></li><li class=" nav-path-selected active nav-item-160"><a href="/virusbulletin/" target="_self" class=" nav-path-selected active nav-item-160 ">Bulletin</a></li><li class=" nav-last nav-item-130"><a href="/blog/" target="_self" class=" nav-last nav-item-130 ">Blog</a></li></ul> </div>
</div>
</div><div class="clearfix"></div>
</div>
</div>
</div>
<div class="navbar-top-fixed-space "><div class="clearfix"></div></div>

<div class="container m-top-20">
<div class="row">
<div class="col-md-9 col-sm-9 col-lg-9">
<div class="titlepage" xmlns=""><div><div><h1 class="title" xmlns="http://www.w3.org/1999/xhtml"><a id="vb201506-throwback-thursday-macro-viruses-2"></a>Throwback Thursday: Macro Viruses - Part 2 (October 1999)</h1></div><div><p class="pubdate" xmlns="http://www.w3.org/1999/xhtml">2015-06-18</p></div><div><div class="authorgroup" xmlns="http://www.w3.org/1999/xhtml"><div class="author titlepage"><h3 class="author"><span class="firstname">Igor</span> <span class="surname">Muttik</span></h3><span class="orgname">AVERT Labs</span>, <span class="orgdiv">UK</span></div><b class="editedby">Editor: </b><span class="editor"><span class="firstname">Martijn</span> <span class="surname">Grooten</span></span></div></div><div><div class="abstract" xmlns="http://www.w3.org/1999/xhtml"><p class="title"><b>Abstract</b></p><p>Everything you ever wanted to know about macro viruses but were afraid to ask! In this part: WordBasic, VBA, up/down conversion and polymorphism. </p></div></div><div><p class="copyright" xmlns="http://www.w3.org/1999/xhtml"><i>Copyright &copy; 2015 Virus Bulletin</i></p></div></div><hr /></div>
<div class="ccm-remo-expand">
<div id="ccm-remo-expand-title-2272" class="ccm-remo-expand-title ccm-remo-expand-closed" data-expander-speed="200">Table of contents</div><div id="ccm-remo-expand-content-2272" class="ccm-remo-expand-content"><div class="toc"><dl><dt><span class="sect1"><a href="#id4718908"></a></span></dt><dt><span class="sect1"><a href="#id4334289">VBA3, VBA5, VBA6 and Excel Formulae</a></span></dt><dt><span class="sect1"><a href="#id3624013">Visual Basic for Applications</a></span></dt><dt><span class="sect1"><a href="#id3538625">Upconverting and Downconverting</a></span></dt><dt><span class="sect1"><a href="#id2880157">Typical Life-cycle of a Macro Virus</a></span></dt><dt><span class="sect1"><a href="#id2782413">Auto Macros</a></span></dt><dt><span class="sect1"><a href="#id3503677">Menu Items Interception and Key Shortcuts</a></span></dt><dt><span class="sect1"><a href="#id3374303">Polymorphic Macro Viruses</a></span></dt><dt><span class="sect1"><a href="#id3207265">Stealth and Encryption</a></span></dt><dt><span class="sect1"><a href="#id2660521">Password Protection</a></span></dt><dt><span class="sect1"><a href="#id3600087">Corruptions and Manual Editions</a></span></dt><dt><span class="sect1"><a href="#id3810412">Remnants</a></span></dt></dl></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4718908"></a></h2></div></div></div><p><span class="emphasis"><em>(This article was first published in Virus Bulletin in October 1999.)</em></span></p><p>Most of the old macro viruses work under and were written for the <span class="emphasis"><em>WinWord 6.0</em></span> macro language which is known as WordBasic. The commonness of the <span class="emphasis"><em>Word 6.0</em></span> environment at the time enabled <span class="emphasis"><em>WinWord</em></span> macro viruses to become widespread. WordBasic is based on the good old BASIC programming language but has many (hundreds) of extensions (for example to deal with documents: edit, replace string, obtain the name of current document, open new window, move cursor, etc.). </p><p><span class="emphasis"><em>WinWord 7.0 </em></span>was included in <span class="emphasis"><em>Office 95 </em></span>and it also used WordBasic. The appearance of macro viruses forced <span class="emphasis"><em>Microsoft</em></span> to release a version with some sort of protection. <span class="emphasis"><em>WinWord 7.0a</em></span> was the first <span class="emphasis"><em>MS</em></span> application to have the built-in anti-virus warning mechanism which is now present in almost all <span class="emphasis"><em>Office</em></span> applications.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4334289"></a>VBA3, VBA5, VBA6 and Excel Formulae</h2></div></div></div><p><span class="emphasis"><em>Excel 5.0</em></span> had a macro language called VBA3 (Visual Basic for Applications v.3). This was used as a prototype for VBA5 &ndash; the macro language for <span class="emphasis"><em>Office 97</em></span> applications. VBA6 is the one used in <span class="emphasis"><em>Office 2000</em></span>. For the list of new features and differences see <span class="emphasis"><em>VB</em></span>, August 1999, p.13.</p><p>Old <span class="emphasis"><em>Excel 4.0 </em></span>had formula macros. They were kept for compatibility in all later <span class="emphasis"><em>Excel</em></span> versions. There are also field viruses (e.g.XF/Paix) that use this macro language. Formula macros are written in an <span class="emphasis"><em>Excel</em></span>-specific language that has nothing in common with either WordBasic or any VBA flavour and they live in the <span class="emphasis"><em>Excel</em></span> spreadsheet&rsquo;s cells.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3624013"></a>Visual Basic for Applications</h2></div></div></div><p>In January 1997 <span class="emphasis"><em>Microsoft</em></span> unveiled <span class="emphasis"><em>Office 97 </em></span>&ndash; it was a complete rewrite, no longer using WordBasic. In <span class="emphasis"><em>Office 97</em></span> all applications use the same macro language &ndash; VBA5 (Visual Basic for Applications). <span class="emphasis"><em>WinWord 8.0</em></span> (<span class="emphasis"><em>WinWord</em></span> in <span class="emphasis"><em>Office 97</em></span>) has an ability to convert (recompile) old macros into this new language. Many viruses can be recompiled this way resulting in completely different viruses (some of them non-viable as the convertor success rate was estimated by <span class="emphasis"><em>Microsoft</em></span> at about 90%). </p><p>Further, <span class="emphasis"><em>Microsoft</em></span> put some sort of detection of the most common viruses into the convertor to prevent their recompilation (so that, for example very common viruses like WM/Concept.A, WM/Wazzu.A and WM/Npad.A are not converted). Unfortunately, these precautions were not made in <span class="emphasis"><em>Office 97</em></span> beta releases and several viruses were upconverted to the new format by the beta software.</p><p>Another feature of <span class="emphasis"><em>Word 97</em></span> is that it produces a warning (like <span class="emphasis"><em>WinWord 7.0a</em></span>) if somebody is trying to load a document containing macros. It displays a dialog box saying &lsquo;The document you are opening contains macros or customizations. Some macros may contain viruses that could harm your computer.&rsquo; and presents three options:</p><div class="orderedlist"><ol type="1"><li><p>Disable Macros (default)</p></li><li><p>Enable Macros</p></li><li><p>Do Not Open</p></li></ol></div><p>This warning, however, can be turned off so that it will never appear again. </p><p>VBA5 is a far more complex language than WordBasic (in fact, it even includes WordBasic as a subset of its commands) and its data is stored in a file in a much more complex way. Macros written in VBA5/6 are represented in OLE2 files by two different entities &ndash; there is a compiled macro body and also compressed macro text (both are usually present in OLE2 files with macros). When macro text gets modified the macro body is recompiled from it. </p><p>Usually, both instances of a macro contain the same information (in simple terms, one is used by the VB editor, another by the VB interpreter). However, in the case of corruption this may be not true &ndash; for example, even if macro text is missing the compiled body could still be executed. Different scanners may choose to detect macro viruses in either form (compiled body or compressed text). This explains why different scanners may produce incoherent results on some corrupted samples (having, say, one form missing or damaged).</p><p>Under <span class="emphasis"><em>Office 97</em></span> all major applications use the same macro language. That means cross-application viruses are possible (see <span class="emphasis"><em>VB</em></span>, October 1998, p.9). What is more, files with PPT extensions (<span class="emphasis"><em>PowerPoint 97</em></span>) can now have macros (which previous incarnations of <span class="emphasis"><em>PowerPoint</em></span> did not have at all). Naturally, the first <span class="emphasis"><em>PowerPoint</em></span> viruses appeared after <span class="emphasis"><em>PowerPoint 97</em></span> had been released.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3538625"></a>Upconverting and Downconverting</h2></div></div></div><p><span class="emphasis"><em>Excel 97</em></span> has an ability to save spreadsheets in old <span class="emphasis"><em>Excel 5.0 </em></span>format (i.e. in VBA3). So viruses in VBA5 format can be &lsquo;downconverted&rsquo; back to VBA3 format. It is even possible to have both VBA3 and VBA5 incarnations of macros in a single spreadsheet file, recognizable by both old and new <span class="emphasis"><em>Excels</em></span>. Downconverted viruses can be upconverted again, resulting in exactly the same virus body. However, it is known that the virus&rsquo; formatting (for example, spaces, tabs and empty lines) does change. This is why, in the proper identification of <span class="emphasis"><em>Excel</em></span> viruses, these variable parts should be ignored.</p><p>Following the release of <span class="emphasis"><em>Office 2000</em></span>, macros written for <span class="emphasis"><em>Office 97</em></span> (VBA5) could be upconverted to <span class="emphasis"><em>Office 2000</em></span> (VBA6) and downconverted back to <span class="emphasis"><em>Office 97</em></span>. Any antivirus scanner should be capable of automatically dealing with all differences which appear as a result of multiple up/ down-conversions. </p><p>Many viruses do not survive this (the convertor adds an empty line for every downconversion which breaks most common viruses). However, even among broken viruses a scanner should be able to find and clean the non-viable, damaged viruses.</p><p>VBA6 macros do not differ much from VBA5 ones. In fact, VBA6 includes VBA5 as a subset. Macros written for <span class="emphasis"><em>Office 97</em></span> usually work under <span class="emphasis"><em>Office 2000</em></span> while the opposite is not always true (i.e. <span class="emphasis"><em>Office 2000</em></span> is downwardly compatible with <span class="emphasis"><em>Office 97</em></span>). Decent scanners are not able to distinguish between <span class="emphasis"><em>Office 97</em></span> and <span class="emphasis"><em>Office 2000</em></span> incarnations of the same virus, performing internal mapping to cover up/ down-conversions automatically.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id2880157"></a>Typical Life-cycle of a Macro Virus</h2></div></div></div><p>The life cycle of a great majority of <span class="emphasis"><em>WinWord</em></span> macro viruses is as follows. A macro virus in a document which is being loaded gets control (for example via so-called auto macros, those which get executed automatically at certain moments; such macros are &ndash; AutoOpen, AutoClose, etc). The corresponding macro copies all the viral macros to the global template (NORMAL.DOT on a PC). NORMAL.DOT is used automatically when <span class="emphasis"><em>WinWord</em></span> starts. It contains user settings (fonts, etc) and shortcuts (key redefinitions) and it can also contain macros.</p><p>If NORMAL.DOT contains the AutoExec macro it will be executed when WinWord is started. If NORMAL.DOT contains AutoClose it will be executed every time any document is closed.</p><p>Macro viruses do not necessarily have to infect the global template (NORMAL.DOT). Some infect files directly, searching for a victim on a disk and infecting it that way. WM/Snickers and WM/Ordo use the MRU list (mostrecently- used list at the bottom of the File menu usually consisting of four items) to get the names of files to infect. Others (like the W97M/Groov family and WM/Eraser) drop their own template in <span class="emphasis"><em>WinWord</em></span>&rsquo;s template directory and may or may not also infect NORMAL.DOT. This additional template (if it is registered as an add-in) will work in exactly the same way as NORMAL.DOT and <span class="emphasis"><em>WinWord</em></span> will pick it up automatically.</p><p>In many ways, <span class="emphasis"><em>Excel</em></span> infectors are similar to <span class="emphasis"><em>Word</em></span> infectors. However, instead of infecting NORMAL.DOT, viruses written for <span class="emphasis"><em>Excel</em></span> usually drop a new startup file in the XLSTART folder. <span class="emphasis"><em>Excel</em></span> automatically picks up such dropped files when it starts. The most common name is PERSONAL.XLS (which is <span class="emphasis"><em>Excel</em></span>&rsquo;s default name for a startup file; Laroux.A uses it).</p><p>However, the name can be anything &ndash; Laroux.e uses PLDT.XLS. <span class="emphasis"><em>Excel</em></span> does not bother to check the extension so many viruses drop a file with no extension like &lsquo;BOOK1.&rsquo; (e.g. O97M/Tristate.A).</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id2782413"></a>Auto Macros</h2></div></div></div><p>Most macro viruses operate using auto macros. <span class="emphasis"><em>Word 6.0</em></span> had just a few of them (AutoOpen, AutoClose, AutoExec, AutoExit and AutoNew). VBA5/6 have many more. Apart from the old ones kept for compatibility, there are also &lsquo;event handlers&rsquo; (Document_Open, Document_Close, Workbook_Open, Workbook_BeforeClose, etc.). Event handlers should be put in special &lsquo;class&rsquo; modules to be able to work (hence the name of the first W97M virus to use event handlers &ndash; W97M/Class). </p><p>Event handlers exist only in VBA5/6 and are not present in VBA3 (<span class="emphasis"><em>Excel 5.0</em></span>). That is why many <span class="emphasis"><em>Excel 97</em></span> viruses (X97M/Hopper, for example) cannot be downconverted to <span class="emphasis"><em>Excel 5.0</em></span> (following downconversion there are no modules in the file). </p><p>In fact, probably every single field virus makes use of the &lsquo;Auto&rsquo; macros. Viruses which do not use them do exist but their chances of spreading are simply below the threshold that enables them to survive in the wild.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3503677"></a>Menu Items Interception and Key Shortcuts</h2></div></div></div><p>It is easy to modify the functionality of any <span class="emphasis"><em>Office</em></span> application by associating its menu item with a macro. For example, many viruses have the macro called FileSaveAs (in VBA it would be a function with the same name and it can be defined in any module). If this menu item is activated by a user it is the macro which gets control, pretending to be a real menu option while it copies additional viral macros to the destination file. Viruses can also remove and modify menu items (many remove the Tools/Macro item to make it impossible to check for the presence of viral macros) using the Tools/Customize functionality. </p><p>Macro viruses can attach a macro to a particular keyboard key. For example, WM/Gangsterz and WM/DLK1.a link their viral macros to frequently used keys (like space, &lsquo;e&rsquo;, &lsquo;a&rsquo;) and activate when this key is pressed. This is one of the ways macro viruses can avoid using auto-macros or menu-linked macros to get control.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3374303"></a>Polymorphic Macro Viruses</h2></div></div></div><p>There are many known polymorphic macro viruses in existence at the time of writing. A few examples include WM/FutureN, WM/Outlaw, WM/Slow, WM/Minimorph, W97M/Class.a and W97M/STP. </p><p>They all use <span class="emphasis"><em>WinWord</em></span>&rsquo;s editing abilities to modify their own macros (like replace function) before copying them. This has the effect of making the virus body variable. Another approach to hiding parts of the virus is to use document variables which are stored in a file (for example, a WordBasic program can assign a string variable A$ and then save it in a file along with macros). Such variables can contain various bits and pieces of viral code/data which are used by viral macros.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3207265"></a>Stealth and Encryption</h2></div></div></div><p>Stealth for macro viruses involves some measures to prevent the easy viewing of a virus&rsquo; source code. Normally, the host program is capable of displaying the source code of any macro or module. To prevent easy viewing, some viruses remove the Tools/Macro, File/Templates/Organizer and Visual Basic Editor menu items. Some viruses present the user with artificial, empty dialog boxes instead of real ones or produce fake errors. </p><p>Macros can be encrypted. Encrypted macros are simply stored in scrambled form (however, note that the encryption of macros does not affect the text in a document &ndash; it still is easily readable). So, there are encrypted and not encrypted macro viruses. When an encrypted macro is shown in Tools/Macro the option to edit is not available. The encryption is easy to overcome &ndash; the key to decrypt macros is in the file, so it is not a problem to scan encrypted macros for viruses. Macro encryption is also called &lsquo;macros are read-only&rsquo; because the macro editor does not allow the editing of encrypted macros.</p><p>Macros encrypted in <span class="emphasis"><em>Word 6.0 </em></span>cannot be converted to either <span class="emphasis"><em>Office 97 </em></span>or <span class="emphasis"><em>Office 2000</em></span> because the latter insists on protection being enabled on modules&rsquo; projects, not individual macros (under both applications several functions/ macros can be defined in one module).</p><p><span class="emphasis"><em>Office 97</em></span>/<span class="emphasis"><em>2000</em></span> can also use &lsquo;read-only&rsquo; macros (or, as <span class="emphasis"><em>Office</em></span> puts it, &lsquo;lock project for viewing&rsquo;). Such macros have a special flag set and cannot be edited in the Visual Basic Editor. Macros, however, are not actually encrypted in any way and macro bodies are easily accessible by any tool except the built-in macro editor.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id2660521"></a>Password Protection</h2></div></div></div><p>Entire <span class="emphasis"><em>WinWord 6.0</em></span>/<span class="emphasis"><em>7.0 </em></span>documents can be password-protected. This means that the whole file is scrambled and access to the text and macros is not possible without deciphering the file. The password is needed to access the macros and check them for viruses. However, the protection is weak and there are many shareware and freeware <span class="emphasis"><em>WinWord</em></span> password crackers around. Many contemporary scanners are able to do on-the-fly cracking of password protected documents to check them for viruses. </p><p>Under <span class="emphasis"><em>Office 97</em></span>/<span class="emphasis"><em>2000</em></span> macros are not password-protected so scanning for viruses is not only possible but easy, even when the text is protected by a password. Repair, however, might be difficult as the area protected by the password may contain references to viral macro bodies. Furthermore, encryption in <span class="emphasis"><em>Office 97</em></span>/<span class="emphasis"><em>2000</em></span> is far more advanced and cannot be cracked on-the-fly.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3600087"></a>Corruptions and Manual Editions</h2></div></div></div><p><span class="emphasis"><em>WinWord 6.0 </em></span>has buggy routines that are responsible for macro copying. As was discovered by the author, any I/O error during macro copying produces unpredicted results on the destination macro. For example, if macro virus was in a document on a floppy disk and the disk was removed when the macro copying was being performed, parts of the written copy will be corrupted without any warnings. </p><p>In fact, there are about 200 different variants of WM/Npad around and all of them (except the original virus) are the result of the natural corruption described above. Between 1997 and 1998 this natural corruption was the main source of macro viruses because many of them are able to replicate even if they are seriously corrupted (the WordBasic statement &lsquo;On Error Goto Next&rsquo; helps a lot).</p><p>In <span class="emphasis"><em>Office 97</em></span> corruptions are very rare so they are not responsible for creating new viruses. However, the availability of the Visual Basic Editor (say, via Alt+F11) makes it very easy to modify the source of any virus manually (if it is not a &lsquo;read-only&rsquo; macro). Users&rsquo; modifications to field viruses are the most common source of new variants because the vast majority of manual modifications are perfectly able to travel even when the user is attempting to &lsquo;disable&rsquo; the virus.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3810412"></a>Remnants</h2></div></div></div><p>Some macro viruses have just one macro (like WM/Wazzu, W97M/Ethan, WM/MDMA). However, many macro viruses consist of multiple macros (for example, WM/Rapi, WM/Concept and W97M/Aleja). It could and does happen that some of the macros belonging to a virus go missing. </p><p>This might happen because somebody deleted alien macros using the Tools/Macro/Delete command or some sloppy anti-virus tool that did not perform the disinfection correctly or because <span class="emphasis"><em>WinWord</em></span> hung in the middle of the macro copying operation. Whatever the reason, we get a document with the remnants of the original macro virus. Remnants occur very frequently in <span class="emphasis"><em>Word 6.0 </em></span>viruses.</p><p>In most cases, remnants no longer constitute a viable virus because some part of the original is missing. However, in some cases remnants can still be viral. Say, WM/DZT has two macros (AutoOpen, FileSaveAs in documents) &ndash; what is left can replicate if either of the two is missing. </p><p>Under <span class="emphasis"><em>Office 97</em></span>/<span class="emphasis"><em>2000</em></span> remnants are rare. The reason is that VBA5/VBA6 allows several functions (like AutoOpen) and event handlers (like Document_Close) to be present in one single module. So, there is no necessity for a virus writer to place a virus in more than one module. <span class="emphasis"><em>Office 97</em></span> viruses spanning several modules do exist but they are rare. That is why viable remnants of native W97M and X97M viruses have yet to be reported.</p></div> </div>
<div class="col-md-3 col-sm-3 col-lg-3">
<p><a href="/uploads/pdf/magazine/1999/199910-featureseries-IgorMuttik.pdf" target="_blank"><img class="ccm-image-block responsive" alt="" src="/uploads/images/buttons/pdf-download-button.jpg" onmouseover="this.src = '/uploads/images/buttons/pdf-download-button-hover.jpg'" onmouseout="this.src = '/uploads/images/buttons/pdf-download-button.jpg'" border="0" height="45" width="262"></a></p>
<div id="NDPHPBlock13359" class="NDPHPBlock">
<div style="width: 100%;"><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Tweet this!' href="https://twitter.com/share?text=Throwback Thursday: Macro Viruses - Part 2 (October 1999)&url=https://www.virusbulletin.com/virusbulletin/2015/06/throwback-thursday-macro-viruses-part-2-october-1999"><img src='/uploads/images/buttons/twitter.png' alt='twitter.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Facebook' href='https://www.facebook.com/sharer.php?u=https://www.virusbulletin.com/virusbulletin/2015/06/throwback-thursday-macro-viruses-part-2-october-1999'><img src='/uploads/images/buttons/fb.png' alt='fb.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on LinkedIn' href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.virusbulletin.com/virusbulletin/2015/06/throwback-thursday-macro-viruses-part-2-october-1999&title=Throwback Thursday: Macro Viruses - Part 2 (October 1999)"><img src='/uploads/images/buttons/linkedin.png' alt='linkedin.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Hacker News' href="https://news.ycombinator.com/submitlink?u=https://www.virusbulletin.com/virusbulletin/2015/06/throwback-thursday-macro-viruses-part-2-october-1999&t=Throwback Thursday: Macro Viruses - Part 2 (October 1999)"><img src='/uploads/images/buttons/hackernews.png' alt='hackernews.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='reddit this!' href="https://www.reddit.com/submit?url=https://www.virusbulletin.com/virusbulletin/2015/06/throwback-thursday-macro-viruses-part-2-october-1999"><img src='/uploads/images/buttons/reddit.png' alt='reddit.png' width='45' height='45' class='responsive' /></a></center></div></div></div><p> </p>
<h2>Latest articles:</h2>
<div class="ccm-page-list">
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2022/04/cryptojacking-fly-teamtnt-using-nvidia-drivers-mine-cryptocurrency/" target="_self">Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency</a>
</h3>
<div class="ccm-page-list-description">
TeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order to infiltrate organizations&rsquo; dedicated environments and transform them into attack launchpads. In this article Aditya Sood presents a new module introduced by&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/12/collector-stealer-russian-origin-credential-and-information-extractor/" target="_self">Collector-stealer: a Russian origin credential and information extractor</a>
</h3>
<div class="ccm-page-list-description">
Collector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to exfiltrate sensitive data from end-user systems and store it in its C&amp;C panels. In this article, researchers Aditya K Sood and Rohit Chaturvedi present a 360&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/06/fighting-fire-fire/" target="_self">Fighting Fire with Fire</a>
</h3>
<div class="ccm-page-list-description">
In 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and from that moment onward, was intrigued by the properties of these small pieces of self-replicating code. Joe Wells was an expert on computer viruses, was partly&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/run-your-malicious-vba-macros-anywhere/" target="_self">Run your malicious VBA macros anywhere!</a>
</h3>
<div class="ccm-page-list-description">
Kurt Natvig wanted to understand whether it&rsquo;s possible to recompile VBA macros to another language, which could then easily be &lsquo;run&rsquo; on any gateway, thus revealing a sample&rsquo;s true nature in a safe manner. In this article he explains how he recompiled&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/dissecting-design-and-vulnerabilities-azorultccpanels/" target="_self">Dissecting the design and vulnerabilities in AZORult&nbsp;C&amp;C&nbsp;panels</a>
</h3>
<div class="ccm-page-list-description">
Aditya K Sood looks at the command-and-control (C&amp;C) design of the AZORult malware, discussing his team's findings related to the C&amp;C design and some security issues they identified during the research. </div>
</div>
<p><br /><a class="btn btn-block btn-warning" href="/virusbulletin/archive">Bulletin Archive</a></p> </div>
</div>
</div>

<footer class="bs-footer" role="contentinfo">
<div class="container">
<div class="bs-social">
<div class="row ">
<div class="col-md-3">
<p><a title="About Us" href="/about-vb/about-us/">About us</a></p>
<p><a title="Contact Us" href="/about-vb/contact-us/">Contact us</a></p>
<p><a title="Advisory Board" href="/about-vb/advisory-board/">Advisory board</a></p>
<p><a title="Press" href="/about-vb/press/">Press information</a></p>
<p><a title="Security Events Calendar" href="/resources/calendar/">Security events calendar</a></p>
<p><a title="Newsletter" href="/newsletter/">Virus Bulletin newsletter</a></p> </div>
<div class="col-md-3">
<p><a title="VB Testing" href="/testing/">Testing</a></p>
<p><a title="VB100" href="/testing/vb1001/">VB100</a></p>
<p><a title="VBSpam" href="/testing/vbspam/">VBSpam</a></p>
<p><a title="VBWeb" href="/testing/vbweb/">VBWeb</a></p>
<p><a title="Consultancy Services" href="/testing/consultancy-services/">Consultancy services</a></p>
<p><a title="The Spammers' Compendium" href="/resources/spammerscompendium/">Spammers' Compendium</a></p> </div>
<div class="col-md-3">
<p><a title="VB2021 localhost" href="/conference/vb2021/">VB2021 localhost</a></p>
<p><a title="VB2020 localhost" href="/conference/vb2020/">VB2020 localhost</a></p>
<p><a title="VB2019" href="/conference/vb2019/">VB2019 (London)</a></p>
<p><a title="VB2018" href="/conference/vb2018">VB2018 (Montreal)</a></p>
<p><a title="VB2017" href="/conference/vb2017">VB2017 (Madrid)</a></p>
<p><a title="Conference Archive" href="/conference/vb-conference-archive/">Older conferences</a></p> </div>
<div class="col-md-3">
<div class="row">
<table style="float: right;" border="0">
<tbody>
<tr>
<td align="center"><a href="/rss" target="_blank"><img title="Get our blog updates" src="/uploads/images/buttons/rss-square-gray.png" alt="rss.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://twitter.com/virusbtn" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on Twitter" src="/uploads/images/buttons/twitter-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.linkedin.com/company/virus-bulletin" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on LinkedIn" src="/uploads/images/buttons/linkedin-square-gray.png" alt="linkedin.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.facebook.com/virusbulletin" target="_blank"><img title="Visit us on Facebook" src="/uploads/images/buttons/fb-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.youtube.com/user/virusbtn" target="_blank"><img title="Visit us on Youtube" src="/uploads/images/buttons/youtube-square-gray.png" alt="youtube.png" width="35" height="35" /></a></td>
</tr>
</tbody>
</table>
</div> </div>
</div>
<div class="row ">
<div class="col-md-12">
</div>
</div>
</div>
</div>
</footer>

<footer class="bs-footer2" role="contentinfo">
<div class="container">
<div class="bs-social2">
<div class="row ">
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
</div>
<div class="row ">
<div class="col-md-12">
<p style="text-align: left;">©1989-2022 Virus Bulletin.        <a title="Privacy Policy" href="/about-vb/privacy-policy/">Privacy policy</a>        <a title="Cookies" href="/about-vb/privacy-policy/cookies/">Cookies</a>        <a title="Terms and Conditions" href="/about-vb/terms-and-conditions/">Terms and Conditions</a></p> </div>
</div>
</div>
</div>
</footer>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-21876594-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-21876594-2', { 'anonymize_ip': true });
</script><script type="text/javascript" src="/libraries/js/fancybox.load.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/app.js"></script>
<div id="ccm-cookiesDisclosure" class="disclosure-bottom">
<div class="disclosure-container">
<div class="disclosure-content">
<p> We have placed cookies on your device in order to improve the functionality of this site, as outlined in our <a href="/about-vb/privacy-policy/cookies" target="_blank">cookies policy</a>. However, you may delete and block all cookies from this site and your use of the site will be unaffected. By continuing to browse this site, you are agreeing to Virus Bulletin's use of data as outlined in our <a href="/about-vb/privacy-policy/" target="_blank">privacy policy</a>.</p>
</div>
<div class="disclosure-form">
<form action="/index.php/cookies_disclosure/" method="POST">
<input type="hidden" name="allowCookies" value="1" />
<div class="button">
<input class="btn btn-info btn-sm" type="submit" name="submit" value="I understand. Don't show this message again!" />
</div>
</form>
</div>
<div class="ccm-spacer">&nbsp;</div>
</div>
</div>
</body>
</html>