Installing Sguil Using NSMNow

Get link

Facebook

Twitter

Pinterest

Email

Other Apps

December 29, 2008

In my post NSM-Friendly VMware Lab Setup I mentioned wanting to use NSMNow to install Sguil on Ubuntu 8.04 for student use in my next class.  I had tried the Securix-NSM live CD but I had not tried installing Sguil using the same project's NSMNow scripts.  I just did it:root@twsu804:/usr/local/src# wget http://www.securixlive.com/download/nsmnow/NSMnow-1.1.1.tar.gz--22:14:38--  http://www.securixlive.com/download/nsmnow/NSMnow-1.1.1.tar.gz           => `NSMnow-1.1.1.tar.gz'Resolving www.securixlive.com... 202.191.61.156Connecting to www.securixlive.com|202.191.61.156|:80... connected.HTTP request sent, awaiting response... 200 OKLength: 164,613 (161K) [application/x-gzip]100%[====================================>] 164,613       53.85K/s             22:14:42 (53.80 KB/s) - `NSMnow-1.1.1.tar.gz' saved [164613/164613]root@twsu804:/usr/local/src# tar -xzvf NSMnow-1.1.1.tar.gz NSMnow-1.1.1/NSMnow-1.1.1/NSMnow-coreNSMnow-1.1.1/RELEASE.NOTESNSMnow-1.1.1/templates/NSMnow-1.1.1/templates/lib/NSMnow-1.1.1/templates/lib/lib-console-utilsNSMnow-1.1.1/templates/init/NSMnow-1.1.1/templates/init/sancpdNSMnow-1.1.1/templates/init/snortl-newdayNSMnow-1.1.1/templates/init/snortuNSMnow-1.1.1/templates/init/pcap_agentNSMnow-1.1.1/templates/init/barnyard2NSMnow-1.1.1/templates/init/sguildNSMnow-1.1.1/templates/init/snort_agentNSMnow-1.1.1/templates/init/snortlNSMnow-1.1.1/templates/init/sancp_agentNSMnow-1.1.1/templates/rules/NSMnow-1.1.1/templates/rules/pop3.rulesNSMnow-1.1.1/templates/rules/finger.rulesNSMnow-1.1.1/templates/rules/dos.rulesNSMnow-1.1.1/templates/rules/shellcode.rulesNSMnow-1.1.1/templates/rules/dns.rulesNSMnow-1.1.1/templates/rules/attack-responses.rulesNSMnow-1.1.1/templates/rules/local.rulesNSMnow-1.1.1/templates/rules/icmp-info.rulesNSMnow-1.1.1/templates/rules/policy.rulesNSMnow-1.1.1/templates/rules/web-cgi.rulesNSMnow-1.1.1/templates/rules/ddos.rulesNSMnow-1.1.1/templates/rules/mysql.rulesNSMnow-1.1.1/templates/rules/oracle.rulesNSMnow-1.1.1/templates/rules/other-ids.rulesNSMnow-1.1.1/templates/rules/icmp.rulesNSMnow-1.1.1/templates/rules/experimental.rulesNSMnow-1.1.1/templates/rules/chat.rulesNSMnow-1.1.1/templates/rules/info.rulesNSMnow-1.1.1/templates/rules/web-attacks.rulesNSMnow-1.1.1/templates/rules/nntp.rulesNSMnow-1.1.1/templates/rules/telnet.rulesNSMnow-1.1.1/templates/rules/scan.rulesNSMnow-1.1.1/templates/rules/rservices.rulesNSMnow-1.1.1/templates/rules/web-php.rulesNSMnow-1.1.1/templates/rules/bad-traffic.rulesNSMnow-1.1.1/templates/rules/snmp.rulesNSMnow-1.1.1/templates/rules/web-coldfusion.rulesNSMnow-1.1.1/templates/rules/tftp.rulesNSMnow-1.1.1/templates/rules/ftp.rulesNSMnow-1.1.1/templates/rules/misc.rulesNSMnow-1.1.1/templates/rules/multimedia.rulesNSMnow-1.1.1/templates/rules/web-frontpage.rulesNSMnow-1.1.1/templates/rules/imap.rulesNSMnow-1.1.1/templates/rules/porn.rulesNSMnow-1.1.1/templates/rules/web-client.rulesNSMnow-1.1.1/templates/rules/netbios.rulesNSMnow-1.1.1/templates/rules/p2p.rulesNSMnow-1.1.1/templates/rules/rpc.rulesNSMnow-1.1.1/templates/rules/web-misc.rulesNSMnow-1.1.1/templates/rules/backdoor.rulesNSMnow-1.1.1/templates/rules/pop2.rulesNSMnow-1.1.1/templates/rules/exploit.rulesNSMnow-1.1.1/templates/rules/sql.rulesNSMnow-1.1.1/templates/rules/virus.rulesNSMnow-1.1.1/templates/rules/x11.rulesNSMnow-1.1.1/templates/rules/smtp.rulesNSMnow-1.1.1/templates/rules/deleted.rulesNSMnow-1.1.1/templates/rules/web-iis.rulesNSMnow-1.1.1/LICENCENSMnow-1.1.1/NSMnow.confNSMnow-1.1.1/libs/NSMnow-1.1.1/libs/barnyard2.pmNSMnow-1.1.1/libs/utils.pmNSMnow-1.1.1/libs/sguilsensor.pmNSMnow-1.1.1/libs/sguilclient.pmNSMnow-1.1.1/libs/utils.shNSMnow-1.1.1/libs/mysql.pmNSMnow-1.1.1/libs/sguiltools.pmNSMnow-1.1.1/libs/tcl.pmNSMnow-1.1.1/libs/os.pmNSMnow-1.1.1/libs/buildessential.pmNSMnow-1.1.1/libs/sguilserver.pmNSMnow-1.1.1/libs/os.shNSMnow-1.1.1/libs/snort.pmNSMnow-1.1.1/libs/sancp.pmNSMnow-1.1.1/READMENSMnow-1.1.1/INSTALLNSMnow-1.1.1/NSMnow.logNSMnow-1.1.1/run-initNSMnow-1.1.1/NSMnowNSMnow-1.1.1/README.apparmorNSMnow-1.1.1/MANUALroot@twsu804:/usr/local/src# cd NSMnow-1.1.1/root@twsu804:/usr/local/src/NSMnow-1.1.1# lsINSTALL  MANUAL       NSMnow-core  README.apparmor  templateslibs     NSMnow       NSMnow.log   RELEASE.NOTESLICENCE  NSMnow.conf  README       run-initroot@twsu804:/usr/local/src/NSMnow-1.1.1# ./NSMnow -iAllow pre-checks to install requisite packages [Y]: [2008/12/29 22:18:05] #1 - Performing NSMnow pre-checks.[2008/12/29 22:21:06] #1 - Pre-checks completed successully[2008/12/29 22:21:06] #1 - Detected platform: UBUNTU[2008/12/29 22:21:06] #1 - Action: Installing package(s).Download DirectoryPath where all downloaded files will be saved to [./source]: Source DirectoryPath where all source tarballs will be extracted to [./source]: Sensor NameA unique name given to deliniate sensors from one another [sensor1]: twsu804aSensor InterfaceEnter the interface that this sesnor will be monitoring [eth0]: eth1Configuration PathPath to where all sensor related configuration files will be stored [/etc/nsm]: Sensor Data PathPath to where all sensor captured information will be stored [/nsm/sensor_data]: Server HostHostname or IP of the server component that this sensor will connect to [localhost]: Server NameA unique name given to deliniate servers from one another [server1]: Server Data PathPath to where all server collected information will be stored [/nsm/server_data]: Server Database NameName of the sguil database which will store all sguil correlated information. [sguildb]: Server Database UserName of the user who will have access rights to the sguil database. [sguil]: Server Database PasswordPassword of the user who will have access rights to the sguil database. [password]: sguilClient UserName of the sguil client user who will have access the sguil server. [sguil]: Client PasswordPassword of the sguil client user who will have access to the sguil server. [password]: sguilServer HostHostname or IP of the server component that this client will connect to [localhost]: [2008/12/29 22:23:16] #1 - Installing package: mysql[2008/12/29 22:23:16] #1 -   Installing with: apt-get -y install mysql-server[2008/12/29 22:28:22] #1 - Installing package: tcl[2008/12/29 22:28:22] #1 -   Installing with: apt-get -y install tcl8.3 itcl3 mysqltcl tcltls tcllib tcl8.3-dev iwidgets4 tclx8.4 itk3 tcl8.4 tk8.4[2008/12/29 22:29:23] #1 - Installing package: buildessential[2008/12/29 22:29:23] #1 -   Installing with: apt-get -y install libpcre3-dev libpcap0.8-dev build-essential[2008/12/29 22:29:43] #1 - Installing package: snortDownload snort tarball? [Y]: y[2008/12/29 22:39:37] #1 -   Configuring with: ./configure --enable-perfprofiling[2008/12/29 22:40:29] #1 -   Compiling with: make[2008/12/29 22:43:50] #1 -   Installing with: make install[2008/12/29 22:44:02] #1 - Installing package: barnyard2Download barnyard2 tarball? [Y]: y[2008/12/29 22:44:29] #1 -   Configuring with: ./configure --with-tcl=/usr/lib/tcl8.3[2008/12/29 22:44:54] #1 -   Compiling with: make[2008/12/29 22:45:10] #1 -   Installing with: make install[2008/12/29 22:45:10] #1 - Installing package: sancpDownload sancp tarball? [Y]: y[2008/12/29 22:45:18] #1 -   Compiling with: make linux[2008/12/29 22:45:37] #1 -   Installing with: cp sancp /usr/local/bin[2008/12/29 22:45:37] #1 - Installing package: sguilsensorDownload sguil-sensor (sguil) package(s)? [Y]: y[2008/12/29 22:46:09] #1 -   Installing sguil-sensor binaries[2008/12/29 22:46:10] #1 - Installing package: sguilclient[2008/12/29 22:46:10] #1 -   Installing sguil-client library files[2008/12/29 22:46:10] #1 -   Installing sguil-client binary[2008/12/29 22:46:10] #1 - Installing package: sguilserver[2008/12/29 22:46:10] #1 -   Installing sguil-server library files[2008/12/29 22:46:10] #1 -   Installing sguil-server binary[2008/12/29 22:46:10] #1 - Installing package: sguiltools[2008/12/29 22:46:10] #1 -   Installing with: apt-get -y install wireshark p0f tcpflow tcpdump[2008/12/29 22:47:24] #1 - Configuring package: mysql * Stopping MySQL database server mysqld                                 [ OK ]  * Stopping MySQL database server mysqld                                 [ OK ] Reloading AppArmor profiles : done. * Starting MySQL database server mysqld                                 [ OK ]  * Checking for corrupt, not cleanly closed and upgrade needing tables.[2008/12/29 22:48:07] #1 - Configuring package: tcl[2008/12/29 22:48:10] #1 - Configuring package: buildessential[2008/12/29 22:48:10] #1 - Configuring package: snort[2008/12/29 22:48:10] #1 -   Generating snort config file: /etc/nsm/twsu804a/snort.conf[2008/12/29 22:48:11] #1 - Configuring package: barnyard2[2008/12/29 22:48:11] #1 -   Generating barnyard2 config file: /etc/nsm/twsu804a/barnyard2.conf[2008/12/29 22:48:12] #1 - Configuring package: sancp[2008/12/29 22:48:12] #1 -   Generating sancp config file: /etc/nsm/twsu804a/sancp.conf[2008/12/29 22:48:12] #1 - Configuring package: sguilsensor[2008/12/29 22:48:12] #1 -   Generating sensor agent config file(s)[2008/12/29 22:48:12] #1 - Configuring package: sguilclient[2008/12/29 22:48:12] #1 -   Generating sguil-client config file: /etc/sguil/sguil.conf[2008/12/29 22:48:12] #1 - Configuring package: sguilserver[2008/12/29 22:48:12] #1 -   Configuring AppArmor profile[2008/12/29 22:48:12] #1 -     Ensure you restart AppArmor to apply changes[2008/12/29 22:48:12] #1 -   Generating sguil-server config file: /etc/sguild/sguild.conf[2008/12/29 22:48:13] #1 -   Updating sguild init file: /etc/init.d/sguildCopy default rules file(s)? [Y]: yWhat Sensor name is to be associated with these rules [sensor1]: twsu804a[2008/12/29 22:49:20] #1 -   Creating the CA certificate[2008/12/29 22:49:22] #1 -   Creating certificate request for: server1[2008/12/29 22:49:22] #1 -   Signing server certificate for: server1[2008/12/29 22:49:22] #1 -   Adding client user "sguil" to sguil server ACL.[2008/12/29 22:49:22] #1 -   Creating database and initial user.You will need the mysql root password.Enter password: [2008/12/29 22:49:29] #1 - Configuring package: sguiltools[2008/12/29 22:49:29] #1 - Completed installing package(s) successfully.NOTE: Snort can log in either UTC or the localtime, so firstly make sure that all machines are synced together.Secondly, either set the timezone on all machines to UTC or set the timezone on all machines to the same andremove the $UTC variable from the OPTIONS variable in both /etc/init.d/snortu and /etc/init.d/snortlI decided to comment out the $UTC variable in the two scripts.  Then I started the programs.root@twsu804:/usr/local/src/NSMnow-1.1.1# ./run-init startStarting - sguil server (sguild)                                       [  OK  ]Starting - sguil: sensor snort_agent (snort_agent)                     [  OK  ]Starting - sguil: sensor pcap_agent (pcap_agent)                       [  OK  ]Starting - sguil: sensor sancp_agent (sancp_agent)                     [  OK  ]Starting - snort: IDS mode, unified output (snort_unified)             [  OK  ]  * output in /nsm/sensor_data/twsu804a, /ssn_logs, /portscansStarting - barnyard2 (barnyard2)                                       [  OK  ]  * created directory: /var/log/barnyard2  * created directory: /var/log/barnyard2/twsu804aStarting - sancp: session logging (sancpd)                             [  OK  ]  * output in /nsm/sensor_data/twsu804a/sancpStarting - snort: logging mode (snort_packetlogging)                   [  OK  ]  * output in /nsm/sensor_data/twsu804a/dailylogs/2008-12-30  * created directory: /nsm/sensor_data/twsu804a/dailylogs  * created directory: /nsm/sensor_data/twsu804a/dailylogs/2008-12-30  * disk space currently at 43%root@twsu804:/usr/local/src/NSMnow-1.1.1# At this point I could start a user terminal, type sguil.tk, and start using the Sguil console.  The only real change I made was to alter the default fonts.  I would probably consolidate the three panels into 1 as well.Very impressive!  Great work guys.Richard Bejtlich is teaching new classes in DC and Europe in 2009.  Register by 1 Jan and 1 Feb, respectively, for the best rates.
