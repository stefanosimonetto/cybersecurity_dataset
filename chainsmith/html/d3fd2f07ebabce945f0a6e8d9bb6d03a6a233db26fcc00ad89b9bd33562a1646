<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<script type="text/javascript">var BOOTSTRAP_VERSION ="lumen";
	var BOOTSTRAP_JS_HEAD =1;
	var BOOTSTRAP_CDN_ENABLE =0; var BOOTSTRAP_NAVBAR_TYPE =0; var BOOTSTRAP_LOGO_OPTION =0; var BOOTSTRAP_NAVBAR =1; var BootstrapInputFix =true;var BootstrapNavbarLineHeightFix =true;var BOOTSTRAP_EDT= 0; </script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Virus Bulletin :: Collaborative spam filtering with the hashing trick</title>
<meta name="description" content="Josh Attenberg and colleagues describe the hashing trick as an effective method for collaborative spam filtering." />
<meta name="generator" content="concrete5 - 5.6.3.5" />
<script type="text/javascript">
var CCM_DISPATCHER_FILENAME = '/index.php';var CCM_CID = 2335;var CCM_EDIT_MODE = false;var CCM_ARRANGE_MODE = false;var CCM_IMAGE_PATH = "/concrete/images";
var CCM_TOOLS_PATH = "/index.php/tools/required";
var CCM_BASE_URL = "https://www.virusbulletin.com";
var CCM_REL = "";

</script>
<link rel="shortcut icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="/concrete/css/ccm.base.css" />
<script type="text/javascript" src="/concrete/js/jquery.js"></script>
<script type="text/javascript" src="/concrete/js/ccm.base.js"></script>
<script type="text/javascript">
var COOKIES_ALLOWED=false;
</script>
<link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure.css" />
<!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure_ie.css" /><![endif]-->
<script type="text/javascript">
var COOKIES_DISCLOSURE_HIDE_INTERVAL=10;
</script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_hide.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap-overwrites.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/members.css" />
<script type="text/javascript" src="/packages/bootstrap/js/common/prettify.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="/libraries/css/jquery.fancybox.css" />
<script type="text/javascript" src="/libraries/js/jquery.fancybox.pack.js"></script>
<link rel="stylesheet" media="screen" type="text/css" href="/files/cache/css/bootstrap/typography.css" />
<script type="text/javascript" src="/index.php/tools/packages/free_cookies_disclosure/disclosure_i18n_js"></script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_ajax_form.js"></script>
<link rel="stylesheet" type="text/css" href="/concrete/blocks/page_list/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/remo_expand/blocks/remo_expand/templates/vbexpand/view.css" />
<script type="text/javascript" src="/packages/remo_expand/js/jquery.color.js"></script>
<script type="text/javascript" src="/packages/remo_expand/js/jquery.ba-hashchange.js"></script>
<script type="text/javascript" src="/packages/remo_expand/js/remo.expand.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/blocks/search/templates/VB_global_search/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/travisn_spacer/css/ccm.tnspacer.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.js" integrity="sha256-1SFdTXlsw0RkQ+iO0E91LDshGiIbPiTYqJto0px4wds=" crossorigin="anonymous"></script>
<!--[if gte IE 9]>
<script src="/packages/bootstrap/js/common/modernizr.js"></script>
<![endif]-->

<!--[if lt IE 9]>	
	
	<script src="/packages/bootstrap/js/common/html5shiv.js"></script>
	<script src="/packages/bootstrap/js/common/respond.min.js"></script>
	
<![endif]-->
</head>
<body data-spy="scroll" data-target=".bs-sidebar">

<div class="navbar  navbar-fixed-top navbar-default  bs-docs-nav">
<div class="navbar-inner">
<div class="container"><div class="row"><div class="col-sm-4 col-md-4 logo-position-1 col-logo">
<div class="navbar-header">
<button type="button" class="navbar-toggle btn_navbar_custom">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button><div class="mobile-clearfix"></div><div class="navbar-brand navbar-brand-area"><a href="/"><img border="0" class="ccm-image-block" alt="" src="/files/4614/4535/7515/logo-big.png" width="339" height="92" /></a></div> </div>
</div><div class="col-sm-8 col-md-8 logo-position-1 col-nav"> <div class="nav-collapse collapse nav_collapse_custom navbar-collapse"> <div style="clear:both"></div>
<div class="vb-global-search-div">
<form action="/index.php/global-search-results/" method="get">
<fieldset>
<input name="search_paths[]" type="hidden" value="" />
<input name="query" type="text" class="vb-global-search" placeholder="Search site..." />
<input name="submit" type="submit" value="Search!" style="display:none" />
</fieldset>
</form>
</div>
<div class="tnSpacer" style="height:48px"></div>
<ul class="nav nav-pills"><li class=" nav-first nav-item-6299"><a href="/newsletter/" target="_self" class=" nav-first nav-item-6299 ">Newsletter</a></li><li class=" nav-item-260"><a href="/conference/" target="_self" class=" nav-item-260 ">VB Conference</a></li><li class=" nav-item-166"><a href="/testing/" target="_self" class=" nav-item-166 ">VB Testing</a></li><li class=" nav-path-selected active nav-item-160"><a href="/virusbulletin/" target="_self" class=" nav-path-selected active nav-item-160 ">Bulletin</a></li><li class=" nav-last nav-item-130"><a href="/blog/" target="_self" class=" nav-last nav-item-130 ">Blog</a></li></ul> </div>
</div>
</div><div class="clearfix"></div>
</div>
</div>
</div>
<div class="navbar-top-fixed-space "><div class="clearfix"></div></div>

<div class="container m-top-20">
<div class="row">
<div class="col-md-9 col-sm-9 col-lg-9">
<div class="titlepage" xmlns=""><div><div><h1 class="title" xmlns="http://www.w3.org/1999/xhtml"><a id="vb200911-collaborative-spam-filtering"></a>Collaborative spam filtering with the hashing trick</h1></div><div><p class="pubdate" xmlns="http://www.w3.org/1999/xhtml">2009-11-01</p></div><div><div class="authorgroup" xmlns="http://www.w3.org/1999/xhtml"><div class="author titlepage"><h3 class="author"><span class="firstname">Josh</span> <span class="surname">Attenberg</span></h3><span class="orgname">Polytechnic Institute of NYU</span>, <span class="orgdiv">USA</span></div><div class="author titlepage"><h3 class="author"><span class="firstname">Kilian</span> <span class="surname">Weinberger</span></h3><span class="orgname">Yahoo! Research</span>, <span class="orgdiv">USA</span></div><div class="author titlepage"><h3 class="author"><span class="firstname">Alex</span> <span class="surname">Smola</span></h3><span class="orgname">Yahoo! Research</span>, <span class="orgdiv">USA</span></div><div class="author titlepage"><h3 class="author"><span class="firstname">Anirban</span> <span class="surname">Dasgupta</span></h3><span class="orgname">Yahoo! Research</span>, <span class="orgdiv">USA</span></div><div class="author titlepage"><h3 class="author"><span class="firstname">Martin</span> <span class="surname">Zinkevich</span></h3><span class="orgname">Yahoo! Research</span>, <span class="orgdiv">USA</span></div><b class="editedby">Editor: </b><span class="editor"><span class="firstname">Helen</span> <span class="surname">Martin</span></span></div></div><div><div class="abstract" xmlns="http://www.w3.org/1999/xhtml"><p class="title"><b>Abstract</b></p><p>Josh Attenberg and colleagues describe the hashing trick as an effective method for collaborative spam filtering.</p></div></div><div><p class="copyright" xmlns="http://www.w3.org/1999/xhtml"><i>Copyright &copy; 2009 Virus Bulletin</i></p></div></div><hr /></div>
<div class="ccm-remo-expand">
<div id="ccm-remo-expand-title-4163" class="ccm-remo-expand-title ccm-remo-expand-closed" data-expander-speed="200">Table of contents</div><div id="ccm-remo-expand-content-4163" class="ccm-remo-expand-content"><div class="toc"><dl><dt><span class="sect1"><a href="#id4114120"></a></span></dt><dt><span class="sect1"><a href="#id3957868">Hashing trick</a></span></dt><dt><span class="sect1"><a href="#id3909976">Personalization</a></span></dt><dt><span class="sect1"><a href="#id4342625">Experimental set-up and results</a></span></dt><dt><span class="sect1"><a href="#id3712900">The validity of hashing in email spam filtering</a></span></dt><dt><span class="sect1"><a href="#id3858848">Mitigating the actions of malicious users with hybrid hashing</a></span></dt><dt><span class="sect1"><a href="#id2497053">Conclusion</a></span></dt></dl></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4114120"></a></h2></div></div></div><p>User feedback is vital to the quality of the collaborative spam filters frequently used in open membership email systems such as <em class="productname">Yahoo! Mail </em>or <em class="productname">Gmail</em>. Users occasionally designate emails as spam or non-spam (often termed as ham), and these labels are subsequently used to train the spam filter. Although the majority of users provide very little data, as a collective the amount of training data is very large (many millions of emails per day). Unfortunately, there is substantial deviation in users&rsquo; notions of what constitutes spam and ham. Additionally, the open membership policy of these systems makes it vulnerable to users with malicious intent &ndash; spammers who wish to see their emails accepted by any spam filtration system can create accounts and use these to give malicious feedback to &lsquo;train&rsquo; the spam filter in giving their emails a free pass. When combined, these realities make it extremely difficult to assemble a single, global spam classifier.</p><p>The aforementioned problems could be avoided entirely if we could create a completely separate classifier for each user based solely on that user&rsquo;s feedback. Unfortunately, few users provide the magnitude of feedback required for this approach (many not providing any feedback at all). The number of emails labelled by an individual user approximates a power law distribution. Purely individualized classifiers offer the possibility of excellent performance to a few users with many labelled emails, at the expense of the great many users whose classifiers will become unreliable due to a lack of training data.</p><p>This article illustrates a simple and effective technique that is able to balance the wide coverage provided by a global spam filter with the flexibility provided by personalized filters. By using ideas from multi-task learning, we build a hybrid method that combines both global and personalized filters. By training both the collection of personal and global classifiers simultaneously we are able to accommodate the idiosyncrasies of each user, as well as provide a global classifier for users that label few emails. In fact, as is well known in multi-task learning [<span class="citation"><a href="#citation.1">1</a></span>], in addition to improving the experience of users who label many examples, this multi-task learning approach actually mitigates the impact of malicious users on the global filter. By offering specific consideration to the intents of the most active and unusual users, a global classifier is created that focuses on the truly common aspects of the classification problem. The end result is improved classifier performance for everyone, including users who label relatively few emails.</p><p>With large-scale open membership email systems such as <em class="productname">Yahoo! Mail</em>, one of the main hurdles to a hybrid personal/global spam filter is the enormous amount of memory required to store individual classifiers for every user. We circumvent this obstacle with the use of the hashing trick [<span class="citation"><a href="#citation.2">2</a></span>], [<span class="citation"><a href="#citation.3">3</a></span>]. The hashing trick allows a fixed amount of memory to store all of the parameters for all the personal classifiers and a global classifier by mapping all personal and global features into a single low-dimensional feature space, in a way which bounds the required memory independently of the input. In this space, a single parameter vector, <span class="emphasis"><em>w</em></span>, is trained which captures both global spam activity and the individual aspects of all active users. Feature hashing provides an extremely simple means of dimensionality reduction, eliminating the large word-to-dimension dictionary data structure typically needed for text-based classification, providing substantial savings in both complexity and available system memory.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3957868"></a>Hashing trick</h2></div></div></div><p>The standard way to represent instances (i.e. emails) in text classification is the so-called bag-of-words approach. This method assumes the existence of a dictionary that contains all possible words and represents an email as a very large vector, <span class="bold"><strong><span class="emphasis"><em>x</em></span></strong></span>, with as many entries as there are words in the dictionary. For a specific email, the <span class="emphasis"><em>i</em></span>th entry in the vector contains the number of occurrences of word <span class="emphasis"><em>i</em></span> in the email. Naturally, this method lends itself to very sparse representations of instances and examples &ndash; as the great majority of words do not appear in any specific text, almost all entries in the data vectors are zero. However, when building a classifier one often has to maintain information on all words in the entire corpus (e.g. in a weight vector), and this can become unmanageable in large corpora.</p><p>The hashing trick is a dimensionality reduction technique used to give traditional learning algorithms a foothold in high dimensional input spaces (i.e. in settings with large dictionaries), by reducing the memory footprint of learning, and reducing the influence of noisy features.</p><p>The main idea behind the hashing trick is simple and intuitive: instead of generating bag-of-word feature vectors through a dictionary that maps tokens to word indices, one uses a hash function that hashes words directly into a feature vector of size <span class="emphasis"><em>b</em></span>. The hash function <span class="emphasis"><em>h</em></span> : {<span class="emphasis"><em>Strings</em></span>} &rarr; [1..<span class="emphasis"><em>b</em></span>] operates directly on strings and should be approximately uniform. (<span class="emphasis"><em>For the experiments in this paper we used a public domain implementation of a hash function from http://burtleburtle.net/bob/hash/doobs.html</em></span>.)</p><p>In [<span class="citation"><a href="#citation.3">3</a></span>] we propose using a second independent hash function &xi; : {<span class="emphasis"><em>Strings</em></span>} &rarr; {-1, 1}, that determines whether the particular hashed dimension of a token should be incremented or decremented. This causes the hashed feature vectors to be unbiased, since the expectation of the noise for any entry is zero. The algorithm below shows a pseudo-code implementation of the hashing trick that generates a hashed bag-of-words feature vector for an email:</p><pre class="programlisting">hashingtrick([string] <span class="emphasis"><em>email</em></span>)
<span class="bold"><strong><span class="emphasis"><em> x</em></span></strong></span> = <span class="bold"><strong><span class="emphasis"><em>0</em></span></strong></span>
<span class="bold"><strong> for</strong></span> <span class="emphasis"><em>word</em></span> <span class="bold"><strong>in</strong></span> <span class="emphasis"><em>email</em></span> <span class="bold"><strong>do</strong></span>
<span class="emphasis"><em>  i</em></span> = <span class="emphasis"><em>h</em></span>(<span class="emphasis"><em>word</em></span>)
<span class="bold"><strong><span class="emphasis"><em>  x<sub>i</sub></em></span></strong></span> = <span class="bold"><strong><span class="emphasis"><em>x<sub>i</sub></em></span></strong></span> + &xi;(<span class="emphasis"><em>word</em></span>)
<span class="bold"><strong> end for</strong></span>
<span class="bold"><strong>return <span class="emphasis"><em>x</em></span></strong></span></pre><p>The key point behind this hashing is that every hashed feature effectively represents an infinite number of unhashed features. It is the mathematical equivalent of a group of homographs (e.g. lie and lie) or homophones (e.g. you&rsquo;re and your) - words with different meanings that look or sound alike. It is important to realize that having two meanings of the same feature is no more and no less of an issue than a homograph or homophone: if a computer can guess the meaning of the feature, or more importantly, the impact of the feature on the label of the message, it will change its decision based upon the feature. If not, then it will try to make its decision based on the rest of the email. The wonderful thing about hashing is that instead of trying to cram a lot of different conflicting meanings into short words as humans do, we are trying to randomly spread the meanings evenly into over a million different features in our hashed language. So, although a word like &lsquo;antidisestablishmentarianism&rsquo; might accidentally run into &lsquo;the&rsquo;, our hashing function is a lot less likely to make two meaningful words homographs in our hashed language than those already put there by human beings.</p><p>Of course there are so many features in our hashed language, that in the context of spam detection most features won&rsquo;t mean anything at all.</p><p>In the context of email spam filtering, the hashing trick by itself has several great advantages over the traditional dictionary-based bag-of-words method: 1. It considers even low-frequency tokens that might traditionally be ignored to keep the dictionary manageable - this is especially useful in view of attacks by spammers using rare variants of words (e.g. misspellings like &lsquo;viogra&rsquo;). 2. Hashing the terms makes a classifier agnostic to changes in the set of terms used, and if the spam classifier is used in an online setting, the hashing trick equips the classifier with a dictionary of effectively infinite size, which helps it adapt naturally to changes in the language of spam and ham. 3. By associating many raw words in its &lsquo;infinite&rsquo; dictionary (most of which never occur) with a single parameter, the meaning of this parameter changes depending upon which words are common, rare, or absent from the corpus.</p><p>So, how large a language can this hashing trick handle? As we show in the next section, if it allows us to &lsquo;square&rsquo; the number of unhashed features we may possibly see, it could help us handle personalization.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3909976"></a>Personalization</h2></div></div></div><p>As the hashing trick frees up a lot of memory, the number of parameters a spam classifier can manage increases. In fact, we can train multiple classifiers which &lsquo;share&rsquo; the same parameter space [<span class="citation"><a href="#citation.3">3</a></span>]. For a set of users, <span class="emphasis"><em>U</em></span>, and a dictionary size <span class="emphasis"><em>d</em></span>, our goal is to train one global classifier, <span class="bold"><strong><span class="emphasis"><em>w<sub>0</sub></em></span></strong></span>, that is shared amongst all users and one local classifier, <span class="bold"><strong><span class="emphasis"><em>w<sub>u</sub></em></span></strong></span>, for each user <span class="emphasis"><em>u</em></span> &isin; <span class="emphasis"><em>U</em></span>. In a system with | <span class="emphasis"><em>U</em></span> | users, we need |<span class="emphasis"><em>U</em></span> | + 1 classifiers. When an email arrives, it is classified by the combination of the recipient&rsquo;s local classifier and the global classifier <span class="bold"><strong><span class="emphasis"><em>w<sub>0</sub></em></span></strong></span> + <span class="bold"><strong><span class="emphasis"><em>w<sub>u</sub></em></span></strong></span><sub> </sub>&ndash; we call this the hybrid classifier. Traditionally, this goal would be very hard to achieve, as each classifier <span class="bold"><strong><span class="emphasis"><em>w<sub>u</sub></em></span></strong></span> has <span class="emphasis"><em>d</em></span> parameters, and hence the total number of parameters we need to store becomes (| <span class="emphasis"><em>U</em></span> | + 1)<span class="emphasis"><em>d</em></span>. Systems like <em class="productname">Yahoo! Mail</em> handle billions of emails for hundreds of millions of users per day. With millions of users and millions of words, storing all vectors would require hundreds of terabytes of parameters. Further, to load the appropriate classifier for any given user in time when an email arrives would be prohibitively expensive.</p><p>The hashing trick provides a convenient solution to the aforementioned complexity, allowing us to perform personalized and global spam filtration in a single hashed bag-of-words representation. Instead of training | <span class="emphasis"><em>U</em></span> | + 1 classifiers, we train a single classifier with a very large feature space. For each email, we create a personalized bag of words by concatenating the recipient&rsquo;s user id to each word of the email (we use the &ordm; symbol to indicate string concatenation), and add to this the traditional global bag of words. All the elements in these bags are hashed into one of <span class="emphasis"><em>b</em></span> buckets to form a <span class="emphasis"><em>b</em></span>-dimensional representation of the email, which is then fed into the classifier. Effectively, this process allows | <span class="emphasis"><em>U</em></span> | +1 classifiers to share a <span class="emphasis"><em>b</em></span>-dimensional parameter space nicely [<span class="citation"><a href="#citation.3">3</a></span>]. It is important to point out that the one classifier <span class="bold"><strong><span class="emphasis"><em>x</em></span></strong></span> &ndash; over <span class="emphasis"><em>b</em></span> hashed features &ndash; is trained <span class="emphasis"><em>after</em></span> hashing. Because <span class="emphasis"><em>b</em></span> will be much smaller than <span class="emphasis"><em>d</em></span> &times; | <span class="emphasis"><em>U</em></span> |, there will be many hash collisions.</p><p>However, because of the sparsity and high redundancy of each email, we can show that the theoretical number of possible collisions does not really matter for most of the emails.</p><p>Moreover, because the classifier is aware of any collisions before the weights are learned, the classifier is not likely to put weights of high magnitude on features with an ambiguous meaning.</p><div class="figure"><a id="figure.1"></a><div class="mediaobject"><img alt="Global/personal hybrid spam filtering with feature hashing." src="/uploads/images/figures/2009/11/attenberg-fig1.gif" /></div><p class="title"><b>Figure&nbsp;1.&nbsp;Global/personal hybrid spam filtering with feature hashing.</b></p></div><p>Intuitively, the weights on the individualized tokens (i.e. those that are concatenated with the recipient&rsquo;s id) indicate the personal eccentricities of the particular users. Imagine for example that user &lsquo;barney&rsquo; likes emails containing the word &lsquo;viagra&rsquo;, whereas the majority of users do not. The personalized hashing trick will learn that &lsquo;viagra&rsquo; itself is a spam indicative word, whereas &lsquo;BARNEY_viagra&rsquo; is not. The entire process is illustrated in <a href="#figure.1">Figure 1</a>. See the algorithm below for details on a pseudo-code implementation of the personalized hashing trick. Note that with the personalized hashing trick, using a hash function <span class="emphasis"><em>h</em></span> : {<span class="emphasis"><em>Strings</em></span>} &rarr; [1..<span class="emphasis"><em>b</em></span>], we only require <span class="emphasis"><em>b</em></span> parameters independent of how many users or words appear in our system.</p><pre class="programlisting">personalized_hashingtrick(string <span class="emphasis"><em>userid</em></span>, [string] <span class="emphasis"><em>email</em></span>)
<span class="bold"><strong><span class="emphasis"><em> x</em></span></strong></span> = <span class="bold"><strong><span class="emphasis"><em>0</em></span></strong></span>
<span class="bold"><strong> for</strong></span> <span class="emphasis"><em>word</em></span> <span class="bold"><strong>in</strong></span> <span class="emphasis"><em>email</em></span> <span class="bold"><strong>do</strong></span>
<span class="emphasis"><em>  i</em></span> = <span class="emphasis"><em>h</em></span>(<span class="emphasis"><em>word</em></span>)
<span class="bold"><strong><span class="emphasis"><em>  x<sub>i</sub></em></span></strong></span> = <span class="bold"><strong><span class="emphasis"><em>x<sub>i</sub></em></span></strong></span> + &xi;(<span class="emphasis"><em>word</em></span>)
<span class="emphasis"><em>  j</em></span> = <span class="emphasis"><em>h</em></span>(<span class="emphasis"><em>word userid</em></span>)
<span class="bold"><strong><span class="emphasis"><em>  x<sub>j</sub></em></span></strong></span> = <span class="bold"><strong><span class="emphasis"><em>x<sub>j</sub></em></span></strong></span> + &xi;(word &ordm; userid)
<span class="bold"><strong> end for
return </strong></span><span class="bold"><strong><span class="emphasis"><em>x</em></span></strong></span>
</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4342625"></a>Experimental set-up and results</h2></div></div></div><p>To assess the validity of our proposed techniques, we conducted a series of experiments on the freely distributed trec07p benchmark data set, and on a large-scale proprietary data set representing the realities of an open-membership email system. The trec data set contains 75,419 labelled and chronologically ordered emails taken from a single email server over four months in 2007 and compiled for trec spam filtering competitions [<span class="citation"><a href="#citation.4">4</a></span>]. Our proprietary data was collected over 14 days and contains <span class="emphasis"><em>n</em></span> = 3.2 million anonymized emails from | <span class="emphasis"><em>U</em></span> | = 400,000 anonymized users. Here the first ten days are used for training, and the last four days are used for experimental validation. Emails are either spam (positive) or ham (non-spam, negative). All spam filter experiments utilize the Vowpal Wabbit (VW) [<span class="citation"><a href="#citation.5">5</a></span>] linear classifier trained with stochastic gradient descent on a squared loss. Note that the hashing trick is independent of the classification scheme used; the hashing trick could apply equally well with many learning-based spam filtration solutions. To analyse the performance of our classification scheme we evaluate the spam catch rate (SCR, the percentage of spam emails detected) of our classifier at a fixed 1% ham misclassification rate (HMR, the percentage of good emails erroneously labelled as spam). We note that the proprietary nature of the latter data set precludes publishing of exact performance numbers. Instead we compare the performance to a baseline classifier, a global classifier hashed onto <span class="emphasis"><em>b</em></span> = 2<sup>26</sup> dimensions. Since 2<sup>26</sup> is far larger than the actual number of terms used, <span class="emphasis"><em>d</em></span> = 40M, we believe this is representative of full-text classification without feature hashing.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3712900"></a>The validity of hashing in email spam filtering</h2></div></div></div><p>To measure the performance of the hashing trick and the influence of aggressive dimensionality reduction on classifier quality, we compare global classifier performance to that of our baseline classifier when hashing onto spaces of dimension <span class="emphasis"><em>b</em></span> = {2<sup>18</sup>, 2<sup>20</sup>, 2<sup>22</sup>, 2<sup>24</sup>, 2<sup>26</sup>} on our proprietary data set. The results of this experiment are displayed as the blue line in <a href="#figure.2">Figure 2</a>. Note that using 2<sup>18</sup> bins results in only an 8% reduction in classifier performance, despite large numbers of hash collisions. Increasing <span class="emphasis"><em>b</em></span> to 2<sup>20</sup> improves the performance to within 3% of the baseline. Given that our data set has 40M unique tokens, this means that using a weight vector of 0.6% of the size of the full data results in approximately the same performance as a classifier using all dimensions.</p><div class="figure"><a id="figure.2"></a><div class="mediaobject"><img alt="The results of the global and hybrid classifiers applied to a large-scale real-world data set of 3.2 million emails." src="/uploads/images/figures/2009/11/attenberg-fig2.gif" /></div><p class="title"><b>Figure&nbsp;2.&nbsp;The results of the global and hybrid classifiers applied to a large-scale real-world data set of 3.2 million emails.</b></p></div><p>Previously, we have proposed using hybrid global/personal spam filtering via feature hashing as a means for effectively mitigating the effects of differing opinions of spam and ham amongst a population of email users. We now seek to verify the efficacy of these techniques in a realistic setting. On our proprietary data set, we examine the techniques illustrated in Section 3 and display the results as the red line in <a href="#figure.2">Figure 2</a>. Considering that our hybrid technique results from the cross product of | <span class="emphasis"><em>U</em></span> | = 400K users and <span class="emphasis"><em>d</em></span> = 40M tokens, a total of 16 trillion possible features, it is understandable that noise induced by collisions in the hash table adversely affects classifier performance when <span class="emphasis"><em>b</em></span> is small. As the number of hash bins grows to 2<sup>22</sup>, personalization already offers a 30% spam reduction over the baseline, despite aggressive hashing.</p><p>In any open email system, the number of emails labelled as either spam or non-spam varies greatly among users. Overall, the labelling distribution approximates a power law distribution. With this in mind, one possible explanation for the improved performance of the hybrid classifier in <a href="#figure.2">Figure 2</a> could be that we are heavily benefiting those few users with a rich set of personally labelled examples, while the masses of email users &ndash; those with few labelled examples &ndash; actually suffer. In fact, many users do not appear at all during training time and are only present in our test set. For these users, personalized features are mapped into hash buckets with weights set exclusively by other examples, resulting in some interference being added to the global spam prediction.</p><p>In Section 3, we hypothesized that using a hybrid spam classifier could mitigate the idiosyncrasies of the most active spam labellers, thereby creating a more general classifier for the remaining users, benefiting everyone. To validate this claim, we segregate users according to the number of training labels provided in our proprietary data. As before, a hybrid classifier is trained with <span class="emphasis"><em>b</em></span> = {2<sup>18</sup>, 2<sup>20</sup>, 2<sup>22</sup>, 2<sup>24</sup>, 2<sup>26</sup>} bins. The results of this experiment are seen in <a href="#figure.3">Figure 3</a>.</p><div class="figure"><a id="figure.3"></a><div class="mediaobject"><img alt="The amount of spam left in users&rsquo; inboxes, relative to the baseline. The users are binned by the amount of training data they provide." src="/uploads/images/figures/2009/11/attenberg-fig3.gif" /></div><p class="title"><b>Figure&nbsp;3.&nbsp;The amount of spam left in users&rsquo; inboxes, relative to the baseline. The users are binned by the amount of training data they provide.</b></p></div><p>Note that for small <span class="emphasis"><em>b</em></span>, it does indeed appear that the most active users benefit at the expense of those with few labelled examples. However, as<span class="emphasis"><em> b</em></span> increases, therefore reducing the noise due to hash collisions, users with no or very few examples in the training set also benefit from the added personalization. This improvement can be explained if we recall the subjective nature of spam and ham &ndash; users do not always agree, especially in the case of business emails or newsletters. Additionally, spammers may have infiltrated the data set with malicious labels. The hybrid classifier absorbs these peculiarities with the personal component, freeing the global component to truly reflect a common definition of spam and ham and leading to better overall generalization, which benefits all users.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3858848"></a>Mitigating the actions of malicious users with hybrid hashing</h2></div></div></div><p>In order to simulate the influence of deliberate noise in a controlled setting we performed additional experiments on the trec data set. We chose some percentage, <span class="emphasis"><em>mal</em></span>, of &lsquo;malicious&rsquo; users uniformly at random from the pool of email receivers, and set their email labels at random. Note that having malicious users label randomly is actually a harder case than having them label adversarially in a consistent fashion &ndash; as then the personalized spam filter could potentially learn and invert their preferences.</p><p><a href="#figure.4">Figure 4</a> presents a comparison of global and hybrid spam filters under varying loads of malicious activity and different sized hash tables. Here we set <span class="emphasis"><em>mal</em></span> &rarr; {0%, 20%, 40%}. Note that malicious activity does indeed harm the overall spam filter performance for a fixed classifier configuration. The random nature of our induced malicious activity leads to a &lsquo;background noise&rsquo; occurring in many bins of our hash table, increasing the harmful nature of collisions. Both global and hybrid classifiers can mitigate this impact somewhat if the number of hash bins <span class="emphasis"><em>b</em></span> is increased. In short, with malicious users, both global (dashed line) and hybrid (solid line) classifiers require more hash bins to achieve near-optimum performance. Since the hybrid classifier has more tokens, the number of hash collisions is also correspondingly larger. Given a large enough number of hash bins, the hybrid classifier clearly outperforms the single global classifier under the malicious settings. We do not include the results of a pure local approach, as the performance is abysmal for many users due to a lack of training data.</p><div class="figure"><a id="figure.4"></a><div class="mediaobject"><img alt="The influence of the number of hash bins on global and hybrid classifier performance with varying percentages of malicious users." src="/uploads/images/figures/2009/11/attenberg-fig4.gif" /></div><p class="title"><b>Figure&nbsp;4.&nbsp;The influence of the number of hash bins on global and hybrid classifier performance with varying percentages of malicious users.</b></p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id2497053"></a>Conclusion</h2></div></div></div><p>This work demonstrates the hashing trick as an effective method for collaborative spam filtering. It allows spam filtering without the necessity of a memory-consuming dictionary and strictly bounds the overall memory required by the classifier. Further, the hashing trick allows the compression of many (thousands of) classifiers into a single, finite-sized weight vector. This allows us to run personalized and global classification together with very little additional computational overhead. We provide strong empirical evidence that the resulting classifier is more robust against noise and absorbs individual preferences that are common in the context of open-membership spam classification.</p><div class="bibliography"><div class="titlepage"><div><div><h3 class="title"><a class="chapter" id="id2445282"></a>Bibliography</h3></div></div></div><div class="bibliomixed"><a id="citation.1"></a><p class="bibliomixed">[1] Caruana, R. Algorithms and applications for multitask learning. Proc. Intl. Conf. Machine Learning, pp.87&ndash;95. Morgan Kaufmann, 1996. </p></div><div class="bibliomixed"><a id="citation.2"></a><p class="bibliomixed">[2] Attenberg, J.; Weinberger, K.; Dasgupta, A.; Smola. A.; Zinkevich, M. Collaborative email-spam filtering with the hashing trick. Proceedings of the Sixth Conference on Email and Spam, CEAS 2009, 2009.</p></div><div class="bibliomixed"><a id="citation.3"></a><p class="bibliomixed">[3] Weinberger, K.; Dasgupta, A.; Attenberg, J.; Langford, J.; Smola, A. Feature hashing for large scale multitask learning. ICML, 2009. </p></div><div class="bibliomixed"><a id="citation.4"></a><p class="bibliomixed">[4] Cormack, G. TREC 2007 spam track overview. The Sixteenth Text REtrieval Conference (TREC 2007) Proceedings, 2007. </p></div><div class="bibliomixed"><a id="citation.5"></a><p class="bibliomixed">[5] Langford, J.; Li, L.; Strehl, A. Vowpal Wabbit online learning project. <span class="bibliosource"><a href="http://hunch.net/?p=309" target="_blank">http://hunch.net/?p=309</a></span>, 2007.</p></div></div></div> </div>
<div class="col-md-3 col-sm-3 col-lg-3">
<div id="NDPHPBlock13359" class="NDPHPBlock">
<div style="width: 100%;"><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Tweet this!' href="https://twitter.com/share?text=Collaborative spam filtering with the hashing trick&url=https://www.virusbulletin.com/virusbulletin/2009/11/collaborative-spam-filtering-hashing-trick"><img src='/uploads/images/buttons/twitter.png' alt='twitter.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Facebook' href='https://www.facebook.com/sharer.php?u=https://www.virusbulletin.com/virusbulletin/2009/11/collaborative-spam-filtering-hashing-trick'><img src='/uploads/images/buttons/fb.png' alt='fb.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on LinkedIn' href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.virusbulletin.com/virusbulletin/2009/11/collaborative-spam-filtering-hashing-trick&title=Collaborative spam filtering with the hashing trick"><img src='/uploads/images/buttons/linkedin.png' alt='linkedin.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Hacker News' href="https://news.ycombinator.com/submitlink?u=https://www.virusbulletin.com/virusbulletin/2009/11/collaborative-spam-filtering-hashing-trick&t=Collaborative spam filtering with the hashing trick"><img src='/uploads/images/buttons/hackernews.png' alt='hackernews.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='reddit this!' href="https://www.reddit.com/submit?url=https://www.virusbulletin.com/virusbulletin/2009/11/collaborative-spam-filtering-hashing-trick"><img src='/uploads/images/buttons/reddit.png' alt='reddit.png' width='45' height='45' class='responsive' /></a></center></div></div></div><p> </p>
<h2>Latest articles:</h2>
<div class="ccm-page-list">
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2022/04/cryptojacking-fly-teamtnt-using-nvidia-drivers-mine-cryptocurrency/" target="_self">Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency</a>
</h3>
<div class="ccm-page-list-description">
TeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order to infiltrate organizations&rsquo; dedicated environments and transform them into attack launchpads. In this article Aditya Sood presents a new module introduced by&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/12/collector-stealer-russian-origin-credential-and-information-extractor/" target="_self">Collector-stealer: a Russian origin credential and information extractor</a>
</h3>
<div class="ccm-page-list-description">
Collector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to exfiltrate sensitive data from end-user systems and store it in its C&amp;C panels. In this article, researchers Aditya K Sood and Rohit Chaturvedi present a 360&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/06/fighting-fire-fire/" target="_self">Fighting Fire with Fire</a>
</h3>
<div class="ccm-page-list-description">
In 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and from that moment onward, was intrigued by the properties of these small pieces of self-replicating code. Joe Wells was an expert on computer viruses, was partly&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/run-your-malicious-vba-macros-anywhere/" target="_self">Run your malicious VBA macros anywhere!</a>
</h3>
<div class="ccm-page-list-description">
Kurt Natvig wanted to understand whether it&rsquo;s possible to recompile VBA macros to another language, which could then easily be &lsquo;run&rsquo; on any gateway, thus revealing a sample&rsquo;s true nature in a safe manner. In this article he explains how he recompiled&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/dissecting-design-and-vulnerabilities-azorultccpanels/" target="_self">Dissecting the design and vulnerabilities in AZORult&nbsp;C&amp;C&nbsp;panels</a>
</h3>
<div class="ccm-page-list-description">
Aditya K Sood looks at the command-and-control (C&amp;C) design of the AZORult malware, discussing his team's findings related to the C&amp;C design and some security issues they identified during the research. </div>
</div>
<p><br /><a class="btn btn-block btn-warning" href="/virusbulletin/archive">Bulletin Archive</a></p> </div>
</div>
</div>

<footer class="bs-footer" role="contentinfo">
<div class="container">
<div class="bs-social">
<div class="row ">
<div class="col-md-3">
<p><a title="About Us" href="/about-vb/about-us/">About us</a></p>
<p><a title="Contact Us" href="/about-vb/contact-us/">Contact us</a></p>
<p><a title="Advisory Board" href="/about-vb/advisory-board/">Advisory board</a></p>
<p><a title="Press" href="/about-vb/press/">Press information</a></p>
<p><a title="Security Events Calendar" href="/resources/calendar/">Security events calendar</a></p>
<p><a title="Newsletter" href="/newsletter/">Virus Bulletin newsletter</a></p> </div>
<div class="col-md-3">
<p><a title="VB Testing" href="/testing/">Testing</a></p>
<p><a title="VB100" href="/testing/vb1001/">VB100</a></p>
<p><a title="VBSpam" href="/testing/vbspam/">VBSpam</a></p>
<p><a title="VBWeb" href="/testing/vbweb/">VBWeb</a></p>
<p><a title="Consultancy Services" href="/testing/consultancy-services/">Consultancy services</a></p>
<p><a title="The Spammers' Compendium" href="/resources/spammerscompendium/">Spammers' Compendium</a></p> </div>
<div class="col-md-3">
<p><a title="VB2021 localhost" href="/conference/vb2021/">VB2021 localhost</a></p>
<p><a title="VB2020 localhost" href="/conference/vb2020/">VB2020 localhost</a></p>
<p><a title="VB2019" href="/conference/vb2019/">VB2019 (London)</a></p>
<p><a title="VB2018" href="/conference/vb2018">VB2018 (Montreal)</a></p>
<p><a title="VB2017" href="/conference/vb2017">VB2017 (Madrid)</a></p>
<p><a title="Conference Archive" href="/conference/vb-conference-archive/">Older conferences</a></p> </div>
<div class="col-md-3">
<div class="row">
<table style="float: right;" border="0">
<tbody>
<tr>
<td align="center"><a href="/rss" target="_blank"><img title="Get our blog updates" src="/uploads/images/buttons/rss-square-gray.png" alt="rss.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://twitter.com/virusbtn" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on Twitter" src="/uploads/images/buttons/twitter-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.linkedin.com/company/virus-bulletin" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on LinkedIn" src="/uploads/images/buttons/linkedin-square-gray.png" alt="linkedin.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.facebook.com/virusbulletin" target="_blank"><img title="Visit us on Facebook" src="/uploads/images/buttons/fb-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.youtube.com/user/virusbtn" target="_blank"><img title="Visit us on Youtube" src="/uploads/images/buttons/youtube-square-gray.png" alt="youtube.png" width="35" height="35" /></a></td>
</tr>
</tbody>
</table>
</div> </div>
</div>
<div class="row ">
<div class="col-md-12">
</div>
</div>
</div>
</div>
</footer>

<footer class="bs-footer2" role="contentinfo">
<div class="container">
<div class="bs-social2">
<div class="row ">
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
</div>
<div class="row ">
<div class="col-md-12">
<p style="text-align: left;">©1989-2022 Virus Bulletin.        <a title="Privacy Policy" href="/about-vb/privacy-policy/">Privacy policy</a>        <a title="Cookies" href="/about-vb/privacy-policy/cookies/">Cookies</a>        <a title="Terms and Conditions" href="/about-vb/terms-and-conditions/">Terms and Conditions</a></p> </div>
</div>
</div>
</div>
</footer>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-21876594-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-21876594-2', { 'anonymize_ip': true });
</script><script type="text/javascript" src="/libraries/js/fancybox.load.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/app.js"></script>
<div id="ccm-cookiesDisclosure" class="disclosure-bottom">
<div class="disclosure-container">
<div class="disclosure-content">
<p> We have placed cookies on your device in order to improve the functionality of this site, as outlined in our <a href="/about-vb/privacy-policy/cookies" target="_blank">cookies policy</a>. However, you may delete and block all cookies from this site and your use of the site will be unaffected. By continuing to browse this site, you are agreeing to Virus Bulletin's use of data as outlined in our <a href="/about-vb/privacy-policy/" target="_blank">privacy policy</a>.</p>
</div>
<div class="disclosure-form">
<form action="/index.php/cookies_disclosure/" method="POST">
<input type="hidden" name="allowCookies" value="1" />
<div class="button">
<input class="btn btn-info btn-sm" type="submit" name="submit" value="I understand. Don't show this message again!" />
</div>
</form>
</div>
<div class="ccm-spacer">&nbsp;</div>
</div>
</div>
</body>
</html>