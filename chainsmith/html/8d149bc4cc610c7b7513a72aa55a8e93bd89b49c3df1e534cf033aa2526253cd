<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<script type="text/javascript">var BOOTSTRAP_VERSION ="lumen";
	var BOOTSTRAP_JS_HEAD =1;
	var BOOTSTRAP_CDN_ENABLE =0; var BOOTSTRAP_NAVBAR_TYPE =0; var BOOTSTRAP_LOGO_OPTION =0; var BOOTSTRAP_NAVBAR =1; var BootstrapInputFix =true;var BootstrapNavbarLineHeightFix =true;var BOOTSTRAP_EDT= 0; </script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Virus Bulletin :: The problem of backscatter – part 1</title>
<meta name="description" content="Backscatter is one of the hot issues in the world of spam filtering. So what exactly is backscatter? Why does it occur? How do we stop it? And why can’t we do a better job of filtering it? Terry Zink explains all." />
<meta name="generator" content="concrete5 - 5.6.3.5" />
<script type="text/javascript">
var CCM_DISPATCHER_FILENAME = '/index.php';var CCM_CID = 2486;var CCM_EDIT_MODE = false;var CCM_ARRANGE_MODE = false;var CCM_IMAGE_PATH = "/concrete/images";
var CCM_TOOLS_PATH = "/index.php/tools/required";
var CCM_BASE_URL = "https://www.virusbulletin.com";
var CCM_REL = "";

</script>
<link rel="shortcut icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="/concrete/css/ccm.base.css" />
<script type="text/javascript" src="/concrete/js/jquery.js"></script>
<script type="text/javascript" src="/concrete/js/ccm.base.js"></script>
<script type="text/javascript">
var COOKIES_ALLOWED=false;
</script>
<link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure.css" />
<!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure_ie.css" /><![endif]-->
<script type="text/javascript">
var COOKIES_DISCLOSURE_HIDE_INTERVAL=10;
</script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_hide.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap-overwrites.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/members.css" />
<script type="text/javascript" src="/packages/bootstrap/js/common/prettify.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="/libraries/css/jquery.fancybox.css" />
<script type="text/javascript" src="/libraries/js/jquery.fancybox.pack.js"></script>
<link rel="stylesheet" media="screen" type="text/css" href="/files/cache/css/bootstrap/typography.css" />
<script type="text/javascript" src="/index.php/tools/packages/free_cookies_disclosure/disclosure_i18n_js"></script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_ajax_form.js"></script>
<link rel="stylesheet" type="text/css" href="/concrete/blocks/page_list/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/remo_expand/blocks/remo_expand/templates/vbexpand/view.css" />
<script type="text/javascript" src="/packages/remo_expand/js/jquery.color.js"></script>
<script type="text/javascript" src="/packages/remo_expand/js/jquery.ba-hashchange.js"></script>
<script type="text/javascript" src="/packages/remo_expand/js/remo.expand.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/blocks/search/templates/VB_global_search/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/travisn_spacer/css/ccm.tnspacer.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.js" integrity="sha256-1SFdTXlsw0RkQ+iO0E91LDshGiIbPiTYqJto0px4wds=" crossorigin="anonymous"></script>
<!--[if gte IE 9]>
<script src="/packages/bootstrap/js/common/modernizr.js"></script>
<![endif]-->

<!--[if lt IE 9]>	
	
	<script src="/packages/bootstrap/js/common/html5shiv.js"></script>
	<script src="/packages/bootstrap/js/common/respond.min.js"></script>
	
<![endif]-->
</head>
<body data-spy="scroll" data-target=".bs-sidebar">

<div class="navbar  navbar-fixed-top navbar-default  bs-docs-nav">
<div class="navbar-inner">
<div class="container"><div class="row"><div class="col-sm-4 col-md-4 logo-position-1 col-logo">
<div class="navbar-header">
<button type="button" class="navbar-toggle btn_navbar_custom">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button><div class="mobile-clearfix"></div><div class="navbar-brand navbar-brand-area"><a href="/"><img border="0" class="ccm-image-block" alt="" src="/files/4614/4535/7515/logo-big.png" width="339" height="92" /></a></div> </div>
</div><div class="col-sm-8 col-md-8 logo-position-1 col-nav"> <div class="nav-collapse collapse nav_collapse_custom navbar-collapse"> <div style="clear:both"></div>
<div class="vb-global-search-div">
<form action="/index.php/global-search-results/" method="get">
<fieldset>
<input name="search_paths[]" type="hidden" value="" />
<input name="query" type="text" class="vb-global-search" placeholder="Search site..." />
<input name="submit" type="submit" value="Search!" style="display:none" />
</fieldset>
</form>
</div>
<div class="tnSpacer" style="height:48px"></div>
<ul class="nav nav-pills"><li class=" nav-first nav-item-6299"><a href="/newsletter/" target="_self" class=" nav-first nav-item-6299 ">Newsletter</a></li><li class=" nav-item-260"><a href="/conference/" target="_self" class=" nav-item-260 ">VB Conference</a></li><li class=" nav-item-166"><a href="/testing/" target="_self" class=" nav-item-166 ">VB Testing</a></li><li class=" nav-path-selected active nav-item-160"><a href="/virusbulletin/" target="_self" class=" nav-path-selected active nav-item-160 ">Bulletin</a></li><li class=" nav-last nav-item-130"><a href="/blog/" target="_self" class=" nav-last nav-item-130 ">Blog</a></li></ul> </div>
</div>
</div><div class="clearfix"></div>
</div>
</div>
</div>
<div class="navbar-top-fixed-space "><div class="clearfix"></div></div>

<div class="container m-top-20">
<div class="row">
<div class="col-md-9 col-sm-9 col-lg-9">
<div class="titlepage" xmlns=""><div><div><h1 class="title" xmlns="http://www.w3.org/1999/xhtml"><a id="sb200809-backscatter-1"></a>The problem of backscatter &ndash; part 1</h1></div><div><p class="pubdate" xmlns="http://www.w3.org/1999/xhtml">2008-09-01</p></div><div><div class="authorgroup" xmlns="http://www.w3.org/1999/xhtml"><div class="author titlepage"><h3 class="author"><span class="firstname">Terry</span> <span class="surname">Zink</span></h3><span class="orgname">Microsoft</span>, <span class="orgdiv">USA</span></div><b class="editedby">Editor: </b><span class="editor"><span class="firstname">Helen</span> <span class="surname">Martin</span></span></div></div><div><div class="abstract" xmlns="http://www.w3.org/1999/xhtml"><p class="title"><b>Abstract</b></p><p>Backscatter is one of the hot issues in the world of spam filtering. So what exactly is backscatter? Why does it occur? How do we stop it? And why can&rsquo;t we do a better job of filtering it? Terry Zink explains all.</p></div></div><div><p class="copyright" xmlns="http://www.w3.org/1999/xhtml"><i>Copyright &copy; 2008 Virus Bulletin</i></p></div></div><hr /></div>
<div class="ccm-remo-expand">
<div id="ccm-remo-expand-title-4520" class="ccm-remo-expand-title ccm-remo-expand-closed" data-expander-speed="200">Table of contents</div><div id="ccm-remo-expand-content-4520" class="ccm-remo-expand-content"><div class="toc"><dl><dt><span class="sect1"><a href="#id4770936"></a></span></dt><dt><span class="sect1"><a href="#id3493619">The legitimate case</a></span></dt><dt><span class="sect1"><a href="#id4223222">When should bounces be sent?</a></span></dt><dt><span class="sect1"><a href="#id2966818">How DSNs should be formatted&hellip; according to the RFC</a></span></dt><dt><span class="sect1"><a href="#id2348093">Format of a Delivery Status Notification</a></span></dt><dt><span class="sect1"><a href="#id3207462">So what is backscatter?</a></span></dt><dt><span class="sect1"><a href="#id4320105">Why is it so hard to block?</a></span></dt><dt><span class="sect1"><a href="#id3617941">Summary</a></span></dt></dl></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4770936"></a></h2></div></div></div><p>Have you ever received a message in your inbox informing you that an email you sent was undeliverable, and yet when you looked at the message that failed to be delivered, you saw that it contained spam &ndash; and in fact you hadn&rsquo;t sent it? Such notifications are known as backscatter, and backscatter is one of the hot issues in the world of spam filtering. So what exactly is backscatter? Why does it occur? How do we stop it? And why can&rsquo;t we do a better job of filtering it?</p><p>These are some of the questions that I will answer in this two-part article (part 2 will appear in next month&rsquo;s issue of <span class="emphasis"><em>VB</em></span>).</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3493619"></a>The legitimate case</h2></div></div></div><p>Before getting into the problem of backscatter, let&rsquo;s look at how the system was intended to work before spammers ruined it for everyone.</p><p>Let&rsquo;s imagine that you want to mail a letter to your friend. You write the letter, put it in an envelope, and write your friend&rsquo;s address in the centre of the front of the envelope. You then put your own address on the top left-hand corner of the envelope, put a stamp on the top right-hand corner, walk to the nearest mailbox and drop the envelope in the slot. A post office representative comes, picks up the letter and then through some seemingly magical process, your friend receives the letter a few days later.</p><p>But suppose there is a problem. Let&rsquo;s say you write the letter to your friend and address it this way: </p><pre class="programlisting">Homer Simpson
771 Evergreen Terrace
Springfield, USA</pre><p>Aside from the fact that Homer lives at 742 Evergreen Terrace (or 743 depending on the episode), you have specified neither the state nor the zip code at which Homer lives. The post office is unable to deliver your letter so they mark it and return it to you (since you put your return address at the top of the envelope). On the letter, they put a notice such as &lsquo;Bad address&rsquo; or &lsquo;Insufficient postage&rsquo; or something similar. In other words, they mark the message as undeliverable.</p><p>Email works in the same way. You write an email, put your name and email address in the P1 From field (SMTP MAIL FROM) and address it to your friend, whose address you put in the P2 From field (SMTP RCPT TO). You hit &lsquo;send&rsquo; in your email client and by a seemingly magical process your email is delivered to your friend in a matter of seconds.</p><p>But what happens if there is a typo in your friend&rsquo;s email address? Just like the post office, the email postmaster has ways of letting you know that your message was unable to be delivered. Suppose Homer did this:</p><pre class="programlisting">From: Homer Simpson &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5830322b3135282b3736183d20393528343d763b3735">[email&#160;protected]</a>&gt;
To: Krusty the Klown &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9df6efe8eee9e4def1f2eaf3ddf9f8f0f2f3eee9effce9f4f2f3b3fef2f0">[email&#160;protected]</a>&gt;</pre><p>But Krusty&rsquo;s email address is actually krusty<span class="bold"><strong>K</strong></span><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="214d4e564f6145444c4e4f5255534055484e4f0f424e4c0f">[email&#160;protected]</a> Krusty&rsquo;s recipient mail server gets Homer&rsquo;s email, looks at the To: address and then tries to deliver the mail. But it sees that the email address doesn&rsquo;t exist so it sends a notification back to Homer that the message could not be delivered because the email address that he specified was invalid. This is known as a Non-Deliverable Receipt (NDR) or a Delivery Status Notification (DSN). Suffice to say, the email postmaster Homer has been sending to has been kind enough to notify him that his message did not go through. Homer gets the NDR back in his own email inbox so he can take action on it.</p><p>That&rsquo;s the general process of how things work.</p><p>Whose server is responsible for generating a bounce message, and under what circumstances does this occur? Once Homer&rsquo;s mail server has accepted the message, it must either pass it along to Krusty&rsquo;s mail server, or else deposit a bounce message in Homer&rsquo;s mailbox.</p><p>Let us say that Homer&rsquo;s mail server passes the message on to Krusty&rsquo;s mail server (at demonstration.com), which accepts the message for delivery. Unfortunately, however, a moment later the disk space on the demonstration.com server fills up, and so the mail daemon cannot deposit the message in Krusty&rsquo;s mailbox. </p><p>The demonstration.com mail server must then send a bounce message to <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="81e9ebf2e8ecf1f2eeefc1e4f9e0ecf1ede4afe2eeec">[email&#160;protected]</a> informing Homer that his message could not be delivered to Krusty&rsquo;s mailbox.</p><p>Had the demonstration.com mail server known that the message would be undeliverable (for instance, if Krusty had no user account there) then it would not have accepted the message in the first place, and therefore would not have sent the bounce. Instead, it would have rejected the message with an SMTP error code. This would have left <span class="emphasis"><em>Homer</em></span>&rsquo;s mail server (at example.com) the obligation to create and deliver a bounce.</p><p>So, the recipient mail server does not always generate an NDR; only in some of the cases after it has accepted the message and the SMTP conversation has finished (i.e. after the DATA command) will the recipient mail server be responsible for generating an NDR. If the reject happens during the SMTP conversation, then it is the transmitting mail server that generates the bounce.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4223222"></a>When should bounces be sent?</h2></div></div></div><p>When a mail server accepts a message and later decides that it can&rsquo;t deliver the message, it is required to send a bounce notification to the sender of the original message. There are a few kinds of bounce notification that a mail server can send, which include:</p><div class="itemizedlist"><ul type="disc"><li><p>Recipient does not exist.</p></li><li><p>Recipient&rsquo;s email inbox is full.</p></li><li><p>Your mail server is on an IP blocklist and therefore the recipient&rsquo;s mail server is rejecting your mail.</p></li><li><p>Out of office notifications (not technically NDRs but close enough).</p></li></ul></div><p>For the first one, let&rsquo;s say you send a message and the recipient you are sending to does not exist; the recipient mail server lets you know by sending you a message indicating as much.</p><p>Some recipient mail servers are nice about this and they attach the original message to their email. For example, the message you get back might look something like this:</p><pre class="programlisting">Date: Fri, 27 Jun 2008 06:56:00 +0000 (UTC)
From: MAILER-DAEMON (Mail Delivery System)
Subject: Undelivered Mail Returned to Sender
To: Bob&rsquo;s Test Account &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="523026372126372012372a333f223e377c313d3f">[email&#160;protected]</a>&gt;
Reporting-MTA: dns; mail111-de3.example.com
X-Postfix-Queue-ID: CCCDA18680DA
X-Postfix-Sender: rfc822; <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9efceafbedeafbecdefbe6fff3eef2fbb0f1ecf9">[email&#160;protected]</a>
Arrival-Date: Fri, 27 Jun 2008 06:55:54 +0000 (UTC)

Final-Recipient: rfc822; <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="325046574146574072574a535f425e571c515d5f">[email&#160;protected]</a>
Action: failed
Status: 5.0.0
Diagnostic-Code: X-Postfix; host winse-6216-mail4.customer.example.com
[123.21.222.101] said: 550 5.7.1 Email rejected because recipient
<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8be9ffeef8ffeef9cbeef3eae6fbe7eea5e8e4e6">[email&#160;protected]</a> does not exist. (in reply to end of DATA command)

Subject: This is a test
From: Bob&rsquo;s Test Account &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d8baacbdabacbdaa98bda0b9b5a8b4bdf6bbb7b5">[email&#160;protected]</a>&gt;
Date: Thu, 26 Jun 2008 23:55:49 -0700
To: Bob&rsquo;s Real Account &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="462432233532233406233e272b362a2368293421">[email&#160;protected]</a>&gt;
This is a test to see if I get can generate an NDR.</pre><p>The message contains the reason the email was bounced back to Bob and the last part shows the original message (usually sent as an attachment but sometimes sent inline). Note the key characteristics of the NDR message:</p><div class="itemizedlist"><ul type="disc"><li><p>The message that arrives in your inbox is From: something that you wouldn&#39;t initially recognize like the MAILER-DAEMON, or Mail Delivery System, or something similar.</p></li><li><p>The Subject: line of the message contains the notification that your mail could not be delivered (in this case &lsquo;Undelivered Mail Returned To Sender&rsquo;).</p></li><li><p>The reason that your message could not be delivered is included in the bounce message.</p></li><li><p>Your original message is included in the bounce message.</p></li></ul></div><p>Here&rsquo;s where things get interesting. There is no set format about how NDRs should be structured. Or rather, there is no set format that everyone follows. In this case the From: address is &lsquo;Mail Delivery System&rsquo;, but it could be &lsquo;Mailer System&rsquo;, &lsquo;Recipient Mailer&rsquo;, or some other description that doesn&rsquo;t even contain the word mail. </p><p>The Subject: line could say &lsquo;Undelivered Mail&rsquo;, &lsquo;Undeliverable Mail&rsquo;, &lsquo;Your Message could not be Delivered&rsquo;, &lsquo;Delivery Status Notification&rsquo;, &lsquo;550 Status Notice&rsquo;, &lsquo;We Don&rsquo;t Know What To Do With Your Mail&rsquo;, etc. The messages are usually in a foreign language if we are in Europe. In other words, this subject line could contain a variety of messages. </p><p>The reason for the bounce, like the two cases above, could be phrased in a variety of ways, in a variety of languages.</p><p>Finally, the bounced message is usually included (although this is not always the case). It could be sent inline, it could be an attachment, or it could be truncated (i.e. a partial message). </p><p>The SMTP MAIL FROM is usually a null sender, that is the SMTP MAIL FROM is &lt; &gt;. This is legal within the SMTP protocol. An NDR is usually sent as a null sender, but not always; sometimes they are &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a9cbc6dcc7cacce9878787">[email&#160;protected]</a>&gt; or &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7f0f100c0b121e0c0b1a0d3f515151">[email&#160;protected]</a>&gt; or something similar. To make matters worse, others use null senders for non-NDR messages. This happens often with automated messages that send out reports. So, you can&rsquo;t count on NDRs to have null senders one hundred per cent of the time, and you can&rsquo;t count on null senders to be NDRs one hundred per cent of the time.</p><p>To sum up, NDRs from legitimate servers can take on a variety of forms. Everyone does it differently. </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id2966818"></a>How DSNs should be formatted&hellip; according to the RFC</h2></div></div></div><p>There is actually a specification for how DSNs should be sent; RFC 3464 specifies the content-type for Delivery Status Notifications. This isn&rsquo;t an article about the RFC specification so I shall attempt to summarize it as best I can (<span class="emphasis"><em>RFC 3464 can be found at </em></span><a href="https://tools.ietf.org/html/rfc3464" target="_blank"><span class="emphasis"><em>http://tools.ietf.org/html/rfc3464</em></span></a>).</p><p>A DSN must provide the following:</p><div class="itemizedlist"><ul type="disc"><li><p>It must be readable by humans as well as being machine-parsable.</p></li><li><p>It must provide enough information to allow message senders to associate a DSN unambiguously with the message that was sent and the original recipient address for which the DSN is issued.</p></li><li><p>It must be able to preserve the reason for the success or failure of a delivery attempt in a remote messaging system, using the &lsquo;language&rsquo; (mailbox addresses and status codes) of that remote system. </p></li><li><p>It must also be able to describe the reason for the success or failure of a delivery attempt, independent of any particular human language or of the &lsquo;language&rsquo; of any particular mail system.</p></li><li><p>It must preserve enough information to allow the maintainer of a remote MTA to understand (and if possible, reproduce) the conditions that caused a delivery failure at that MTA. </p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id2348093"></a>Format of a Delivery Status Notification</h2></div></div></div><p>A DSN is a MIME message with a top-level content-type of multipart/report. In other words, it has a Content-Type header with multitype/report following it. When a multipart/report content is used to transmit a DSN:</p><div class="orderedlist"><ol type="1"><li><p>The report-type parameter of the multipart/report content is &lsquo;delivery-status&rsquo;.</p></li><li><p>The first component of the multipart/report contains a humanly readable explanation of the DSN.</p></li><li><p>The second component of the multipart/report is of content-type message/delivery-status.</p></li><li><p>If the original message or a portion of the message is to be returned to the sender, it appears as the third component of the multipart/report.</p></li></ol></div><p>We&rsquo;ll see an example a little later on in this article.</p><p>The From: field of the message header of the DSN should contain the address of a human who is responsible for maintaining the mail system at the reporting MTA site, such as <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5b2b34282f363a282f3e291b75">[email&#160;protected]</a></p><p>The envelope sender address of the DSN should be chosen to ensure that no delivery status reports will be issued in response to the DSN itself, and must be chosen so that DSNs will not generate mail loops. Whenever an SMTP transaction is used to send a DSN, the MAIL FROM command must use a null return address, i.e. MAIL FROM: &lt; &gt;. The MAIL FROM is not to be confused with the From: field in the message headers.</p><p>At this point, I will draw to a close the summary of the proper format of an NDR. If you&rsquo;re any more interested in it, please read the RFC. The bottom line is we need to know that it&rsquo;s a bounce, the reason for the bounce and we need to see the bounce message itself. However, after having seen a lot of NDR messages, it seems to me that mail operators treat the RFC a lot like the &lsquo;Pirates&rsquo; Code&rsquo; from Pirates of the Caribbean &ndash; they&rsquo;re not really rules, they&rsquo;re more like guidelines.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3207462"></a>So what is backscatter?</h2></div></div></div><p>Having worked our way through how NDRs and DSNs are supposed to work, we can now finally look at backscatter.</p><p>According to the SMTP protocol, when you send a message, you specify the HELO, the MAIL FROM, the RCPT TO, the DATA (email contents including other miscellaneous headers) and the QUIT. Here&rsquo;s a sample email (my comments are shown in bold):</p><pre class="programlisting">HELO mail.evergreenterrace.com
MAIL FROM: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f991938a9094898a9697b99c81989489959cd79a9694">[email&#160;protected]</a>
RCPT TO: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f8938a8d8b8c81bb94978f96b89d80999588949dd6978a9f">[email&#160;protected]</a> <span class="bold"><strong>(this is wrong, it should be <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="68031a1d1b1c112304071f06280d10090518040d46071a0f">[email&#160;protected]</a>)</strong></span>
DATA

This is a sample message to generate an NDR message.
<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="49023b3c3a3d300a25263e27092c31282439252c67263b2e">[email&#160;protected]</a> does not exist, it will bounce.
.
QUIT</pre><p>The message goes out from Homer&rsquo;s web server. The mail is routed to example.org&rsquo;s mail server. Rather than looking up the email address during the SMTP conversation and rejecting the message with a 5xx level error (which would force Homer&rsquo;s email server to send the NDR), Krusty&rsquo;s email server accepts the message with a 250. Later on, however, Krusty&rsquo;s email server sees that the email address Homer sent to doesn&rsquo;t exist, so it looks at the SMTP MAIL FROM, in this case <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0b63617862667b7864654b6e736a667b676e25686466">[email&#160;protected]</a>, and sends an NDR back to Homer indicating that the message couldn&rsquo;t be delivered. </p><p>But, what if it wasn&rsquo;t Homer who sent the message? Let&rsquo;s say Nubar Q. Spammer decides to send a spam message to Krusty. What Nubar would do if he were a nice guy is put his email address in the SMTP MAIL FROM. But Nubar isn&rsquo;t about to do that. He puts Homer&rsquo;s email address in the SMTP MAIL FROM, because the SMTP protocol allows you to put any email address you want in the field (again, my comments appear in bold):</p><pre class="programlisting">HELO mail.scammers.com
MAIL FROM: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="046c6e776d6974776b6a44617c65697468612a676b69">[email&#160;protected]</a> <span class="bold"><strong>(this is not Homer, it is Nubar Q. Spammer forging Homer&rsquo;s email address)</strong></span>
RCPT TO: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="315a4344424548725d5e465f715449505c415d541f5e4356">[email&#160;protected]</a>
DATA

Get cheap Viagra!  Check out the following website to get it because you
obviously need it!
.
QUIT</pre><p>Once again, Krusty&rsquo;s email web server accepts the message with a 250 but finds that it cannot deliver it so it looks at the email address in the SMTP MAIL FROM field. In this case, it is and the mail server sends an NDR &lsquo;back&rsquo; to Homer. </p><p>Homer turns on his computer and opens up his email. He takes a look and sees the following in his email inbox (the first six lines below are the message headers and do not appear in the body content, and the text in bold are my comments): </p><pre class="programlisting"> Return-Path: &lt;&gt; <span class="bold"><strong>(MAIL FROM is often called the Return-Path&hellip; note that it  is null)</strong></span>
 Date: Tue, 8 Jul 2008 22:26:56 +0000 (UTC)
 From: MAILER-DAEMON (Mail Delivery System)
 Subject: Undelivered Mail Returned to Sender
 To: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2f645d5a5c5b566c434058416f4a574e425f434a01405d48">[email&#160;protected]</a>
 Content-Type: multipart/report; report-type=delivery-status;
 boundary=&rdquo;67A3E14185FC.1215556016/mail.example.org&rdquo; <span class="bold"><strong>(Remember this from
 the Pirate&rsquo;s Code? I mean RFC? It&rsquo;s required.)</strong></span>

 This is the Postfix program at host mail.example.org. I&rsquo;m sorry to have to
 inform you that your message could not be delivered to one or more
 recipients. It&rsquo;s attached below. For further assistance, please send mail
 to &lt;postmaster&gt;

 - The Postfix program

<span class="bold"><strong> (That&rsquo;s the human readable part)</strong></span>

 <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="87ecf5f2f4f3fec4ebe8f0e9c7e2ffe6eaf7ebe2a9e8f5e0">[email&#160;protected]</a>: host mail.example.org[292.85.201.114] said:
 550-5.1.1 The email account that you tried to reach does not exist. (in
 reply to the end of DATA command)

 <span class="bold"><strong>(That&rsquo;s the machine-parsable part, and it includes the reason why it could not be delivered)</strong></span>

 --- Below this line is a copy of the message.
 Return-Path:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="84eceef7ede9f4f7ebeac4e1fce5e9f4e8e1aae7ebe9">[email&#160;protected]</a>
 Received: (qmail 32443 invoked by uid 507); 9 Jul 2008 05:02:16 +0800
 Delivered-To: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c0abb2b5b3b4b983acafb7ae80a5b8a1adb0aca5eeafb2a7">[email&#160;protected]</a> Date: Tue, 08 Jul 2008 10:47:32 -0700
 From: Homer Simpson &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b1d9dbc2d8dcc1c2dedff1d4c9d0dcc1ddd49fd2dedc">[email&#160;protected]</a>&gt;
 To: Krusty the Klown &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="355e474046414c76595a425b75504d54584559501b5a4752">[email&#160;protected]</a>&gt;
 Subject: Get cheap viagra!
 Content-Type: text/plain; charset=ISO-8859-1; format=flowed
 Content-Transfer-Encoding: 7bit

 Get cheap Viagra! Check out the following website to get it because you
 obviously need it!</pre><p>Homer didn&rsquo;t send the message but it certainly looks like he did. In fact, Nubar Q. Spammer forged Homer&rsquo;s email address and the receiving email server sent the bounce to Homer rather than Nubar, even though Homer didn&rsquo;t send it. The result? Homer receives an NDR message with spam attached to it, and this entire type of spamming by proxy is known as <span class="emphasis"><em>backscatter</em></span>. </p><p><a href="#figure.1">Figure 1</a> illustrates the problem of backscatteron a wider scale.</p><div class="figure"><a id="figure.1"></a><div class="mediaobject"><img alt="The problem of backscatter." src="/uploads/images/figures/2008/09/BACKSCATTER.gif" /></div><p class="title"><b>Figure&nbsp;1.&nbsp;The problem of backscatter.</b></p></div><p>Getting a single piece of backscatter is one thing, getting dozens, hundreds or even thousands of them is a major problem. While spammers may be nefarious in attempting to spam indirectly, what&rsquo;s more annoying is that legitimate hosts are sending piles of messages that are cluttering up inboxes and it takes forever to sort through them all. </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4320105"></a>Why is it so hard to block?</h2></div></div></div><p>So why is backscatter so difficult to defend against? Here are some reasons:</p><div class="orderedlist"><ol type="1"><li><p>IP reputation analysis doesn&rsquo;t work &ndash; spammers who spam from botnets have a weakness: public RBLs like <em class="productname">Spamhaus</em> will list them and so content filters can reject all mail from them. In the case of backscatter, the sending mail server is not a bot and is known to send good mail so it doesn&rsquo;t belong on a blacklist (a good blacklist, anyway).</p><p>Finding sources of mail servers that send NDR backscatter exclusively is one thing, but if you ban all mail servers that send you backscatter, you will end up blocking a lot of legitimate mail.</p></li><li><p>Sender reputation doesn&rsquo;t work &ndash; or rather, regular sender reputation doesn&rsquo;t work. When most MTAs send backscatter, they usually send with an SMTP MAIL FROM as &lt; &gt;. This is so that if they send the NDR and their NDR bounces, the recipient MTA doesn&rsquo;t bounce it back again; you can&rsquo;t bounce to a null sender &lt; &gt;.</p><p>Traditional sender reputation assumes that the inbound message is coming to you directly from another sender. So you can perform an SPF check on the SMTP MAIL FROM, but since the sender is empty, you can&rsquo;t verify the source of the message. The spam filter is forced to rely on something else. </p></li><li><p>Content filtering is more difficult &ndash; NDR messages are a pain to handle. You can&rsquo;t do regular sender or IP reputation analysis on NDRs in the SMTP conversation, so you have to accept the body contents of the message. Then, if you want to do the above you need to parse the body contents of the message (and not the message headers of the NDR itself) in order to extract the information you need.</p><p>If you were to do this your spam filter would need specialized logic to recognize that the message is a bounce message and to treat it differently to extract the tokens in the message. This is trickier than it sounds because different bouncing MTAs will bounce messages differently. Remember the RFC guidelines? Hopefully, the bouncing MTA sends back the message contents including the headers. If not, or if it changes them in transit or corrupts them, header analysis is not going to work too well.</p></li><li><p>Regular content filtering is more difficult &ndash; if you don&rsquo;t want to go to the trouble of extracting many different tokens and running checks that you would normally do during the SMTP conversation (i.e. SPF or DKIM checks or IP reputation), you could default to regular content filtering. Your inbound spam filter can simply examine the message content and if there is spam, filter out the message regardless of whether or not it is an NDR.</p><p>The problem here is that often, content filters will detect the spam and mark it as spam but they will also detect that the message is a bounce and &lsquo;de-spamify&rsquo; its earlier spam classification. (<span class="emphasis"><em>&#39;De-spamify&#39; is my own term derived from the words &lsquo;spam&rsquo; and &lsquo;classify&rsquo;. To de-spamify is to reverse the judgment of a spam filter that has previously classified a message as spam. </em></span>) In other words, the filter is intelligent enough to detect that this is a bounce message and possibly legitimate, thus lowering the overall spam score of the total message with spam attached. This leads to inconsistent spam filtering of backscatter. Not all of it gets through to the user&rsquo;s inbox, but some of it does.</p></li></ol></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3617941"></a>Summary</h2></div></div></div><p>That summarizes the problem of backscatter. Relying on regular inbound mail filtering to detect and filter backscatter introduces problems because NDR messages are different from regular mail. They are notifications. In order to catch them we need a different method from those normally used to catch spam.</p><p>Next month, we&rsquo;ll look at some of the ways in which we can defend against backscatter.</p></div> </div>
<div class="col-md-3 col-sm-3 col-lg-3">
<div id="NDPHPBlock13359" class="NDPHPBlock">
<div style="width: 100%;"><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Tweet this!' href="https://twitter.com/share?text=The problem of backscatter – part 1&url=https://www.virusbulletin.com/virusbulletin/2008/09/problem-backscatter-part-1"><img src='/uploads/images/buttons/twitter.png' alt='twitter.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Facebook' href='https://www.facebook.com/sharer.php?u=https://www.virusbulletin.com/virusbulletin/2008/09/problem-backscatter-part-1'><img src='/uploads/images/buttons/fb.png' alt='fb.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on LinkedIn' href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.virusbulletin.com/virusbulletin/2008/09/problem-backscatter-part-1&title=The problem of backscatter – part 1"><img src='/uploads/images/buttons/linkedin.png' alt='linkedin.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Hacker News' href="https://news.ycombinator.com/submitlink?u=https://www.virusbulletin.com/virusbulletin/2008/09/problem-backscatter-part-1&t=The problem of backscatter – part 1"><img src='/uploads/images/buttons/hackernews.png' alt='hackernews.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='reddit this!' href="https://www.reddit.com/submit?url=https://www.virusbulletin.com/virusbulletin/2008/09/problem-backscatter-part-1"><img src='/uploads/images/buttons/reddit.png' alt='reddit.png' width='45' height='45' class='responsive' /></a></center></div></div></div><p> </p>
<h2>Latest articles:</h2>
<div class="ccm-page-list">
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2022/04/cryptojacking-fly-teamtnt-using-nvidia-drivers-mine-cryptocurrency/" target="_self">Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency</a>
</h3>
<div class="ccm-page-list-description">
TeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order to infiltrate organizations&rsquo; dedicated environments and transform them into attack launchpads. In this article Aditya Sood presents a new module introduced by&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/12/collector-stealer-russian-origin-credential-and-information-extractor/" target="_self">Collector-stealer: a Russian origin credential and information extractor</a>
</h3>
<div class="ccm-page-list-description">
Collector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to exfiltrate sensitive data from end-user systems and store it in its C&amp;C panels. In this article, researchers Aditya K Sood and Rohit Chaturvedi present a 360&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/06/fighting-fire-fire/" target="_self">Fighting Fire with Fire</a>
</h3>
<div class="ccm-page-list-description">
In 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and from that moment onward, was intrigued by the properties of these small pieces of self-replicating code. Joe Wells was an expert on computer viruses, was partly&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/run-your-malicious-vba-macros-anywhere/" target="_self">Run your malicious VBA macros anywhere!</a>
</h3>
<div class="ccm-page-list-description">
Kurt Natvig wanted to understand whether it&rsquo;s possible to recompile VBA macros to another language, which could then easily be &lsquo;run&rsquo; on any gateway, thus revealing a sample&rsquo;s true nature in a safe manner. In this article he explains how he recompiled&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/dissecting-design-and-vulnerabilities-azorultccpanels/" target="_self">Dissecting the design and vulnerabilities in AZORult&nbsp;C&amp;C&nbsp;panels</a>
</h3>
<div class="ccm-page-list-description">
Aditya K Sood looks at the command-and-control (C&amp;C) design of the AZORult malware, discussing his team's findings related to the C&amp;C design and some security issues they identified during the research. </div>
</div>
<p><br /><a class="btn btn-block btn-warning" href="/virusbulletin/archive">Bulletin Archive</a></p> </div>
</div>
</div>

<footer class="bs-footer" role="contentinfo">
<div class="container">
<div class="bs-social">
<div class="row ">
<div class="col-md-3">
<p><a title="About Us" href="/about-vb/about-us/">About us</a></p>
<p><a title="Contact Us" href="/about-vb/contact-us/">Contact us</a></p>
<p><a title="Advisory Board" href="/about-vb/advisory-board/">Advisory board</a></p>
<p><a title="Press" href="/about-vb/press/">Press information</a></p>
<p><a title="Security Events Calendar" href="/resources/calendar/">Security events calendar</a></p>
<p><a title="Newsletter" href="/newsletter/">Virus Bulletin newsletter</a></p> </div>
<div class="col-md-3">
<p><a title="VB Testing" href="/testing/">Testing</a></p>
<p><a title="VB100" href="/testing/vb1001/">VB100</a></p>
<p><a title="VBSpam" href="/testing/vbspam/">VBSpam</a></p>
<p><a title="VBWeb" href="/testing/vbweb/">VBWeb</a></p>
<p><a title="Consultancy Services" href="/testing/consultancy-services/">Consultancy services</a></p>
<p><a title="The Spammers' Compendium" href="/resources/spammerscompendium/">Spammers' Compendium</a></p> </div>
<div class="col-md-3">
<p><a title="VB2021 localhost" href="/conference/vb2021/">VB2021 localhost</a></p>
<p><a title="VB2020 localhost" href="/conference/vb2020/">VB2020 localhost</a></p>
<p><a title="VB2019" href="/conference/vb2019/">VB2019 (London)</a></p>
<p><a title="VB2018" href="/conference/vb2018">VB2018 (Montreal)</a></p>
<p><a title="VB2017" href="/conference/vb2017">VB2017 (Madrid)</a></p>
<p><a title="Conference Archive" href="/conference/vb-conference-archive/">Older conferences</a></p> </div>
<div class="col-md-3">
<div class="row">
<table style="float: right;" border="0">
<tbody>
<tr>
<td align="center"><a href="/rss" target="_blank"><img title="Get our blog updates" src="/uploads/images/buttons/rss-square-gray.png" alt="rss.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://twitter.com/virusbtn" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on Twitter" src="/uploads/images/buttons/twitter-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.linkedin.com/company/virus-bulletin" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on LinkedIn" src="/uploads/images/buttons/linkedin-square-gray.png" alt="linkedin.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.facebook.com/virusbulletin" target="_blank"><img title="Visit us on Facebook" src="/uploads/images/buttons/fb-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.youtube.com/user/virusbtn" target="_blank"><img title="Visit us on Youtube" src="/uploads/images/buttons/youtube-square-gray.png" alt="youtube.png" width="35" height="35" /></a></td>
</tr>
</tbody>
</table>
</div> </div>
</div>
<div class="row ">
<div class="col-md-12">
</div>
</div>
</div>
</div>
</footer>

<footer class="bs-footer2" role="contentinfo">
<div class="container">
<div class="bs-social2">
<div class="row ">
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
</div>
<div class="row ">
<div class="col-md-12">
<p style="text-align: left;">©1989-2022 Virus Bulletin.        <a title="Privacy Policy" href="/about-vb/privacy-policy/">Privacy policy</a>        <a title="Cookies" href="/about-vb/privacy-policy/cookies/">Cookies</a>        <a title="Terms and Conditions" href="/about-vb/terms-and-conditions/">Terms and Conditions</a></p> </div>
</div>
</div>
</div>
</footer>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-21876594-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-21876594-2', { 'anonymize_ip': true });
</script><script type="text/javascript" src="/libraries/js/fancybox.load.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/app.js"></script>
<div id="ccm-cookiesDisclosure" class="disclosure-bottom">
<div class="disclosure-container">
<div class="disclosure-content">
<p> We have placed cookies on your device in order to improve the functionality of this site, as outlined in our <a href="/about-vb/privacy-policy/cookies" target="_blank">cookies policy</a>. However, you may delete and block all cookies from this site and your use of the site will be unaffected. By continuing to browse this site, you are agreeing to Virus Bulletin's use of data as outlined in our <a href="/about-vb/privacy-policy/" target="_blank">privacy policy</a>.</p>
</div>
<div class="disclosure-form">
<form action="/index.php/cookies_disclosure/" method="POST">
<input type="hidden" name="allowCookies" value="1" />
<div class="button">
<input class="btn btn-info btn-sm" type="submit" name="submit" value="I understand. Don't show this message again!" />
</div>
</form>
</div>
<div class="ccm-spacer">&nbsp;</div>
</div>
</div>
</body>
</html>