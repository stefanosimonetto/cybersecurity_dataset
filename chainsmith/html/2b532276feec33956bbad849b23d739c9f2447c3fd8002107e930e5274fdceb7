<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<script type="text/javascript">var BOOTSTRAP_VERSION ="lumen";
	var BOOTSTRAP_JS_HEAD =1;
	var BOOTSTRAP_CDN_ENABLE =0; var BOOTSTRAP_NAVBAR_TYPE =0; var BOOTSTRAP_LOGO_OPTION =0; var BOOTSTRAP_NAVBAR =1; var BootstrapInputFix =true;var BootstrapNavbarLineHeightFix =true;var BOOTSTRAP_EDT= 0; </script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Virus Bulletin :: VB2019 paper: Static analysis methods for detection of Microsoft Office exploits</title>
<meta name="description" content="This paper presents an exploit detection tool built for the purpose of detecting malicious lure documents. This detection engine employs multiple binary stream analysis techniques for flagging malicious Office documents, supporting static analysis of RTF, Office Open XML and Compound Binary File format (MS-CFB). The use, by attackers, of weaponized lure documents necessitates deeper inspection of these file formats at the perimeter." />
<meta name="generator" content="concrete5 - 5.6.3.5" />
<script type="text/javascript">
var CCM_DISPATCHER_FILENAME = '/index.php';var CCM_CID = 6691;var CCM_EDIT_MODE = false;var CCM_ARRANGE_MODE = false;var CCM_IMAGE_PATH = "/concrete/images";
var CCM_TOOLS_PATH = "/index.php/tools/required";
var CCM_BASE_URL = "https://www.virusbulletin.com";
var CCM_REL = "";

</script>
<link rel="shortcut icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="/concrete/css/ccm.base.css" />
<script type="text/javascript" src="/concrete/js/jquery.js"></script>
<script type="text/javascript" src="/concrete/js/ccm.base.js"></script>
<script type="text/javascript">
var COOKIES_ALLOWED=false;
</script>
<link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure.css" />
<!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure_ie.css" /><![endif]-->
<script type="text/javascript">
var COOKIES_DISCLOSURE_HIDE_INTERVAL=10;
</script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_hide.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap-overwrites.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/members.css" />
<script type="text/javascript" src="/packages/bootstrap/js/common/prettify.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="/libraries/css/jquery.fancybox.css" />
<script type="text/javascript" src="/libraries/js/jquery.fancybox.pack.js"></script>
<link rel="stylesheet" media="screen" type="text/css" href="/files/cache/css/bootstrap/typography.css" />
<script type="text/javascript" src="/index.php/tools/packages/free_cookies_disclosure/disclosure_i18n_js"></script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_ajax_form.js"></script>
<link rel="stylesheet" type="text/css" href="/concrete/blocks/page_list/view.css" />
<link rel="stylesheet" type="text/css" href="/blocks/expand_collapse_toc/templates/vbexpand/view.css" />
<script type="text/javascript" src="/blocks/expand_collapse_toc/js/jquery.color.js"></script>
<script type="text/javascript" src="/blocks/expand_collapse_toc/js/jquery.ba-hashchange.js"></script>
<script type="text/javascript" src="/blocks/expand_collapse_toc/js/expand.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/blocks/search/templates/VB_global_search/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/travisn_spacer/css/ccm.tnspacer.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.js" integrity="sha256-1SFdTXlsw0RkQ+iO0E91LDshGiIbPiTYqJto0px4wds=" crossorigin="anonymous"></script>
<!--[if gte IE 9]>
<script src="/packages/bootstrap/js/common/modernizr.js"></script>
<![endif]-->

<!--[if lt IE 9]>	
	
	<script src="/packages/bootstrap/js/common/html5shiv.js"></script>
	<script src="/packages/bootstrap/js/common/respond.min.js"></script>
	
<![endif]-->
</head>
<body data-spy="scroll" data-target=".bs-sidebar">

<div class="navbar  navbar-fixed-top navbar-default  bs-docs-nav">
<div class="navbar-inner">
<div class="container"><div class="row"><div class="col-sm-4 col-md-4 logo-position-1 col-logo">
<div class="navbar-header">
<button type="button" class="navbar-toggle btn_navbar_custom">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button><div class="mobile-clearfix"></div><div class="navbar-brand navbar-brand-area"><a href="/"><img border="0" class="ccm-image-block" alt="" src="/files/4614/4535/7515/logo-big.png" width="339" height="92" /></a></div> </div>
</div><div class="col-sm-8 col-md-8 logo-position-1 col-nav"> <div class="nav-collapse collapse nav_collapse_custom navbar-collapse"> <div style="clear:both"></div>
<div class="vb-global-search-div">
<form action="/index.php/global-search-results/" method="get">
<fieldset>
<input name="search_paths[]" type="hidden" value="" />
<input name="query" type="text" class="vb-global-search" placeholder="Search site..." />
<input name="submit" type="submit" value="Search!" style="display:none" />
</fieldset>
</form>
</div>
<div class="tnSpacer" style="height:48px"></div>
<ul class="nav nav-pills"><li class=" nav-first nav-item-6299"><a href="/newsletter/" target="_self" class=" nav-first nav-item-6299 ">Newsletter</a></li><li class=" nav-item-260"><a href="/conference/" target="_self" class=" nav-item-260 ">VB Conference</a></li><li class=" nav-item-166"><a href="/testing/" target="_self" class=" nav-item-166 ">VB Testing</a></li><li class=" nav-path-selected active nav-item-160"><a href="/virusbulletin/" target="_self" class=" nav-path-selected active nav-item-160 ">Bulletin</a></li><li class=" nav-last nav-item-130"><a href="/blog/" target="_self" class=" nav-last nav-item-130 ">Blog</a></li></ul> </div>
</div>
</div><div class="clearfix"></div>
</div>
</div>
</div>
<div class="navbar-top-fixed-space "><div class="clearfix"></div></div>

<div class="container m-top-20">
<div class="row">
<div class="col-md-9 col-sm-9 col-lg-9">
<h1><a class="chapter" name="h1-vb2019-paper-static-analysis-methods-detection-microsoft-office-exploits"></a>VB2019 paper: Static analysis methods for detection of Microsoft Office exploits</h1>
<h3><a class="chapter" name="h3-chintan-shah"></a>Chintan Shah</h3>
<p><em>McAfee, India</em></p>
<hr />
<p> </p>
<div class="ccm-expand-collapse-toc">
<div id="ccm-expand-collapse-toc-title-15184" class="ccm-expand-collapse-toc-title ccm-expand-collapse-toc-closed" data-expander-speed="500">Table of contents</div><div id="ccm-expand-collapse-toc-content-15184" class="ccm-expand-collapse-toc-content"><p><a class="toc-level2" href="#h2-abstract">Abstract</a><br /> <a class="toc-level2" href="#h2-introduction">Introduction</a><br /> <a class="toc-level2" href="#h2-static-analysis-rtf-rich-text-format-files">Static analysis of RTF (Rich Text Format) files</a><br /> <a class="toc-level3" href="#h3-rtf-control-words">RTF control words</a><br /> <a class="toc-level3" href="#h3-malicious-code-inside-embedded-microsoft-ole-objects">Malicious code inside embedded Microsoft OLE objects</a><br /> <a class="toc-level3" href="#h3-links-external-resources-inside-embedded-microsoft-ole-objects">Links to external resources inside embedded Microsoft OLE objects</a><br /> <a class="toc-level3" href="#h3-overlay-data-rtf-files">Overlay data in RTF files</a><br /> <a class="toc-level3" href="#h3-embedded-files-inside-rtf-documents">Embedded files inside RTF documents</a><br /> <a class="toc-level2" href="#h2-static-analysis-ms-ooxml-microsoft-office-open-xml-format">Static analysis of MS-OOXML (Microsoft Office Open XML) format</a><br /> <a class="toc-level3" href="#h3-suspicious-loading-activex-objects">Suspicious loading of ActiveX objects</a><br /> <a class="toc-level3" href="#h3-identifying-rop-chains-and-sledges-ole-object">Identifying ROP chains and sledges in OLE object</a><br /> <a class="toc-level2" href="#h2-static-analysis-ms-cfb-microsoft-compound-file-binary-file-format">Static analysis of MS-CFB (Microsoft Compound File Binary File) format</a><br /> <a class="toc-level3" href="#h3-scanning-storage-and-stream-objects">Scanning storage and stream objects</a><br /> <a class="toc-level3" href="#h3-extraction-and-analysis-vb-macro-code">Extraction and analysis of VB macro code</a><br /> <a class="toc-level2" href="#h2-high-level-implementation-static-analysis-engine">High-level implementation of the static analysis engine</a><br /> <a class="toc-level2" href="#h2-results-over-wild-exploits">Results over in-the-wild exploits</a><br /> <a class="toc-level3" href="#h3-mixed-exploits-detection-results">Mixed exploits detection results</a></p><p>&nbsp;</p></div></div>
<h2><a class="chapter" name="h2-abstract"></a>Abstract</h2>
<p>Despite recent advances in exploitation strategies and exploit mitigation techniques, fundamental infection vectors remain the same. It is critical to advance security solutions to inspect both new and known infection vectors in order to successfully mitigate targeted attacks. Apparently, the use of lure documents has become one of the most favoured attack strategies for infiltrating target organizations. Recently, some of the most high impact attacks using this conventional technique have been uncovered by the security community.</p>
<p>In this paper, we present an exploit detection tool that we built for the purpose of detecting malicious lure documents. This detection engine employs multiple binary stream analysis techniques for flagging malicious <em>Office</em> documents, supporting static analysis of RTF, Office Open XML and Compound Binary File format (MS-CFB). The use, by attackers, of weaponized lure documents necessitates deeper inspection of these file formats at the perimeter.</p>
<p>Object Linking and Embedding exposes a rich attack surface which has been abused by attackers over the past few years to hide malicious resources. For instance, OOXML files can be used to load OLE controls which can eventually facilitate remote code execution. Our proposed detection tool is built to extract embedded storage streams, OLE objects, etc. and apply binary stream analysis techniques over it, in addition to inspecting specific file sections and analysing embedded scripts, to identify malicious code. This detection tool had been tested over a wide set of in-the-wild exploits and variants.</p>
<p> </p>
<h2><a class="chapter" name="h2-introduction"></a>Introduction</h2>
<p>It is hardly surprising that some of the most infamous targeted attacks that we have spotted in the past used conventional attack vectors and infection techniques to penetrate their target organizations. Multiple attacks using lure documents have been uncovered by the security community over the last year. Since attackers using this technique to execute phishing attacks would most likely deliver the weaponized exploit documents to the target, it becomes a pressing need for any perimeter security solution to investigate these file formats a little deeper for signs of maliciousness. Network and endpoint security solutions have the capability to look deeper into several file formats, but seemingly have limited detection capability of weaponized documents exploiting zero-day vulnerabilities. Modern sandboxing solutions also support analysis of multiple file formats, but often do not provide complete behaviour visibility. It is critical to augment the exploit detection capability of these solutions with an engine that can perform static inspection of files and classify documents based on the characteristics of the embedded binary content.</p>
<p>Object Linking and Embedding (OLE), a technology based on Component Object Model (COM), is one of the features in <em>Microsoft Office</em> documents which allows the objects created in other <em>Windows</em> applications to be linked or embedded into documents, thereby creating a compound document structure and providing a richer user experience. OLE had been massively abused by attackers over the past few years in a variety of ways. OLE exploits in the recent past have been observed either loading COM objects to orchestrate and control the process memory, taking advantage of the parsing vulnerabilities of the COM objects, hiding malicious code or connecting to external resources to download additional malware. We have had multiple instances of OLE exploits using the multi-COM loading method to execute an attack. With this, it becomes vital for any security solution to inspect documents at the perimeter before they reach the endpoint. Additionally, it is fundamental to inspect other attack surfaces like embedded scripts, Flash files, etc. to be able to detect unknown attacks.</p>
<p>In the following sections, we describe the Static Analysis Engine (SAE) that we implemented for a similar purpose. The Static Analysis Engine supports the inspection of OLE Compound Binary File format (MS-CFB), Rich Text Format (RTF) and OOXML file format, and applies binary stream analysis techniques to identify unusual streams of data. SAE utilizes the underlying document parsing capabilities to extract all the embedded or linked COM objects from <em>Microsoft Office</em> documents and further analyses them for any suspicious or malicious indicators. It also extracts the embedded object and storage streams from the Compound Binary File format and explores the possibility of injected malicious code by emulating and statically analysing these streams. It is also important to analyse known attack surfaces such as embedded VB macro scripts, since targeted attacks using lure documents with obfuscated macro scripts have been on the rise. It is crucial to look for attack vectors that deliver other file format exploits, such as Flash files, from within the <em>Microsoft Office</em> documents, extract and probe them for any possible malicious indications.</p>
<p>In the following sections, we walk through some of the malicious indicators, inspection methods and heuristics implemented by the SAE over the various file formats and share some of the initial observed results towards the end. However, the methods outlined here are by no means an exhaustive list.</p>
<p> </p>
<h2><a class="chapter" name="h2-static-analysis-rtf-rich-text-format-files"></a>Static analysis of RTF (Rich Text Format) files</h2>
<p>RTF documents have been one of the primary exploitation targets. Attackers have predominantly used RTF parsing and logic vulnerabilities to deliver malware and execute attacks. In the following sections, we highlight some of the inspection methods for identifying malicious RTF documents.</p>
<p> </p>
<h3><a class="chapter" name="h3-rtf-control-words"></a>RTF control words</h3>
<p>Rich Text Format files are heavily formatted using control words. Control words in RTF files primarily define the way a document is presented to the user. Since these RTF control words have associated parameters and data, parsing errors for them can become the primary target for exploitation. Exploits in the past have been found using control words to embed malicious resources as well. Consequently, it becomes important to examine destination control words that consume data, and to extract and analyse the embedded binary stream for malicious indicators. Figures 1 to 3 show a few instances of past exploits using control word parameters to introduce malicious code or executable payloads.</p>
<p><a class="zoom-img" title="Figure 1: A previous exploit with embedded binary data inside the ‘PFragments’ RTF control word." href="/files/9415/7588/6024/Shah-figrue1.png"><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/c3487b069550323825547971bbcd09c2_f4331.png" alt="Shah-figrue1.png" width="840" height="205" /></a><span class="centered-caption">Figure 1: A previous exploit with embedded binary data inside the ‘PFragments’ RTF control word.</span></p>
<p> <img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/7815/7588/6102/Shah-figure2.png" alt="Shah-figure2.png" width="812" height="700" /></p>
<p class="centered-caption">Figure 2: CVE-2012-0158: Embedded executable payload inside the ‘datastore’ RTF control word.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/4315/7588/6139/Shah-figure3.png" alt="Shah-figure3.png" width="824" height="756" /><span class="centered-caption"> Figure 3: CVE-2014-1761: Embedded shellcode inside the ‘listlevel’ RTF control word.</span></p>
<p>It is crucial for the Static Analysis Engine to scan the destination control words, especially those that consume data, since these could be the target for hiding the malicious content. <em>Microsoft</em> RTF specifications mention several such destination control words, a snapshot of which is shown in Figure 4.</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/1715/7588/6195/Shah-figure4.png" alt="Shah-figure4.png" width="500" height="600" /><span class="centered-caption">Figure 4: Microsoft RTF specifications mention several destination control words that consume data.</span></p>
<p>To be able to generically detect such auxiliary strategies, an RTF document parser must be able to scan the control words that consume data and extract the stream, so that it can be passed on for additional scanning. RTF parsers must also be able to handle the control word obfuscation mechanisms commonly used by attackers, otherwise significant detections could be missed. The Static Analysis Engine integrates an RTF parser which performs sanity checks for such obfuscation attempts and extracts the data for the specific control words, apparently for performance reasons, which are then passed onto the supplementary scanning module. Figure 5 shows one of the instances as described previously: SAE extracts the data consumed by the ‘datastore’ control word and then passes it on to the stream analyser, which identifies the embedded single-byte XORed executable payload.</p>
<p><a class="zoom-img" title="Figure 5: The SAE extracts the data consumed by the ‘datastore’ control word and then passes it to the stream analyser." href="/files/9815/7588/6533/Shah-figure5.jpg"><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/c3e4dba2d585cdebfd9a6592f9e76efe_f4335.jpg" alt="Shah-figure5.jpg" width="840" height="552" /></a><span class="centered-caption">Figure 5: The SAE extracts the data consumed by the ‘datastore’ control word and then passes it to the stream analyser.</span></p>
<p> </p>
<h3><a class="chapter" name="h3-malicious-code-inside-embedded-microsoft-ole-objects"></a>Malicious code inside embedded Microsoft OLE objects</h3>
<p><em>Microsoft</em> OLE links or <em>Microsoft</em> OLE embedded objects are represented in RTF documents as RTF objects, more precisely as a parameter to the RTF control word ‘objdata’. The data for the object is hex encoded, stored in the OLESaveToStream format, which is supplied to the respective OLE application for processing when the OLE client is loaded into the application via a specified Class ID. It is imperative that this embedded OLE object is extracted from the RTF document and scanned for possible malicious code. On several occasions, crafted RTF exploits used as lure documents to execute a targeted attack have been observed to embed shellcodes in the object data and to exploit the vulnerability in the embedded OLE controls.</p>
<p>The CVE-2015-2424 RTF exploit, as shown in Figure 6, uses a multiple COM loading technique where malicious code is planted within the Forms.Image.1 OLE object while exploiting a memory corruption vulnerability within the Control.TaskSymbol.1 OLE object.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/7915/7588/6625/Shah-figure6.png" alt="Shah-figure6.png" width="808" height="472" /> <span class="centered-caption">Figure 6: CVE-2015-2424 uses a multiple COM loading technique.</span></p>
<p>Figure 7 shows the injected code inside the OLE object.</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/f1a5d24ee091a5788f80e0cf31f67cd1_f4337.png" alt="Shah-figure7a.png" width="840" height="313" /><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/2915/7588/6693/Shah-figure7b.png" alt="Shah-figure7b.png" width="806" height="667" /><span class="centered-caption">Figure 7: Injected shellcode inside OLE object.</span></p>
<p>The Static Analysis Engine can extract all the <em>Microsoft</em> OLE objects embedded inside RTF documents, parsing the RTF ‘objdata’ control word, and can inspect them for possible hidden malicious code.</p>
<p> </p>
<h3><a class="chapter" name="h3-links-external-resources-inside-embedded-microsoft-ole-objects"></a>Links to external resources inside embedded Microsoft OLE objects</h3>
<p>As a part of static analysis, it is critical to scan embedded OLE objects for any links pointing to external resources. Apparently, by embedding specific OLE controls inside <em>Microsoft Office</em> documents, exploits can be crafted to invoke respective handlers to parse or handle the downloaded resources. Evidently, attackers can take advantage of this functionality to exploit either logic bugs or resource-parsing vulnerabilities, which can eventually lead to full remote code execution.</p>
<p>Figure 8 is an example of a similar infamous RTF vulnerability, CVE-2017-0199, which was found to be exploited in the wild to deliver additional malware, and which had an embedded OLE2Link object.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/8015/7588/6763/Shah-figure8.png" alt="Shah-figure8.png" width="823" height="311" /><span class="centered-caption">Figure 8: CVE-2017-0199 had an embedded OLE2Link object.</span></p>
<p>The OLE2Link object enables Winword.exe to initiate the HTTP request to fetch an .hta file from the remote server. If we look at the OLE file, the OLE Stream object contained a link to the external resource, as highlighted in Figure 9, which, based on the server response, invoked the resource handler – in this case mshta.exe to execute the inserted malicious script inside the .hta file.</p>
<p><a class="zoom-img" title="Figure 9: The OLE Stream object contained a link to the external resource." href="/files/8315/7588/7204/Shah-figure9.png"><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/46edc021dac1e3eefbc760bce772cbfc_f4340.png" alt="Shah-figure9.png" width="840" height="195" /></a></p>
<p class="centered-caption">Figure 9: The OLE Stream object contained a link to the external resource.</p>
<p>Several other analogous cases have also been observed in the recent past. CVE-2017-8756 exploited the Web Service Description Language (WSDL) parsing code injection vulnerability by inserting an external link into the WSDL definition, which gets downloaded and parsed by the WSDL SOAP parser exploiting validation bug, leading to remote code execution.</p>
<p><a class="zoom-img" title="Figure 10: CVE-2017-8756 inserted an external link into the WSDL definition." href="/index.php/download_file/view_inline/4341"><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/7b2c48e8e328dcc117c762ce79ec699a_f4341.png" alt="Shah-figure10.png" width="840" height="161" /></a> <span class="centered-caption">Figure 10: CVE-2017-8756 inserted an external link into the WSDL definition.</span></p>
<p>CVE-2017-11882 was yet another vulnerability exploited in the wild to infect victims. This was a stack overflow in the Equation Editor OLE object with a link to download external resources.</p>
<p> <img class="framed" src="/files/6215/7588/7519/Shah-figure11-a.png" alt="Shah-figure11-a.png" width="824" height="332" /></p>
<p> <img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/7615/7588/7614/Shah-figure11-b.png" alt="Shah-figure11-b.png" width="821" height="357" /></p>
<p class="centered-caption">Figure 11: CVE-2017-11882 was a stack overflow in the Equation Editor OLE object with a link to download external resources.</p>
<p> </p>
<h3><a class="chapter" name="h3-overlay-data-rtf-files"></a>Overlay data in RTF files</h3>
<p>Overlay data is the additional data which is appended to the end of an RTF document and is predominantly used by exploit authors to embed decoy files or additional resources either in clear or encrypted form, and usually decrypted when the attacker-controlled code is executed. Overlay data having a volume beyond a certain size should be deemed suspicious and must be extracted and analysed further. However, the <em>Microsoft Word</em> RTF parser will ignore the overlay data while processing RTF documents. Figure 12 shows one RTF exploit, CVE-2015-1641, with 380KB of data appended at the end of the file, storing both the decoy document and multi-staged shellcodes with appropriate markers to aid decryption when the attacker-controlled code is executed.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/602110642ea621ba0395baa6fc80a22d_f4344.png" alt="Shah-figure12.png" width="840" height="526" /> <span class="centered-caption">Figure 12: CVE-2015-1641 with decoy document and shellcode in the overlay section of the document.</span></p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/4936762c700f96c41fdec95ecdb6a8c9_f4345.png" alt="Shah-figure13.png" width="840" height="531" /> <span class="centered-caption">Figure 13: CVE-2017-11826 with 189KB of overlay.</span></p>
<p>To test the detection of overlay data inside RTF files, we ran the Static Analysis Engine over 2,483 RTF files with large-sized overlay data. The results are shown in Table 1. We found that more than 90% of the RTF documents with overlay data of more than 500 bytes had been found malicious as per <em>VirusTotal</em> detection.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td>Size of RTF overlay data section</td>
<td colspan="2">Total RTF documents having overlay tested: 2,483</td>
</tr>
<tr>
<td> </td>
<td colspan="2">Overlay data section &gt; 100B found: 2,310 [ 93 %]</td>
</tr>
<tr>
<td>Overlay &gt; 500B</td>
<td>Total found: 2,093</td>
<td>Malicious: 1,928 [ 92.11 %]</td>
</tr>
<tr>
<td>300B &gt; Overlay &lt;= 500B</td>
<td>Total found: 137</td>
<td>Malicious: 136 [ 99.27 %]</td>
</tr>
<tr>
<td>100B &gt; Overlay &lt; = 300B</td>
<td>Total found: 80</td>
<td>Malicious: 73 [ 91.25 %]</td>
</tr>
<tr>
<td>10B &gt; Overlay &lt;= 100B</td>
<td>Total found: 173</td>
<td>Malicious: 156 [90.17 %]</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 1: Breakdown of results.</p>
<p> </p>
<h3><a class="chapter" name="h3-embedded-files-inside-rtf-documents"></a>Embedded files inside RTF documents</h3>
<p>Besides OLE files, RTF documents can have other files embedded at multiple locations, e.g. Flash files, Office Open XML format files, image files, etc. Extracting and re-analysing the embedded files becomes extremely important as a part of the static analysis process and on several occasions can become a decisive factor in identifying zero-day exploits. Extracted files can then be forwarded to the respective analysis modules for re-analysis. For instance, RTF exploits in the recent past had been found delivering Flash zero-day exploits, subsequently infecting the target with the additional malware. To support the exploitation process, weaponized RTF documents had been observed embedding OOXML files, on most occasions to perform the heap spray. Figure 14 is a snapshot of the CVE-2017-11826 RTF exploit used in the wild embedding malicious Office Open XML files to assist the further exploitation.</p>
<p><a class="zoom-img" title="Figure 14: CVE-2017-11826 embeds malicious OOXML files." href="/files/6815/7588/7969/Shah-figure14.jpg"><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/e8e0abcd730cf173aa44fc167da8efb8_f4346.jpg" alt="Shah-figure14.jpg" width="840" height="647" /></a></p>
<p class="centered-caption">Figure 14: CVE-2017-11826 embeds malicious OOXML files.</p>
<p> </p>
<h2><a class="chapter" name="h2-static-analysis-ms-ooxml-microsoft-office-open-xml-format"></a>Static analysis of MS-OOXML (Microsoft Office Open XML) format</h2>
<p><em>Microsoft Office</em> version 2007 and above introduced a new way of representing the documents in the form of XML schema, which replaced the previous binary file format representation. Office Open XML file format was specifically designed to consume less storage space, to increase performance and to increase the interoperability across multiple other applications. An Office Open XML (OOXML) file is preserved on the disk in the form of a compressed archive, comprising multiple compartmentalized markup documents with described relationships among them. The security and integrity of OOXML documents was also enhanced.</p>
<p>With the new document format, attack methods in OOXML files still revolve predominantly around exploiting OLE-based vulnerabilities and embedding malicious VBA macros. A sizeable proportion of exploits used in targeted attacks have been found exploiting OLE vulnerabilities, from memory corruption or logic bugs to undermining the <em>Windows</em> exploit mitigations by loading vulnerable or insecure OLE objects. The Static Analysis Engine essentially emphasizes the analysis of embedded ActiveX objects for any suspicious binary streams commonly used to assist further exploitation processes. The SAE also examines the objects for other inserted file formats and extracts them in order to forward them to other independent static analysis modules.</p>
<p> </p>
<h3><a class="chapter" name="h3-suspicious-loading-activex-objects"></a>Suspicious loading of ActiveX objects</h3>
<p>For ActiveX objects embedded inside an OOXML file, <em>Microsoft Office</em> creates a unique ActiveX.bin file, which is Compound Document Format, containing the CLSID corresponding to the library to be loaded in the application. <em>Office</em> reads the CLSID from the OLESS (OLE Structured Storage) stream and, post initialization of the OLE object, passes the storage data to the object for further processing via exposed interfaces. Attackers can abuse this OLE object-loading mechanism to load multiple OLE objects with the same but legitimate CLSID in order to perform heap spray. In some of the in‑the-wild exploits, attackers have been found using fake CLSIDs, which do not point to any of the ActiveX libraries, to optimize and accelerate the heap spray process.</p>
<p><a class="zoom-img" title="Figure 15: In some exploits attackers use fake CLSIDs which do not point to an ActiveX library." href="/files/4715/7588/8077/Shah-figrue15.png"><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/742fd3fc091349855034256a68fde13f_f4347.png" alt="Shah-figrue15.png" width="840" height="450" /></a></p>
<p class="centered-caption">Figure 15: In some exploits attackers use fake CLSIDs which do not point to an ActiveX library.</p>
<p>It becomes important to examine if the OLE objects in the <em>Office</em> OOXML document are loaded suspiciously, along with performing a stream analysis of ActiveX.bin files for any malicious attributes. The same ActiveX object loading repeatedly should be deemed suspicious and corresponding .bin files should be analysed further.</p>
<p><a class="zoom-img" title="Figure 16: The same CLSID loading multiple times should be considered suspicious." href="/files/2915/7588/8140/Shah-figure16.jpg"><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/9d9421ec503a8adc6424ba7197ede9b4_f4348.jpg" alt="Shah-figure16.jpg" width="840" height="439" /></a></p>
<p class="centered-caption">Figure 16: The same CLSID loading multiple times should be considered suspicious.</p>
<p>Another exploit, CVE-2017-11826, used in multiple targeted attacks, loaded a non-existent CLSID multiple times to be able to optimize and accelerate the heap spray process. Since there is no library associated with the class-id, heap spray time can be drastically reduced, increasing the overall performance.</p>
<p><a class="zoom-img" title="Figure 17: CVE-2017-11826 loaded a non-existent CLSID multiple times." href="/files/3015/7588/8189/Shah-figure17.jpg"><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/f9dc0d23bd059fdcf0b34006956b7338_f4349.jpg" alt="Shah-figure17.jpg" width="840" height="372" /></a></p>
<p class="centered-caption">Figure 17: CVE-2017-11826 loaded a non-existent CLSID multiple times.</p>
<p> </p>
<h3><a class="chapter" name="h3-identifying-rop-chains-and-sledges-ole-object"></a>Identifying ROP chains and sledges in OLE object</h3>
<p>The Static Analysis Engine also analyses the embedded OLE structured storage streams for any possible sledges, which is most likely the address within the loaded module that points to the instructions, usually a junk code to increase the possibility of successful exploitation. Sledges are then usually followed by ROP gadgets, which are subsequently executed to bypass the <em>Windows</em> exploit mitigations. Figure 18 shows an OLE stream from one of the previous exploits used in the targeted attacks, highlighting the sledges, ROP chain and the shellcode.</p>
<p><a class="zoom-img" title="Figure 18: OLE stream with sledges, ROP chain and shellcode highlighted." href="/files/6715/7588/8253/Shah-figure18.png"><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/c22b639440cf0f89e5eccadaafd9dfd1_f4350.png" alt="Shah-figure18.png" width="840" height="344" /></a></p>
<p><span class="centered-caption">Figure 18: OLE stream with sledges, ROP chain and shellcode highlighted</span>.</p>
<p>The SAE applies an analysis algorithm to guess the valid address sequence within the binary stream and then attempts to further establish the sequence by performing deeper checks to eliminate false positives. Figure 19 shows the result of the SAE correctly extracting the ROP chain and the sledge from the binary stream shown in Figure 18.</p>
<p><a class="zoom-img" title="Figure 19: The SAE correctly extracts the ROP chain and sledge." href="/files/1115/7588/8304/Shah-figure19.jpg"><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/bb0b980730c3c651ae42692c76166f9a_f4351.jpg" alt="Shah-figure19.jpg" width="840" height="456" /></a></p>
<p class="centered-caption">Figure 19: The SAE correctly extracts the ROP chain and sledge.</p>
<p> </p>
<h2><a class="chapter" name="h2-static-analysis-ms-cfb-microsoft-compound-file-binary-file-format"></a>Static analysis of MS-CFB (Microsoft Compound File Binary File) format</h2>
<p>Compound Binary File format is a complex and legacy file format that existed before <em>Office 2007</em>, after which the newer and much simpler OOXML format was introduced. A compound file format provides a user with an efficient way to store multiple different kinds of objects (images, charts, documents, etc.) within a single hierarchical file structure in the form of stream and storage objects. All these stream and storage objects are stored in a separate directory entry, collectively known as structured storage, which increases the overall performance of the file system. Compound file format is organized in the form of sectors, containing user-defined data for stream objects; directory sectors which contain several directory entries; and free space to store additional objects when required. Sectors can be of multiple types such as FAT sectors, DIFAT sectors and mini FAT sectors.</p>
<p> </p>
<h3><a class="chapter" name="h3-scanning-storage-and-stream-objects"></a>Scanning storage and stream objects</h3>
<p>While variants of FAT sectors are predominantly for the allocation of space within the compound file, there is one that is of primary interest to us: File Directory sectors, which contain information about the stream objects and storage objects. Stream sectors are typically a collection of bytes and contain the user-defined data streams. There are no restrictions on the contents of the stream. It is critical for the Static Analysis Engine to parse the directory entries and locate these stream objects to be able to scan the byte streams for malicious code. Figure 20 shows an instance of the previous exploit parsed by the available Compound Binary File format parser, showing all the directory entries and storage types.</p>
<p><a class="zoom-img" title="Figure 20: Exploit parsed by the Compound Binary File format parser." href="/files/7715/7588/8378/Shah-figure20.png"><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/fd867e202465f37a4f944a0f006af57a_f4352.png" alt="Shah-figure20.png" width="840" height="380" /></a></p>
<p class="centered-caption">Figure 20: Exploit parsed by the Compound Binary File format parser.</p>
<p>Another section of the Compound Binary File which is of specific interest is the ObjectPool storage. ObjectPool storage contains storage for the embedded OLE objects and can be abused by attackers to insert malicious code into the weaponized exploits, as discussed in the earlier sections. Figure 21 shows the CVE-2018-4878 MS-CFB file-embedding Flash exploit, where the Static Analysis Engine extracts all the stream objects.</p>
<p><a class="zoom-img" title="Figure 21: The SAE extracts all the stream objects." href="/files/7715/7588/8557/Shah-figure21.png"><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/0109e5452f33c390cae5962b3eed3219_f4353.png" alt="Shah-figure21.png" width="840" height="105" /></a><span class="centered-caption">Figure 21: The SAE extracts all the stream objects.</span></p>
<p>On analysis of the stream data, malicious code was identified in the ‘Contents’ stream of the ObjectPool storage.</p>
<p><a class="zoom-img" title="Figure 22: CVE-2018-4878: Compound Document format with embedded Flash exploit." href="/files/2315/7588/8661/Shah-figure22.png"><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/465e1d157f8e07748496dbccf7a4c0d9_f4354.png" alt="Shah-figure22.png" width="840" height="318" /></a><span class="centered-caption">Figure 22: CVE-2018-4878: Compound Document format with embedded Flash exploit.</span></p>
<p>While ObjectPool storage is one of the critical areas in the Compound Binary File format to examine, it is also essential, as indicated before, to locate stream objects in the other directory entries and scan them as well, predominantly looking for signs of embedded malicious code. Figure 23 shows an instance of a weaponized <em>Microsoft PowerPoint</em> exploit, where malicious code was found hidden in the ‘PowerPoint Document’ binary stream.</p>
<p><a class="zoom-img" title="Figure 23: A weaponized PowerPoint exploit." href="/files/5515/7588/8724/Shah-figure23.jpg"><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/ca95ab7a76c476944927c0a6cb45077d_f4355.jpg" alt="Shah-figure23.jpg" width="840" height="537" /></a><span class="centered-caption">Figure 23: A weaponized PowerPoint exploit.</span></p>
<p> </p>
<h3><a class="chapter" name="h3-extraction-and-analysis-vb-macro-code"></a>Extraction and analysis of VB macro code</h3>
<p>In Compound Binary files, Visual Basic macro source code is located across multiple streams under the storage object called macros at the root storage of the OLE file. The macros storage object contains a VBA structured storage object which contains the /VBA/_VBA_PROJECT, /VBA/dir/ and several other streams containing macro source code. This code is stored as a compressed stream in the binary structure using rgw RLE (Run Length Encoding) compression algorithm, hence it is necessary to parse these binary streams in order to locate the code stream accurately. In an OOXML file, macro source is stored in the OLE file ‘vbaProject.bin’ within the zip archive. As indicated, this is again the OLE file with the same structure as the CFB file storage, and the macro source code is stored in the same format.</p>
<p>Malicious VBA (Visual Basic Application) malware has been on the rise in the recent past. Multiple high-impact targeted attacks have been executed by embedding malicious VBA macros inside <em>Office</em> documents. Therefore, it is essential for any static analysis solution to extract and classify the severity of the macro code. Figures 24 and 25 illustrate the storage of macro code in the two file formats.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/2115/7588/8813/Shah-figure24.png" alt="Shah-figure24.png" width="656" height="223" /> <span class="centered-caption">Figure 24: Macro storage in the ‘ThisDocument’ stream of a compound binary file.</span></p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/2015/7588/8846/Shah-figure25.png" alt="Shah-figure25.png" width="702" height="239" /> <span class="centered-caption">Figure 25: Macro storage in the ‘ThisWorkBook’ stream of an OOXML file.</span></p>
<p>The VB macro code classification module can extract the embedded VB macro code from the MS-CFB and MS-OOXML file formats, and applies code analysis for classification of malicious macros. Table 2 shows the results of initial testing done over 10,500 malicious macro embedded documents.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td> </td>
<td>Positive</td>
<td>Negative</td>
</tr>
<tr>
<td>True</td>
<td>96%</td>
<td>3%</td>
</tr>
<tr>
<td>False</td>
<td>0.5%</td>
<td>0.5%</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 2: Results of initial testing over 10,500 malicious macro embedded documents.</p>
<p> </p>
<h2><a class="chapter" name="h2-high-level-implementation-static-analysis-engine"></a>High-level implementation of the static analysis engine</h2>
<p>The Static Analysis Engine implements all of the previously described static analysis methods and concludes the classification of the input file based on the severity of the triggered heuristics. It includes multiple sub-analysis modules responsible for analysing various file formats depending upon the type of file passed as the input. Each sub-analysis engine has multiple heuristics implemented and respective checks are applied after the file is parsed by the integrated parser. It also implements an auxiliary generic stream analyser which is used by other analysis modules as and when required. Figure 26 is a high-level pictorial representation of the implementation. Analysis modules and their respective functionalities are indicated in the representation itself.</p>
<p><a class="zoom-img" title="Figure 26: Implementation of the static analysis engine." href="/files/4015/7588/8989/Shah-figure26.jpg"><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/5c5b35ec3e83320aa240da9a987d97b2_f4358.jpg" alt="Shah-figure26.jpg" width="840" height="784" /></a></p>
<p class="centered-caption">Figure 26: Implementation of the static analysis engine.</p>
<p> </p>
<h2><a class="chapter" name="h2-results-over-wild-exploits"></a>Results over in-the-wild exploits</h2>
<p>The Static Analysis Engine has been tested with all the implemented detection techniques over a number of in-the-wild exploits used in targeted attacks. Since the exploits used in the targeted attacks are weaponized, the implemented heuristics can be best tested over them. The results of this preliminary testing are shown in Table 3.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td><strong>Exploit type</strong></td>
<td><strong>Type</strong></td>
<td><strong>Total exploits</strong></td>
<td><strong>Detected</strong></td>
<td><strong>Not detected</strong></td>
<td><strong>Rate</strong></td>
</tr>
<tr>
<td>CVE-2012-0158</td>
<td>Mixed exploits (Targeted attacks and variants)</td>
<td>2000</td>
<td>1809</td>
<td>191</td>
<td>90.4%</td>
</tr>
<tr>
<td>CVE 2013-3906</td>
<td>Exploits used in targeted attacks</td>
<td>32</td>
<td>32</td>
<td>0</td>
<td>100%</td>
</tr>
<tr>
<td>CVE 2014-1761</td>
<td>Exploits used in targeted attacks</td>
<td>35</td>
<td>29</td>
<td>6</td>
<td>83%</td>
</tr>
<tr>
<td>CVE 2015-1641<br />CVE-2015-2424<br />CVE-2015-6172</td>
<td>Exploits used in targeted attacks and variants</td>
<td>150</td>
<td>138</td>
<td>12</td>
<td>92%</td>
</tr>
<tr>
<td>CVE 2016-4117</td>
<td>Exploits used in targeted attacks</td>
<td>87</td>
<td>77</td>
<td>10</td>
<td>88.5%</td>
</tr>
<tr>
<td>CVE-2017-11882</td>
<td>Exploits used in targeted attacks</td>
<td>12</td>
<td>11</td>
<td>1</td>
<td>91.6%</td>
</tr>
<tr>
<td>CVE 2018-4878<br />CVE-2018-15982</td>
<td>Exploits used in targeted attacks</td>
<td>30</td>
<td>27</td>
<td>3</td>
<td>90%</td>
</tr>
</tbody>
</table>
<p><span class="centered-caption">Table 3: Results of preliminary testing.</span></p>
<p> </p>
<h3><a class="chapter" name="h3-mixed-exploits-detection-results"></a>Mixed exploits detection results</h3>
<p>Table 4 shows the results when the Static Analysis Engine was tested over the exploit variants. This includes multiple variants of malicious files with the CVEs shown above.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td><strong>Exploit type</strong></td>
<td><strong>Total exploits</strong></td>
<td><strong>Detected</strong></td>
<td><strong>Not detected</strong></td>
<td><strong>Rate</strong></td>
</tr>
<tr>
<td>Exploit variants from 2012 to 2018</td>
<td>4185</td>
<td>3754</td>
<td>431</td>
<td>89.70%</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 4: Results when the Static Analysis Engine was tested over exploit variants.</p>
<p>It seems that the discussed detection mechanisms show a lot of promise in mitigating targeted attacks. Careful selection and implementation of additional heuristics will significantly improve the detection rate and, together, can certainly help to mitigate future attacks.</p>
<p> </p>
<p> </p> </div>
<div class="col-md-3 col-sm-3 col-lg-3">
<p><a href="/uploads/pdf/magazine/2019/VB2019-Shah.pdf" target="_blank"><img src="/uploads/images/buttons/pdf-download-button.jpg" alt="Download PDF" width="262" height="45" /></a></p>
<div id="NDPHPBlock13359" class="NDPHPBlock">
<div style="width: 100%;"><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Tweet this!' href="https://twitter.com/share?text=VB2019 paper: Static analysis methods for detection of Microsoft Office exploits&url=https://www.virusbulletin.com/virusbulletin/2020/02/vb2019-paper-static-analysis-methods-detection-microsoft-office-exploits"><img src='/uploads/images/buttons/twitter.png' alt='twitter.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Facebook' href='https://www.facebook.com/sharer.php?u=https://www.virusbulletin.com/virusbulletin/2020/02/vb2019-paper-static-analysis-methods-detection-microsoft-office-exploits'><img src='/uploads/images/buttons/fb.png' alt='fb.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on LinkedIn' href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.virusbulletin.com/virusbulletin/2020/02/vb2019-paper-static-analysis-methods-detection-microsoft-office-exploits&title=VB2019 paper: Static analysis methods for detection of Microsoft Office exploits"><img src='/uploads/images/buttons/linkedin.png' alt='linkedin.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Hacker News' href="https://news.ycombinator.com/submitlink?u=https://www.virusbulletin.com/virusbulletin/2020/02/vb2019-paper-static-analysis-methods-detection-microsoft-office-exploits&t=VB2019 paper: Static analysis methods for detection of Microsoft Office exploits"><img src='/uploads/images/buttons/hackernews.png' alt='hackernews.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='reddit this!' href="https://www.reddit.com/submit?url=https://www.virusbulletin.com/virusbulletin/2020/02/vb2019-paper-static-analysis-methods-detection-microsoft-office-exploits"><img src='/uploads/images/buttons/reddit.png' alt='reddit.png' width='45' height='45' class='responsive' /></a></center></div></div></div><p> </p>
<h2>Latest articles:</h2>
<div class="ccm-page-list">
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2022/04/cryptojacking-fly-teamtnt-using-nvidia-drivers-mine-cryptocurrency/" target="_self">Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency</a>
</h3>
<div class="ccm-page-list-description">
TeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order to infiltrate organizations&rsquo; dedicated environments and transform them into attack launchpads. In this article Aditya Sood presents a new module introduced by&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/12/collector-stealer-russian-origin-credential-and-information-extractor/" target="_self">Collector-stealer: a Russian origin credential and information extractor</a>
</h3>
<div class="ccm-page-list-description">
Collector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to exfiltrate sensitive data from end-user systems and store it in its C&amp;C panels. In this article, researchers Aditya K Sood and Rohit Chaturvedi present a 360&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/06/fighting-fire-fire/" target="_self">Fighting Fire with Fire</a>
</h3>
<div class="ccm-page-list-description">
In 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and from that moment onward, was intrigued by the properties of these small pieces of self-replicating code. Joe Wells was an expert on computer viruses, was partly&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/run-your-malicious-vba-macros-anywhere/" target="_self">Run your malicious VBA macros anywhere!</a>
</h3>
<div class="ccm-page-list-description">
Kurt Natvig wanted to understand whether it&rsquo;s possible to recompile VBA macros to another language, which could then easily be &lsquo;run&rsquo; on any gateway, thus revealing a sample&rsquo;s true nature in a safe manner. In this article he explains how he recompiled&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/dissecting-design-and-vulnerabilities-azorultccpanels/" target="_self">Dissecting the design and vulnerabilities in AZORult&nbsp;C&amp;C&nbsp;panels</a>
</h3>
<div class="ccm-page-list-description">
Aditya K Sood looks at the command-and-control (C&amp;C) design of the AZORult malware, discussing his team's findings related to the C&amp;C design and some security issues they identified during the research. </div>
</div>
<p><br /><a class="btn btn-block btn-warning" href="/virusbulletin/archive">Bulletin Archive</a></p> </div>
</div>
</div>

<footer class="bs-footer" role="contentinfo">
<div class="container">
<div class="bs-social">
<div class="row ">
<div class="col-md-3">
<p><a title="About Us" href="/about-vb/about-us/">About us</a></p>
<p><a title="Contact Us" href="/about-vb/contact-us/">Contact us</a></p>
<p><a title="Advisory Board" href="/about-vb/advisory-board/">Advisory board</a></p>
<p><a title="Press" href="/about-vb/press/">Press information</a></p>
<p><a title="Security Events Calendar" href="/resources/calendar/">Security events calendar</a></p>
<p><a title="Newsletter" href="/newsletter/">Virus Bulletin newsletter</a></p> </div>
<div class="col-md-3">
<p><a title="VB Testing" href="/testing/">Testing</a></p>
<p><a title="VB100" href="/testing/vb1001/">VB100</a></p>
<p><a title="VBSpam" href="/testing/vbspam/">VBSpam</a></p>
<p><a title="VBWeb" href="/testing/vbweb/">VBWeb</a></p>
<p><a title="Consultancy Services" href="/testing/consultancy-services/">Consultancy services</a></p>
<p><a title="The Spammers' Compendium" href="/resources/spammerscompendium/">Spammers' Compendium</a></p> </div>
<div class="col-md-3">
<p><a title="VB2021 localhost" href="/conference/vb2021/">VB2021 localhost</a></p>
<p><a title="VB2020 localhost" href="/conference/vb2020/">VB2020 localhost</a></p>
<p><a title="VB2019" href="/conference/vb2019/">VB2019 (London)</a></p>
<p><a title="VB2018" href="/conference/vb2018">VB2018 (Montreal)</a></p>
<p><a title="VB2017" href="/conference/vb2017">VB2017 (Madrid)</a></p>
<p><a title="Conference Archive" href="/conference/vb-conference-archive/">Older conferences</a></p> </div>
<div class="col-md-3">
<div class="row">
<table style="float: right;" border="0">
<tbody>
<tr>
<td align="center"><a href="/rss" target="_blank"><img title="Get our blog updates" src="/uploads/images/buttons/rss-square-gray.png" alt="rss.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://twitter.com/virusbtn" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on Twitter" src="/uploads/images/buttons/twitter-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.linkedin.com/company/virus-bulletin" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on LinkedIn" src="/uploads/images/buttons/linkedin-square-gray.png" alt="linkedin.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.facebook.com/virusbulletin" target="_blank"><img title="Visit us on Facebook" src="/uploads/images/buttons/fb-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.youtube.com/user/virusbtn" target="_blank"><img title="Visit us on Youtube" src="/uploads/images/buttons/youtube-square-gray.png" alt="youtube.png" width="35" height="35" /></a></td>
</tr>
</tbody>
</table>
</div> </div>
</div>
<div class="row ">
<div class="col-md-12">
</div>
</div>
</div>
</div>
</footer>

<footer class="bs-footer2" role="contentinfo">
<div class="container">
<div class="bs-social2">
<div class="row ">
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
</div>
<div class="row ">
<div class="col-md-12">
<p style="text-align: left;">©1989-2022 Virus Bulletin.        <a title="Privacy Policy" href="/about-vb/privacy-policy/">Privacy policy</a>        <a title="Cookies" href="/about-vb/privacy-policy/cookies/">Cookies</a>        <a title="Terms and Conditions" href="/about-vb/terms-and-conditions/">Terms and Conditions</a></p> </div>
</div>
</div>
</div>
</footer>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-21876594-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-21876594-2', { 'anonymize_ip': true });
</script><script type="text/javascript" src="/libraries/js/fancybox.load.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/app.js"></script>
<div id="ccm-cookiesDisclosure" class="disclosure-bottom">
<div class="disclosure-container">
<div class="disclosure-content">
<p> We have placed cookies on your device in order to improve the functionality of this site, as outlined in our <a href="/about-vb/privacy-policy/cookies" target="_blank">cookies policy</a>. However, you may delete and block all cookies from this site and your use of the site will be unaffected. By continuing to browse this site, you are agreeing to Virus Bulletin's use of data as outlined in our <a href="/about-vb/privacy-policy/" target="_blank">privacy policy</a>.</p>
</div>
<div class="disclosure-form">
<form action="/index.php/cookies_disclosure/" method="POST">
<input type="hidden" name="allowCookies" value="1" />
<div class="button">
<input class="btn btn-info btn-sm" type="submit" name="submit" value="I understand. Don't show this message again!" />
</div>
</form>
</div>
<div class="ccm-spacer">&nbsp;</div>
</div>
</div>
</body>
</html>