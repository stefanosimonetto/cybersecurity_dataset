<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://news.sophos.com/xmlrpc.php">
	<link rel="alternate" hreflang="es-419" href="https://news.sophos.com/es-419/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy" />
	<link rel="alternate" hreflang="nl-nl" href="https://news.sophos.com/nl-nl/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy" />
	<link rel="alternate" hreflang="pt-br" href="https://news.sophos.com/pt-br/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy" />
	<link rel="alternate" hreflang="de-de" href="https://news.sophos.com/de-de/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy" />
	<link rel="alternate" hreflang="en-us" href="https://news.sophos.com/en-us/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy" />
	<link rel="alternate" hreflang="fr-fr" href="https://news.sophos.com/fr-fr/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy" />
	<link rel="alternate" hreflang="es-es" href="https://news.sophos.com/es-es/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy" />
	<link rel="alternate" hreflang="it-it" href="https://news.sophos.com/it-it/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy" />
	<link rel="alternate" hreflang="ja-jp" href="https://news.sophos.com/ja-jp/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy" />
	<link rel="alternate" hreflang="zh-tw" href="https://news.sophos.com/zh-tw/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy" />
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl+ '&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x';f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5L6H3LN');</script>
<!-- End Google Tag Manager -->
<title>&#8220;Double agent&#8221;: a MacOS bundleware installer that acts like a spy &#8211; Sophos News</title>
<meta name='robots' content='max-image-preview:large' />
<!-- Jetpack Site Verification Tags -->
<meta name="google-site-verification" content="8r1qg681OjOolfxmHEY1IYupmTBdyKXc-OPfpgeQHFk" />
<link rel='dns-prefetch' href='//cdn.jsdelivr.net' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Feed" href="https://news.sophos.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Comments Feed" href="https://news.sophos.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; &#8220;Double agent&#8221;: a MacOS bundleware installer that acts like a spy Comments Feed" href="https://news.sophos.com/en-us/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy/feed/" />
<script type="text/javascript">
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/news.sophos.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.0.1"}};
/*! This file is auto-generated */
!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode,e=(p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0),i.toDataURL());return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([129777,127995,8205,129778,127999],[129777,127995,8203,129778,127999])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(e=t.source||{}).concatemoji?c(e.concatemoji):e.wpemoji&&e.twemoji&&(c(e.twemoji),c(e.wpemoji)))}(window,document,window._wpemojiSettings);
</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 0.07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0' href='https://news.sophos.com/_static/??-eJyNj9EOwjAIRX/IDpeomQ/Gb+komSjtmsJi+vfOmSXbm48XOMCBd3acUKZACqgKgdWglxFfTrgvvlRQq0JN5NTMAwfYEk+FSIE9CUVKtgtZfKXihAaP9T987m3zDsIx2XJiclmmgZOCki/4ABKvxpgLrf9/RcpcNgouj2rqfkaLia5r7/HWXs5ddzq21+4DN6hjBg==' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='global-styles-inline-css'>
body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--duotone--dark-grayscale: url('#wp-duotone-dark-grayscale');--wp--preset--duotone--grayscale: url('#wp-duotone-grayscale');--wp--preset--duotone--purple-yellow: url('#wp-duotone-purple-yellow');--wp--preset--duotone--blue-red: url('#wp-duotone-blue-red');--wp--preset--duotone--midnight: url('#wp-duotone-midnight');--wp--preset--duotone--magenta-yellow: url('#wp-duotone-magenta-yellow');--wp--preset--duotone--purple-green: url('#wp-duotone-purple-green');--wp--preset--duotone--blue-orange: url('#wp-duotone-blue-orange');--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
</style>
<link rel='stylesheet' id='all-css-2' href='https://news.sophos.com/_static/??/wp-content/themes/sophosnews-2017/style-2021.css,/wp-content/mu-plugins/jetpack-11.1/css/jetpack.css?m=1658840194' type='text/css' media='all' />
<script type="text/javascript" src="https://news.sophos.com/_static/??-eJzTLy/QzcxLzilNSS3WzwKiwtLUokoopZebmaeXVayjj0+Rbm5melFiSSpUsX2uraGZqYWFkTmQyAIAr9AiMg==" ></script><link rel="https://api.w.org/" href="https://news.sophos.com/wp-json/" /><link rel="alternate" type="application/json" href="https://news.sophos.com/wp-json/wp/v2/posts/54118" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://news.sophos.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://news.sophos.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 6.0.1" />
<link rel="canonical" href="https://news.sophos.com/en-us/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy/" />
<link rel='shortlink' href='https://news.sophos.com/?p=54118' />
<link rel="alternate" type="application/json+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2020%2F03%2F17%2Fdouble-agent-a-macos-bundleware-installer-that-acts-like-a-spy%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2020%2F03%2F17%2Fdouble-agent-a-macos-bundleware-installer-that-acts-like-a-spy%2F&#038;format=xml" />
<style>img#wpstats{display:none}</style>
	<link rel="amphtml" href="https://news.sophos.com/en-us/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="&#8220;Double agent&#8221;: a MacOS bundleware installer that acts like a spy" />
<meta property="og:url" content="https://news.sophos.com/en-us/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy/" />
<meta property="og:description" content="Security software frequently blocks “bundleware” installers &#8211; software distribution tools that bundle their advertised applications with (usually undesired) additional software &#8211; as pot…" />
<meta property="article:published_time" content="2020-03-17T08:00:58+00:00" />
<meta property="article:modified_time" content="2021-08-26T08:58:50+00:00" />
<meta property="og:site_name" content="Sophos News" />
<meta property="og:image" content="https://news.sophos.com/wp-content/uploads/2020/03/stierlitz.jpg?w=640" />
<meta property="og:image:secure_url" content="https://news.sophos.com/wp-content/uploads/2020/03/stierlitz.jpg?w=640" />
<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="384" />
<meta property="og:image:alt" content="" />
<meta property="og:locale" content="en_US" />
<meta property="fb:admins" content="28552295016" />
<meta name="twitter:text:title" content="&#8220;Double agent&#8221;: a MacOS bundleware installer that acts like a spy" />
<meta name="twitter:image" content="https://news.sophos.com/wp-content/uploads/2020/03/stierlitz.jpg?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=32" sizes="32x32" />
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=192" sizes="192x192" />
<link rel="apple-touch-icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=180" />
<meta name="msapplication-TileImage" content="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=270" />
</head>

<body class="post-template-default single single-post postid-54118 single-format-standard group-blog">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5L6H3LN&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div id="page" class="hfeed site">
	<a class="sr-only" href="#content">Skip to content</a>

	
<header class="bg-blue-600" x-data="{ mobileMenu: false, searchField: false }">
	<div class="container">
		<div class="flex items-center justify-between h-16">

			<!-- Logo -->
			<div class="flex-shrink-0">
				<a class="site-logo" href="https://news.sophos.com/en-us/" rel="home">
				<svg width="172" height="17" xmlns="http://www.w3.org/2000/svg">
					<g fill="#FFF" fill-rule="evenodd">
						<path d="M113.024 5.298V16.74h-2.595V.259h2.265l7.997 11.49V.26h2.619v16.482h-2.289l-7.997-11.443M126.064.259h10.78v2.307H128.8v4.521h7.549v2.214h-7.55v5.133h8.376v2.307h-11.111V.259M138.478.259h2.855l2.694 12.29L147.29.26h2.783l3.61 12.314L156.005.26h2.783l-3.62 16.482h-2.76l-3.751-12.126-3.426 12.126h-2.784L138.478.259M168.933 4.968v-.283c0-1.318-.778-2.425-3.492-2.425-2.43 0-3.279 1.013-3.279 2.284 0 1.201.708 1.743 2.218 2.073l3.491.776c2.123.448 4.129 1.602 4.129 4.333 0 3.014-1.675 5.274-6.204 5.274-5.214 0-6.559-2.26-6.559-4.52v-.307h2.737v.26c0 1.2.755 2.284 3.774 2.284 2.5 0 3.421-1.084 3.421-2.638 0-1.224-.731-1.907-2.289-2.237l-3.49-.777c-2.407-.517-3.917-1.742-3.917-4.309 0-2.566 1.77-4.756 6.016-4.756 4.553 0 6.18 2.26 6.18 4.639v.33h-2.736M85.303 16.718h8.88c2.492 0 3.549-.15 4.379-.677 1.308-.803 2.139-2.378 2.139-4.162 0-1.457-.504-2.868-1.258-3.622-.981-1.006-2.316-1.382-4.783-1.382h-2.693c-1.208 0-2.097-.05-2.6-.276-.605-.277-.956-.81-.956-1.562 0-.88.427-1.455 1.132-1.632.529-.124 1.14-.124 2.726-.15h7.949V.265h-8.754c-1.963 0-2.843.075-3.598.353-1.737.602-2.921 2.383-2.921 4.518 0 1.458.58 2.745 1.587 3.624.881.753 2.189 1.105 4.202 1.105h3.584c.805 0 1.46.1 1.813.3.678.327 1.08.934 1.08 1.714 0 .652-.301 1.122-.83 1.447-.426.278-1.158.403-2.49.403h-8.588v2.99zm-84.945 0h8.88c2.492 0 3.549-.15 4.38-.677 1.307-.803 2.138-2.378 2.138-4.162 0-1.457-.504-2.868-1.258-3.622-.982-1.006-2.316-1.382-4.783-1.382H7.023c-1.209 0-2.098-.05-2.6-.276-.605-.277-.957-.81-.957-1.562 0-.88.427-1.455 1.132-1.632.53-.124 1.141-.124 2.726-.15h7.95V.265H6.52c-1.964 0-2.844.075-3.6.353C1.185 1.22 0 3 0 5.136 0 6.594.582 7.881 1.587 8.76c.881.753 2.19 1.105 4.203 1.105h3.582c.807 0 1.46.1 1.814.3.678.327 1.08.934 1.08 1.714 0 .652-.3 1.122-.83 1.447-.426.278-1.157.403-2.49.403H.358v2.99zM71.99 4.596c-.52.813-.765 2.118-.765 3.87 0 3.845 1.331 5.595 4.294 5.595 2.915 0 4.248-1.75 4.248-5.546 0-3.847-1.308-5.571-4.248-5.571-1.604 0-2.864.592-3.53 1.652zm10.05-1.897c1.013 1.33 1.58 3.498 1.58 6.039 0 2.882-.914 5.249-2.544 6.555-1.233.986-3.11 1.528-5.335 1.528-3.16 0-5.654-1.037-6.937-2.884-.964-1.355-1.435-3.155-1.435-5.35 0-3.152.866-5.544 2.495-6.826C71.149.726 73.175.158 75.497.158c2.938 0 5.284.913 6.543 2.54zM65.36.279h-3.507v6.73h-6.345V.278h-3.507v16.439h3.507V9.94h6.345v6.778h3.506V.278zM43.533 8.042c.938 0 1.48-.123 1.852-.469.442-.37.715-1.158.715-2.07 0-1.084-.443-1.872-1.208-2.144-.272-.1-.717-.149-1.286-.149h-4.839v4.832h4.766zm-4.766 8.674h-3.507V.278h8.223c2.889 0 3.902.295 4.988 1.504.964 1.036 1.481 2.39 1.481 3.845 0 1.725-.69 3.327-1.826 4.289-.962.813-1.854 1.058-3.728 1.058h-5.63v5.743zM21.665 4.596c-.519.813-.764 2.118-.764 3.87 0 3.845 1.333 5.595 4.297 5.595 2.913 0 4.247-1.75 4.247-5.546 0-3.847-1.308-5.571-4.247-5.571-1.606 0-2.866.592-3.533 1.652zm10.052-1.897c1.014 1.33 1.581 3.498 1.581 6.039 0 2.882-.914 5.249-2.545 6.555-1.233.986-3.11 1.528-5.333 1.528-3.162 0-5.656-1.037-6.94-2.884-.964-1.355-1.432-3.155-1.432-5.35 0-3.152.865-5.544 2.496-6.826C20.825.726 22.85.158 25.173.158c2.938 0 5.286.913 6.544 2.54z"/>
					</g>
				</svg>
				</a>
			</div>

			<!-- Search Field -->
			<div class="lg:flex justify-end flex-grow hidden" x-show="searchField" x-cloak>
				<div class="relative w-1/2 rounded-md shadow-sm">
					<form role="search" method="get" action="https://news.sophos.com/en-us/">
						<input
							type="text"
							class="block w-full text-lg text-white placeholder-gray-100 bg-blue-800 border-0 rounded-md font-sansMedium font-medium"
							placeholder="Type to Search News"
							x-ref="searchInput"
							name="s"
						/>
						<div class="absolute inset-y-0 right-0 flex items-center px-3">
							<button
								class="hover:opacity-100 opacity-60 p-1 text-xs text-white uppercase rounded-full cursor-pointer"
								type="submit"
							>
								Search							</button>
						</div>
					</form>
				</div>
			</div>

			<!-- Main Nav -->
			<div class="lg:flex items-center flex-grow hidden" x-show="!searchField" x-cloak>
				<div class="flex ml-auto">
				<ul id="menu-en-us-primary" class="primary-menu"><li id="menu-item-77773" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-77773"><a href="https://news.sophos.com/en-us/category/products-services/">Products &amp; Services<div class="menu-item-description"></div></a></li>
<li id="menu-item-77772" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-77772"><a href="https://news.sophos.com/en-us/category/security-operations/">Security Operations<div class="menu-item-description"></div></a></li>
<li id="menu-item-77774" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-77774"><a href="https://news.sophos.com/en-us/category/threat-research/">Threat Research<div class="menu-item-description"></div></a></li>
<li id="menu-item-85326" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-85326"><a href="https://news.sophos.com/en-us/category/ai-research/">AI Research<div class="menu-item-description"></div></a></li>
<li id="menu-item-77776" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-77776"><a href="https://nakedsecurity.sophos.com">Security News<div class="menu-item-description"></div></a></li>
<li id="menu-item-83702" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-83702"><a href="https://news.sophos.com/en-us/category/sophos-life/">Sophos Life<div class="menu-item-description"></div></a></li>
</ul>				</div>
			</div>

			<!-- Search button -->
			<div class="lg:block hidden ml-4">
				<div class="flex items-center">
					<button
					class="border-2 border-transparent hover:border-white inline-flex items-center justify-center p-2 text-white rounded-md focus:outline-none transition-colors"
					@click.prevent="searchField = !searchField; $nextTick(() => { setTimeout(() => { $refs.searchInput.focus(); }, 150);});"
					>
						<span class="sr-only">Search</span>
						<!-- Heroicon name: outline/bell -->
						<svg
							class="w-5 h-5"
							xmlns="http://www.w3.org/2000/svg"
							fill="none"
							viewBox="0 0 24 24"
							stroke="currentColor"
							:class="{ 'block': !searchField, 'hidden': searchField }"
						>
							<path
							stroke-linecap="round"
							stroke-linejoin="round"
							stroke-width="3"
							d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
							/>
						</svg>
						<svg
							class="hidden w-5 h-5"
							xmlns="http://www.w3.org/2000/svg"
							fill="none"
							viewBox="0 0 24 24"
							stroke="currentColor"
							aria-hidden="true"
							:class="{ 'block': searchField, 'hidden': !searchField }"
						>
							<path
							stroke-linecap="round"
							stroke-linejoin="round"
							stroke-width="3"
							d="M6 18L18 6M6 6l12 12"
							/>
						</svg>
					</button>
				</div>
			</div>

			<!-- Mobile menu button -->
			<div class="lg:hidden flex -mr-2">
				<button
					type="button"
					class="hover:text-white hover:bg-blue-800 focus:outline-none hover:ring-2 focus:ring-offset-2 focus:ring-offset-gray-300 focus:ring-white inline-flex items-center justify-center p-2 text-white rounded-md"
					aria-controls="mobile-menu"
					aria-expanded="false"
					@click="mobileMenu = !mobileMenu"
				>
					<span class="sr-only">Open main menu</span>
					<!--
						Heroicon name: outline/menu

						Menu open: "hidden", Menu closed: "block"
					-->
					<svg
					class="block w-6 h-6"
					xmlns="http://www.w3.org/2000/svg"
					fill="none"
					viewBox="0 0 24 24"
					stroke="currentColor"
					:class="{ 'block': !mobileMenu, 'hidden': mobileMenu }"
					>
					<path
						stroke-linecap="round"
						stroke-linejoin="round"
						stroke-width="3"
						d="M4 6h16M4 12h16m-7 6h7"
					/>
					</svg>
					<!--
						Heroicon name: outline/x

						Menu open: "block", Menu closed: "hidden"
					-->
					<svg
					class="hidden w-6 h-6"
					xmlns="http://www.w3.org/2000/svg"
					fill="none"
					viewBox="0 0 24 24"
					stroke="currentColor"
					aria-hidden="true"
					:class="{ 'block': mobileMenu, 'hidden': !mobileMenu }"
					>
					<path
						stroke-linecap="round"
						stroke-linejoin="round"
						stroke-width="3"
						d="M6 18L18 6M6 6l12 12"
					/>
					</svg>
				</button>
			</div>
		</div>
	</div>

	<!-- Mobile menu, show/hide based on menu state. -->
	<div
	class="lg:hidden container"
	x-show="mobileMenu"
	x-cloak
	x-transition:enter="transition-all ease-out duration-100"
	x-transition:enter-start="transform opacity-0 scale-95"
	x-transition:enter-end="transform opacity-100 scale-100"
	x-transition:leave="transition ease-in duration-75"
	x-transition:leave-start="transform opacity-100 scale-100"
	x-transition:leave-end="transform opacity-0 scale-95"
	>
		<div class="pt-2 pb-8 space-y-2">
			<div class="relative rounded-md shadow-sm">
				<form role="search" method="get" action="https://news.sophos.com/en-us/">
					<input
						type="text"
						class="focus:ring-blue-600 focus:border-blue-600 sm:text-sm block w-full placeholder-gray-600 border-gray-300 rounded-md"
						placeholder="Search News"
						name="s"
					/>
					<div
						class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none"
					>
						<button class="p-1 text-gray-500 rounded-full" type="submit">
							<span class="sr-only">Search</span>
							<!-- Heroicon name: outline/bell -->
							<svg
								class="w-4 h-4"
								xmlns="http://www.w3.org/2000/svg"
								fill="none"
								viewBox="0 0 24 24"
								stroke="currentColor"
							>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="3"
									d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
								/>
							</svg>
						</button>
					</div>
				</form>
			</div>

			<ul id="menu-en-us-primary-1" class="mobile-menu"><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-77773"><a href="https://news.sophos.com/en-us/category/products-services/">Products &amp; Services<div class="menu-item-description"></div></a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-77772"><a href="https://news.sophos.com/en-us/category/security-operations/">Security Operations<div class="menu-item-description"></div></a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-77774"><a href="https://news.sophos.com/en-us/category/threat-research/">Threat Research<div class="menu-item-description"></div></a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-85326"><a href="https://news.sophos.com/en-us/category/ai-research/">AI Research<div class="menu-item-description"></div></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-77776"><a href="https://nakedsecurity.sophos.com">Security News<div class="menu-item-description"></div></a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-83702"><a href="https://news.sophos.com/en-us/category/sophos-life/">Sophos Life<div class="menu-item-description"></div></a></li>
</ul>		</div>
	</div>
</header>

	<div id="content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-54118" class="post-54118 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut category-threat-research region-en-us">

		<div class="md:mt-16 container mt-8">
		<div class="relative max-w-5xl mx-auto">
				<div
						class="aspect-w-16 aspect-h-9 flex bg-gray-400 bg-right bg-no-repeat bg-cover"
				>
					<img width="1200" height="720" src="https://news.sophos.com/wp-content/uploads/2020/03/stierlitz.jpg?w=1200" class="object-cover wp-post-image" alt="" srcset="https://news.sophos.com/wp-content/uploads/2020/03/stierlitz.jpg 1300w, https://news.sophos.com/wp-content/uploads/2020/03/stierlitz.jpg?resize=300,180 300w, https://news.sophos.com/wp-content/uploads/2020/03/stierlitz.jpg?resize=768,461 768w, https://news.sophos.com/wp-content/uploads/2020/03/stierlitz.jpg?resize=1024,614 1024w" sizes="(max-width: 1200px) 100vw, 1200px" />				</div>
								<div
						class="left-4 w-24 h-24 lg:left-12 xl:left-16 lg:w-40 lg:h-40 place-items-center absolute top-0 grid  "
				>
										<img
							src="https://news.sophos.com/wp-content/uploads/2022/07/Category-Icon-X-Ops-v2.png"
							alt="Threat Research"
					/>
														</div>
						</div>
	</div>


			
	<header>
		<div class="container mt-8 md:mt-16 md:-mb-4">
			<div class="max-w-4xl mx-auto">

				<h1 class="text-style-h1 mb-8">&#8220;Double agent&#8221;: a MacOS bundleware installer that acts like a spy</h1>
				
				<div class="text-xl md:text-xl -mt-2">
					<span class="byline">
		Written by 				<span class="author vcard">
				<a href="https://news.sophos.com/en-us/author/sergei-shevchenko/" title="Posts by Sergei Shevchenko" class="author url fn" rel="author">Sergei Shevchenko</a>				</span>
								</span>
						</div>

				<div class="text-sophos-gray-600 mt-4 text-xs font-sansSemiBold font-semibold leading-tight uppercase">
					<span class="posted-on"><a href="https://news.sophos.com/en-us/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy/" rel="bookmark">March 17, 2020</a></span>				</div>

				<div class="mt-6 space-y-2 space-x-1">
					<a href="https://news.sophos.com/en-us/category/threat-research/sophoslabs-uncut/" class="category-tag-pill">SophosLabs Uncut</a> <a href="https://news.sophos.com/en-us/category/threat-research/" class="category-tag-pill">Threat Research</a>				</div>
			</div>
		</div>
	</header><!-- .entry-header -->

	<div class="container md:my-16 xl:my-24 my-8">
	<div class="entry-content lg:prose-lg mx-auto prose max-w-4xl">
		<p>Security software frequently blocks “bundleware” installers &#8211; software distribution tools that bundle their advertised applications with (usually undesired) additional software &#8211; as potentially undesirable applications. But one widely-used software distribution tool for MacOS applications goes to great lengths to avoid being blocked as “bundleware” &#8211; using a number of anti-forensics techniques that are more common in malware code. The installer is from a legitimate company, which claims to reach over 1 billion users per month with its various downloaders and adware platforms.</p>
<p>This software attempts to evade blocking by endpoint protection systems with anti-debugging code, strings and API encryption, runtime decompression and virtual machine detection. Its developers went as far as to embed a full backdoor-like component into the installer that allows remote injection of new code into the installer &#8211; granting it capabilities that extend far beyond what one might expect from a piece of installation software.</p>
<p>This particular bundleware has potential access to a large number of Macs around the world. The power given to the installer practically enables full control over the target system. Even if this was done so that the company behind it would have &#8216;advanced analytics&#8217; or the ability to push any third-party software it wants, given the amount of power it aggregates, what happens if this power is abused?</p>
<p>We&#8217;re not naming the company or the installer here because of its wide distribution; this research is entirely focused on technical aspects of the reverse-engineered software. The developers have been contacted by researchers, but have shown no interest in changing what they see as a feature of their installer, as long as it allows them to monetize the installations of their software.</p>
<h3>The allure of bundleware</h3>
<p>MacOS application developers use third-party installers for a number of reasons. One of the reasons often given is the desire to improve the overall &#8220;user experience&#8221; of software installation. Many developers turn to application installation platforms because they promise enhanced installation analytics, an optimized footprint, and a guaranteed smoothness of installation.</p>
<p>But these installers offer another attraction that is more important to many developers: the promise of monetization. Developers or websites distributing freeware (such as free games) or software based on open source components may not be able to charge for the applications, but they can capture some revenue by teaming with a third-party installation tool.</p>
<p>Some of these application installation platforms bundle the title application with third-party software such as adware or browser toolbars, leading to a setup that the end-user might find unwanted. Once the target application is installed, users often encounter undesirable consequences, such as installed browser hijackers that modify the search engine for their web browser. In some cases, these inject messages for &#8220;scare-ware&#8221; removers that prompt the user to pay for the removal of non-exist threats.</p>
<p>Apple actively combats these types of unethical applications, which the company labels as &#8221; <a href="https://developer.apple.com/support/protecting-users-from-suspicious-software/">suspicious software</a> .&#8221; In 2019, starting with macOS 10.14.5 (Mojave), Apple began requiring application developers to submit their code for &#8221; <a href="https://developer.apple.com/news/?id=04102019a">notarization</a> &#8220;, and blocking applications without notarisation or with revoked developer signatures by macOS&#8217;s <a href="https://support.apple.com/en-us/HT202491">Gatekeeper</a> . Apple can revoke notarisation and the developer accounts associated with applications that are found to be abusive. But bundleware installers may not get flagged as &#8220;suspicious&#8221; in the notarization process.</p>
<p>Detecting bundleware is almost never a problem for endpoint protection systems &#8211; it&#8217;s a much more simplistic breed, so to speak, than malware. But the bundleware package we examine here, already blocked by a number of endpoint protection tools as a potentially unwanted application, adopts many anti-forensics and counter-detection techniques that have in the past been found mostly in malware.</p>
<h3>The Application</h3>
<p>The bundleware described in this post is a Cocoa application &#8211; an application built with the <a href="https://developer.apple.com/documentation/appkit">AppKit</a> framework, and is distributed as an <a href="https://developer.apple.com/library/archive/documentation/CoreFoundation/Conceptual/CFBundles/AboutBundles/AboutBundles.html">application bundle</a> . From sample to sample, the name of the main executable varies. For example, it can be named as <code>radiosurgical</code>or <code>Herculid</code>.</p>
<p>The digital signature used to sign the app varies, as this is generated by the developer packaging the application with the installer. Some observed installers are signed by “Owen Bell”. Some other installers were found to be signed by “RuiQing Software Technology Beijing Inc.” or “AVSoftware EOOD”.</p>
<h3>The main executable</h3>
<p>Compiled as Mach-O (the native executable file format for macOS), the main executable relies on Objective-C runtime <code>libobjc.dylib</code>. When the kernel first loads the main executable, it makes sure that the executable is a valid Mach-O file, and then examines its <code>mach_header</code>structure.</p>
<p>Next, it loads the dynamic linker to load all the shared libraries that the main executable links against. The dynamic linker then initializes the Objective-C runtime, and then calls the program&#8217;s <em>main ()</em> function.</p>
<p>However, the main executable&#8217;s entry point starts from garbage bytes &#8211; that is, it has no valid code to execute:</p>
<pre style="background-color: #000064;line-height: 125%;color: silver;padding-top: 1em;padding-bottom: 1em">__text: 0000000100001150 <span style="color: white">04 </span>     <span style="color: yellow">start</span>     db     <span style="color: cyan">4</span>  
__text: 0000000100001151 <span style="color: white">4A</span>                db     <span style="color: cyan">4Ah</span> ; J 
__text: 0000000100001152 <span style="color: white">3E</span>                db     <span style="color: cyan">3Eh</span> ; &gt;</pre>
<p>With no valid code at the entry point, how does it run without crashing? The answer lays in Objective-C&#8217;s concept of <em>non-lazy</em> (&#8216;eager&#8217;) and <em>lazy</em> (&#8216;on-demand&#8217;) implementation of classes.</p>
<p><em>Non-lazy</em> classes are realized when the program starts up. These classes will always implement <em>+ load</em> method. Contrary to that, <em>lazy</em> classes (classes without <em>+ load</em> method) do not have to be realized immediately, but only when they receive a message for the first time (hence the term &#8216;lazy&#8217;).</p>
<p>Let&#8217;s check out Objective-C Runtime&#8217;s own <a href="https://opensource.apple.com/source/objc4/objc4-532/runtime/objc-runtime-new.mm">source,</a> found in <code>objc-runtime-new.mm</code> file. The snippet below realizes the <em>non-lazy</em> classes, retrieved with <em>_getObjc2NonlazyClassList ()</em> call:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em"><span style="color: #008000">// Realize non-lazy classes (for + load methods and static instances) </span>
<span style="color: #0000ff">for</span> (EACH_HEADER) {
     <span style="color: #2b91af">classref_t</span> * classlist = _getObjc2NonlazyClassList (hi, &amp; count);
    <span style="color: #0000ff">for</span> (i = 0; i &lt;count; i ++) { 
        realizeClass (remapClass (classlist [i])); 
    } 
}
</pre>
<p>Looking at the Objective-C Runtime&#8217;s <a href="https://github.com/opensource-apple/objc4/blob/master/runtime/objc-file.mm">source</a> in <code>objc-file.mm</code>, one can see that <em>_getObjc2NonlazyClassList ()</em> function collects <em>non-lazy</em> classes from the <code>__objc_nlclslist</code>data section:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em">GETSECT (_getObjc2NonlazyClassList,    <span style="color: #008000">// function name </span>
         <span style="color: #2b91af">classref_t</span> ,                  <span style="color: #008000">// content type </span>
         <span style="color: #a31515">"__objc_nlclslist"</span> );         <span style="color: #008000">// section name - 'nl' stands for non-lazy</span>
</pre>
<p>In the case of our bundleware executable, the <code>__objc_nlclslist</code>data section of the main binary is very small. It enlists only two <em>non-lazy</em> classes: <code>ListedUpaithric</code>and <code>__ARCLite__</code>:</p>
<pre style="background-color: #000064;line-height: 125%;color: silver;padding-top: 1em;padding-bottom: 1em">__objc_nlclslist: 0001000692C8     <span style="color: yellow">__objc_nlclslist segment para public 'DATA' use64</span>  
__objc_nlclslist: 0001000692C8 dq offset <span style="color: yellow">_OBJC_CLASS _ $ _ ListedUpaithric</span>  
__objc_nlclslist: 0001000692D0 dq offset <span style="color: yellow">_OBJC_CLASS _ $ ___ ARCLite__</span>  
__objc_nlclslist: 0001000692D0     <span style="color: yellow">__objc_nlclslist ends</span></pre>
<p>The <code>ListedUpaithric</code>name, like many of the other class names in the executable, is random. For example, in another sample this class is called <code>HoundingHusky</code>.</p>
<p>These two non-lazy classes will be called in the order they&#8217;re listed, realized by their <em>+ load </em> method.  However, at first glance the <em>+ load</em> method of the <code>__ARCLite__</code>class contains no valid code, because it is located within the <code>__text</code>section of the executable &#8211; which is encrypted.</p>
<h3>Finding a secret agent</h3>
<p>The <em>+ load</em> method of the <code>ListedUpaithric</code>class is physically located in a section of the executable that has a random name, such as <code>__amorpha</code>or <code>__mottled</code>. Once run, the <em>+ load</em> method will take a 32-byte XOR key hard-coded in the body and then use that key to decrypt the <code>__text</code>section (around 15KB in size) of the executable, including the <em>+ load</em> method of the <code>__ARCLite__</code>class.</p>
<p>The decryption routine relies on a special anchor stored in the <code>__text</code>section. The virtual address of this anchor is used to describe the virtual address and virtual size of the encrypted <code>__text</code>section.</p>
<p>For example, in this particular sample, the anchor can be located at the virtual address <code>0x100001CF0</code>, as shown below:</p>
<pre style="background-color: #000064;line-height: 125%;color: silver;padding-top: 1em;padding-bottom: 1em">__text: 000100001CF0 23        <span style="color: yellow">anchor </span>      <span style="color: cyan">db 23h</span> ; #      <span style="color: cyan">; DATA XREF: decrypt_code + 101</span>  
__text: 000100001CF1 2B                     <span style="color: cyan">db 2Bh</span> ; + 
...</pre>
<p>The decryptor uses the address of the anchor to describe the parameters of the <code>__text</code> section. In the snippet below, the decryptor makes the <code>__text</code> section writable and executable, by assigning a new protection to it. To do that, it takes the address of the anchor <code>0x100001CF0</code> and subtracts <code>0xBA0</code> from it to locate the start of the <code>__text</code> section &#8211; <code>0x100001150</code>:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em">vm_protect (mach_task_self (),          <span style="color: #008000">// decoded stings: 'vm_protect', 'mach_task_self_'</span>  
            ( <span style="color: #2b91af">char</span> *) &amp; anchor - 0xBA0,    <span style="color: #008000">// 0x100001150 -&gt; start of the __text section</span>  
            0x37F2,                    <span style="color: #008000">// size of the entire __text section: 14,322 bytes</span> 
            0 , 
            VM_PROT_ALL)               <span style="color: #008000">// assign read, write, and execute access rights</span>
</pre>
<p>Once the entire <code>__text</code>section is decrypted, the anchor shown above gets decrypted into the following text:</p>
<pre style="background-color: #000064;line-height: 125%;color: silver;padding-top: 1em;padding-bottom: 1em">__text: 000100001CF0 MaximMaximovicIsayev db ' <span style="color: #00ff00">Maxim Maximovich Isayev</span> ', <span style="color: #00ff00">0</span></pre>
<p>The resulting text is the same across all the samples we&#8217;ve looked at, and is quite interesting by itself. Maxim Maximovich Isayev (Максим Максимович Исаев) is the Russian name of Max Otto von Stierlitz, the lead <a href="https://en.wikipedia.org/wiki/Stierlitz">character</a> in a popular Russian book series written in the 1960s, and of the most popular Soviet television series ever, <em>Seventeen Moments of Spring</em> .</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2018/11/image1.jpeg"><img loading="lazy" class="alignnone size-medium wp-image-54150" src="https://news.sophos.com/wp-content/uploads/2018/11/image1.jpeg?w=300" alt="" width="300" height="223" srcset="https://news.sophos.com/wp-content/uploads/2018/11/image1.jpeg 640w, https://news.sophos.com/wp-content/uploads/2018/11/image1.jpeg?resize=300,223 300w" sizes="(max-width: 300px) 100vw, 300px" /></a>A Soviet James <a href="http://www.bbc.com/news/magazine-39862225">Bond</a> , Stierlitz takes a key role in SS Reich Main Security Office in Berlin during World War II. Working as a deep undercover agent within SS, he diverts the German nuclear &#8220;Vengeance Weapon&#8221; research program into a fruitless dead-end.</p>
<p>Leaving a hidden marker like that could indicate an intentionally planted false flag. Regardless of the intention, this marker stays constant across the entire family of this bundleware.</p>
<p>After the <code>ListedUpaithric</code> class is called and decrypts the text, being next in line, the <em>+ load</em> method of the <code>__ARCLite__</code> <em>non-lazy</em> class is called to perform further initialization. The decrypted <code>__text</code> section is quite small &#8211; it&#8217;s a valid code section containing a valid entry point in it, and it consists of another layer of decryptor and decompressor:</p>
<pre style="background-color: #000064;line-height: 125%;color: silver;padding-top: 1em;padding-bottom: 1em">__text: 0000000100001150             <span style="color: yellow">public start</span>  
__text: 0000000100001150      <span style="color: yellow">start proc near</span>  
__text: 0000000100001150 push    <span style="color: cyan">0</span> 
__text: 0000000100001152 mov rbp, rsp 
__text: 0000000100001155 and rsp, <span style="color: cyan">0FFFFFFFFFFFFFFF0h</span>  
__text: 0000000100001159 mov rdi, [rbp + <span style="color: cyan">8</span> ]</pre>
<p>With both <em>non-lazy</em> classes realized, the entry point above receives control. From there, the <em>main ()</em> function of the executable is called, followed with <em>_exit ()</em> .</p>
<h3>The main () function</h3>
<p>Once the entry point within <code>__text</code>section is called, the <em>main ()</em> function that follows it will read an internal chunk of data with the size of ~ 300KB.</p>
<p>This encrypted data is stored in a separate section of the executable.</p>
<p>The data will be read, its CRC32-based hash validated, then decrypted and further decompressed into a buffer, allocated with <em>vm_allocate ()</em> function.</p>
<p>The decompression is achieved by dynamically loading <code>libz.1.dylib</code> library, and calling <em>uncompress ()</em> API from it.</p>
<p>The decompressed data has a size of ~ 800Kb, having a format of Mach-O executable ( <code>MH_BUNDLE</code> type). This data is loaded from memory as a plugin with the help of <em>NSCreateObjectFileImageFromMemory ()</em> and <em>NSLinkModule ()</em> APIs.</p>
<p>This method is equivalent to dynamic DLL loading on Windows. It is described on macOS man <a href="http://mirror.informatimago.com/next/developer.apple.com/documentation/Darwin/Reference/ManPages/man3/NSModule.3.html">page</a> as a way to programmatically load <a href="http://mirror.informatimago.com/next/developer.apple.com/documentation/Darwin/Reference/ManPages/man3/NSObjectFileImage.3.html">plugins</a> after a program starts executing.</p>
<h3>The Engine</h3>
<p>The loaded module represents itself an engine driven by the JavaScript files.</p>
<p>Some of the scripts reside in the app&#8217;s Resources directory in an encrypted form, forming an SDK. Other JavaScript files are fetched from a remote server as tasks (internally called &#8216;offers&#8217; as they are designed to offer / advertise other products).</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2018/11/engine_schema.png"><img loading="lazy" class="alignnone size-full wp-image-63212" src="https://news.sophos.com/wp-content/uploads/2018/11/engine_schema.png" alt="" width="640" height="242" srcset="https://news.sophos.com/wp-content/uploads/2018/11/engine_schema.png 1720w, https://news.sophos.com/wp-content/uploads/2018/11/engine_schema.png?resize=300,113 300w, https://news.sophos.com/wp-content/uploads/2018/11/engine_schema.png?resize=768,290 768w, https://news.sophos.com/wp-content/uploads/2018/11/engine_schema.png?resize=1024,387 1024w, https://news.sophos.com/wp-content/uploads/2018/11/engine_schema.png?resize=1536,580 1536w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>The downloaded tasks rely on high-level function calls from the SDK. This allows composing tasks with a very flexible logic.</p>
<p>There are several classes exposed by the engine to the SDK, such as:</p>
<ul>
<li>System controller</li>
<li>Install</li>
<li>Screenshot controller</li>
<li>Task manager</li>
<li>Collector info system</li>
<li>Event reporter</li>
<li>Application manager</li>
<li>File downloader</li>
</ul>
<p>The engine itself is executed on macOS platform natively.</p>
<p>For example, a JavaScript task may attempt to elevate the privilege level with the following call:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em">function relaunchWithRoot () { 
    installer.relaunchingWithRoot = true; 
    var successR = installer.elevatePrivilegedTask ();</pre>
<p>The <em>elevatePrivilegedTask ()</em> call in JavaScript has a corresponding method in the engine&#8217;s class, such as <code>tr54jds23</code>. The engine exposes this method to JavaScript code so that it can be called directly from the engine.</p>
<p>When <code>tr54jds23</code> -&gt; <em>elevatePrivilegedTask ()</em> is executed, the engine calls another method: <code>ICTaskManager</code> -&gt; <em>elevatePrivilegedTask ()</em> .</p>
<p>That will, in turn, create a task <code>ICTaskManager</code>-&gt; <em>root_Task</em> . The task will then create an authorization with the <code>system.privilege.admin</code>flag. Next, the task is executed with the <em>AuthorizationExecuteWithPrivileges ()</em> call.</p>
<p>In practice, this may invoke a dialog asking for admin password so that the task can be executed as root.</p>
<h3>String / API Encryption</h3>
<p>The engine module stores the names of all critical functions and most critical strings encoded. In one of the analyzed samples, there are 1,228 encoded strings, decoded with 1,055 different functions. That is, some strings are decoded with the same function.</p>
<p>All the string decoding functions use different keys, but they implement one of the following 3 algorithms:</p>
<ul>
<li>Simple XOR key</li>
<li>Simple key subtraction</li>
<li>Auto-incremented XOR key</li>
</ul>
<p>One of the string decryption routines can be demonstrated with the anti-debugging trick explained in the next section.</p>
<h3>Anti-debugging Trick</h3>
<p>An attempt to attach to or run the bundleware app under a debugger produces the following error:</p>
<pre style="background-color: #27292c;line-height: 125%;color: silver;padding-top: 1em;padding-bottom: 1em"><span style="color: cyan">mac: / user $ sudo lldb /Users/user/Installer/Installer.app
(lldb) target create "/Users/user/Installer/Installer.app"
Current executable set to '/Users/user/Installer/Installer.app' (x86_64).
(lldb) r
Process 1280 launched:
'/Users/user/Installer/Installer.app/Contents/MacOS/radiosurgical' (x86_64)
<span style="color: yellow">Process 1280 exited with status = 45 (0x0000002d)</span></span></pre>
<p>The anti-debugging defense is provided with <em>ptrace ()</em> request named <code>PT_DENY_ATTACH</code>( <code>0x1F</code>), called from the function below:</p>
<pre style="background-color: #000064;line-height: 125%;color: silver;padding-top: 1em;padding-bottom: 1em"><span style="color: cyan">ptrace = 0x515D5A5D;                       <span style="color: #00ff00">// encrypted 'ptrace' string: 5D 5A 5D 51 
<span style="color: cyan">ptrace_plus_4 = 0x5752;                    <span style="color: #00ff00">// 52 57 
<span style="color: cyan">ptrace_plus_6 = 0x33;                      <span style="color: #00ff00">// 33 
<span style="color: cyan">ptrace [0] = <span style="color: white">add_2D_xor (0x5D, 0);           <span style="color: #00ff00">// decrypt 1st char (5D ^ (2D + 0)) 
<span style="color: cyan">i = 1;                                     <span style="color: #00ff00">// start loop from the 2nd char
do
{                                           <span style="color: #00ff00">// decrypt the rest 
    <span style="color: cyan">ptrace [ <span style="color: cyan">i ] = <span style="color: white">add_2D_xor ( <span style="color: cyan">ptrace [ <span style="color: cyan">i ], <span style="color: cyan">i );  <span style="color: #00ff00">// ptrace [i] ^ = 2D + i 
    <span style="color: cyan">i ++;
}
while ( <span style="color: cyan">i ! = 6);                            <span style="color: #00ff00">// 6 characters from the 2nd char, including / 0 
<span style="color: cyan">fn_ptrace = <span style="color: cyan">dlsym (RTLD_NEXT, &amp; <span style="color: cyan">ptrace );     <span style="color: #00ff00">// get proc address from the linked dylibs 
return <span style="color: cyan">fn_ptrace ( <span style="color: yellow">PT_DENY_ATTACH , 0, 0, 0); <span style="color: #00ff00">// call ptrace () by pointer, deny tracing</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
<p>If the process is being debugged, as defined in man <a href="http://mirror.informatimago.com/next/developer.apple.com/documentation/Darwin/Reference/ManPages/man2/ptrace.2.html"><code>ptrace</code></a>, it will exit with the exit status of <code>ENOTSUP</code>( <code>45</code>), <em>&#8216;error, not supported&#8217;</em> . Otherwise, it sets a flag that denies future traces &#8211; an attempt to debug it with this flag set will result in a segmentation violation exception.</p>
<p>By stepping over a call into the function that denies tracing (or NOP-ing the 5 bytes of the call), the anti-debugging trick above can be easily circumvented:</p>
<pre style="background-color: #27292c;line-height: 125%;color: silver;padding-top: 1em;padding-bottom: 1em">-&gt;   <span style="color: orange">0x103dd1ff5 &lt;+25&gt;: callq 0x103e30cd3                ; </span>call the function with ptrace ()
    0x103dd1ffa &lt;+30&gt;: callq 0x103de03aa; ICCrashLogger :: sharedLogger ()
    0x103dd1fff &lt;+35&gt;: movq% rax,% rdi
(lldb) <span style="color: yellow">re w pc `$ pc + 5`       <span style="color: #00ff00">; </span>step over the call by adding 5 bytes to $ pc 
(lldb) <span style="color: yellow">x / 2i $ pc              <span style="color: #00ff00">; </span>now $ pc (pseudo-name for RIP) points to the next instruction
-&gt; 0x103dd1ffa: e8 ab e3 00 00 callq 0x103de03aa; </span>ICCrashLogger :: sharedLogger ()
    0x103dd1fff: 48 89 c7 movq% rax,% rdi</span></pre>
<h3>Obfuscation Variations</h3>
<p>Some samples of this bundleware family contain variations in the string encryption algorithm.</p>
<p>For example, a hard-coded integer number <code>6</code>within a decryption function can be encoded with a separate function, as shown below:</p>
<pre style="background-color: #000064;line-height: 125%;color: silver;padding-top: 1em;padding-bottom: 1em"><span style="color: yellow">get_6 proc near
        push rbp
        mov rbp, rsp
        mov al, <span style="color: cyan">3          <span style="color: #00ff00">; </span>al = 3 
        shl al, <span style="color: cyan">2          <span style="color: #00ff00">; </span>al = 12 
        movsx ecx, al        <span style="color: #00ff00">; </span>ecx = 12 
        mov eax, <span style="color: cyan">65        <span style="color: #00ff00">; </span>eax = 65 
        xor edx, edx       <span style="color: #00ff00">; </span>edx = 0 
        idiv ecx            <span style="color: #00ff00">; </span>65/12, eax = 5 
        mul cl             <span style="color: #00ff00">; </span>eax = 60 
        mov cl, <span style="color: cyan">65         <span style="color: #00ff00">; </span>cl = 65 
        sub cl, al         <span style="color: #00ff00">; </span>cl = 65 - 60 = 5 
        inc cl             <span style="color: #00ff00">; </span>cl = 6 
        movsx eax, cl        <span style="color: #00ff00">; </span>result = 6
        pop rbp
        retn
<span style="color: yellow">get_6 endp</span></span></span></span></span></span></pre>
<p>The same function is collapsed by the Hex-Rays Decompiler into:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em">signed __int64 get_6 ()
{
    return 6;
}</pre>
<h3>VM Evasion</h3>
<p>Because of their advertising-based business model, the developers of this bundleware installer go to great lengths to prevent fraud by those looking to pump up the monetization of their apps using large numbers of virtual machine installs. The engine is able to detect the presence of a virtual environment through the method <em>checkPossibleFraud ()</em> . This method is exposed to JavaScript, where it can be called as:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em">var isVm = system.checkPossibleFraud ()&gt; 0? 1: 0;</pre>
<p>To achieve that, the engine compiles a so called &#8216;fraud&#8217; report that consists of the following details:</p>
<ul>
<li><code>MAC_L</code><br />
MAC and IP addresses for all network interfaces, to recognize sandboxes that rely on a common network setup.</li>
<li><code>vmVendor</code><br />
The engine checks if the MAC address starts from an address that is common for a given VM manufacturer. For example, if the MAC address starts from <code>00:1C:42</code>, the installer determines that it&#8217;s running under a <em>Parallels</em> VM.<br />
Using this trick for over 35 known MAC prefixes, it reports the following VM vendors (the vendor names are shown exactly as the installer reports them):</p>
<ul>
<li>Parallels ID.</li>
<li>Egenera, Inc.</li>
<li>First Virtual Corporation</li>
<li>linux kernal virtual machine (kvm)</li>
<li>Virtual Iron Software, Inc. (was: Katana Technology)</li>
<li>Paravirtual Corporation (was: Accenia, Inc.)</li>
<li>Virtual Conexions</li>
<li>Virtual Computer Inc.</li>
<li>virtual access, ltd.</li>
<li>Virtual Instruments</li>
<li>Virtualtek. Co. Ltd</li>
<li>VMware, Inc.</li>
<li>Microsoft Corporation (was: Connectix)</li>
<li>Microsoft Corp.</li>
<li>Microsoft Network Load Balancing Service Heartbeat</li>
<li>Microsoft XCG</li>
<li>Oracle Corporation (was: Virtual Iron Software)</li>
<li>Oracle Corporation (was: Xsigo Systems, Inc.)</li>
<li>Oracle Corporation (was: Sun Microsystems, Inc)</li>
<li>CADMUS COMPUTER SYSTEMS</li>
</ul>
</li>
<li><code>Host UUID</code><br />
Reported by <em>gethostuuid ()</em> , to recognise common sandboxes.</li>
<li><code>hddName</code><br />
The engine collects data reported by <em>DADiskCreateFromBSDName ()</em> for <code>/dev/disk0</code>device, to recognise HDD presumably common for some sandbox installations.</li>
<li><code>usbFraud</code><br />
A list of USB devices, presumably common for certain VMs, as reported by calling:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em">ioreg -l | grep -e 'USB Vendor Name'</pre>
</li>
<li><code>dispRats</code><br />
Report display ratio, to recognize display ratios used in common sandboxes.</li>
<li><code>lastMove</code><br />
Report mouse position since the last mouse movement event, to see if a VM was restored from a clean snapshot.</li>
<li><code>lastRbt</code><br />
Gets system up-time, since last reboot, to recognize a VM restored from a snapshot.</li>
<li><code>dmgLoc</code>, <code>fromDMG</code><br />
Gets full path filename of the DMG file, in case it&#8217;s executed by a sandbox under a generic name, such as using file hash.</li>
<li><code>wndPos</code><br />
Gets position and size of the app&#8217;s window.</li>
<li><code>msePos</code><br />
Gets mouse position, to see if mouse is in use.</li>
</ul>
<h3>Crash Logger</h3>
<p>The crash logger in the samples we examined sends a GET request to a remote script, disguised as a PNG file:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em">http [: //] ec2-54-191-37-103.us-west-2.compute.amazonaws [.] com / black.png</pre>
<p>The stats it submits to the remote script are encoded as URL parameters:</p>
<ul>
<li><code>crash=1</code></li>
<li><code>os=mac</code></li>
<li><code>appkit=%APP_KIT%</code></li>
<li><code>ver=%VERSION%</code></li>
<li><code>ldebug=%LIVE_DEBUG%</code></li>
<li><code>backtrace=%CALL_BACKTRACE%</code></li>
</ul>
<h3>Configuration</h3>
<p>The installer uses two configuration files. The first one is dynamically extracted from an unused cavity of the installer&#8217;s own DMG file. This configuration is written into the DMG file (a process internally called &#8216;injection&#8217;) after the DMG file is built, and is encrypted with AES-128 algorithm.</p>
<p>To locate the encrypted config within the DMG file, the installer module parses the contents of the file. For each pair of bytes, it subtracts one byte from another, until if locates the following signature that consists of 7 64-bit integers, such as:</p>
<pre style="background-color: #000064;line-height: 125%;color: silver;padding-top: 1em;padding-bottom: 1em">__const: 0000000103E51C40    <span style="color: white">signature    dq <span style="color: cyan">0Fh , <span style="color: cyan">9 , <span style="color: cyan">3Eh , <span style="color: cyan">23h , <span style="color: cyan">7 , <span style="color: cyan">86h , <span style="color: cyan">0Ch</span></span></span></span></span></span></span></span></pre>
<p>Once located, the config is then extracted and decrypted. As shown in the example below, the extracted configuration specifies the URL of an application to download and install:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em"><span style="color: #900"><strong>PRODUCT_TITLE</strong></span> = Duolingo% 202017
<span style="color: #900"><strong> PRODUCT_DESCRIPTION</strong></span> = To% 20install% 20Duolingo% 202017% 20for% 20Mac% 20click% 20Continue.
<span style="color: #900"><strong>PRODUCT_VERSION</strong></span> = Mac
<span style="color: #900"><strong> PRODUCT_PUBLIC_DATE</strong></span> = 2017
<span style="color: #900"><strong> PRODUCT_FILE_NAME</strong></span> = Duolingo% 20% 20Setup
<span style="color: #900"><strong> PRODUCT_FILE_SIZE</strong></span> = 260.8% 20MB
<span style="color: #900"><strong> CHNL</strong></span> = download7-Duolingo
<span style="color: #900"><strong> DOWNLOAD_URL</strong></span> = http% 3A% 2F% 2Fcdn.downloadfree2.com% 2Fmacsoftware% 2FBlueStacks Installer.dmg
<span style="color: #900"><strong> PRODUCT_LOGO_URL</strong></span> = http% 3A% 2F% 2Fwww.download7.co% 2Fgamegraphics% 2F90.png
<span style="color: #900"><strong> ROOT_IF_INSTALLED</strong></span> = com.bluestacks.BlueStacks
<span style="color: #900"><strong> APP_NAME</strong></span> = BlueStacks
<span style="color: #900"><strong> TOS_URL</strong></span> = http% 3A% 2F% 2Fwww.download7.co% 2Feula.html
<span style="color: #900"><strong>TYP</strong></span> = http% 3A% 2F% 2Fpiroga.space% 2Fpages% 2FDM% 2FDMTYP.html% 3Foffers% 3D
<span style="color: #900"><strong> EXIT_PAGE_URL</strong></span> = http% 3A% 2F% 2Fpiroga.space% 2Fpages% 2FDM% 2FDMInter.html
<span style="color: #900"><strong> PRIVACY_URL</strong></span> = http% 3A% 2F% 2Fwww.download7.co% 2Fprivacy.html
<span style="color: #900"><strong> ISPBROWSER</strong></span> = ch
<span style="color: #900"><strong> % 40REPORT_ADD_PARAMS</strong></span> = IRONBRO_ID% 253D9309% 2526INST_GUID% 253D4136ef6c-c79c-49b3 -...
<span style="color: #900"><strong> INST_GUID</strong></span> = 4136ef6c3e -794</pre>
<p>The 2nd configuration file is provided as a JavaScript file, and is decrypted with the other SDK files from the app&#8217;s Resources directory.</p>
<p>This configuration defines multiple operational parameters, such as report and ad servers:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em"><span style="color: #0000ff">var appInfo = {
    report: <span style="color: #a31515">'http: // rp. [REMOVED] .com' ,
    ad_url: <span style="color: #a31515">’http://os.[REMOVED].com/MacDarwenDLM/?v=5.0’</span>,
    requires_root: <span style="color: #0000ff">false</span>,
    root_if_installed: [<span style="color: #a31515">’’</span>],
    skip_vm_check: <span style="color: #0000ff">false</span>,
    ...
</span></span></pre>
<h3>Report Server</h3>
<p>The report server from the configuration is used to receive posted reports.</p>
<p>The example below demonstrates what data is posted to the report server:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em"><span style="color: #900"><strong>AC</strong></span> = DarwenDLM
<span style="color: #900"><strong>PrID</strong></span> = MacDarwenDLM
<span style="color: #900"><strong>PrSub</strong></span> = MacDarwenDLM
<span style="color: #900"><strong>RS</strong></span> = Q
<span style="color: #900"><strong>IRVER</strong></span> = 106.1712
<span style="color: #900"><strong>CHNL</strong></span> = download7-Duolingo
<span style="color: #900"><strong>PROD_TITLE</strong></span> = Duolingo 2017
<span style="color: #900"><strong>schemeName</strong></span> = MacDarwenDLM
<span style="color: #900"><strong>OSName</strong></span> = OSX
<span style="color: #900"><strong>OSVer</strong></span> = 10.12
<span style="color: #900"><strong>OSLang</strong></span> = en
<span style="color: #900"><strong>_makeDate</strong></span> = 201711091722
<span style="color: #900"><strong>SDT</strong></span> = 20181004195204931
<span style="color: #900"><strong>UID</strong></span> = 9C0C266E-266D-4D98-B83C-BCB2A3018EB7
<span style="color: #900"><strong>BRW</strong></span> = Safari
<span style="color: #900"><strong>OSPlat</strong></span> = 2
<span style="color: #900"><strong>MAC_L</strong></span> = [REMOVED]000000000000%3A127.0.0.1%3A24%3A0
<span style="color: #900"><strong>hddSize</strong></span> = 107374182400
<span style="color: #900"><strong>_makerver</strong></span> = total20171107115116
<span style="color: #900"><strong>Isuseradmin</strong></span> = 1
<span style="color: #900"><strong>isVmDef</strong></span> = 1
<span style="color: #900"><strong>inst_flv</strong></span> = no_injection_106.1712
<span style="color: #900"><strong>dwa.SrcNo</strong></span> = 1
<span style="color: #900"><strong>QuitPage</strong></span> = welcomePage
<span style="color: #900"><strong>RepCnt</strong></span> = 1
<span style="color: #900"><strong>ofrClPrm</strong></span> = 266E-266D-4D98-B83C-BCB2A3018EB7</pre>
<p>As seen in the example, the data it posts contains basic system information, such as macOS version number (<code>OSVer</code>), language (<code>OSLang</code>), MAC and IP addresses for all network interfaces (<code>MAC_L</code>), default browser name (<code>BRW</code>), HDD size, whether a VM was detected or not (<code>isVmDef</code>), whether user is admin (<code>isuseradmin</code>), and some other parameters.</p>
<p>The collected data is assembled into a text, then encrypted with AES-128, and posted to the server:</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2018/11/image3.png"><img loading="lazy" class="alignnone size-large wp-image-54175" src="https://news.sophos.com/wp-content/uploads/2018/11/image3.png?w=640" alt="" width="640" height="171" srcset="https://news.sophos.com/wp-content/uploads/2018/11/image3.png 661w, https://news.sophos.com/wp-content/uploads/2018/11/image3.png?resize=300,80 300w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<h3>Tasks</h3>
<p>Remote tasks are received encrypted from the ad server, as shown below:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em">POST <span style="color: #05b">os.[REMOVED].com/MacDarwenDLM/?v=5.0</span>
USER-AGENT: <span style="color: #05b">ICMAC</span>
Response:
    Header: X-ICSCT-SERVER-NAME: <span style="color: #05b">ads-slave-1111-production-us-west-2-i-07e9c6437616f3e49</span>
    Data: 85,368 bytes binary [<span style="color: #d04000">6c ec 6c 99...</span>]</pre>
<p>When the received task is decrypted, its data is split into named sections. Each section is surrounded with the following comments:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em"><span style="color: #05b">var</span> namestartstr = ’<span style="color: #d04000">&lt;!--SECTION NAME="</span>’;
<span style="color: #05b">var</span> nameendstr = ’<span style="color: #d04000">"--&gt;</span>’;
<span style="color: #05b">var</span> sectionendstr = ’&lt;<span style="color: #d04070">!--/SECTION--&gt;</span>’;</pre>
<p>The parser extracts JavaScript code from those sections. That code will then rely on APIs exposed by the SDK, to drive the engine that exposes its own API interface to the SDK.</p>
<p>The nature of the received tasks may depend on the presence of VM (a condition, internally called ’fraud’).</p>
<p>An analysis of the tasks received from the ad server reveals no malicious activity.</p>
<h3>Engine Capabilities</h3>
<p>The bundleware’s engine consists of the several components, capable of doing the following:</p>
<ul>
<li style="list-style-type: none">
<ul>
<li>Browser manager
<ul style="list-style-type: square">
<li>detects supported browsers, such as Safari, Google Chrome, Firefox</li>
<li>terminates browser process</li>
<li>sets new home page</li>
<li>reads Chrome preferences</li>
<li>clears Chrome cache</li>
<li>reads Firefox preferences</li>
</ul>
</li>
<li>Logger
<ul style="list-style-type: square">
<li>takes full screen snapshot</li>
<li>takes installer window’s snapshot</li>
<li>submits ’live debug’ information to the remote server</li>
</ul>
</li>
<li>Screenshot controller
<ul style="list-style-type: square">
<li>takes full screen snapshot with the mouse location</li>
<li>collects a set of screenshots</li>
<li>takes snapshot of a given window</li>
</ul>
</li>
<li>Task manager
<ul style="list-style-type: square">
<li>downloads and execute new tasks
<ul style="list-style-type: circle">
<li>submits task execution output</li>
<li>runs tasks with the privilege level elevated to root</li>
</ul>
</li>
<li>creates authorisation for tasks, using given credentials</li>
</ul>
</li>
<li>System controller
<ul style="list-style-type: square">
<li>collects system OS version</li>
<li>collects mac address and IP for all interfaces</li>
<li>collects all cookies from Safari, Google Chrome, Firefox</li>
<li>collects the list of all installed applications</li>
<li>collects the list of running applications</li>
<li>checks the presence of VM</li>
<li>gets home page for all supported browsers</li>
<li>gets system default browser</li>
<li>adds/removes applications to/from dock</li>
<li>adds applications to dock</li>
<li>checks if user is admin</li>
<li>checks if a given process runs as admin</li>
<li>gets user name</li>
<li>gets user locale/language</li>
<li>gets free space of start-up volume</li>
<li>gets info about connected iOS devices:
<ul style="list-style-type: circle">
<li>device class (iPod/iPad/iPhone)</li>
<li>device identifier</li>
<li>device serial number</li>
</ul>
</li>
<li>builds ’fraud’ report (info about detected VM)</li>
<li>collects the following lists:
<ul style="list-style-type: circle">
<li>running processes</li>
<li>keyboard input sources</li>
<li>graphics card names</li>
<li>USB devices</li>
<li>apps launched automatically on login</li>
<li>launch daemons and agents</li>
<li>user launch agents</li>
<li>Google Chrome extension names</li>
<li>Safari extension names</li>
<li>Firefox extension names</li>
</ul>
</li>
<li>searches for files in the specified directory</li>
<li>checks if the specified application is running</li>
<li>terminates specified applications</li>
<li>encrypts/decrypts data</li>
<li>gets user paths, such as local applications, download paths</li>
<li>checks if an application is installed by the specified name</li>
<li>reads key values from user defaults</li>
<li>gets default apps for all available extensions</li>
<li>adds an app to dock as persistent item</li>
<li>removes all persistent apps from dock for specified path</li>
<li>reads text files</li>
<li>copies given directory to a new location</li>
<li>deletes the specified directory</li>
<li>run specified script with <code>’/bin/sh’</code>, as root</li>
<li>checks if the specified file exists</li>
<li>gets detailed HDD information</li>
<li>collects network information</li>
<li>downloads files</li>
<li>reads/sets window title for running apps</li>
<li>reads mouse position</li>
<li>displays alerts</li>
<li>launches tasks/applications as root</li>
<li>copies/moves files</li>
<li>opens URLs</li>
<li>saves data to files</li>
<li>checks if path is writable</li>
<li>creates/deletes directories</li>
<li>gets specified file size/attributes</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>CI/CD pipeline</h3>
<p>The authors of the bundleware have apparently adopted <a href="https://jenkins.io/">Jenkins</a>, an open source tool for building Continuous Integration and Continuous Delivery (CI/CD) pipelines.</p>
<p>This fact is evident from the full path names of the source files that are still visible in the compiled engine module, such as:</p>
<pre style="background-color: white;line-height: 125%;padding-top: 1em;padding-bottom: 1em">/Users/[REMOVED]-ai/jenkins/workspace/AI_Mac_Release_Production/continuous-integration/mac_team_repo/Sources/[REMOVED]Utils.mm</pre>
<p>With Continuous Integration in place, every commit made to the source code in the Git repository is pulled and built automatically. If it results in a bug, the developers can quickly identify the responsible commit.</p>
<p>Continuous Integration pipeline also allows automated testing and deployment. Apart from reducing the length of time it takes to release new PUA builds, it also allows to increase their quality.</p>
<h3>Conclusion</h3>
<p>Being a legitimate distribution platform, the techniques employed by this popular bundleware product conceal a very powerful engine.</p>
<p>When viewed from a certain angle, this engine resembles a backdoor as it unlocks full access to the system.</p>
<p>The sheer power of the engine is made covert with the wisely engineered trickery. Some of its methods, such as loading code from memory, are known from the “The Mac Hacker’s <a href="https://www.amazon.com/Mac-Hackers-Handbook-Charlie-Miller/dp/0470395362">Handbook</a>”, and rightly belong to the world of malware.</p>
<p>Given that the engine is driven by symmetrically encrypted remote tasks, any researcher who pays attention to detail couldn’t help but wonder what would happen if the control of its engine was intercepted.</p>
<p>Careful analysis of these techniques also demonstrates a disturbing trend we’re witnessing – the continued ’spill’ of the traditional <em>Windows</em> malicious techniques, such as run-time packing, strings/API obfuscation, memory injection into the <em>Mac</em> world.</p>
<p>Even though the installer itself is legitimate, an analysis of state-of-art code where these techniques are honed to perfection is vitally important for the researchers to understand what opportunities exist on the <em>macOS</em> platform, to be better prepared for the challenges that lay ahead of us.</p>
<p><em>This report is based on research <a href="https://www.virusbulletin.com/conference/vb2019/abstracts/never-had-stierlitz-been-so-close-failure">previously presented at Virus Bulletin&#8217;s VB2019 conference</a> .</em></p>
			</div>
	<div class="mt-12">
		
<ul
	id="social-sharing"
	class="flex justify-center items-center space-x-6"
>
	<li class="facebook">
		<a
			class="js-share-modal"
			href="http://www.facebook.com/share.php?u=https://news.sophos.com/?p=54118&#038;title=&#8220;Double%20agent&#8221;:%20a%20MacOS%20bundleware%20installer%20that%20acts%20like%20a%20spy"
			data-title="&#8220;Double agent&#8221;: a MacOS bundleware installer that acts like a spy"
			title="Share on Facebook">
				<span class="sr-only">Share on Facebook</span>
				<svg
					width="8"
					height="16"
					xmlns="http://www.w3.org/2000/svg"
					class="text-sophos-gray-600 hover:text-black"
					fill="currentColor"
				>
					<path d="M7.145 8.006H4.903V16H1.581V8.006H0V5.182h1.581V3.354C1.581 2.045 2.202 0 4.933 0l2.461.01v2.742H5.608c-.291 0-.705.145-.705.77v1.66h2.533l-.291 2.824z" fill-rule="nonzero"/>
				</svg>
		</a>
	</li>
	<li class="twitter">
		<a
			class="js-share-modal"
			href="http://twitter.com/intent/tweet?text=%26%238220%3BDouble%20agent%26%238221%3B%3A%20a%20MacOS%20bundleware%20installer%20that%20acts%20like%20a%20spy%20https%3A%2F%2Fnews.sophos.com%2F%3Fp%3D54118"
			data-title=""
			title="Share on Twitter">
				<span class="sr-only">Share on Twitter</span>
				<svg
					width="14"
					height="13"
					xmlns="http://www.w3.org/2000/svg"
					class="text-sophos-gray-600 hover:text-black"
					fill="currentColor"
				>
					<path d="M12.567 3.238c.007.141.01.281.01.424 0 4.338-2.89 9.34-8.173 9.34-1.623 0-3.132-.543-4.403-1.475.225.03.453.045.685.045 1.346 0 2.584-.523 3.566-1.404-1.255-.028-2.317-.977-2.682-2.28a2.56 2.56 0 001.296-.056C1.554 7.53.562 6.203.562 4.613v-.04c.389.245.83.392 1.302.41C1.094 4.393.587 3.387.587 2.25c0-.602.142-1.166.388-1.65 1.416 1.986 3.534 3.292 5.92 3.43a3.735 3.735 0 01-.074-.749c0-1.813 1.286-3.28 2.873-3.28.825 0 1.572.397 2.096 1.034a5.324 5.324 0 001.824-.797c-.215.768-.67 1.41-1.263 1.816a5.178 5.178 0 001.65-.515 6.362 6.362 0 01-1.434 1.7" fill-rule="nonzero"/>
				</svg>
		</a>
	</li>
	<li class="linkedin">
		<a
			href="http://www.linkedin.com/shareArticle?mini=true&url=https://news.sophos.com/en-us/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy/"
			data-title="&#8220;Double agent&#8221;: a MacOS bundleware installer that acts like a spy"
			title="Share on LinkedIn"
			onclick="window.open(this.href, '', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;">
			<span class="sr-only">Share on LinkedIn</span>
			<svg
				width="16"
				height="16"
				xmlns="http://www.w3.org/2000/svg"
				class="text-sophos-gray-600 hover:text-black"
				fill="currentColor"
			>
				<path d="M16 15.293h-3.43v-5.52c0-1.386-.496-2.334-1.738-2.334-.946 0-1.512.64-1.76 1.256-.09.22-.113.526-.113.836v5.762H5.53s.044-9.35 0-10.316h3.43v1.46c.456-.705 1.27-1.703 3.091-1.703 2.256 0 3.95 1.473 3.95 4.643v5.916zM1.917 3.566h-.022C.745 3.566 0 2.773 0 1.783 0 .772.768 0 1.94 0c1.173 0 1.896.772 1.917 1.783 0 .99-.744 1.783-1.94 1.783zM.202 15.293h3.431V4.977H.203v10.316z" fill-rule="nonzero"/>
			</svg>
		</a>
	</li>
	<li class="comments">
		<a
			href="#comments"
			title="Leave a Reply"
			class="flex items-center space-x-1"
		>
			<svg
				width="16"
				height="16"
				xmlns="http://www.w3.org/2000/svg"
				class="text-sophos-gray-600 hover:text-black"
				fill="currentColor"
			>
				<path d="M8.5 0a7.5 7.5 0 11-3.916 13.898C3.317 15.273 1.773 15.36.256 15.135c1.011-1.185 1.678-2.357 2-3.517l-.007.027A7.5 7.5 0 018.5 0z" fill-rule="evenodd"/>
			</svg>
					</a>
	</li>
</ul>

			</div><!-- .entry-social -->
	</div>

</article><!-- #post-## -->

			<div class="container my-8 md:my-16">
				<div class="max-w-4xl mx-auto">
					<div class="article-author-block article-co-authors-block">
	
					<div class="author-block">
				<div class="author-block__profile">
					<img alt='' src='https://secure.gravatar.com/avatar/41304abfe857c08aed7293c24a6c93fb?s=400&#038;d=blank&#038;r=g' class='avatar avatar-400 photo' height='400' width='400' />				</div> <!-- .author-profile -->

				<div class="author-block__wrapper">
					<div class="author-block__content">

													<div class="author-block__about">
								About the Author							</div>
						
						<h3 class="author-block__name">
						<a href="https://news.sophos.com/en-us/author/sergei-shevchenko/" title="Posts by Sergei Shevchenko" class="author url fn" rel="author">Sergei Shevchenko</a>						</h3>

						
							<div class="author-block__bio">
								<p>Sergei Shevchenko has 20 years of professional experience reverse engineering malware and is a recognized expert in his field. His analysis of high-profile malware attacks, including previous years' Bangladesh Bank heist, attacks on other banks, cyber espionage within managed service providers and ransomware attacks affecting thousands of vital service organizations globally, is the go-to information source for risk and technology officers and their teams around the world. He manages our threat research team in Sydney.</p>
							</div> <!-- .author-bio -->

					</div>
				</div>

			</div> <!-- .author-block-container -->
		
		</div>
				</div>
			</div>

			
<div class="pb-24 bg-white">
<div class="container">
<div class="max-w-5xl mx-auto">

			
			<h3 class="text-style-h2 md:my-8 my-4">
				Read Similar Articles			</h3>

			<div class="article-grid article-grid--3-column">
				<!-- Article -->
<article
	id="post-75410"
	class="hover:shadow-lg dark:bg-sophos-gray-900 border-sophos-gray-200 flex flex-col overflow-hidden text-gray-700 transition-all bg-white border rounded-md shadow-md post-75410 post type-post status-publish format-standard has-post-thumbnail hentry category-security-operations tag-encryption tag-mtr tag-ransomware tag-security tag-sidebar tag-sophos-rapid-response region-en-us">
	<!-- Image -->
	<a
		class="aspect-w-16 aspect-h-9 flex block bg-gray-400 bg-right bg-no-repeat bg-cover"
		href="https://news.sophos.com/en-us/2021/05/24/what-to-expect-when-youve-been-hit-with-avaddon-ransomware/"
		rel="bookmark"
		style="
			background-image: url('https://news.sophos.com/wp-content/uploads/2021/05/sophos-ransomware-web-banner-1200x628px-option-2.png?w=640');
		"
	></a>

	<!-- Wrapper -->
	<div class="flex flex-col justify-between flex-grow">

		<!-- Content -->
		<div class="sm:px-8 sm:py-8 p-4 py-6">
			<!-- Date -->
			<div
				class="text-sophos-blue-600 font-sansMedium mb-2 text-xs leading-tight uppercase truncate"
			>
				May 24, 2021			</div>
			<!-- Post Title -->
				<h2 class="text-style-h2 line-clamp-3 sm:mb-4 sm:text-2xl sm:leading-snug text-lg leading-tight text-gray-700"><a href="https://news.sophos.com/en-us/2021/05/24/what-to-expect-when-youve-been-hit-with-avaddon-ransomware/" rel="bookmark" class="dark:text-white font-sansSemiBold font-semibold text-gray-900 no-underline cursor-pointer">What to expect when you’ve been hit with Avaddon ransomware</a></h2>			<!-- Excerpt -->
						</div>

			</div>
</article>
<!-- Article -->
<article
	id="post-75301"
	class="hover:shadow-lg dark:bg-sophos-gray-900 border-sophos-gray-200 flex flex-col overflow-hidden text-gray-700 transition-all bg-white border rounded-md shadow-md post-75301 post type-post status-publish format-standard has-post-thumbnail hentry category-products-services tag-intercept-x tag-sidebar tag-sophos-edr tag-sophos-xdr region-en-us">
	<!-- Image -->
	<a
		class="aspect-w-16 aspect-h-9 flex block bg-gray-400 bg-right bg-no-repeat bg-cover"
		href="https://news.sophos.com/en-us/2021/05/19/whats-new-in-sophos-edr-4-0/"
		rel="bookmark"
		style="
			background-image: url('https://news.sophos.com/wp-content/uploads/2021/05/sophos-edr-news-blog-image-838x440px@2x.png?w=640');
		"
	></a>

	<!-- Wrapper -->
	<div class="flex flex-col justify-between flex-grow">

		<!-- Content -->
		<div class="sm:px-8 sm:py-8 p-4 py-6">
			<!-- Date -->
			<div
				class="text-sophos-blue-600 font-sansMedium mb-2 text-xs leading-tight uppercase truncate"
			>
				May 19, 2021			</div>
			<!-- Post Title -->
				<h2 class="text-style-h2 line-clamp-3 sm:mb-4 sm:text-2xl sm:leading-snug text-lg leading-tight text-gray-700"><a href="https://news.sophos.com/en-us/2021/05/19/whats-new-in-sophos-edr-4-0/" rel="bookmark" class="dark:text-white font-sansSemiBold font-semibold text-gray-900 no-underline cursor-pointer">What&#8217;s New in Sophos EDR 4.0</a></h2>			<!-- Excerpt -->
						</div>

			</div>
</article>
<!-- Article -->
<article
	id="post-75396"
	class="hover:shadow-lg dark:bg-sophos-gray-900 border-sophos-gray-200 flex flex-col overflow-hidden text-gray-700 transition-all bg-white border rounded-md shadow-md post-75396 post type-post status-publish format-standard has-post-thumbnail hentry category-products-services tag-sidebar tag-sophos-xdr tag-xdr region-en-us">
	<!-- Image -->
	<a
		class="aspect-w-16 aspect-h-9 flex block bg-gray-400 bg-right bg-no-repeat bg-cover"
		href="https://news.sophos.com/en-us/2021/05/19/sophos-xdr-driven-by-data/"
		rel="bookmark"
		style="
			background-image: url('https://news.sophos.com/wp-content/uploads/2021/05/sophos-xdr.png?w=640');
		"
	></a>

	<!-- Wrapper -->
	<div class="flex flex-col justify-between flex-grow">

		<!-- Content -->
		<div class="sm:px-8 sm:py-8 p-4 py-6">
			<!-- Date -->
			<div
				class="text-sophos-blue-600 font-sansMedium mb-2 text-xs leading-tight uppercase truncate"
			>
				May 19, 2021			</div>
			<!-- Post Title -->
				<h2 class="text-style-h2 line-clamp-3 sm:mb-4 sm:text-2xl sm:leading-snug text-lg leading-tight text-gray-700"><a href="https://news.sophos.com/en-us/2021/05/19/sophos-xdr-driven-by-data/" rel="bookmark" class="dark:text-white font-sansSemiBold font-semibold text-gray-900 no-underline cursor-pointer">Sophos XDR: Driven by data</a></h2>			<!-- Excerpt -->
						</div>

			</div>
</article>
			</div>

	
</div>
</div>
</div> <!-- #secondary -->

			
<div class="bg-sophos-gray-50 px-4 pt-16 pb-8" id="comments">

	
	
	<div class="container max-w-2xl py-6 md:py-16">
			<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/en-us/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://news.sophos.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> <span class="required-field-message" aria-hidden="true">Required fields are marked <span class="required" aria-hidden="true">*</span></span></p><p class="comment-form-comment"><label for="comment">Comment <span class="required" aria-hidden="true">*</span></label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required></textarea></p><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p>
<input type="hidden" name="redirect_to" value="https://news.sophos.com/en-us/2020/03/17/double-agent-a-macos-bundleware-installer-that-acts-like-a-spy/" id="redirect_to"><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='54118' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="1234c2051b" /></p><p style="display: none !important;"><label>&#916;<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js_1" name="ak_js" value="59"/><script>document.getElementById( "ak_js_1" ).setAttribute( "value", ( new Date() ).getTime() );</script></p></form>	</div><!-- #respond -->
		</div>

</div><!-- #comments -->
</div><!-- #comments -->

		
		</main><!-- #main -->
	</div><!-- #primary -->


	</div> <!-- #content -->

	

<div class="bg-sophos-gray-50 md:py-16 px-4" x-data="subscribeForm()">
	<div class="container max-w-2xl" x-show="!subscribed">
	<div class="text-style-h2-lg">
		Subscribe to get the latest updates in your inbox.	</div>
	<form action="">
		<div class="flex flex-col my-6">
		<input
			type="text"
			placeholder="name@email.com"
			class="w-full"
			x-model="email"
			x-on:keydown="resetErrors()"
			required
		/>
		<div
			x-cloak
			x-show="message"
			x-text="message"
			class="font-sansMedium px-4 py-3 mt-2 text-sm font-medium text-white bg-black border rounded-md"
		></div>
		</div>
		<div class="mb-4 text-lg">
			Which categories are you interested in?		</div>
		<div class="my-2 space-y-1">
		<template
			x-for="category in Object.entries(categories)"
			:key="category[0]"
		>
			<div>
			<label
				x-bind:for="category[1].value"
				class="inline-flex items-center"
			>
				<input
				type="checkbox"
				x-bind:value="category[1].value"
				x-bind:id="category[1].value"
				x-bind:name="category[1].value"
				x-model="subscribeTo"
				/>
				<span
				class="text-style-form-label ml-2"
				x-text="category[1].name"
				>
				</span>
			</label>
			</div>
		</template>
		</div>
		<div class="mt-6">
		<input
			type="submit"
			class="round-button round-button--primary"
			@click.prevent="submit()"
			x-bind:value="buttonText()"
			x-bind:class="{ 'opacity-30 cursor-not-allowed': buttonDisabled() }"
			x-bind:disabled="buttonDisabled()"
		/>
		</div>
	</form>
	</div>

	<div class="container max-w-2xl" x-cloak x-show="subscribed && !loading">
	<div class="text-style-h2 md:text-3xl mb-4 text-2xl text-center">
		You’re now subscribed!	</div>
	<div
		class="text-lg text-center"
		x-text="`Check your email to confirm your subscription.`"
	></div>
	</div>
</div>

<script>
	let subscribeForm = function () {
	return {
		config: {
		endpoints: {
			signup:
			"https://sophos-mailchimp-signup.netlify.app/.netlify/functions/newsletter-signup",
		},
		},
		subscribed: false,
		loading: false,
		error: false,
		message: "",
		categories: {
		1: {
			name: decodeURIComponent( 'Products%20and%20Services' ),
			value: "products-services",
		},
		2: {
			name: decodeURIComponent( 'Threat%20Research' ),
			value: "threat-research",
		},
		3: {
			name: decodeURIComponent( 'Security%20Operations' ),
			value: "security-operations",
		},
		4: {
			name: decodeURIComponent( 'AI%20Research' ),
			value: "ai-research",
		},
		5: {
			name: decodeURIComponent( '%23SophosLife' ),
			value: "sophos-life",
		},
		},
		subscribeTo: [],
		email: "",

		reset() {
		this.loading = false;
		if (!this.error) {
			this.email = "";
		}
		},

		resetErrors() {
		this.error = false;
		this.message = "";
		},

		setError(message) {
		this.error = true;
		this.message = message;
		},

		setSuccess(message) {
		this.error = false;
		this.message = message;
		},

		emailIsValid(email) {
		return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
		},

		submit() {
		this.loading = true;
		this.resetErrors();

		const mcList = "8d6471d831";
		const mcLanguage = decodeURIComponent( 'en' );
		const mcTags = [...this.subscribeTo, mcLanguage];

		const payload = {
			email: this.email,
			listId: mcList,
			tags: mcTags,
			language: mcLanguage,
		};

		fetch(this.config.endpoints.signup, {
			method: "POST",
			headers: {
			"Content-Type": "application/json",
			},
			body: JSON.stringify(payload),
		})
			.then((r) => r.json())
			.then((data) => {
			if (data.status === "pending") {
				this.setSuccess(
					decodeURIComponent( 'You%20have%20been%20subscribed.%20Please%20check%20your%20email%20to%20confirm.' )
				);
				this.subscribed = true;
			} else if (
				data.status === "subscribed"
			) {
				this.setSuccess(
					decodeURIComponent( 'You%20are%20already%20subscribed.%20Thank%20you%21' )
				);
			} else {
				this.setError(
					decodeURIComponent( 'We%20could%20not%20subscribe%20you.%20Please%20try%20again.' )
				);
			}
			})
			.catch((e) => {
			this.setError(
				decodeURIComponent( 'We%20could%20not%20subscribe%20you.%20Please%20try%20again.' )
			);
			})
			.finally(() => {
			this.reset();
			});
		},

		buttonText() {
		return this.loading ? decodeURIComponent( 'Please%20Wait' ) : decodeURIComponent( 'Subscribe' );
		},

		buttonDisabled() {
		return (
			this.subscribeTo.length < 1 ||
			!this.emailIsValid(this.email) ||
			this.loading
		);
		},
	};
	};
</script>


	<footer
		class="bg-white border-t border-sophos-gray-200 "
		x-data="{ languageMenu: false, privacyMenu: false, legalMenu: false }"
	>
		<div class="container">
			<div class="md:flex-row md:items-center flex flex-col justify-between py-8">
				<div class="flex items-baseline flex-grow space-x-6">
					<!-- Language -->
					
<div class="relative mr-auto">
	<a
		href="#"
		class="whitespace-nowrap font-sansMedium text-sophos-gray-600 inline-block text-xs font-medium leading-tight"
		@click.prevent="languageMenu = !languageMenu"
		@click.away="languageMenu = false"
	>
		Change Region		<svg
			xmlns="http://www.w3.org/2000/svg"
			width="8"
			height="4"
			class="inline-block transition-transform transform"
			:class="{'rotate-180': languageMenu }"
		>
			<path
				fill="#7F8C9D"
				fill-rule="evenodd"
				d="M4 2.178L5.915.262a.708.708 0 01.996 0 .702.702 0 010 .995L4.75 3.415A.7.7 0 014 3.94a.702.702 0 01-.751-.524l-2.16-2.158a.702.702 0 11.996-.995L4 2.178z"
			/>
		</svg>
	</a>

	<!-- Language Menu -->
	<div
		class="focus:outline-none border-sophos-gray-200 absolute bottom-0 left-0 w-48 px-4 py-1 py-4 mb-8 -ml-4 origin-bottom-left bg-white border rounded-md shadow-md"
		role="menu"
		aria-orientation="vertical"
		aria-labelledby="user-menu"
		x-show="languageMenu"
		x-cloak
		x-transition:enter="transition-all ease-out duration-100"
		x-transition:enter-start="transform opacity-0 scale-95"
		x-transition:enter-end="transform opacity-100 scale-100"
		x-transition:leave="transition ease-in duration-75"
		x-transition:leave-start="transform opacity-100 scale-100"
		x-transition:leave-end="transform opacity-0 scale-95"
	>
		<ul
			class="font-sansMedium text-sophos-gray-600 space-y-1 text-xs font-medium"
		>
											<li>
					<a href="https://news.sophos.com/es-419">
						América Latina					</a>
				</li>
															<li>
					<a href="https://news.sophos.com/pt-br">
						Brasil					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/de-de">
						Deutschland					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/en-us">
						English					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/fr-fr">
						France					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/es-es">
						Iberia					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/it-it">
						Italia					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/ja-jp">
						Japan					</a>
				</li>
									</ul>
	</div>
</div>

					<!-- Terms -->
					<a
						href="https://www.sophos.com/en-us/legal/sophos-website.aspx"
						class="whitespace-nowrap font-sansMedium text-sophos-gray-600 inline-block ml-auto text-xs font-medium leading-tight"
						>Terms</a
					>

					<!-- Privacy -->
					
<span class="relative">
	<a
		href="#"
		class="whitespace-nowrap font-sansMedium text-sophos-gray-600 inline-block text-xs font-medium leading-tight"
		@click.prevent="privacyMenu = !privacyMenu"
		@click.away="privacyMenu = false"
	>
		Privacy
		<svg
			xmlns="http://www.w3.org/2000/svg"
			width="8"
			height="4"
			class="inline-block transition-transform transform"
			:class="{'rotate-180': privacyMenu }"
		>
			<path
				fill="#7F8C9D"
				fill-rule="evenodd"
				d="M4 2.178L5.915.262a.708.708 0 01.996 0 .702.702 0 010 .995L4.75 3.415A.7.7 0 014 3.94a.702.702 0 01-.751-.524l-2.16-2.158a.702.702 0 11.996-.995L4 2.178z"
			/>
		</svg>
	</a>
	<div
		class="focus:outline-none border-sophos-gray-200 absolute bottom-0 left-0 w-48 px-4 py-1 py-4 mb-8 -ml-4 origin-bottom-left bg-white border rounded-md shadow-md"
		role="menu"
		aria-orientation="vertical"
		aria-labelledby="user-menu"
		x-show="privacyMenu"
		x-cloak
		x-transition:enter="transition-all ease-out duration-100"
		x-transition:enter-start="transform opacity-0 scale-95"
		x-transition:enter-end="transform opacity-100 scale-100"
		x-transition:leave="transition ease-in duration-75"
		x-transition:leave-start="transform opacity-100 scale-100"
		x-transition:leave-end="transform opacity-0 scale-95"
	>
		<ul
			class="font-sansMedium text-sophos-gray-600 space-y-1 text-xs font-medium"
		>
			<li>
				<a
					href="https://www.sophos.com/en-us/legal/sophos-group-privacy-policy.aspx"
				>
					Privacy Notice				</a>
			</li>
			<li>
				<a
					href="https://www.sophos.com/en-us/legal/cookie-information.aspx"
				>
					Cookies				</a>
			</li>
		</ul>
	</div>
</span>

					<!-- Legal -->
					
<span class="relative">
	<a
		href="#"
		class="whitespace-nowrap font-sansMedium text-sophos-gray-600 inline-block text-xs font-medium leading-tight"
		@click.prevent="legalMenu = !legalMenu"
		@click.away="legalMenu = false"
	>
		Legal
		<svg
			xmlns="http://www.w3.org/2000/svg"
			width="8"
			height="4"
			class="inline-block transition-transform transform"
			:class="{'rotate-180': legalMenu }"
		>
			<path
				fill="#7F8C9D"
				fill-rule="evenodd"
				d="M4 2.178L5.915.262a.708.708 0 01.996 0 .702.702 0 010 .995L4.75 3.415A.7.7 0 014 3.94a.702.702 0 01-.751-.524l-2.16-2.158a.702.702 0 11.996-.995L4 2.178z"
			/>
		</svg>
	</a>
	<div
		class="focus:outline-none border-sophos-gray-200 absolute bottom-0 left-0 w-48 px-4 py-1 py-4 mb-8 -ml-4 origin-bottom-left bg-white border rounded-md shadow-md"
		role="menu"
		aria-orientation="vertical"
		aria-labelledby="user-menu"
		x-show="legalMenu"
		x-cloak
		x-transition:enter="transition-all ease-out duration-100"
		x-transition:enter-start="transform opacity-0 scale-95"
		x-transition:enter-end="transform opacity-100 scale-100"
		x-transition:leave="transition ease-in duration-75"
		x-transition:leave-start="transform opacity-100 scale-100"
		x-transition:leave-end="transform opacity-0 scale-95"
	>
		<ul
			class="font-sansMedium text-sophos-gray-600 space-y-1 text-xs font-medium"
		>
			<li>
				<a
					href="https://www.sophos.com/en-us/legal.aspx"
				>
					General				</a>
			</li>
			<li>
				<a
					href="https://www.sophos.com/en-us/legal/modern-slavery-act-transparency-statement.aspx"
				>
					Modern Slavery Statement				</a>
			</li>
			<li>
				<a
					href="https://secure.ethicspoint.eu/domain/media/en/gui/104916/index.html"
				>
					Speak Out				</a>
			</li>
		</ul>
	</div>
</span>

					<!-- Copyright -->
					<div class="md:ml-6 mt-2 md:mt-0">
						<span
							class="whitespace-nowrap font-sansMedium text-sophos-gray-600 inline-block text-xs font-medium leading-tight"
						>
							&copy; 1997 - 2022 Sophos Ltd. All rights reserved						</span>
					</div>
				</div>
			</div>
			</div>
		</div>
	</footer>
	<script id='sophos-js-core-js-extra'>
var PG8Data = {"startPage":"1","maxPages":"1","nextLink":""};
</script>
<script type="text/javascript" src="https://news.sophos.com/_static/??-eJyVjGEOwiAMRi8kZRCn/jGehZBmA6UQWp3Ht2YXGOn36+W92q2ZWEmQxMqKBdlybWtlwo2Nn9zVZtapVJ8JzceDB6cAdgCZT/bQj1j7gI1f6YGP+zuCt6TXeBVDaSEtNBy20IWwD3dLGE7+TKNHubvLfDvPelP+AaC7oEI=" ></script><script src='https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.1/dist/alpine.min.js?ver=2.0.1' id='alpine-js-js'></script>
<script type="text/javascript" src="https://news.sophos.com/wp-includes/js/comment-reply.min.js?m=1658827588g" ></script><script src='https://stats.wp.com/e-202231.js' defer></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:11.1.2',blog:'166161023',post:'54118',tz:'-4',srv:'news.sophos.com',hp:'vip'} ]);
	_stq.push([ 'clickTrackerInit', '166161023', '54118' ]);
</script>
</body>
</html>
