Updating FreeBSD 7.0-BETA2 to 7.0-BETA3

Get link

Facebook

Twitter

Pinterest

Email

Other Apps

November 21, 2007

Recently I posted FreeBSD Binary Upgrade News about developments with Colin Percival's FreeBSD Update tool.  Today I performed a remote (via SSH) upgrade from FreeBSD 7.0-BETA2 to FreeBSD 7.0-BETA3 using FreeBSD Update.  I document the process below so you can see how easy it is and for my future reference.Here is uname output to show the OS version prior to upgrading.# uname -aFreeBSD myhost.mydomain.com 7.0-BETA2 FreeBSD 7.0-BETA2 #0: Fri Nov  2 16:47:33 UTC 2007    root@logan.cse.buffalo.edu:/usr/obj/usr/src/sys/GENERIC  i386I wasn't sure if the version of FreeBSD Update packaged with FreeBSD 7.0-BETA2 would natively support this process, so I gave it a try.# freebsd-update -r 7.0-BETA3 upgradeusage: freebsd-update [options] command ... [path]Options:  -b basedir   -- Operate on a system mounted at basedir                  (default: /)  -d workdir   -- Store working files in workdir                  (default: /var/db/freebsd-update/)  -f conffile  -- Read configuration options from conffile                  (default: /etc/freebsd-update.conf)  -k KEY       -- Trust an RSA key with SHA256 hash of KEY  -s server    -- Server from which to fetch updates                  (default: update.FreeBSD.org)  -t address   -- Mail output of cron command, if any, to address                  (default: root)Commands:  fetch        -- Fetch updates from server  cron         -- Sleep rand(3600) seconds, fetch updates, and send an                  email if updates were found  install      -- Install downloaded updates  rollback     -- Uninstall most recently installed updatesOk, that didn't work.  Time to retrieve the new version from Colin's site.# fetch http://www.daemonology.net/freebsd-update/freebsd-update-upgrade.tgzfreebsd-update-upgrade.tgz                    100% of   21 kB  104 kBps# fetch http://www.daemonology.net/freebsd-update/freebsd-update-upgrade.tgz.ascfreebsd-update-upgrade.tgz.asc                100% of  187  B  640 kBpsI decided to follow Colin's advice to check the signature of the upgrade file.  To do that I needed to install GnuPG.# pkg_add -r gnupgFetching ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-7-current/Latest/gnupg.tbz... Done.Fetching ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-7-current/All/openldap-client-2.3.39.tbz... Done.************************************************************The OpenLDAP client package has been successfully installed.Edit  /usr/local/etc/openldap/ldap.confto change the system-wide client defaults.Try `man ldap.conf' and visit the OpenLDAP FAQ-O-Matic at  http://www.OpenLDAP.org/faq/index.cgi?file=3for more information.************************************************************Fetching ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-7-current/All/curl-7.16.3.tbz... Done.Fetching ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-7-current/All/pth-2.0.7.tbz... Done.Fetching ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-7-current/All/libiconv-1.11_1.tbz... Done.Fetching ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-7-current/All/gettext-0.16.1_3.tbz... Done.Fetching ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-7-current/All/libgpg-error-1.5.tbz... Done.Fetching ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-7-current/All/libgcrypt-1.2.4_1.tbz... Done.Fetching ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-7-current/All/libksba-1.0.1_1.tbz... Done.Fetching ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-7-current/All/dirmngr-0.9.7_2.tbz... Done.###############################################################################                                A T T E N T I O NIn order to use gpg-agent, you need to install a pinentry dialog.The following ports of pinentry dialogs are available:security/pinentry-curses        (ncurses based dialog)security/pinentry-gtk           (GTK 1.2 based dialog)security/pinentry-gtk2          (GTK 2.x based dialog)security/pinentry-qt            (QT based dialog)###############################################################################Wow, that installed more dependencies than I expected.  Here I import the PGP keys from FreeBSD,org.# rehash# fetch http://www.freebsd.org/doc/pgpkeyring.txtpgpkeyring.txt                                100% of 1406 kB  142 kBps 00m00s# gpg --import pgpkeyring.txtgpg: /root/.gnupg/trustdb.gpg: trustdb createdgpg: key CA6CDFB2: public key "FreeBSD Security Officer " importedgpg: key FF8AE305: public key "core-secretary@FreeBSD.org" imported...edited...gpg: key D069F2A0: duplicated user ID detected - mergedgpg: key D069F2A0: public key "Thomas Abthorpe " importedgpg: Total number processed: 262gpg:           w/o user IDs: 1gpg:               imported: 261  (RSA: 36)gpg: no ultimately trusted keys foundWith the keys imported I verify the file I downloaded.# gpg --verify freebsd-update-upgrade.tgz.asc freebsd-update-upgrade.tgzgpg: Signature made Fri Nov 16 09:01:38 2007 EST using DSA key ID CA6CDFB2gpg: Good signature from "FreeBSD Security Officer "gpg: WARNING: This key is not certified with a trusted signature!gpg:          There is no indication that the signature belongs to the owner.Primary key fingerprint: C374 0FC5 69A6 FBB1 4AED  B131 15D6 8804 CA6C DFB2Note I need to generate my own key and sign the FreeBSD Security Officer's key with my generated key if I want to avoid GPG's warnings, i.e.:gpg --gen-keygpg --sign-key security-officer@FreeBSD.orgNow I am ready to proceed with the upgrade.# tar -xf freebsd-update-upgrade.tgz # sh freebsd-update.sh -f freebsd-update.conf -r 7.0-BETA3 upgradeLooking up update.FreeBSD.org mirrors... 1 mirrors found.Fetching public key from update1.FreeBSD.org... done.Fetching metadata signature for 7.0-BETA2 from update1.FreeBSD.org... done.Fetching metadata index... done.Fetching 2 metadata files... done.Inspecting system... done.The following components of FreeBSD seem to be installed:kernel/generic src/base src/bin src/cddl src/contrib src/crypto src/etcsrc/games src/gnu src/include src/krb5 src/lib src/libexec src/releasesrc/rescue src/sbin src/secure src/share src/sys src/tools src/ubinsrc/usbin world/base world/dict world/doc world/games world/infoworld/manpages world/proflibsThe following components of FreeBSD do not seem to be installed:src/compat world/catpagesDoes this look reasonable (y/n)? yFetching metadata signature for 7.0-BETA3 from update1.FreeBSD.org... done.Fetching metadata index... done.Fetching 1 metadata patches. done.Applying metadata patches... done.Fetching 1 metadata files... Inspecting system... done.Preparing to download files... done.Fetching 1289 patches.....10....20....30....40....50....60....70....80....90.......edited...Applying patches... done.Fetching 329 files... done.The following files will be removed as part of updating to 7.0-BETA3-p0:/etc/pf.conf/usr/share/doc/es_ES.ISO8859-1/books/handbook/LEGALNOTICE.html/usr/share/doc/fr_FR.ISO8859-1/books/handbook/x20872.html/usr/share/doc/fr_FR.ISO8859-1/books/handbook/x20918.html/usr/share/doc/fr_FR.ISO8859-1/books/handbook/x21123.html/usr/share/examples/etc/pf.conf/usr/src/etc/pf.confThe following files will be added as part of updating to 7.0-BETA3-p0:/boot/kernel/if_zyd.ko/boot/kernel/if_zyd.ko.symbols...edited.../usr/share/examples/pf/pf.conf/usr/src/share/examples/pf/pf.confThe following files will be updated as part of updating to 7.0-BETA3-p0:/bin/ps/boot/kernel/3dfx.ko...edited.../usr/src/usr.sbin/wpa/wpa_supplicant/driver_freebsd.c/var/named/etc/namedb/named.root# sh freebsd-update.sh -f freebsd-update.conf install Installing updates...Kernel updates have been installed.  Please reboot and run"freebsd-update.sh install" again to finish installing updates.# shutdown -r nowAfter a reboot I run the following.# sh freebsd-update.sh -f freebsd-update.conf install Installing updates... done.# shutdown -r nowAfter a second reboot the system is completely upgraded.$ uname -aFreeBSD myhost.mydomain.com 7.0-BETA3 FreeBSD 7.0-BETA3 #0: Fri Nov 16 22:20:33 UTC 2007      root@logan.cse.buffalo.edu:/usr/obj/usr/src/sys/GENERIC  i386That's excellent.  The whole process took only a few minutes.
